!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=194)}([function(e,t,n){var r=n(1),i=n(7),o=n(16),a=n(13),s=n(20),u=function(e,t,n){var c,l,h,p,f=e&u.F,d=e&u.G,m=e&u.S,v=e&u.P,g=e&u.B,y=d?r:m?r[t]||(r[t]={}):(r[t]||{}).prototype,b=d?i:i[t]||(i[t]={}),x=b.prototype||(b.prototype={});for(c in d&&(n=t),n)h=((l=!f&&y&&void 0!==y[c])?y:n)[c],p=g&&l?s(h,r):v&&"function"==typeof h?s(Function.call,h):h,y&&a(y,c,h,e&u.U),b[c]!=h&&o(b,c,p),v&&x[c]!=h&&(x[c]=h)};r.core=i,u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){var r=n(4);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var r=n(60)("wks"),i=n(33),o=n(1).Symbol,a="function"==typeof o;(e.exports=function(e){return r[e]||(r[e]=a&&o[e]||(a?o:i)("Symbol."+e))}).store=r},function(e,t,n){var r=n(22),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e,t){var n=e.exports={version:"2.6.10"};"number"==typeof __e&&(__e=n)},function(e,t){(function(){e.exports={Element:1,Attribute:2,Text:3,CData:4,EntityReference:5,EntityDeclaration:6,ProcessingInstruction:7,Comment:8,Document:9,DocType:10,DocumentFragment:11,NotationDeclaration:12,Declaration:201,Raw:202,AttributeDeclaration:203,ElementDeclaration:204,Dummy:205}}).call(this)},function(e,t,n){e.exports=!n(2)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t,n){var r=n(3),i=n(129),o=n(30),a=Object.defineProperty;t.f=n(9)?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),i)try{return a(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var r=n(27);e.exports=function(e){return Object(r(e))}},function(e,t,n){"use strict";var r=TypeError,i=function(){throw new r},o=Object.getOwnPropertyDescriptor?function(){try{return arguments.callee,i}catch(e){try{return Object.getOwnPropertyDescriptor(arguments,"callee").get}catch(e){return i}}}():i,a=n(77)(),s=Object.getPrototypeOf||function(e){return e.__proto__},u=void 0,c="undefined"==typeof Uint8Array?void 0:s(Uint8Array),l={"$ %Array%":Array,"$ %ArrayBuffer%":"undefined"==typeof ArrayBuffer?void 0:ArrayBuffer,"$ %ArrayBufferPrototype%":"undefined"==typeof ArrayBuffer?void 0:ArrayBuffer.prototype,"$ %ArrayIteratorPrototype%":a?s([][Symbol.iterator]()):void 0,"$ %ArrayPrototype%":Array.prototype,"$ %ArrayProto_entries%":Array.prototype.entries,"$ %ArrayProto_forEach%":Array.prototype.forEach,"$ %ArrayProto_keys%":Array.prototype.keys,"$ %ArrayProto_values%":Array.prototype.values,"$ %AsyncFromSyncIteratorPrototype%":void 0,"$ %AsyncFunction%":void 0,"$ %AsyncFunctionPrototype%":void 0,"$ %AsyncGenerator%":void 0,"$ %AsyncGeneratorFunction%":void 0,"$ %AsyncGeneratorPrototype%":void 0,"$ %AsyncIteratorPrototype%":u&&a&&Symbol.asyncIterator?u[Symbol.asyncIterator]():void 0,"$ %Atomics%":"undefined"==typeof Atomics?void 0:Atomics,"$ %Boolean%":Boolean,"$ %BooleanPrototype%":Boolean.prototype,"$ %DataView%":"undefined"==typeof DataView?void 0:DataView,"$ %DataViewPrototype%":"undefined"==typeof DataView?void 0:DataView.prototype,"$ %Date%":Date,"$ %DatePrototype%":Date.prototype,"$ %decodeURI%":decodeURI,"$ %decodeURIComponent%":decodeURIComponent,"$ %encodeURI%":encodeURI,"$ %encodeURIComponent%":encodeURIComponent,"$ %Error%":Error,"$ %ErrorPrototype%":Error.prototype,"$ %eval%":eval,"$ %EvalError%":EvalError,"$ %EvalErrorPrototype%":EvalError.prototype,"$ %Float32Array%":"undefined"==typeof Float32Array?void 0:Float32Array,"$ %Float32ArrayPrototype%":"undefined"==typeof Float32Array?void 0:Float32Array.prototype,"$ %Float64Array%":"undefined"==typeof Float64Array?void 0:Float64Array,"$ %Float64ArrayPrototype%":"undefined"==typeof Float64Array?void 0:Float64Array.prototype,"$ %Function%":Function,"$ %FunctionPrototype%":Function.prototype,"$ %Generator%":void 0,"$ %GeneratorFunction%":void 0,"$ %GeneratorPrototype%":void 0,"$ %Int8Array%":"undefined"==typeof Int8Array?void 0:Int8Array,"$ %Int8ArrayPrototype%":"undefined"==typeof Int8Array?void 0:Int8Array.prototype,"$ %Int16Array%":"undefined"==typeof Int16Array?void 0:Int16Array,"$ %Int16ArrayPrototype%":"undefined"==typeof Int16Array?void 0:Int8Array.prototype,"$ %Int32Array%":"undefined"==typeof Int32Array?void 0:Int32Array,"$ %Int32ArrayPrototype%":"undefined"==typeof Int32Array?void 0:Int32Array.prototype,"$ %isFinite%":isFinite,"$ %isNaN%":isNaN,"$ %IteratorPrototype%":a?s(s([][Symbol.iterator]())):void 0,"$ %JSON%":JSON,"$ %JSONParse%":JSON.parse,"$ %Map%":"undefined"==typeof Map?void 0:Map,"$ %MapIteratorPrototype%":"undefined"!=typeof Map&&a?s((new Map)[Symbol.iterator]()):void 0,"$ %MapPrototype%":"undefined"==typeof Map?void 0:Map.prototype,"$ %Math%":Math,"$ %Number%":Number,"$ %NumberPrototype%":Number.prototype,"$ %Object%":Object,"$ %ObjectPrototype%":Object.prototype,"$ %ObjProto_toString%":Object.prototype.toString,"$ %ObjProto_valueOf%":Object.prototype.valueOf,"$ %parseFloat%":parseFloat,"$ %parseInt%":parseInt,"$ %Promise%":"undefined"==typeof Promise?void 0:Promise,"$ %PromisePrototype%":"undefined"==typeof Promise?void 0:Promise.prototype,"$ %PromiseProto_then%":"undefined"==typeof Promise?void 0:Promise.prototype.then,"$ %Promise_all%":"undefined"==typeof Promise?void 0:Promise.all,"$ %Promise_reject%":"undefined"==typeof Promise?void 0:Promise.reject,"$ %Promise_resolve%":"undefined"==typeof Promise?void 0:Promise.resolve,"$ %Proxy%":"undefined"==typeof Proxy?void 0:Proxy,"$ %RangeError%":RangeError,"$ %RangeErrorPrototype%":RangeError.prototype,"$ %ReferenceError%":ReferenceError,"$ %ReferenceErrorPrototype%":ReferenceError.prototype,"$ %Reflect%":"undefined"==typeof Reflect?void 0:Reflect,"$ %RegExp%":RegExp,"$ %RegExpPrototype%":RegExp.prototype,"$ %Set%":"undefined"==typeof Set?void 0:Set,"$ %SetIteratorPrototype%":"undefined"!=typeof Set&&a?s((new Set)[Symbol.iterator]()):void 0,"$ %SetPrototype%":"undefined"==typeof Set?void 0:Set.prototype,"$ %SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?void 0:SharedArrayBuffer,"$ %SharedArrayBufferPrototype%":"undefined"==typeof SharedArrayBuffer?void 0:SharedArrayBuffer.prototype,"$ %String%":String,"$ %StringIteratorPrototype%":a?s(""[Symbol.iterator]()):void 0,"$ %StringPrototype%":String.prototype,"$ %Symbol%":a?Symbol:void 0,"$ %SymbolPrototype%":a?Symbol.prototype:void 0,"$ %SyntaxError%":SyntaxError,"$ %SyntaxErrorPrototype%":SyntaxError.prototype,"$ %ThrowTypeError%":o,"$ %TypedArray%":c,"$ %TypedArrayPrototype%":c?c.prototype:void 0,"$ %TypeError%":r,"$ %TypeErrorPrototype%":r.prototype,"$ %Uint8Array%":"undefined"==typeof Uint8Array?void 0:Uint8Array,"$ %Uint8ArrayPrototype%":"undefined"==typeof Uint8Array?void 0:Uint8Array.prototype,"$ %Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?void 0:Uint8ClampedArray,"$ %Uint8ClampedArrayPrototype%":"undefined"==typeof Uint8ClampedArray?void 0:Uint8ClampedArray.prototype,"$ %Uint16Array%":"undefined"==typeof Uint16Array?void 0:Uint16Array,"$ %Uint16ArrayPrototype%":"undefined"==typeof Uint16Array?void 0:Uint16Array.prototype,"$ %Uint32Array%":"undefined"==typeof Uint32Array?void 0:Uint32Array,"$ %Uint32ArrayPrototype%":"undefined"==typeof Uint32Array?void 0:Uint32Array.prototype,"$ %URIError%":URIError,"$ %URIErrorPrototype%":URIError.prototype,"$ %WeakMap%":"undefined"==typeof WeakMap?void 0:WeakMap,"$ %WeakMapPrototype%":"undefined"==typeof WeakMap?void 0:WeakMap.prototype,"$ %WeakSet%":"undefined"==typeof WeakSet?void 0:WeakSet,"$ %WeakSetPrototype%":"undefined"==typeof WeakSet?void 0:WeakSet.prototype},h=n(127).call(Function.call,String.prototype.replace),p=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,f=/\\(\\)?/g,d=function(e){var t=[];return h(e,p,(function(e,n,r,i){t[t.length]=r?h(i,f,"$1"):n||e})),t},m=function(e,t){var n="$ "+e;if(!(n in l))throw new SyntaxError("intrinsic "+e+" does not exist!");if(void 0===l[n]&&!t)throw new r("intrinsic "+e+" exists, but is not available. Please file an issue!");return l[n]};e.exports=function(e,t){if(arguments.length>1&&"boolean"!=typeof t)throw new TypeError('"allowMissing" argument must be a boolean');var n=d(e);if(0===n.length)return m(e,t);for(var r=m("%"+n[0]+"%",t),i=1;i<n.length;i+=1)null!=r&&(r=r[n[i]]);return r}},function(e,t,n){var r=n(1),i=n(16),o=n(15),a=n(33)("src"),s=n(199),u=(""+s).split("toString");n(7).inspectSource=function(e){return s.call(e)},(e.exports=function(e,t,n,s){var c="function"==typeof n;c&&(o(n,"name")||i(n,"name",t)),e[t]!==n&&(c&&(o(n,a)||i(n,a,e[t]?""+e[t]:u.join(String(t)))),e===r?e[t]=n:s?e[t]?e[t]=n:i(e,t,n):(delete e[t],i(e,t,n)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[a]||s.call(this)}))},function(e,t,n){var r=n(0),i=n(2),o=n(27),a=/"/g,s=function(e,t,n,r){var i=String(o(e)),s="<"+t;return""!==n&&(s+=" "+n+'="'+String(r).replace(a,"&quot;")+'"'),s+">"+i+"</"+t+">"};e.exports=function(e,t){var n={};n[e]=t(s),r(r.P+r.F*i((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3})),"String",n)}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var r=n(10),i=n(32);e.exports=n(9)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var r=n(54),i=n(27);e.exports=function(e){return r(i(e))}},function(e,t,n){(function(){var t,r,i,o,a,s,u,c,l,h,p,f,d,m,v,g,y,b={}.hasOwnProperty;y=n(29),g=y.isObject,v=y.isFunction,m=y.isEmpty,d=y.getValue,c=null,i=null,o=null,a=null,s=null,p=null,f=null,h=null,u=null,r=null,l=null,t=null,e.exports=function(){function e(e){this.parent=e,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.value=null,this.children=[],this.baseURI=null,c||(c=n(107),i=n(109),o=n(110),a=n(111),s=n(112),p=n(117),f=n(118),h=n(119),u=n(165),r=n(8),l=n(388),n(108),t=n(389))}return Object.defineProperty(e.prototype,"nodeName",{get:function(){return this.name}}),Object.defineProperty(e.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(e.prototype,"nodeValue",{get:function(){return this.value}}),Object.defineProperty(e.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(e.prototype,"childNodes",{get:function(){return this.childNodeList&&this.childNodeList.nodes||(this.childNodeList=new l(this.children)),this.childNodeList}}),Object.defineProperty(e.prototype,"firstChild",{get:function(){return this.children[0]||null}}),Object.defineProperty(e.prototype,"lastChild",{get:function(){return this.children[this.children.length-1]||null}}),Object.defineProperty(e.prototype,"previousSibling",{get:function(){var e;return e=this.parent.children.indexOf(this),this.parent.children[e-1]||null}}),Object.defineProperty(e.prototype,"nextSibling",{get:function(){var e;return e=this.parent.children.indexOf(this),this.parent.children[e+1]||null}}),Object.defineProperty(e.prototype,"ownerDocument",{get:function(){return this.document()||null}}),Object.defineProperty(e.prototype,"textContent",{get:function(){var e,t,n,i,o;if(this.nodeType===r.Element||this.nodeType===r.DocumentFragment){for(o="",t=0,n=(i=this.children).length;t<n;t++)(e=i[t]).textContent&&(o+=e.textContent);return o}return null},set:function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),e.prototype.setParent=function(e){var t,n,r,i,o;for(this.parent=e,e&&(this.options=e.options,this.stringify=e.stringify),o=[],n=0,r=(i=this.children).length;n<r;n++)t=i[n],o.push(t.setParent(this));return o},e.prototype.element=function(e,t,n){var r,i,o,a,s,u,c,l,h,p,f;if(u=null,null===t&&null==n&&(t=(h=[{},null])[0],n=h[1]),null==t&&(t={}),t=d(t),g(t)||(n=(p=[t,n])[0],t=p[1]),null!=e&&(e=d(e)),Array.isArray(e))for(o=0,c=e.length;o<c;o++)i=e[o],u=this.element(i);else if(v(e))u=this.element(e.apply());else if(g(e)){for(s in e)if(b.call(e,s))if(f=e[s],v(f)&&(f=f.apply()),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&0===s.indexOf(this.stringify.convertAttKey))u=this.attribute(s.substr(this.stringify.convertAttKey.length),f);else if(!this.options.separateArrayItems&&Array.isArray(f)&&m(f))u=this.dummy();else if(g(f)&&m(f))u=this.element(s);else if(this.options.keepNullNodes||null!=f)if(!this.options.separateArrayItems&&Array.isArray(f))for(a=0,l=f.length;a<l;a++)i=f[a],(r={})[s]=i,u=this.element(r);else g(f)?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===s.indexOf(this.stringify.convertTextKey)?u=this.element(f):(u=this.element(s)).element(f):u=this.element(s,f);else u=this.dummy()}else u=this.options.keepNullNodes||null!==n?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===e.indexOf(this.stringify.convertTextKey)?this.text(n):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&0===e.indexOf(this.stringify.convertCDataKey)?this.cdata(n):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&0===e.indexOf(this.stringify.convertCommentKey)?this.comment(n):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&0===e.indexOf(this.stringify.convertRawKey)?this.raw(n):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&0===e.indexOf(this.stringify.convertPIKey)?this.instruction(e.substr(this.stringify.convertPIKey.length),n):this.node(e,t,n):this.dummy();if(null==u)throw new Error("Could not create any elements with: "+e+". "+this.debugInfo());return u},e.prototype.insertBefore=function(e,t,n){var r,i,o,a,s;if(null!=e?e.type:void 0)return a=t,(o=e).setParent(this),a?(i=children.indexOf(a),s=children.splice(i),children.push(o),Array.prototype.push.apply(children,s)):children.push(o),o;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(e));return i=this.parent.children.indexOf(this),s=this.parent.children.splice(i),r=this.parent.element(e,t,n),Array.prototype.push.apply(this.parent.children,s),r},e.prototype.insertAfter=function(e,t,n){var r,i,o;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(e));return i=this.parent.children.indexOf(this),o=this.parent.children.splice(i+1),r=this.parent.element(e,t,n),Array.prototype.push.apply(this.parent.children,o),r},e.prototype.remove=function(){var e;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return e=this.parent.children.indexOf(this),[].splice.apply(this.parent.children,[e,e-e+1].concat([])),this.parent},e.prototype.node=function(e,t,n){var r,i;return null!=e&&(e=d(e)),t||(t={}),t=d(t),g(t)||(n=(i=[t,n])[0],t=i[1]),r=new c(this,e,t),null!=n&&r.text(n),this.children.push(r),r},e.prototype.text=function(e){var t;return g(e)&&this.element(e),t=new f(this,e),this.children.push(t),this},e.prototype.cdata=function(e){var t;return t=new i(this,e),this.children.push(t),this},e.prototype.comment=function(e){var t;return t=new o(this,e),this.children.push(t),this},e.prototype.commentBefore=function(e){var t,n;return t=this.parent.children.indexOf(this),n=this.parent.children.splice(t),this.parent.comment(e),Array.prototype.push.apply(this.parent.children,n),this},e.prototype.commentAfter=function(e){var t,n;return t=this.parent.children.indexOf(this),n=this.parent.children.splice(t+1),this.parent.comment(e),Array.prototype.push.apply(this.parent.children,n),this},e.prototype.raw=function(e){var t;return t=new p(this,e),this.children.push(t),this},e.prototype.dummy=function(){return new u(this)},e.prototype.instruction=function(e,t){var n,r,i,o,a;if(null!=e&&(e=d(e)),null!=t&&(t=d(t)),Array.isArray(e))for(o=0,a=e.length;o<a;o++)n=e[o],this.instruction(n);else if(g(e))for(n in e)b.call(e,n)&&(r=e[n],this.instruction(n,r));else v(t)&&(t=t.apply()),i=new h(this,e,t),this.children.push(i);return this},e.prototype.instructionBefore=function(e,t){var n,r;return n=this.parent.children.indexOf(this),r=this.parent.children.splice(n),this.parent.instruction(e,t),Array.prototype.push.apply(this.parent.children,r),this},e.prototype.instructionAfter=function(e,t){var n,r;return n=this.parent.children.indexOf(this),r=this.parent.children.splice(n+1),this.parent.instruction(e,t),Array.prototype.push.apply(this.parent.children,r),this},e.prototype.declaration=function(e,t,n){var i,o;return i=this.document(),o=new a(i,e,t,n),0===i.children.length?i.children.unshift(o):i.children[0].type===r.Declaration?i.children[0]=o:i.children.unshift(o),i.root()||i},e.prototype.dtd=function(e,t){var n,i,o,a,u,c,l,h,p;for(n=this.document(),i=new s(n,e,t),o=a=0,c=(h=n.children).length;a<c;o=++a)if(h[o].type===r.DocType)return n.children[o]=i,i;for(o=u=0,l=(p=n.children).length;u<l;o=++u)if(p[o].isRoot)return n.children.splice(o,0,i),i;return n.children.push(i),i},e.prototype.up=function(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent},e.prototype.root=function(){var e;for(e=this;e;){if(e.type===r.Document)return e.rootObject;if(e.isRoot)return e;e=e.parent}},e.prototype.document=function(){var e;for(e=this;e;){if(e.type===r.Document)return e;e=e.parent}},e.prototype.end=function(e){return this.document().end(e)},e.prototype.prev=function(){var e;if((e=this.parent.children.indexOf(this))<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[e-1]},e.prototype.next=function(){var e;if(-1===(e=this.parent.children.indexOf(this))||e===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[e+1]},e.prototype.importDocument=function(e){var t;return(t=e.root().clone()).parent=this,t.isRoot=!1,this.children.push(t),this},e.prototype.debugInfo=function(e){var t,n;return null!=(e=e||this.name)||(null!=(t=this.parent)?t.name:void 0)?null==e?"parent: <"+this.parent.name+">":(null!=(n=this.parent)?n.name:void 0)?"node: <"+e+">, parent: <"+this.parent.name+">":"node: <"+e+">":""},e.prototype.ele=function(e,t,n){return this.element(e,t,n)},e.prototype.nod=function(e,t,n){return this.node(e,t,n)},e.prototype.txt=function(e){return this.text(e)},e.prototype.dat=function(e){return this.cdata(e)},e.prototype.com=function(e){return this.comment(e)},e.prototype.ins=function(e,t){return this.instruction(e,t)},e.prototype.doc=function(){return this.document()},e.prototype.dec=function(e,t,n){return this.declaration(e,t,n)},e.prototype.e=function(e,t,n){return this.element(e,t,n)},e.prototype.n=function(e,t,n){return this.node(e,t,n)},e.prototype.t=function(e){return this.text(e)},e.prototype.d=function(e){return this.cdata(e)},e.prototype.c=function(e){return this.comment(e)},e.prototype.r=function(e){return this.raw(e)},e.prototype.i=function(e,t){return this.instruction(e,t)},e.prototype.u=function(){return this.up()},e.prototype.importXMLBuilder=function(e){return this.importDocument(e)},e.prototype.replaceChild=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.removeChild=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.appendChild=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.hasChildNodes=function(){return 0!==this.children.length},e.prototype.cloneNode=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.normalize=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.isSupported=function(e,t){return!0},e.prototype.hasAttributes=function(){return 0!==this.attribs.length},e.prototype.compareDocumentPosition=function(e){var n;return this,this===e?0:this.document()!==e.document()?(n=t.Disconnected|t.ImplementationSpecific,Math.random()<.5?n|=t.Preceding:n|=t.Following,n):this.isAncestor(e)?t.Contains|t.Preceding:this.isDescendant(e)?t.Contains|t.Following:this.isPreceding(e)?t.Preceding:t.Following},e.prototype.isSameNode=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.lookupPrefix=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.isDefaultNamespace=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.lookupNamespaceURI=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.isEqualNode=function(e){var t,n,r;if(e.nodeType!==this.nodeType)return!1;if(e.children.length!==this.children.length)return!1;for(t=n=0,r=this.children.length-1;0<=r?n<=r:n>=r;t=0<=r?++n:--n)if(!this.children[t].isEqualNode(e.children[t]))return!1;return!0},e.prototype.getFeature=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.setUserData=function(e,t,n){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.getUserData=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.contains=function(e){return!!e&&(e===this||this.isDescendant(e))},e.prototype.isDescendant=function(e){var t,n,r,i;for(n=0,r=(i=this.children).length;n<r;n++){if(e===(t=i[n]))return!0;if(t.isDescendant(e))return!0}return!1},e.prototype.isAncestor=function(e){return e.isDescendant(this)},e.prototype.isPreceding=function(e){var t,n;return t=this.treePosition(e),n=this.treePosition(this),-1!==t&&-1!==n&&t<n},e.prototype.isFollowing=function(e){var t,n;return t=this.treePosition(e),n=this.treePosition(this),-1!==t&&-1!==n&&t>n},e.prototype.treePosition=function(e){var t,n;return n=0,t=!1,this.foreachTreeNode(this.document(),(function(r){if(n++,!t&&r===e)return t=!0})),t?n:-1},e.prototype.foreachTreeNode=function(e,t){var n,r,i,o,a;for(e||(e=this.document()),r=0,i=(o=e.children).length;r<i;r++){if(a=t(n=o[r]))return a;if(a=this.foreachTreeNode(n,t))return a}},e}()}).call(this)},function(e,t,n){"use strict";var r=n(2);e.exports=function(e,t){return!!e&&r((function(){t?e.call(null,(function(){}),1):e.call(null)}))}},function(e,t,n){var r=n(21);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){var r=n(55),i=n(32),o=n(17),a=n(30),s=n(15),u=n(129),c=Object.getOwnPropertyDescriptor;t.f=n(9)?c:function(e,t){if(e=o(e),t=a(t,!0),u)try{return c(e,t)}catch(e){}if(s(e,t))return i(!r.f.call(e,t),e[t])}},function(e,t,n){var r=n(0),i=n(7),o=n(2);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],a={};a[e]=t(n),r(r.S+r.F*o((function(){n(1)})),"Object",a)}},function(e,t,n){var r=n(20),i=n(54),o=n(11),a=n(6),s=n(145);e.exports=function(e,t){var n=1==e,u=2==e,c=3==e,l=4==e,h=6==e,p=5==e||h,f=t||s;return function(t,s,d){for(var m,v,g=o(t),y=i(g),b=r(s,d,3),x=a(y.length),w=0,_=n?f(t,x):u?f(t,0):void 0;x>w;w++)if((p||w in y)&&(v=b(m=y[w],w,g),e))if(n)_[w]=v;else if(v)switch(e){case 3:return!0;case 5:return m;case 6:return w;case 2:_.push(m)}else if(l)return!1;return h?-1:c||l?l:_}}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){"use strict";if(n(9)){var r=n(34),i=n(1),o=n(2),a=n(0),s=n(71),u=n(102),c=n(20),l=n(48),h=n(32),p=n(16),f=n(49),d=n(22),m=n(6),v=n(156),g=n(36),y=n(30),b=n(15),x=n(56),w=n(4),_=n(11),T=n(94),S=n(37),M=n(39),E=n(38).f,A=n(96),P=n(33),O=n(5),L=n(25),I=n(61),C=n(57),R=n(98),D=n(46),N=n(64),F=n(47),j=n(97),U=n(147),B=n(10),k=n(23),z=B.f,G=k.f,V=i.RangeError,H=i.TypeError,W=i.Uint8Array,X=Array.prototype,Y=u.ArrayBuffer,q=u.DataView,Q=L(0),Z=L(2),K=L(3),J=L(4),$=L(5),ee=L(6),te=I(!0),ne=I(!1),re=R.values,ie=R.keys,oe=R.entries,ae=X.lastIndexOf,se=X.reduce,ue=X.reduceRight,ce=X.join,le=X.sort,he=X.slice,pe=X.toString,fe=X.toLocaleString,de=O("iterator"),me=O("toStringTag"),ve=P("typed_constructor"),ge=P("def_constructor"),ye=s.CONSTR,be=s.TYPED,xe=s.VIEW,we=L(1,(function(e,t){return Ee(C(e,e[ge]),t)})),_e=o((function(){return 1===new W(new Uint16Array([1]).buffer)[0]})),Te=!!W&&!!W.prototype.set&&o((function(){new W(1).set({})})),Se=function(e,t){var n=d(e);if(n<0||n%t)throw V("Wrong offset!");return n},Me=function(e){if(w(e)&&be in e)return e;throw H(e+" is not a typed array!")},Ee=function(e,t){if(!(w(e)&&ve in e))throw H("It is not a typed array constructor!");return new e(t)},Ae=function(e,t){return Pe(C(e,e[ge]),t)},Pe=function(e,t){for(var n=0,r=t.length,i=Ee(e,r);r>n;)i[n]=t[n++];return i},Oe=function(e,t,n){z(e,t,{get:function(){return this._d[n]}})},Le=function(e){var t,n,r,i,o,a,s=_(e),u=arguments.length,l=u>1?arguments[1]:void 0,h=void 0!==l,p=A(s);if(null!=p&&!T(p)){for(a=p.call(s),r=[],t=0;!(o=a.next()).done;t++)r.push(o.value);s=r}for(h&&u>2&&(l=c(l,arguments[2],2)),t=0,n=m(s.length),i=Ee(this,n);n>t;t++)i[t]=h?l(s[t],t):s[t];return i},Ie=function(){for(var e=0,t=arguments.length,n=Ee(this,t);t>e;)n[e]=arguments[e++];return n},Ce=!!W&&o((function(){fe.call(new W(1))})),Re=function(){return fe.apply(Ce?he.call(Me(this)):Me(this),arguments)},De={copyWithin:function(e,t){return U.call(Me(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return J(Me(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return j.apply(Me(this),arguments)},filter:function(e){return Ae(this,Z(Me(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return $(Me(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return ee(Me(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){Q(Me(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return ne(Me(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return te(Me(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return ce.apply(Me(this),arguments)},lastIndexOf:function(e){return ae.apply(Me(this),arguments)},map:function(e){return we(Me(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return se.apply(Me(this),arguments)},reduceRight:function(e){return ue.apply(Me(this),arguments)},reverse:function(){for(var e,t=Me(this).length,n=Math.floor(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this},some:function(e){return K(Me(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return le.call(Me(this),e)},subarray:function(e,t){var n=Me(this),r=n.length,i=g(e,r);return new(C(n,n[ge]))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,m((void 0===t?r:g(t,r))-i))}},Ne=function(e,t){return Ae(this,he.call(Me(this),e,t))},Fe=function(e){Me(this);var t=Se(arguments[1],1),n=this.length,r=_(e),i=m(r.length),o=0;if(i+t>n)throw V("Wrong length!");for(;o<i;)this[t+o]=r[o++]},je={entries:function(){return oe.call(Me(this))},keys:function(){return ie.call(Me(this))},values:function(){return re.call(Me(this))}},Ue=function(e,t){return w(e)&&e[be]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Be=function(e,t){return Ue(e,t=y(t,!0))?h(2,e[t]):G(e,t)},ke=function(e,t,n){return!(Ue(e,t=y(t,!0))&&w(n)&&b(n,"value"))||b(n,"get")||b(n,"set")||n.configurable||b(n,"writable")&&!n.writable||b(n,"enumerable")&&!n.enumerable?z(e,t,n):(e[t]=n.value,e)};ye||(k.f=Be,B.f=ke),a(a.S+a.F*!ye,"Object",{getOwnPropertyDescriptor:Be,defineProperty:ke}),o((function(){pe.call({})}))&&(pe=fe=function(){return ce.call(this)});var ze=f({},De);f(ze,je),p(ze,de,je.values),f(ze,{slice:Ne,set:Fe,constructor:function(){},toString:pe,toLocaleString:Re}),Oe(ze,"buffer","b"),Oe(ze,"byteOffset","o"),Oe(ze,"byteLength","l"),Oe(ze,"length","e"),z(ze,me,{get:function(){return this[be]}}),e.exports=function(e,t,n,u){var c=e+((u=!!u)?"Clamped":"")+"Array",h="get"+e,f="set"+e,d=i[c],g=d||{},y=d&&M(d),b=!d||!s.ABV,_={},T=d&&d.prototype,A=function(e,n){z(e,n,{get:function(){return function(e,n){var r=e._d;return r.v[h](n*t+r.o,_e)}(this,n)},set:function(e){return function(e,n,r){var i=e._d;u&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),i.v[f](n*t+i.o,r,_e)}(this,n,e)},enumerable:!0})};b?(d=n((function(e,n,r,i){l(e,d,c,"_d");var o,a,s,u,h=0,f=0;if(w(n)){if(!(n instanceof Y||"ArrayBuffer"==(u=x(n))||"SharedArrayBuffer"==u))return be in n?Pe(d,n):Le.call(d,n);o=n,f=Se(r,t);var g=n.byteLength;if(void 0===i){if(g%t)throw V("Wrong length!");if((a=g-f)<0)throw V("Wrong length!")}else if((a=m(i)*t)+f>g)throw V("Wrong length!");s=a/t}else s=v(n),o=new Y(a=s*t);for(p(e,"_d",{b:o,o:f,l:a,e:s,v:new q(o)});h<s;)A(e,h++)})),T=d.prototype=S(ze),p(T,"constructor",d)):o((function(){d(1)}))&&o((function(){new d(-1)}))&&N((function(e){new d,new d(null),new d(1.5),new d(e)}),!0)||(d=n((function(e,n,r,i){var o;return l(e,d,c),w(n)?n instanceof Y||"ArrayBuffer"==(o=x(n))||"SharedArrayBuffer"==o?void 0!==i?new g(n,Se(r,t),i):void 0!==r?new g(n,Se(r,t)):new g(n):be in n?Pe(d,n):Le.call(d,n):new g(v(n))})),Q(y!==Function.prototype?E(g).concat(E(y)):E(g),(function(e){e in d||p(d,e,g[e])})),d.prototype=T,r||(T.constructor=d));var P=T[de],O=!!P&&("values"==P.name||null==P.name),L=je.values;p(d,ve,!0),p(T,be,c),p(T,xe,!0),p(T,ge,d),(u?new d(1)[me]==c:me in T)||z(T,me,{get:function(){return c}}),_[c]=d,a(a.G+a.W+a.F*(d!=g),_),a(a.S,c,{BYTES_PER_ELEMENT:t}),a(a.S+a.F*o((function(){g.of.call(d,1)})),c,{from:Le,of:Ie}),"BYTES_PER_ELEMENT"in T||p(T,"BYTES_PER_ELEMENT",t),a(a.P,c,De),F(c),a(a.P+a.F*Te,c,{set:Fe}),a(a.P+a.F*!O,c,je),r||T.toString==pe||(T.toString=pe),a(a.P+a.F*o((function(){new d(1).slice()})),c,{slice:Ne}),a(a.P+a.F*(o((function(){return[1,2].toLocaleString()!=new d([1,2]).toLocaleString()}))||!o((function(){T.toLocaleString.call([1,2])}))),c,{toLocaleString:Re}),D[c]=O?P:L,r||O||p(T,de,L)}}else e.exports=function(){}},function(e,t){(function(){var t,n,r,i,o,a,s,u=[].slice,c={}.hasOwnProperty;t=function(){var e,t,n,r,i,a;if(a=arguments[0],i=2<=arguments.length?u.call(arguments,1):[],o(Object.assign))Object.assign.apply(null,arguments);else for(e=0,n=i.length;e<n;e++)if(null!=(r=i[e]))for(t in r)c.call(r,t)&&(a[t]=r[t]);return a},o=function(e){return!!e&&"[object Function]"===Object.prototype.toString.call(e)},a=function(e){var t;return!!e&&("function"==(t=typeof e)||"object"===t)},r=function(e){return o(Array.isArray)?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},i=function(e){var t;if(r(e))return!e.length;for(t in e)if(c.call(e,t))return!1;return!0},s=function(e){var t,n;return a(e)&&(n=Object.getPrototypeOf(e))&&(t=n.constructor)&&"function"==typeof t&&t instanceof t&&Function.prototype.toString.call(t)===Function.prototype.toString.call(Object)},n=function(e){return o(e.valueOf)?e.valueOf():e},e.exports.assign=t,e.exports.isFunction=o,e.exports.isObject=a,e.exports.isArray=r,e.exports.isEmpty=i,e.exports.isPlainObject=s,e.exports.getValue=n}).call(this)},function(e,t,n){var r=n(4);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var r=n(33)("meta"),i=n(4),o=n(15),a=n(10).f,s=0,u=Object.isExtensible||function(){return!0},c=!n(2)((function(){return u(Object.preventExtensions({}))})),l=function(e){a(e,r,{value:{i:"O"+ ++s,w:{}}})},h=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,r)){if(!u(e))return"F";if(!t)return"E";l(e)}return e[r].i},getWeak:function(e,t){if(!o(e,r)){if(!u(e))return!0;if(!t)return!1;l(e)}return e[r].w},onFreeze:function(e){return c&&h.NEED&&u(e)&&!o(e,r)&&l(e),e}}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t){e.exports=!1},function(e,t,n){var r=n(131),i=n(81);e.exports=Object.keys||function(e){return r(e,i)}},function(e,t,n){var r=n(22),i=Math.max,o=Math.min;e.exports=function(e,t){return(e=r(e))<0?i(e+t,0):o(e,t)}},function(e,t,n){var r=n(3),i=n(132),o=n(81),a=n(80)("IE_PROTO"),s=function(){},u=function(){var e,t=n(78)("iframe"),r=o.length;for(t.style.display="none",n(82).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),u=e.F;r--;)delete u.prototype[o[r]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(s.prototype=r(e),n=new s,s.prototype=null,n[a]=e):n=u(),void 0===t?n:i(n,t)}},function(e,t,n){var r=n(131),i=n(81).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},function(e,t,n){var r=n(15),i=n(11),o=n(80)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t,n){var r=n(5)("unscopables"),i=Array.prototype;null==i[r]&&n(16)(i,r,{}),e.exports=function(e){i[r][e]=!0}},function(e,t,n){var r=n(4);e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var r=n(76),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=h;var o=n(58);o.inherits=n(51);var a=n(169),s=n(123);o.inherits(h,a);for(var u=i(s.prototype),c=0;c<u.length;c++){var l=u[c];h.prototype[l]||(h.prototype[l]=s.prototype[l])}function h(e){if(!(this instanceof h))return new h(e);a.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",p)}function p(){this.allowHalfOpen||this._writableState.ended||r.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(h.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(h.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),h.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},function(e,t,n){var r=n(10).f,i=n(15),o=n(5)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},function(e,t,n){var r=n(0),i=n(27),o=n(2),a=n(84),s="["+a+"]",u=RegExp("^"+s+s+"*"),c=RegExp(s+s+"*$"),l=function(e,t,n){var i={},s=o((function(){return!!a[e]()||"​"!="​"[e]()})),u=i[e]=s?t(h):a[e];n&&(i[n]=u),r(r.P+r.F*s,"String",i)},h=l.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(u,"")),2&t&&(e=e.replace(c,"")),e};e.exports=l},function(e,t){e.exports={}},function(e,t,n){"use strict";var r=n(1),i=n(10),o=n(9),a=n(5)("species");e.exports=function(e){var t=r[e];o&&t&&!t[a]&&i.f(t,a,{configurable:!0,get:function(){return this}})}},function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var r=n(13);e.exports=function(e,t,n){for(var i in t)r(e,i,t[i],n);return e}},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var u,c=[],l=!1,h=-1;function p(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&f())}function f(){if(!l){var e=s(p);l=!0;for(var t=c.length;t;){for(u=c,c=[];++h<t;)u&&u[h].run();h=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new d(e,t)),1!==c.length||l||s(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},function(e,t,n){"use strict";var r=n(127);e.exports=r.call(Function.call,Object.prototype.hasOwnProperty)},function(e,t,n){"use strict";var r=n(12),i=n(188),o=i(r("String.prototype.indexOf"));e.exports=function(e,t){var n=r(e,!!t);return"function"==typeof n&&o(e,".prototype.")?i(n):n}},function(e,t,n){var r=n(26);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){var r=n(26),i=n(5)("toStringTag"),o="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:o?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t,n){var r=n(3),i=n(21),o=n(5)("species");e.exports=function(e,t){var n,a=r(e).constructor;return void 0===a||null==(n=r(a)[o])?t:i(n)}},function(e,t,n){(function(e){function n(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===n(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===n(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===n(e)},t.isError=function(e){return"[object Error]"===n(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer}).call(this,n(74).Buffer)},function(e,t,n){"use strict";(function(e){var n=function(){this._tweens={},this._tweensAddedDuringUpdate={}};n.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var n=Object.keys(this._tweens);if(0===n.length)return!1;for(e=void 0!==e?e:i.now();n.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var o=this._tweens[n[r]];o&&!1===o.update(e)&&(o._isPlaying=!1,t||delete this._tweens[n[r]])}n=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var r,i=new n;i.Group=n,i._nextId=0,i.nextId=function(){return i._nextId++},"undefined"==typeof self&&void 0!==e&&e.hrtime?i.now=function(){var t=e.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?i.now=self.performance.now.bind(self.performance):void 0!==Date.now?i.now=Date.now:i.now=function(){return(new Date).getTime()},i.Tween=function(e,t){this._isPaused=!1,this._pauseStart=null,this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=i.Easing.Linear.None,this._interpolationFunction=i.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onRepeatCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||i,this._id=i.nextId()},i.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},isPaused:function(){return this._isPaused},to:function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},duration:function(e){return this._duration=e,this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?i.now()+parseFloat(e):e:i.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(void 0===this._valuesStart[t]&&(this._valuesStart[t]=this._object[t]),this._valuesStart[t]instanceof Array==!1&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(1/0),this},pause:function(e){return this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=void 0===e?i.now():e,this._group.remove(this),this)},resume:function(e){return this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=(void 0===e?i.now():e)-this._pauseStart,this._pauseStart=0,this._group.add(this),this):this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onRepeat:function(e){return this._onRepeatCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,n,r;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),n=(e-this._startTime)/this._duration,n=0===this._duration||n>1?1:n,r=this._easingFunction(n),this._valuesEnd)if(void 0!==this._valuesStart[t]){var i=this._valuesStart[t]||0,o=this._valuesEnd[t];o instanceof Array?this._object[t]=this._interpolationFunction(o,r):("string"==typeof o&&(o="+"===o.charAt(0)||"-"===o.charAt(0)?i+parseFloat(o):parseFloat(o)),"number"==typeof o&&(this._object[t]=i+(o-i)*r))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object,n),1===n){if(this._repeat>0){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var a=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=a}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,null!==this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,u=this._chainedTweens.length;s<u;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}return!0}},i.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-i.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*i.Easing.Bounce.In(2*e):.5*i.Easing.Bounce.Out(2*e-1)+.5}}},i.Interpolation={Linear:function(e,t){var n=e.length-1,r=n*t,o=Math.floor(r),a=i.Interpolation.Utils.Linear;return t<0?a(e[0],e[1],r):t>1?a(e[n],e[n-1],n-r):a(e[o],e[o+1>n?n:o+1],r-o)},Bezier:function(e,t){for(var n=0,r=e.length-1,o=Math.pow,a=i.Interpolation.Utils.Bernstein,s=0;s<=r;s++)n+=o(1-t,r-s)*o(t,s)*e[s]*a(r,s);return n},CatmullRom:function(e,t){var n=e.length-1,r=n*t,o=Math.floor(r),a=i.Interpolation.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(o=Math.floor(r=n*(1+t))),a(e[(o-1+n)%n],e[o],e[(o+1)%n],e[(o+2)%n],r-o)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[n]-(a(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):a(e[o?o-1:0],e[o],e[n<o+1?n:o+1],e[n<o+2?n:o+2],r-o)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=i.Interpolation.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:(r=[1],function(e){var t=1;if(r[e])return r[e];for(var n=e;n>1;n--)t*=n;return r[e]=t,t}),CatmullRom:function(e,t,n,r,i){var o=.5*(n-e),a=.5*(r-t),s=i*i;return(2*t-2*n+o+a)*(i*s)+(-3*t+3*n-2*o-a)*s+o*i+t}}},i.version="18.5.0",t.a=i}).call(this,n(50))},function(e,t,n){var r=n(7),i=n(1),o=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(34)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t,n){var r=n(17),i=n(6),o=n(36);e.exports=function(e){return function(t,n,a){var s,u=r(t),c=i(u.length),l=o(a,c);if(e&&n!=n){for(;c>l;)if((s=u[l++])!=s)return!0}else for(;c>l;l++)if((e||l in u)&&u[l]===n)return e||l||0;return!e&&-1}}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var r=n(26);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){var r=n(5)("iterator"),i=!1;try{var o=[7][r]();o.return=function(){i=!0},Array.from(o,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var o=[7],a=o[r]();a.next=function(){return{done:n=!0}},o[r]=function(){return a},e(o)}catch(e){}return n}},function(e,t,n){"use strict";var r=n(3);e.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,n){"use strict";var r=n(56),i=RegExp.prototype.exec;e.exports=function(e,t){var n=e.exec;if("function"==typeof n){var o=n.call(e,t);if("object"!=typeof o)throw new TypeError("RegExp exec method returned something other than an Object or null");return o}if("RegExp"!==r(e))throw new TypeError("RegExp#exec called on incompatible receiver");return i.call(e,t)}},function(e,t,n){"use strict";n(149);var r=n(13),i=n(16),o=n(2),a=n(27),s=n(5),u=n(99),c=s("species"),l=!o((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),h=function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2===n.length&&"a"===n[0]&&"b"===n[1]}();e.exports=function(e,t,n){var p=s(e),f=!o((function(){var t={};return t[p]=function(){return 7},7!=""[e](t)})),d=f?!o((function(){var t=!1,n=/a/;return n.exec=function(){return t=!0,null},"split"===e&&(n.constructor={},n.constructor[c]=function(){return n}),n[p](""),!t})):void 0;if(!f||!d||"replace"===e&&!l||"split"===e&&!h){var m=/./[p],v=n(a,p,""[e],(function(e,t,n,r,i){return t.exec===u?f&&!i?{done:!0,value:m.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}})),g=v[0],y=v[1];r(String.prototype,e,g),i(RegExp.prototype,p,2==t?function(e,t){return y.call(e,this,t)}:function(e){return y.call(e,this)})}}},function(e,t,n){var r=n(20),i=n(144),o=n(94),a=n(3),s=n(6),u=n(96),c={},l={};(t=e.exports=function(e,t,n,h,p){var f,d,m,v,g=p?function(){return e}:u(e),y=r(n,h,t?2:1),b=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(o(g)){for(f=s(e.length);f>b;b++)if((v=t?y(a(d=e[b])[0],d[1]):y(e[b]))===c||v===l)return v}else for(m=g.call(e);!(d=m.next()).done;)if((v=i(m,y,d.value,t))===c||v===l)return v}).BREAK=c,t.RETURN=l},function(e,t,n){var r=n(1).navigator;e.exports=r&&r.userAgent||""},function(e,t,n){"use strict";var r=n(1),i=n(0),o=n(13),a=n(49),s=n(31),u=n(68),c=n(48),l=n(4),h=n(2),p=n(64),f=n(44),d=n(85);e.exports=function(e,t,n,m,v,g){var y=r[e],b=y,x=v?"set":"add",w=b&&b.prototype,_={},T=function(e){var t=w[e];o(w,e,"delete"==e?function(e){return!(g&&!l(e))&&t.call(this,0===e?0:e)}:"has"==e?function(e){return!(g&&!l(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return g&&!l(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,n){return t.call(this,0===e?0:e,n),this})};if("function"==typeof b&&(g||w.forEach&&!h((function(){(new b).entries().next()})))){var S=new b,M=S[x](g?{}:-0,1)!=S,E=h((function(){S.has(1)})),A=p((function(e){new b(e)})),P=!g&&h((function(){for(var e=new b,t=5;t--;)e[x](t,t);return!e.has(-0)}));A||((b=t((function(t,n){c(t,b,e);var r=d(new y,t,b);return null!=n&&u(n,v,r[x],r),r}))).prototype=w,w.constructor=b),(E||P)&&(T("delete"),T("has"),v&&T("get")),(P||M)&&T(x),g&&w.clear&&delete w.clear}else b=m.getConstructor(t,e,v,x),a(b.prototype,n),s.NEED=!0;return f(b,e),_[e]=b,i(i.G+i.W+i.F*(b!=y),_),g||m.setStrong(b,e,v),b}},function(e,t,n){for(var r,i=n(1),o=n(16),a=n(33),s=a("typed_array"),u=a("view"),c=!(!i.ArrayBuffer||!i.DataView),l=c,h=0,p="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");h<9;)(r=i[p[h++]])?(o(r.prototype,s,!0),o(r.prototype,u,!0)):l=!1;e.exports={ABV:c,CONSTR:l,TYPED:s,VIEW:u}},function(e,t,n){(function(){var t,r={}.hasOwnProperty;t=n(18),e.exports=function(e){function t(e){t.__super__.constructor.call(this,e),this.value=""}return function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this.value},set:function(e){return this.value=e||""}}),Object.defineProperty(t.prototype,"length",{get:function(){return this.value.length}}),Object.defineProperty(t.prototype,"textContent",{get:function(){return this.value},set:function(e){return this.value=e||""}}),t.prototype.clone=function(){return Object.create(this)},t.prototype.substringData=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},t.prototype.appendData=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},t.prototype.insertData=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},t.prototype.deleteData=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},t.prototype.replaceData=function(e,t,n){throw new Error("This DOM method is not implemented."+this.debugInfo())},t.prototype.isEqualNode=function(e){return!!t.__super__.isEqualNode.apply(this,arguments).isEqualNode(e)&&e.data===this.data},t}(t)}).call(this)},function(e,t){(function(){e.exports={None:0,OpenTag:1,InsideTag:2,CloseTag:3}}).call(this)},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var r=n(394),i=n(395),o=n(168);function a(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,n){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return c(this,e,t,n)}function c(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=p(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|d(t,n),i=(e=s(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(u.isBuffer(t)){var n=0|f(t.length);return 0===(e=s(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?s(e,0):p(e,t);if("Buffer"===t.type&&o(t.data))return p(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(l(t),e=s(e,t<0?0:0|f(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function p(e,t){var n=t.length<0?0:0|f(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function d(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return z(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return G(e).length;default:if(r)return z(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return L(this,t,n);case"utf8":case"utf-8":return E(this,t,n);case"ascii":return P(this,t,n);case"latin1":case"binary":return O(this,t,n);case"base64":return M(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function v(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){var o,a=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,s/=2,u/=2,n/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var l=-1;for(o=n;o<s;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*a}else-1!==l&&(o-=o-l),l=-1}else for(n+u>s&&(n=s-u),o=n;o>=0;o--){for(var h=!0,p=0;p<u;p++)if(c(e,o+p)!==c(t,p)){h=!1;break}if(h)return o}return-1}function b(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function x(e,t,n,r){return V(z(t,e.length-n),e,n,r)}function w(e,t,n,r){return V(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function _(e,t,n,r){return w(e,t,n,r)}function T(e,t,n,r){return V(G(t),e,n,r)}function S(e,t,n,r){return V(function(e,t){for(var n,r,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function M(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function E(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,a,s,u,c=e[i],l=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=n)switch(h){case 1:c<128&&(l=c);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(u=(15&c)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(u=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,h=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=h}return function(e){var t=e.length;if(t<=A)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=A));return n}(r)}t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=a(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return c(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?s(e,t):void 0!==n?"string"==typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},u.allocUnsafe=function(e){return h(null,e)},u.allocUnsafeSlow=function(e){return h(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=u.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var a=e[n];if(!u.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,i),i+=a.length}return r},u.byteLength=d,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?E(this,0,e):m.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,r,i){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),a=(n>>>=0)-(t>>>=0),s=Math.min(o,a),c=this.slice(r,i),l=e.slice(t,n),h=0;h<s;++h)if(c[h]!==l[h]){o=c[h],a=l[h];break}return o<a?-1:a<o?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return x(this,e,t,n);case"ascii":return w(this,e,t,n);case"latin1":case"binary":return _(this,e,t,n);case"base64":return T(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var A=4096;function P(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function O(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function L(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=k(e[o]);return i}function I(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function C(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,n,r,i,o){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function D(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function N(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function F(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function j(e,t,n,r,o){return o||F(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function U(e,t,n,r,o){return o||F(e,0,n,8),i.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=u.prototype;else{var i=t-e;n=new u(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},u.prototype.readUInt8=function(e,t){return t||C(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||C(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||C(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||C(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||C(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},u.prototype.readInt8=function(e,t){return t||C(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||C(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){t||C(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return t||C(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||C(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||C(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||C(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||C(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||C(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||R(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||R(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):N(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);R(this,e,t,n,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);R(this,e,t,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):N(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return j(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return j(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return U(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return U(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},u.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var a=u.isBuffer(e)?e:z(new u(e,r).toString()),s=a.length;for(o=0;o<n-t;++o)this[o+t]=a[o%s]}return this};var B=/[^+\/0-9A-Za-z-_]/g;function k(e){return e<16?"0"+e.toString(16):e.toString(16)}function z(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function G(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(B,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function V(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(42))},function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var u=10;function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function l(e,t,n,r){var i,o,a,s;if("function"!=typeof n)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n);if(void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=c(e))>0&&a.length>i&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,s=u,console&&console.warn&&console.warn(s)}return e}function h(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,o(this.listener,this.target,e))}function p(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=h.bind(r);return i.listener=n,r.wrapFn=i,i}function f(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):m(i,i.length)}function d(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var u=i[e];if(void 0===u)return!1;if("function"==typeof u)o(u,this,t);else{var c=u.length,l=m(u,c);for(n=0;n<c;++n)o(l[n],this,t)}return!0},s.prototype.addListener=function(e,t){return l(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return l(this,e,t,!0)},s.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,p(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,p(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,i,o,a;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return f(this,e,!0)},s.prototype.rawListeners=function(e){return f(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},s.prototype.listenerCount=d,s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";(function(t){void 0===t||!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:function(e,n,r,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var o,a,s=arguments.length;switch(s){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick((function(){e.call(null,n)}));case 3:return t.nextTick((function(){e.call(null,n,r)}));case 4:return t.nextTick((function(){e.call(null,n,r,i)}));default:for(o=new Array(s-1),a=0;a<o.length;)o[a++]=arguments[a];return t.nextTick((function(){e.apply(null,o)}))}}}:e.exports=t}).call(this,n(50))},function(e,t,n){"use strict";(function(t){var r=t.Symbol,i=n(422);e.exports=function(){return"function"==typeof r&&("function"==typeof Symbol&&("symbol"==typeof r("foo")&&("symbol"==typeof Symbol("bar")&&i())))}}).call(this,n(42))},function(e,t,n){var r=n(4),i=n(1).document,o=r(i)&&r(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,n){t.f=n(5)},function(e,t,n){var r=n(60)("keys"),i=n(33);e.exports=function(e){return r[e]||(r[e]=i(e))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var r=n(1).document;e.exports=r&&r.documentElement},function(e,t,n){var r=n(4),i=n(3),o=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=n(20)(Function.call,n(23).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return o(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:o}},function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(e,t,n){var r=n(4),i=n(83).set;e.exports=function(e,t,n){var o,a=t.constructor;return a!==n&&"function"==typeof a&&(o=a.prototype)!==n.prototype&&r(o)&&i&&i(e,o),e}},function(e,t,n){"use strict";var r=n(22),i=n(27);e.exports=function(e){var t=String(i(this)),n="",o=r(e);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(n+=t);return n}},function(e,t){e.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},function(e,t){var n=Math.expm1;e.exports=!n||n(10)>22025.465794806718||n(10)<22025.465794806718||-2e-17!=n(-2e-17)?function(e){return 0==(e=+e)?e:e>-1e-6&&e<1e-6?e+e*e/2:Math.exp(e)-1}:n},function(e,t,n){var r=n(22),i=n(27);e.exports=function(e){return function(t,n){var o,a,s=String(i(t)),u=r(n),c=s.length;return u<0||u>=c?e?"":void 0:(o=s.charCodeAt(u))<55296||o>56319||u+1===c||(a=s.charCodeAt(u+1))<56320||a>57343?e?s.charAt(u):o:e?s.slice(u,u+2):a-56320+(o-55296<<10)+65536}}},function(e,t,n){"use strict";var r=n(34),i=n(0),o=n(13),a=n(16),s=n(46),u=n(143),c=n(44),l=n(39),h=n(5)("iterator"),p=!([].keys&&"next"in[].keys()),f=function(){return this};e.exports=function(e,t,n,d,m,v,g){u(n,t,d);var y,b,x,w=function(e){if(!p&&e in M)return M[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},_=t+" Iterator",T="values"==m,S=!1,M=e.prototype,E=M[h]||M["@@iterator"]||m&&M[m],A=E||w(m),P=m?T?w("entries"):A:void 0,O="Array"==t&&M.entries||E;if(O&&(x=l(O.call(new e)))!==Object.prototype&&x.next&&(c(x,_,!0),r||"function"==typeof x[h]||a(x,h,f)),T&&E&&"values"!==E.name&&(S=!0,A=function(){return E.call(this)}),r&&!g||!p&&!S&&M[h]||a(M,h,A),s[t]=A,s[_]=f,m)if(y={values:T?A:w("values"),keys:v?A:w("keys"),entries:P},g)for(b in y)b in M||o(M,b,y[b]);else i(i.P+i.F*(p||S),t,y);return y}},function(e,t,n){var r=n(92),i=n(27);e.exports=function(e,t,n){if(r(t))throw TypeError("String#"+n+" doesn't accept regex!");return String(i(e))}},function(e,t,n){var r=n(4),i=n(26),o=n(5)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},function(e,t,n){var r=n(5)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,!"/./"[e](t)}catch(e){}}return!0}},function(e,t,n){var r=n(46),i=n(5)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||o[i]===e)}},function(e,t,n){"use strict";var r=n(10),i=n(32);e.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},function(e,t,n){var r=n(56),i=n(5)("iterator"),o=n(46);e.exports=n(7).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||o[r(e)]}},function(e,t,n){"use strict";var r=n(11),i=n(36),o=n(6);e.exports=function(e){for(var t=r(this),n=o(t.length),a=arguments.length,s=i(a>1?arguments[1]:void 0,n),u=a>2?arguments[2]:void 0,c=void 0===u?n:i(u,n);c>s;)t[s++]=e;return t}},function(e,t,n){"use strict";var r=n(40),i=n(148),o=n(46),a=n(17);e.exports=n(90)(Array,"Array",(function(e,t){this._t=a(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])}),"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},function(e,t,n){"use strict";var r,i,o=n(65),a=RegExp.prototype.exec,s=String.prototype.replace,u=a,c=(r=/a/,i=/b*/g,a.call(r,"a"),a.call(i,"a"),0!==r.lastIndex||0!==i.lastIndex),l=void 0!==/()??/.exec("")[1];(c||l)&&(u=function(e){var t,n,r,i,u=this;return l&&(n=new RegExp("^"+u.source+"$(?!\\s)",o.call(u))),c&&(t=u.lastIndex),r=a.call(u,e),c&&r&&(u.lastIndex=u.global?r.index+r[0].length:t),l&&r&&r.length>1&&s.call(r[0],n,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)})),r}),e.exports=u},function(e,t,n){"use strict";var r=n(89)(!0);e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},function(e,t,n){var r,i,o,a=n(20),s=n(137),u=n(82),c=n(78),l=n(1),h=l.process,p=l.setImmediate,f=l.clearImmediate,d=l.MessageChannel,m=l.Dispatch,v=0,g={},y=function(){var e=+this;if(g.hasOwnProperty(e)){var t=g[e];delete g[e],t()}},b=function(e){y.call(e.data)};p&&f||(p=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return g[++v]=function(){s("function"==typeof e?e:Function(e),t)},r(v),v},f=function(e){delete g[e]},"process"==n(26)(h)?r=function(e){h.nextTick(a(y,e,1))}:m&&m.now?r=function(e){m.now(a(y,e,1))}:d?(o=(i=new d).port2,i.port1.onmessage=b,r=a(o.postMessage,o,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",b,!1)):r="onreadystatechange"in c("script")?function(e){u.appendChild(c("script")).onreadystatechange=function(){u.removeChild(this),y.call(e)}}:function(e){setTimeout(a(y,e,1),0)}),e.exports={set:p,clear:f}},function(e,t,n){"use strict";var r=n(1),i=n(9),o=n(34),a=n(71),s=n(16),u=n(49),c=n(2),l=n(48),h=n(22),p=n(6),f=n(156),d=n(38).f,m=n(10).f,v=n(97),g=n(44),y="prototype",b="Wrong index!",x=r.ArrayBuffer,w=r.DataView,_=r.Math,T=r.RangeError,S=r.Infinity,M=x,E=_.abs,A=_.pow,P=_.floor,O=_.log,L=_.LN2,I=i?"_b":"buffer",C=i?"_l":"byteLength",R=i?"_o":"byteOffset";function D(e,t,n){var r,i,o,a=new Array(n),s=8*n-t-1,u=(1<<s)-1,c=u>>1,l=23===t?A(2,-24)-A(2,-77):0,h=0,p=e<0||0===e&&1/e<0?1:0;for((e=E(e))!=e||e===S?(i=e!=e?1:0,r=u):(r=P(O(e)/L),e*(o=A(2,-r))<1&&(r--,o*=2),(e+=r+c>=1?l/o:l*A(2,1-c))*o>=2&&(r++,o/=2),r+c>=u?(i=0,r=u):r+c>=1?(i=(e*o-1)*A(2,t),r+=c):(i=e*A(2,c-1)*A(2,t),r=0));t>=8;a[h++]=255&i,i/=256,t-=8);for(r=r<<t|i,s+=t;s>0;a[h++]=255&r,r/=256,s-=8);return a[--h]|=128*p,a}function N(e,t,n){var r,i=8*n-t-1,o=(1<<i)-1,a=o>>1,s=i-7,u=n-1,c=e[u--],l=127&c;for(c>>=7;s>0;l=256*l+e[u],u--,s-=8);for(r=l&(1<<-s)-1,l>>=-s,s+=t;s>0;r=256*r+e[u],u--,s-=8);if(0===l)l=1-a;else{if(l===o)return r?NaN:c?-S:S;r+=A(2,t),l-=a}return(c?-1:1)*r*A(2,l-t)}function F(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function j(e){return[255&e]}function U(e){return[255&e,e>>8&255]}function B(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function k(e){return D(e,52,8)}function z(e){return D(e,23,4)}function G(e,t,n){m(e[y],t,{get:function(){return this[n]}})}function V(e,t,n,r){var i=f(+n);if(i+t>e[C])throw T(b);var o=e[I]._b,a=i+e[R],s=o.slice(a,a+t);return r?s:s.reverse()}function H(e,t,n,r,i,o){var a=f(+n);if(a+t>e[C])throw T(b);for(var s=e[I]._b,u=a+e[R],c=r(+i),l=0;l<t;l++)s[u+l]=c[o?l:t-l-1]}if(a.ABV){if(!c((function(){x(1)}))||!c((function(){new x(-1)}))||c((function(){return new x,new x(1.5),new x(NaN),"ArrayBuffer"!=x.name}))){for(var W,X=(x=function(e){return l(this,x),new M(f(e))})[y]=M[y],Y=d(M),q=0;Y.length>q;)(W=Y[q++])in x||s(x,W,M[W]);o||(X.constructor=x)}var Q=new w(new x(2)),Z=w[y].setInt8;Q.setInt8(0,2147483648),Q.setInt8(1,2147483649),!Q.getInt8(0)&&Q.getInt8(1)||u(w[y],{setInt8:function(e,t){Z.call(this,e,t<<24>>24)},setUint8:function(e,t){Z.call(this,e,t<<24>>24)}},!0)}else x=function(e){l(this,x,"ArrayBuffer");var t=f(e);this._b=v.call(new Array(t),0),this[C]=t},w=function(e,t,n){l(this,w,"DataView"),l(e,x,"DataView");var r=e[C],i=h(t);if(i<0||i>r)throw T("Wrong offset!");if(i+(n=void 0===n?r-i:p(n))>r)throw T("Wrong length!");this[I]=e,this[R]=i,this[C]=n},i&&(G(x,"byteLength","_l"),G(w,"buffer","_b"),G(w,"byteLength","_l"),G(w,"byteOffset","_o")),u(w[y],{getInt8:function(e){return V(this,1,e)[0]<<24>>24},getUint8:function(e){return V(this,1,e)[0]},getInt16:function(e){var t=V(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=V(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return F(V(this,4,e,arguments[1]))},getUint32:function(e){return F(V(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return N(V(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return N(V(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){H(this,1,e,j,t)},setUint8:function(e,t){H(this,1,e,j,t)},setInt16:function(e,t){H(this,2,e,U,t,arguments[2])},setUint16:function(e,t){H(this,2,e,U,t,arguments[2])},setInt32:function(e,t){H(this,4,e,B,t,arguments[2])},setUint32:function(e,t){H(this,4,e,B,t,arguments[2])},setFloat32:function(e,t){H(this,4,e,z,t,arguments[2])},setFloat64:function(e,t){H(this,8,e,k,t,arguments[2])}});g(x,"ArrayBuffer"),g(w,"DataView"),s(w[y],a.VIEW,!0),t.ArrayBuffer=x,t.DataView=w},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){e.exports=!n(161)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t){(function(){t.defaults={.1:{explicitCharkey:!1,trim:!0,normalize:!0,normalizeTags:!1,attrkey:"@",charkey:"#",explicitArray:!1,ignoreAttrs:!1,mergeAttrs:!1,explicitRoot:!1,validator:null,xmlns:!1,explicitChildren:!1,childkey:"@@",charsAsChildren:!1,includeWhiteChars:!1,async:!1,strict:!0,attrNameProcessors:null,attrValueProcessors:null,tagNameProcessors:null,valueProcessors:null,emptyTag:""},.2:{explicitCharkey:!1,trim:!1,normalize:!1,normalizeTags:!1,attrkey:"$",charkey:"_",explicitArray:!0,ignoreAttrs:!1,mergeAttrs:!1,explicitRoot:!0,validator:null,xmlns:!1,explicitChildren:!1,preserveChildrenOrder:!1,childkey:"$$",charsAsChildren:!1,includeWhiteChars:!1,async:!1,strict:!0,attrNameProcessors:null,attrValueProcessors:null,tagNameProcessors:null,valueProcessors:null,rootName:"root",xmldec:{version:"1.0",encoding:"UTF-8",standalone:!0},doctype:null,renderOpts:{pretty:!0,indent:"  ",newline:"\n"},headless:!1,chunkSize:1e4,emptyTag:"",cdata:!1}}}).call(this)},function(e,t,n){(function(){var t,r,i,o,a,s,u,c,l={}.hasOwnProperty;c=n(29),u=c.isObject,s=c.isFunction,a=c.getValue,o=n(18),t=n(8),r=n(164),i=n(108),e.exports=function(e){function n(e,r,i){var o,a,s,u;if(n.__super__.constructor.call(this,e),null==r)throw new Error("Missing element name. "+this.debugInfo());if(this.name=this.stringify.name(r),this.type=t.Element,this.attribs={},this.schemaTypeInfo=null,null!=i&&this.attribute(i),e.type===t.Document&&(this.isRoot=!0,this.documentObject=e,e.rootObject=this,e.children))for(a=0,s=(u=e.children).length;a<s;a++)if((o=u[a]).type===t.DocType){o.name=this.name;break}}return function(e,t){for(var n in t)l.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(n,e),Object.defineProperty(n.prototype,"tagName",{get:function(){return this.name}}),Object.defineProperty(n.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(n.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(n.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(n.prototype,"id",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(n.prototype,"className",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(n.prototype,"classList",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(n.prototype,"attributes",{get:function(){return this.attributeMap&&this.attributeMap.nodes||(this.attributeMap=new i(this.attribs)),this.attributeMap}}),n.prototype.clone=function(){var e,t,n,r;for(t in(n=Object.create(this)).isRoot&&(n.documentObject=null),n.attribs={},r=this.attribs)l.call(r,t)&&(e=r[t],n.attribs[t]=e.clone());return n.children=[],this.children.forEach((function(e){var t;return(t=e.clone()).parent=n,n.children.push(t)})),n},n.prototype.attribute=function(e,t){var n,i;if(null!=e&&(e=a(e)),u(e))for(n in e)l.call(e,n)&&(i=e[n],this.attribute(n,i));else s(t)&&(t=t.apply()),this.options.keepNullAttributes&&null==t?this.attribs[e]=new r(this,e,""):null!=t&&(this.attribs[e]=new r(this,e,t));return this},n.prototype.removeAttribute=function(e){var t,n,r;if(null==e)throw new Error("Missing attribute name. "+this.debugInfo());if(e=a(e),Array.isArray(e))for(n=0,r=e.length;n<r;n++)t=e[n],delete this.attribs[t];else delete this.attribs[e];return this},n.prototype.toString=function(e){return this.options.writer.element(this,this.options.writer.filterOptions(e))},n.prototype.att=function(e,t){return this.attribute(e,t)},n.prototype.a=function(e,t){return this.attribute(e,t)},n.prototype.getAttribute=function(e){return this.attribs.hasOwnProperty(e)?this.attribs[e].value:null},n.prototype.setAttribute=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.getAttributeNode=function(e){return this.attribs.hasOwnProperty(e)?this.attribs[e]:null},n.prototype.setAttributeNode=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.removeAttributeNode=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.getElementsByTagName=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.getAttributeNS=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.setAttributeNS=function(e,t,n){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.removeAttributeNS=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.getAttributeNodeNS=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.setAttributeNodeNS=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.getElementsByTagNameNS=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.hasAttribute=function(e){return this.attribs.hasOwnProperty(e)},n.prototype.hasAttributeNS=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.setIdAttribute=function(e,t){return this.attribs.hasOwnProperty(e)?this.attribs[e].isId:t},n.prototype.setIdAttributeNS=function(e,t,n){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.setIdAttributeNode=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.getElementsByTagName=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.getElementsByTagNameNS=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.getElementsByClassName=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.isEqualNode=function(e){var t,r,i;if(!n.__super__.isEqualNode.apply(this,arguments).isEqualNode(e))return!1;if(e.namespaceURI!==this.namespaceURI)return!1;if(e.prefix!==this.prefix)return!1;if(e.localName!==this.localName)return!1;if(e.attribs.length!==this.attribs.length)return!1;for(t=r=0,i=this.attribs.length-1;0<=i?r<=i:r>=i;t=0<=i?++r:--r)if(!this.attribs[t].isEqualNode(e.attribs[t]))return!1;return!0},n}(o)}).call(this)},function(e,t){(function(){e.exports=function(){function e(e){this.nodes=e}return Object.defineProperty(e.prototype,"length",{get:function(){return Object.keys(this.nodes).length||0}}),e.prototype.clone=function(){return this.nodes=null},e.prototype.getNamedItem=function(e){return this.nodes[e]},e.prototype.setNamedItem=function(e){var t;return t=this.nodes[e.nodeName],this.nodes[e.nodeName]=e,t||null},e.prototype.removeNamedItem=function(e){var t;return t=this.nodes[e],delete this.nodes[e],t||null},e.prototype.item=function(e){return this.nodes[Object.keys(this.nodes)[e]]||null},e.prototype.getNamedItemNS=function(e,t){throw new Error("This DOM method is not implemented.")},e.prototype.setNamedItemNS=function(e){throw new Error("This DOM method is not implemented.")},e.prototype.removeNamedItemNS=function(e,t){throw new Error("This DOM method is not implemented.")},e}()}).call(this)},function(e,t,n){(function(){var t,r,i={}.hasOwnProperty;t=n(8),r=n(72),e.exports=function(e){function n(e,r){if(n.__super__.constructor.call(this,e),null==r)throw new Error("Missing CDATA text. "+this.debugInfo());this.name="#cdata-section",this.type=t.CData,this.value=this.stringify.cdata(r)}return function(e,t){for(var n in t)i.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(n,e),n.prototype.clone=function(){return Object.create(this)},n.prototype.toString=function(e){return this.options.writer.cdata(this,this.options.writer.filterOptions(e))},n}(r)}).call(this)},function(e,t,n){(function(){var t,r,i={}.hasOwnProperty;t=n(8),r=n(72),e.exports=function(e){function n(e,r){if(n.__super__.constructor.call(this,e),null==r)throw new Error("Missing comment text. "+this.debugInfo());this.name="#comment",this.type=t.Comment,this.value=this.stringify.comment(r)}return function(e,t){for(var n in t)i.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(n,e),n.prototype.clone=function(){return Object.create(this)},n.prototype.toString=function(e){return this.options.writer.comment(this,this.options.writer.filterOptions(e))},n}(r)}).call(this)},function(e,t,n){(function(){var t,r,i,o={}.hasOwnProperty;i=n(29).isObject,r=n(18),t=n(8),e.exports=function(e){function n(e,r,o,a){var s;n.__super__.constructor.call(this,e),i(r)&&(r=(s=r).version,o=s.encoding,a=s.standalone),r||(r="1.0"),this.type=t.Declaration,this.version=this.stringify.xmlVersion(r),null!=o&&(this.encoding=this.stringify.xmlEncoding(o)),null!=a&&(this.standalone=this.stringify.xmlStandalone(a))}return function(e,t){for(var n in t)o.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(n,e),n.prototype.toString=function(e){return this.options.writer.declaration(this,this.options.writer.filterOptions(e))},n}(r)}).call(this)},function(e,t,n){(function(){var t,r,i,o,a,s,u,c,l={}.hasOwnProperty;c=n(29).isObject,u=n(18),t=n(8),r=n(113),o=n(114),i=n(115),a=n(116),s=n(108),e.exports=function(e){function n(e,r,i){var o,a,s,u,l,h;if(n.__super__.constructor.call(this,e),this.type=t.DocType,e.children)for(a=0,s=(u=e.children).length;a<s;a++)if((o=u[a]).type===t.Element){this.name=o.name;break}this.documentObject=e,c(r)&&(r=(l=r).pubID,i=l.sysID),null==i&&(i=(h=[r,i])[0],r=h[1]),null!=r&&(this.pubID=this.stringify.dtdPubID(r)),null!=i&&(this.sysID=this.stringify.dtdSysID(i))}return function(e,t){for(var n in t)l.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(n,e),Object.defineProperty(n.prototype,"entities",{get:function(){var e,n,r,i,o;for(i={},n=0,r=(o=this.children).length;n<r;n++)(e=o[n]).type!==t.EntityDeclaration||e.pe||(i[e.name]=e);return new s(i)}}),Object.defineProperty(n.prototype,"notations",{get:function(){var e,n,r,i,o;for(i={},n=0,r=(o=this.children).length;n<r;n++)(e=o[n]).type===t.NotationDeclaration&&(i[e.name]=e);return new s(i)}}),Object.defineProperty(n.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(n.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(n.prototype,"internalSubset",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),n.prototype.element=function(e,t){var n;return n=new i(this,e,t),this.children.push(n),this},n.prototype.attList=function(e,t,n,i,o){var a;return a=new r(this,e,t,n,i,o),this.children.push(a),this},n.prototype.entity=function(e,t){var n;return n=new o(this,!1,e,t),this.children.push(n),this},n.prototype.pEntity=function(e,t){var n;return n=new o(this,!0,e,t),this.children.push(n),this},n.prototype.notation=function(e,t){var n;return n=new a(this,e,t),this.children.push(n),this},n.prototype.toString=function(e){return this.options.writer.docType(this,this.options.writer.filterOptions(e))},n.prototype.ele=function(e,t){return this.element(e,t)},n.prototype.att=function(e,t,n,r,i){return this.attList(e,t,n,r,i)},n.prototype.ent=function(e,t){return this.entity(e,t)},n.prototype.pent=function(e,t){return this.pEntity(e,t)},n.prototype.not=function(e,t){return this.notation(e,t)},n.prototype.up=function(){return this.root()||this.documentObject},n.prototype.isEqualNode=function(e){return!!n.__super__.isEqualNode.apply(this,arguments).isEqualNode(e)&&(e.name===this.name&&(e.publicId===this.publicId&&e.systemId===this.systemId))},n}(u)}).call(this)},function(e,t,n){(function(){var t,r,i={}.hasOwnProperty;r=n(18),t=n(8),e.exports=function(e){function n(e,r,i,o,a,s){if(n.__super__.constructor.call(this,e),null==r)throw new Error("Missing DTD element name. "+this.debugInfo());if(null==i)throw new Error("Missing DTD attribute name. "+this.debugInfo(r));if(!o)throw new Error("Missing DTD attribute type. "+this.debugInfo(r));if(!a)throw new Error("Missing DTD attribute default. "+this.debugInfo(r));if(0!==a.indexOf("#")&&(a="#"+a),!a.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT. "+this.debugInfo(r));if(s&&!a.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT. "+this.debugInfo(r));this.elementName=this.stringify.name(r),this.type=t.AttributeDeclaration,this.attributeName=this.stringify.name(i),this.attributeType=this.stringify.dtdAttType(o),s&&(this.defaultValue=this.stringify.dtdAttDefault(s)),this.defaultValueType=a}return function(e,t){for(var n in t)i.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(n,e),n.prototype.toString=function(e){return this.options.writer.dtdAttList(this,this.options.writer.filterOptions(e))},n}(r)}).call(this)},function(e,t,n){(function(){var t,r,i,o={}.hasOwnProperty;i=n(29).isObject,r=n(18),t=n(8),e.exports=function(e){function n(e,r,o,a){if(n.__super__.constructor.call(this,e),null==o)throw new Error("Missing DTD entity name. "+this.debugInfo(o));if(null==a)throw new Error("Missing DTD entity value. "+this.debugInfo(o));if(this.pe=!!r,this.name=this.stringify.name(o),this.type=t.EntityDeclaration,i(a)){if(!a.pubID&&!a.sysID)throw new Error("Public and/or system identifiers are required for an external entity. "+this.debugInfo(o));if(a.pubID&&!a.sysID)throw new Error("System identifier is required for a public external entity. "+this.debugInfo(o));if(this.internal=!1,null!=a.pubID&&(this.pubID=this.stringify.dtdPubID(a.pubID)),null!=a.sysID&&(this.sysID=this.stringify.dtdSysID(a.sysID)),null!=a.nData&&(this.nData=this.stringify.dtdNData(a.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity. "+this.debugInfo(o))}else this.value=this.stringify.dtdEntityValue(a),this.internal=!0}return function(e,t){for(var n in t)o.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(n,e),Object.defineProperty(n.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(n.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(n.prototype,"notationName",{get:function(){return this.nData||null}}),Object.defineProperty(n.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(n.prototype,"xmlEncoding",{get:function(){return null}}),Object.defineProperty(n.prototype,"xmlVersion",{get:function(){return null}}),n.prototype.toString=function(e){return this.options.writer.dtdEntity(this,this.options.writer.filterOptions(e))},n}(r)}).call(this)},function(e,t,n){(function(){var t,r,i={}.hasOwnProperty;r=n(18),t=n(8),e.exports=function(e){function n(e,r,i){if(n.__super__.constructor.call(this,e),null==r)throw new Error("Missing DTD element name. "+this.debugInfo());i||(i="(#PCDATA)"),Array.isArray(i)&&(i="("+i.join(",")+")"),this.name=this.stringify.name(r),this.type=t.ElementDeclaration,this.value=this.stringify.dtdElementValue(i)}return function(e,t){for(var n in t)i.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(n,e),n.prototype.toString=function(e){return this.options.writer.dtdElement(this,this.options.writer.filterOptions(e))},n}(r)}).call(this)},function(e,t,n){(function(){var t,r,i={}.hasOwnProperty;r=n(18),t=n(8),e.exports=function(e){function n(e,r,i){if(n.__super__.constructor.call(this,e),null==r)throw new Error("Missing DTD notation name. "+this.debugInfo(r));if(!i.pubID&&!i.sysID)throw new Error("Public or system identifiers are required for an external entity. "+this.debugInfo(r));this.name=this.stringify.name(r),this.type=t.NotationDeclaration,null!=i.pubID&&(this.pubID=this.stringify.dtdPubID(i.pubID)),null!=i.sysID&&(this.sysID=this.stringify.dtdSysID(i.sysID))}return function(e,t){for(var n in t)i.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(n,e),Object.defineProperty(n.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(n.prototype,"systemId",{get:function(){return this.sysID}}),n.prototype.toString=function(e){return this.options.writer.dtdNotation(this,this.options.writer.filterOptions(e))},n}(r)}).call(this)},function(e,t,n){(function(){var t,r,i={}.hasOwnProperty;t=n(8),r=n(18),e.exports=function(e){function n(e,r){if(n.__super__.constructor.call(this,e),null==r)throw new Error("Missing raw text. "+this.debugInfo());this.type=t.Raw,this.value=this.stringify.raw(r)}return function(e,t){for(var n in t)i.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(n,e),n.prototype.clone=function(){return Object.create(this)},n.prototype.toString=function(e){return this.options.writer.raw(this,this.options.writer.filterOptions(e))},n}(r)}).call(this)},function(e,t,n){(function(){var t,r,i={}.hasOwnProperty;t=n(8),r=n(72),e.exports=function(e){function n(e,r){if(n.__super__.constructor.call(this,e),null==r)throw new Error("Missing element text. "+this.debugInfo());this.name="#text",this.type=t.Text,this.value=this.stringify.text(r)}return function(e,t){for(var n in t)i.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(n,e),Object.defineProperty(n.prototype,"isElementContentWhitespace",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(n.prototype,"wholeText",{get:function(){var e,t,n;for(n="",t=this.previousSibling;t;)n=t.data+n,t=t.previousSibling;for(n+=this.data,e=this.nextSibling;e;)n+=e.data,e=e.nextSibling;return n}}),n.prototype.clone=function(){return Object.create(this)},n.prototype.toString=function(e){return this.options.writer.text(this,this.options.writer.filterOptions(e))},n.prototype.splitText=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.replaceWholeText=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},n}(r)}).call(this)},function(e,t,n){(function(){var t,r,i={}.hasOwnProperty;t=n(8),r=n(72),e.exports=function(e){function n(e,r,i){if(n.__super__.constructor.call(this,e),null==r)throw new Error("Missing instruction target. "+this.debugInfo());this.type=t.ProcessingInstruction,this.target=this.stringify.insTarget(r),this.name=this.target,i&&(this.value=this.stringify.insValue(i))}return function(e,t){for(var n in t)i.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(n,e),n.prototype.clone=function(){return Object.create(this)},n.prototype.toString=function(e){return this.options.writer.processingInstruction(this,this.options.writer.filterOptions(e))},n.prototype.isEqualNode=function(e){return!!n.__super__.isEqualNode.apply(this,arguments).isEqualNode(e)&&e.target===this.target},n}(r)}).call(this)},function(e,t,n){(function(){var t,r={}.hasOwnProperty;t=n(167),e.exports=function(e){function t(e){t.__super__.constructor.call(this,e)}return function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.document=function(e,t){var n,r,i,o,a;for(t=this.filterOptions(t),o="",r=0,i=(a=e.children).length;r<i;r++)n=a[r],o+=this.writeChildNode(n,t,0);return t.pretty&&o.slice(-t.newline.length)===t.newline&&(o=o.slice(0,-t.newline.length)),o},t}(t)}).call(this)},function(e,t,n){(t=e.exports=n(169)).Stream=t,t.Readable=t,t.Writable=n(123),t.Duplex=n(43),t.Transform=n(173),t.PassThrough=n(403)},function(e,t,n){var r=n(74),i=r.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function a(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(o(r,t),t.Buffer=a),o(i,a),a.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},a.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t,n){"use strict";(function(t,r,i){var o=n(76);function a(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;e.entry=null;for(;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=y;var s,u=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?r:o.nextTick;y.WritableState=g;var c=n(58);c.inherits=n(51);var l={deprecate:n(401)},h=n(170),p=n(122).Buffer,f=i.Uint8Array||function(){};var d,m=n(171);function v(){}function g(e,t){s=s||n(43),e=e||{};var r=t instanceof s;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,c=e.writableHighWaterMark,l=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(c||0===c)?c:l,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var h=!1===e.decodeStrings;this.decodeStrings=!h,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,i){--t.pendingcb,n?(o.nextTick(i,r),o.nextTick(S,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(i(r),e._writableState.errorEmitted=!0,e.emit("error",r),S(e,t))}(e,n,r,t,i);else{var a=_(n);a||n.corked||n.bufferProcessing||!n.bufferedRequest||w(e,n),r?u(x,e,n,a,i):x(e,n,a,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function y(e){if(s=s||n(43),!(d.call(y,this)||this instanceof s))return new y(e);this._writableState=new g(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),h.call(this)}function b(e,t,n,r,i,o,a){t.writelen=r,t.writecb=a,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function x(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),S(e,t)}function w(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var s=0,u=!0;n;)i[s]=n,n.isBuf||(u=!1),n=n.next,s+=1;i.allBuffers=u,b(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new a(t),t.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,l=n.encoding,h=n.callback;if(b(e,t,!1,t.objectMode?1:c.length,c,l,h),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function _(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function T(e,t){e._final((function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),S(e,t)}))}function S(e,t){var n=_(t);return n&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,o.nextTick(T,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}c.inherits(y,h),g.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(g.prototype,"buffer",{get:l.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(d=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(e){return!!d.call(this,e)||this===y&&(e&&e._writableState instanceof g)}})):d=function(e){return e instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(e,t,n){var r,i=this._writableState,a=!1,s=!i.objectMode&&(r=e,p.isBuffer(r)||r instanceof f);return s&&!p.isBuffer(e)&&(e=function(e){return p.from(e)}(e)),"function"==typeof t&&(n=t,t=null),s?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=v),i.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),o.nextTick(t,n)}(this,n):(s||function(e,t,n,r){var i=!0,a=!1;return null===n?a=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(e.emit("error",a),o.nextTick(r,a),i=!1),i}(this,i,e,n))&&(i.pendingcb++,a=function(e,t,n,r,i,o){if(!n){var a=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=p.from(t,n));return t}(t,r,i);r!==a&&(n=!0,i="buffer",r=a)}var s=t.objectMode?1:r.length;t.length+=s;var u=t.length<t.highWaterMark;u||(t.needDrain=!0);if(t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else b(e,t,!1,s,r,i,o);return u}(this,i,s,e,t,n)),a},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||w(this,e))},y.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(y.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),y.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,S(e,t),n&&(t.finished?o.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,r,n)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),y.prototype.destroy=m.destroy,y.prototype._undestroy=m.undestroy,y.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,n(50),n(172).setImmediate,n(42))},function(e,t,n){"use strict";var r=n(402).Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=u,this.end=c,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=l,this.end=h,t=3;break;default:return this.write=p,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function a(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function s(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function u(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function l(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function h(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function p(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}t.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},o.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=a(t[r]);if(i>=0)return i>0&&(e.lastNeed=i-1),i;if(--r<n||-2===i)return 0;if((i=a(t[r]))>=0)return i>0&&(e.lastNeed=i-2),i;if(--r<n||-2===i)return 0;if((i=a(t[r]))>=0)return i>0&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){"use strict";var r=n(175),i="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),o=Object.prototype.toString,a=Array.prototype.concat,s=Object.defineProperty,u=s&&function(){var e={};try{for(var t in s(e,"x",{enumerable:!1,value:e}),e)return!1;return e.x===e}catch(e){return!1}}(),c=function(e,t,n,r){var i;t in e&&("function"!=typeof(i=r)||"[object Function]"!==o.call(i)||!r())||(u?s(e,t,{configurable:!0,enumerable:!1,value:n,writable:!0}):e[t]=n)},l=function(e,t){var n=arguments.length>2?arguments[2]:{},o=r(t);i&&(o=a.call(o,Object.getOwnPropertySymbols(t)));for(var s=0;s<o.length;s+=1)c(e,o[s],t[o[s]],n[o[s]])};l.supportsDescriptors=!!u,e.exports=l},function(e,t,n){(function(e){var r=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},i=/%[sdj%]/g;t.format=function(e){if(!g(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,o=r.length,a=String(e).replace(i,(function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),u=r[n];n<o;u=r[++n])m(u)||!x(u)?a+=" "+u:a+=" "+s(u);return a},t.deprecate=function(n,r){if(void 0!==e&&!0===e.noDeprecation)return n;if(void 0===e)return function(){return t.deprecate(n,r).apply(this,arguments)};var i=!1;return function(){if(!i){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),i=!0}return n.apply(this,arguments)}};var o,a={};function s(e,n){var r={seen:[],stylize:c};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),d(n)?r.showHidden=n:n&&t._extend(r,n),y(r.showHidden)&&(r.showHidden=!1),y(r.depth)&&(r.depth=2),y(r.colors)&&(r.colors=!1),y(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=u),l(r,e,r.depth)}function u(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function c(e,t){return e}function l(e,n,r){if(e.customInspect&&n&&T(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return g(i)||(i=l(e,i,r)),i}var o=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(g(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(v(t))return e.stylize(""+t,"number");if(d(t))return e.stylize(""+t,"boolean");if(m(t))return e.stylize("null","null")}(e,n);if(o)return o;var a=Object.keys(n),s=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(n)),_(n)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return h(n);if(0===a.length){if(T(n)){var u=n.name?": "+n.name:"";return e.stylize("[Function"+u+"]","special")}if(b(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(w(n))return e.stylize(Date.prototype.toString.call(n),"date");if(_(n))return h(n)}var c,x="",S=!1,M=["{","}"];(f(n)&&(S=!0,M=["[","]"]),T(n))&&(x=" [Function"+(n.name?": "+n.name:"")+"]");return b(n)&&(x=" "+RegExp.prototype.toString.call(n)),w(n)&&(x=" "+Date.prototype.toUTCString.call(n)),_(n)&&(x=" "+h(n)),0!==a.length||S&&0!=n.length?r<0?b(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),c=S?function(e,t,n,r,i){for(var o=[],a=0,s=t.length;a<s;++a)P(t,String(a))?o.push(p(e,t,n,r,String(a),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(p(e,t,n,r,i,!0))})),o}(e,n,r,s,a):a.map((function(t){return p(e,n,r,s,t,S)})),e.seen.pop(),function(e,t,n){if(e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(c,x,M)):M[0]+x+M[1]}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,n,r,i,o){var a,s,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),P(r,i)||(a="["+i+"]"),s||(e.seen.indexOf(u.value)<0?(s=m(n)?l(e,u.value,null):l(e,u.value,n-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),y(a)){if(o&&i.match(/^\d+$/))return s;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function f(e){return Array.isArray(e)}function d(e){return"boolean"==typeof e}function m(e){return null===e}function v(e){return"number"==typeof e}function g(e){return"string"==typeof e}function y(e){return void 0===e}function b(e){return x(e)&&"[object RegExp]"===S(e)}function x(e){return"object"==typeof e&&null!==e}function w(e){return x(e)&&"[object Date]"===S(e)}function _(e){return x(e)&&("[object Error]"===S(e)||e instanceof Error)}function T(e){return"function"==typeof e}function S(e){return Object.prototype.toString.call(e)}function M(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(n){if(y(o)&&(o=Object({SBM_TYPE:"sbm",WORKER_URL:"/example/sdk"}).NODE_DEBUG||""),n=n.toUpperCase(),!a[n])if(new RegExp("\\b"+n+"\\b","i").test(o)){var r=e.pid;a[n]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",n,r,e)}}else a[n]=function(){};return a[n]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=d,t.isNull=m,t.isNullOrUndefined=function(e){return null==e},t.isNumber=v,t.isString=g,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=y,t.isRegExp=b,t.isObject=x,t.isDate=w,t.isError=_,t.isFunction=T,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(411);var E=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function A(){var e=new Date,t=[M(e.getHours()),M(e.getMinutes()),M(e.getSeconds())].join(":");return[e.getDate(),E[e.getMonth()],t].join(" ")}function P(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",A(),t.format.apply(t,arguments))},t.inherits=n(412),t._extend=function(e,t){if(!t||!x(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var O="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function L(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(O&&e[O]){var t;if("function"!=typeof(t=e[O]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,O,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise((function(e,r){t=e,n=r})),i=[],o=0;o<arguments.length;o++)i.push(arguments[o]);i.push((function(e,r){e?n(e):t(r)}));try{e.apply(this,i)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),O&&Object.defineProperty(t,O,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,r(e))},t.promisify.custom=O,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);var i=n.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var o=this,a=function(){return i.apply(o,arguments)};t.apply(this,n).then((function(t){e.nextTick(a,null,t)}),(function(t){e.nextTick(L,t,a)}))}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.defineProperties(n,r(t)),n}}).call(this,n(50))},function(e,t,n){"use strict";var r=n(417);e.exports=Function.prototype.bind||r},function(e,t,n){"use strict";var r=Function.prototype.toString,i=/^\s*class\b/,o=function(e){try{var t=r.call(e);return i.test(t)}catch(e){return!1}},a=Object.prototype.toString,s="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;e.exports=function(e){if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if("function"==typeof e&&!e.prototype)return!0;if(s)return function(e){try{return!o(e)&&(r.call(e),!0)}catch(e){return!1}}(e);if(o(e))return!1;var t=a.call(e);return"[object Function]"===t||"[object GeneratorFunction]"===t}},function(e,t,n){e.exports=!n(9)&&!n(2)((function(){return 7!=Object.defineProperty(n(78)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,n){var r=n(1),i=n(7),o=n(34),a=n(79),s=n(10).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:a.f(e)})}},function(e,t,n){var r=n(15),i=n(17),o=n(61)(!1),a=n(80)("IE_PROTO");e.exports=function(e,t){var n,s=i(e),u=0,c=[];for(n in s)n!=a&&r(s,n)&&c.push(n);for(;t.length>u;)r(s,n=t[u++])&&(~o(c,n)||c.push(n));return c}},function(e,t,n){var r=n(10),i=n(3),o=n(35);e.exports=n(9)?Object.defineProperties:function(e,t){i(e);for(var n,a=o(t),s=a.length,u=0;s>u;)r.f(e,n=a[u++],t[n]);return e}},function(e,t,n){var r=n(17),i=n(38).f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return a.slice()}}(e):i(r(e))}},function(e,t,n){"use strict";var r=n(9),i=n(35),o=n(62),a=n(55),s=n(11),u=n(54),c=Object.assign;e.exports=!c||n(2)((function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=c({},e)[n]||Object.keys(c({},t)).join("")!=r}))?function(e,t){for(var n=s(e),c=arguments.length,l=1,h=o.f,p=a.f;c>l;)for(var f,d=u(arguments[l++]),m=h?i(d).concat(h(d)):i(d),v=m.length,g=0;v>g;)f=m[g++],r&&!p.call(d,f)||(n[f]=d[f]);return n}:c},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,t,n){"use strict";var r=n(21),i=n(4),o=n(137),a=[].slice,s={},u=function(e,t,n){if(!(t in s)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";s[t]=Function("F,a","return new F("+r.join(",")+")")}return s[t](e,n)};e.exports=Function.bind||function(e){var t=r(this),n=a.call(arguments,1),s=function(){var r=n.concat(a.call(arguments));return this instanceof s?u(t,r.length,r):o(t,r,e)};return i(t.prototype)&&(s.prototype=t.prototype),s}},function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var r=n(1).parseInt,i=n(45).trim,o=n(84),a=/^[-+]?0[xX]/;e.exports=8!==r(o+"08")||22!==r(o+"0x16")?function(e,t){var n=i(String(e),3);return r(n,t>>>0||(a.test(n)?16:10))}:r},function(e,t,n){var r=n(1).parseFloat,i=n(45).trim;e.exports=1/r(n(84)+"-0")!=-1/0?function(e){var t=i(String(e),3),n=r(t);return 0===n&&"-"==t.charAt(0)?-0:n}:r},function(e,t,n){var r=n(26);e.exports=function(e,t){if("number"!=typeof e&&"Number"!=r(e))throw TypeError(t);return+e}},function(e,t,n){var r=n(4),i=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&i(e)===e}},function(e,t){e.exports=Math.log1p||function(e){return(e=+e)>-1e-8&&e<1e-8?e-e*e/2:Math.log(1+e)}},function(e,t,n){"use strict";var r=n(37),i=n(32),o=n(44),a={};n(16)(a,n(5)("iterator"),(function(){return this})),e.exports=function(e,t,n){e.prototype=r(a,{next:i(1,n)}),o(e,t+" Iterator")}},function(e,t,n){var r=n(3);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&r(o.call(e)),t}}},function(e,t,n){var r=n(289);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,n){var r=n(21),i=n(11),o=n(54),a=n(6);e.exports=function(e,t,n,s,u){r(t);var c=i(e),l=o(c),h=a(c.length),p=u?h-1:0,f=u?-1:1;if(n<2)for(;;){if(p in l){s=l[p],p+=f;break}if(p+=f,u?p<0:h<=p)throw TypeError("Reduce of empty array with no initial value")}for(;u?p>=0:h>p;p+=f)p in l&&(s=t(s,l[p],p,c));return s}},function(e,t,n){"use strict";var r=n(11),i=n(36),o=n(6);e.exports=[].copyWithin||function(e,t){var n=r(this),a=o(n.length),s=i(e,a),u=i(t,a),c=arguments.length>2?arguments[2]:void 0,l=Math.min((void 0===c?a:i(c,a))-u,a-s),h=1;for(u<s&&s<u+l&&(h=-1,u+=l-1,s+=l-1);l-- >0;)u in n?n[s]=n[u]:delete n[s],s+=h,u+=h;return n}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){"use strict";var r=n(99);n(0)({target:"RegExp",proto:!0,forced:r!==/./.exec},{exec:r})},function(e,t,n){n(9)&&"g"!=/./g.flags&&n(10).f(RegExp.prototype,"flags",{configurable:!0,get:n(65)})},function(e,t,n){"use strict";var r,i,o,a,s=n(34),u=n(1),c=n(20),l=n(56),h=n(0),p=n(4),f=n(21),d=n(48),m=n(68),v=n(57),g=n(101).set,y=n(309)(),b=n(152),x=n(310),w=n(69),_=n(153),T=u.TypeError,S=u.process,M=S&&S.versions,E=M&&M.v8||"",A=u.Promise,P="process"==l(S),O=function(){},L=i=b.f,I=!!function(){try{var e=A.resolve(1),t=(e.constructor={})[n(5)("species")]=function(e){e(O,O)};return(P||"function"==typeof PromiseRejectionEvent)&&e.then(O)instanceof t&&0!==E.indexOf("6.6")&&-1===w.indexOf("Chrome/66")}catch(e){}}(),C=function(e){var t;return!(!p(e)||"function"!=typeof(t=e.then))&&t},R=function(e,t){if(!e._n){e._n=!0;var n=e._c;y((function(){for(var r=e._v,i=1==e._s,o=0,a=function(t){var n,o,a,s=i?t.ok:t.fail,u=t.resolve,c=t.reject,l=t.domain;try{s?(i||(2==e._h&&F(e),e._h=1),!0===s?n=r:(l&&l.enter(),n=s(r),l&&(l.exit(),a=!0)),n===t.promise?c(T("Promise-chain cycle")):(o=C(n))?o.call(n,u,c):u(n)):c(r)}catch(e){l&&!a&&l.exit(),c(e)}};n.length>o;)a(n[o++]);e._c=[],e._n=!1,t&&!e._h&&D(e)}))}},D=function(e){g.call(u,(function(){var t,n,r,i=e._v,o=N(e);if(o&&(t=x((function(){P?S.emit("unhandledRejection",i,e):(n=u.onunhandledrejection)?n({promise:e,reason:i}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",i)})),e._h=P||N(e)?2:1),e._a=void 0,o&&t.e)throw t.v}))},N=function(e){return 1!==e._h&&0===(e._a||e._c).length},F=function(e){g.call(u,(function(){var t;P?S.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})}))},j=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),R(t,!0))},U=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw T("Promise can't be resolved itself");(t=C(e))?y((function(){var r={_w:n,_d:!1};try{t.call(e,c(U,r,1),c(j,r,1))}catch(e){j.call(r,e)}})):(n._v=e,n._s=1,R(n,!1))}catch(e){j.call({_w:n,_d:!1},e)}}};I||(A=function(e){d(this,A,"Promise","_h"),f(e),r.call(this);try{e(c(U,this,1),c(j,this,1))}catch(e){j.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(49)(A.prototype,{then:function(e,t){var n=L(v(this,A));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=P?S.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&R(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new r;this.promise=e,this.resolve=c(U,e,1),this.reject=c(j,e,1)},b.f=L=function(e){return e===A||e===a?new o(e):i(e)}),h(h.G+h.W+h.F*!I,{Promise:A}),n(44)(A,"Promise"),n(47)("Promise"),a=n(7).Promise,h(h.S+h.F*!I,"Promise",{reject:function(e){var t=L(this);return(0,t.reject)(e),t.promise}}),h(h.S+h.F*(s||!I),"Promise",{resolve:function(e){return _(s&&this===a?A:this,e)}}),h(h.S+h.F*!(I&&n(64)((function(e){A.all(e).catch(O)}))),"Promise",{all:function(e){var t=this,n=L(t),r=n.resolve,i=n.reject,o=x((function(){var n=[],o=0,a=1;m(e,!1,(function(e){var s=o++,u=!1;n.push(void 0),a++,t.resolve(e).then((function(e){u||(u=!0,n[s]=e,--a||r(n))}),i)})),--a||r(n)}));return o.e&&i(o.v),n.promise},race:function(e){var t=this,n=L(t),r=n.reject,i=x((function(){m(e,!1,(function(e){t.resolve(e).then(n.resolve,r)}))}));return i.e&&r(i.v),n.promise}})},function(e,t,n){"use strict";var r=n(21);function i(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)}e.exports.f=function(e){return new i(e)}},function(e,t,n){var r=n(3),i=n(4),o=n(152);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=o.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){"use strict";var r=n(10).f,i=n(37),o=n(49),a=n(20),s=n(48),u=n(68),c=n(90),l=n(148),h=n(47),p=n(9),f=n(31).fastKey,d=n(41),m=p?"_s":"size",v=function(e,t){var n,r=f(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,c){var l=e((function(e,r){s(e,l,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[m]=0,null!=r&&u(r,n,e[c],e)}));return o(l.prototype,{clear:function(){for(var e=d(this,t),n=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];e._f=e._l=void 0,e[m]=0},delete:function(e){var n=d(this,t),r=v(n,e);if(r){var i=r.n,o=r.p;delete n._i[r.i],r.r=!0,o&&(o.n=i),i&&(i.p=o),n._f==r&&(n._f=i),n._l==r&&(n._l=o),n[m]--}return!!r},forEach:function(e){d(this,t);for(var n,r=a(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!v(d(this,t),e)}}),p&&r(l.prototype,"size",{get:function(){return d(this,t)[m]}}),l},def:function(e,t,n){var r,i,o=v(e,t);return o?o.v=n:(e._l=o={i:i=f(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=o),r&&(r.n=o),e[m]++,"F"!==i&&(e._i[i]=o)),e},getEntry:v,setStrong:function(e,t,n){c(e,t,(function(e,n){this._t=d(e,t),this._k=n,this._l=void 0}),(function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?l(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,l(1))}),n?"entries":"values",!n,!0),h(t)}}},function(e,t,n){"use strict";var r=n(49),i=n(31).getWeak,o=n(3),a=n(4),s=n(48),u=n(68),c=n(25),l=n(15),h=n(41),p=c(5),f=c(6),d=0,m=function(e){return e._l||(e._l=new v)},v=function(){this.a=[]},g=function(e,t){return p(e.a,(function(e){return e[0]===t}))};v.prototype={get:function(e){var t=g(this,e);if(t)return t[1]},has:function(e){return!!g(this,e)},set:function(e,t){var n=g(this,e);n?n[1]=t:this.a.push([e,t])},delete:function(e){var t=f(this.a,(function(t){return t[0]===e}));return~t&&this.a.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,n,o){var c=e((function(e,r){s(e,c,t,"_i"),e._t=t,e._i=d++,e._l=void 0,null!=r&&u(r,n,e[o],e)}));return r(c.prototype,{delete:function(e){if(!a(e))return!1;var n=i(e);return!0===n?m(h(this,t)).delete(e):n&&l(n,this._i)&&delete n[this._i]},has:function(e){if(!a(e))return!1;var n=i(e);return!0===n?m(h(this,t)).has(e):n&&l(n,this._i)}}),c},def:function(e,t,n){var r=i(o(t),!0);return!0===r?m(e).set(t,n):r[e._i]=n,e},ufstore:m}},function(e,t,n){var r=n(22),i=n(6);e.exports=function(e){if(void 0===e)return 0;var t=r(e),n=i(t);if(t!==n)throw RangeError("Wrong length!");return n}},function(e,t,n){var r=n(38),i=n(62),o=n(3),a=n(1).Reflect;e.exports=a&&a.ownKeys||function(e){var t=r.f(o(e)),n=i.f;return n?t.concat(n(e)):t}},function(e,t,n){var r=n(6),i=n(86),o=n(27);e.exports=function(e,t,n,a){var s=String(o(e)),u=s.length,c=void 0===n?" ":String(n),l=r(t);if(l<=u||""==c)return s;var h=l-u,p=i.call(c,Math.ceil(h/c.length));return p.length>h&&(p=p.slice(0,h)),a?p+s:s+p}},function(e,t,n){var r=n(9),i=n(35),o=n(17),a=n(55).f;e.exports=function(e){return function(t){for(var n,s=o(t),u=i(s),c=u.length,l=0,h=[];c>l;)n=u[l++],r&&!a.call(s,n)||h.push(e?[n,s[n]]:s[n]);return h}}},function(e,t){var n=e.exports={version:"2.6.10"};"number"==typeof __e&&(__e=n)},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){(function(){e.exports=function(){function e(){}return e.prototype.hasFeature=function(e,t){return!0},e.prototype.createDocumentType=function(e,t,n){throw new Error("This DOM method is not implemented.")},e.prototype.createDocument=function(e,t,n){throw new Error("This DOM method is not implemented.")},e.prototype.createHTMLDocument=function(e){throw new Error("This DOM method is not implemented.")},e.prototype.getFeature=function(e,t){throw new Error("This DOM method is not implemented.")},e}()}).call(this)},function(e,t,n){(function(){var t,r,i,o,a,s,u,c={}.hasOwnProperty;u=n(29).isPlainObject,i=n(162),r=n(385),o=n(18),t=n(8),s=n(166),a=n(120),e.exports=function(e){function n(e){n.__super__.constructor.call(this,null),this.name="#document",this.type=t.Document,this.documentURI=null,this.domConfig=new r,e||(e={}),e.writer||(e.writer=new a),this.options=e,this.stringify=new s(e)}return function(e,t){for(var n in t)c.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(n,e),Object.defineProperty(n.prototype,"implementation",{value:new i}),Object.defineProperty(n.prototype,"doctype",{get:function(){var e,n,r,i;for(n=0,r=(i=this.children).length;n<r;n++)if((e=i[n]).type===t.DocType)return e;return null}}),Object.defineProperty(n.prototype,"documentElement",{get:function(){return this.rootObject||null}}),Object.defineProperty(n.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(n.prototype,"strictErrorChecking",{get:function(){return!1}}),Object.defineProperty(n.prototype,"xmlEncoding",{get:function(){return 0!==this.children.length&&this.children[0].type===t.Declaration?this.children[0].encoding:null}}),Object.defineProperty(n.prototype,"xmlStandalone",{get:function(){return 0!==this.children.length&&this.children[0].type===t.Declaration&&"yes"===this.children[0].standalone}}),Object.defineProperty(n.prototype,"xmlVersion",{get:function(){return 0!==this.children.length&&this.children[0].type===t.Declaration?this.children[0].version:"1.0"}}),Object.defineProperty(n.prototype,"URL",{get:function(){return this.documentURI}}),Object.defineProperty(n.prototype,"origin",{get:function(){return null}}),Object.defineProperty(n.prototype,"compatMode",{get:function(){return null}}),Object.defineProperty(n.prototype,"characterSet",{get:function(){return null}}),Object.defineProperty(n.prototype,"contentType",{get:function(){return null}}),n.prototype.end=function(e){var t;return t={},e?u(e)&&(t=e,e=this.options.writer):e=this.options.writer,e.document(this,e.filterOptions(t))},n.prototype.toString=function(e){return this.options.writer.document(this,this.options.writer.filterOptions(e))},n.prototype.createElement=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.createDocumentFragment=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.createTextNode=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.createComment=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.createCDATASection=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.createProcessingInstruction=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.createAttribute=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.createEntityReference=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.getElementsByTagName=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.importNode=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.createElementNS=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.createAttributeNS=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.getElementsByTagNameNS=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.getElementById=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.adoptNode=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.normalizeDocument=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.renameNode=function(e,t,n){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.getElementsByClassName=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.createEvent=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.createRange=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.createNodeIterator=function(e,t,n){throw new Error("This DOM method is not implemented."+this.debugInfo())},n.prototype.createTreeWalker=function(e,t,n){throw new Error("This DOM method is not implemented."+this.debugInfo())},n}(o)}).call(this)},function(e,t,n){(function(){var t;t=n(8),n(18),e.exports=function(){function e(e,n,r){if(this.parent=e,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),null==n)throw new Error("Missing attribute name. "+this.debugInfo(n));this.name=this.stringify.name(n),this.value=this.stringify.attValue(r),this.type=t.Attribute,this.isId=!1,this.schemaTypeInfo=null}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(e.prototype,"ownerElement",{get:function(){return this.parent}}),Object.defineProperty(e.prototype,"textContent",{get:function(){return this.value},set:function(e){return this.value=e||""}}),Object.defineProperty(e.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(e.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(e.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(e.prototype,"specified",{get:function(){return!0}}),e.prototype.clone=function(){return Object.create(this)},e.prototype.toString=function(e){return this.options.writer.attribute(this,this.options.writer.filterOptions(e))},e.prototype.debugInfo=function(e){return null==(e=e||this.name)?"parent: <"+this.parent.name+">":"attribute: {"+e+"}, parent: <"+this.parent.name+">"},e.prototype.isEqualNode=function(e){return e.namespaceURI===this.namespaceURI&&(e.prefix===this.prefix&&(e.localName===this.localName&&e.value===this.value))},e}()}).call(this)},function(e,t,n){(function(){var t,r,i={}.hasOwnProperty;r=n(18),t=n(8),e.exports=function(e){function n(e){n.__super__.constructor.call(this,e),this.type=t.Dummy}return function(e,t){for(var n in t)i.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(n,e),n.prototype.clone=function(){return Object.create(this)},n.prototype.toString=function(e){return""},n}(r)}).call(this)},function(e,t){(function(){var t=function(e,t){return function(){return e.apply(t,arguments)}},n={}.hasOwnProperty;e.exports=function(){function e(e){var r,i,o;for(r in this.assertLegalName=t(this.assertLegalName,this),this.assertLegalChar=t(this.assertLegalChar,this),e||(e={}),this.options=e,this.options.version||(this.options.version="1.0"),i=e.stringify||{})n.call(i,r)&&(o=i[r],this[r]=o)}return e.prototype.name=function(e){return this.options.noValidation?e:this.assertLegalName(""+e||"")},e.prototype.text=function(e){return this.options.noValidation?e:this.assertLegalChar(this.textEscape(""+e||""))},e.prototype.cdata=function(e){return this.options.noValidation?e:(e=(e=""+e||"").replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(e))},e.prototype.comment=function(e){if(this.options.noValidation)return e;if((e=""+e||"").match(/--/))throw new Error("Comment text cannot contain double-hypen: "+e);return this.assertLegalChar(e)},e.prototype.raw=function(e){return this.options.noValidation?e:""+e||""},e.prototype.attValue=function(e){return this.options.noValidation?e:this.assertLegalChar(this.attEscape(e=""+e||""))},e.prototype.insTarget=function(e){return this.options.noValidation?e:this.assertLegalChar(""+e||"")},e.prototype.insValue=function(e){if(this.options.noValidation)return e;if((e=""+e||"").match(/\?>/))throw new Error("Invalid processing instruction value: "+e);return this.assertLegalChar(e)},e.prototype.xmlVersion=function(e){if(this.options.noValidation)return e;if(!(e=""+e||"").match(/1\.[0-9]+/))throw new Error("Invalid version number: "+e);return e},e.prototype.xmlEncoding=function(e){if(this.options.noValidation)return e;if(!(e=""+e||"").match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+e);return this.assertLegalChar(e)},e.prototype.xmlStandalone=function(e){return this.options.noValidation?e:e?"yes":"no"},e.prototype.dtdPubID=function(e){return this.options.noValidation?e:this.assertLegalChar(""+e||"")},e.prototype.dtdSysID=function(e){return this.options.noValidation?e:this.assertLegalChar(""+e||"")},e.prototype.dtdElementValue=function(e){return this.options.noValidation?e:this.assertLegalChar(""+e||"")},e.prototype.dtdAttType=function(e){return this.options.noValidation?e:this.assertLegalChar(""+e||"")},e.prototype.dtdAttDefault=function(e){return this.options.noValidation?e:this.assertLegalChar(""+e||"")},e.prototype.dtdEntityValue=function(e){return this.options.noValidation?e:this.assertLegalChar(""+e||"")},e.prototype.dtdNData=function(e){return this.options.noValidation?e:this.assertLegalChar(""+e||"")},e.prototype.convertAttKey="@",e.prototype.convertPIKey="?",e.prototype.convertTextKey="#text",e.prototype.convertCDataKey="#cdata",e.prototype.convertCommentKey="#comment",e.prototype.convertRawKey="#raw",e.prototype.assertLegalChar=function(e){var t,n;if(this.options.noValidation)return e;if(t="","1.0"===this.options.version){if(t=/[\0-\x08\x0B\f\x0E-\x1F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,n=e.match(t))throw new Error("Invalid character in string: "+e+" at index "+n.index)}else if("1.1"===this.options.version&&(t=/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,n=e.match(t)))throw new Error("Invalid character in string: "+e+" at index "+n.index);return e},e.prototype.assertLegalName=function(e){var t;if(this.options.noValidation)return e;if(this.assertLegalChar(e),t=/^([:A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])([\x2D\.0-:A-Z_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/,!e.match(t))throw new Error("Invalid character in name");return e},e.prototype.textEscape=function(e){var t;return this.options.noValidation?e:(t=this.options.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,e.replace(t,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;"))},e.prototype.attEscape=function(e){var t;return this.options.noValidation?e:(t=this.options.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,e.replace(t,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;"))},e}()}).call(this)},function(e,t,n){(function(){var t,r,i,o={}.hasOwnProperty;i=n(29).assign,t=n(8),n(111),n(112),n(109),n(110),n(107),n(117),n(118),n(119),n(165),n(113),n(115),n(114),n(116),r=n(73),e.exports=function(){function e(e){var t,n,r;for(t in e||(e={}),this.options=e,n=e.writer||{})o.call(n,t)&&(r=n[t],this["_"+t]=this[t],this[t]=r)}return e.prototype.filterOptions=function(e){var t,n,o,a,s,u,c,l;return e||(e={}),e=i({},this.options,e),(t={writer:this}).pretty=e.pretty||!1,t.allowEmpty=e.allowEmpty||!1,t.indent=null!=(n=e.indent)?n:"  ",t.newline=null!=(o=e.newline)?o:"\n",t.offset=null!=(a=e.offset)?a:0,t.dontPrettyTextNodes=null!=(s=null!=(u=e.dontPrettyTextNodes)?u:e.dontprettytextnodes)?s:0,t.spaceBeforeSlash=null!=(c=null!=(l=e.spaceBeforeSlash)?l:e.spacebeforeslash)?c:"",!0===t.spaceBeforeSlash&&(t.spaceBeforeSlash=" "),t.suppressPrettyCount=0,t.user={},t.state=r.None,t},e.prototype.indent=function(e,t,n){var r;return!t.pretty||t.suppressPrettyCount?"":t.pretty&&(r=(n||0)+t.offset+1)>0?new Array(r).join(t.indent):""},e.prototype.endline=function(e,t,n){return!t.pretty||t.suppressPrettyCount?"":t.newline},e.prototype.attribute=function(e,t,n){var r;return this.openAttribute(e,t,n),r=" "+e.name+'="'+e.value+'"',this.closeAttribute(e,t,n),r},e.prototype.cdata=function(e,t,n){var i;return this.openNode(e,t,n),t.state=r.OpenTag,i=this.indent(e,t,n)+"<![CDATA[",t.state=r.InsideTag,i+=e.value,t.state=r.CloseTag,i+="]]>"+this.endline(e,t,n),t.state=r.None,this.closeNode(e,t,n),i},e.prototype.comment=function(e,t,n){var i;return this.openNode(e,t,n),t.state=r.OpenTag,i=this.indent(e,t,n)+"\x3c!-- ",t.state=r.InsideTag,i+=e.value,t.state=r.CloseTag,i+=" --\x3e"+this.endline(e,t,n),t.state=r.None,this.closeNode(e,t,n),i},e.prototype.declaration=function(e,t,n){var i;return this.openNode(e,t,n),t.state=r.OpenTag,i=this.indent(e,t,n)+"<?xml",t.state=r.InsideTag,i+=' version="'+e.version+'"',null!=e.encoding&&(i+=' encoding="'+e.encoding+'"'),null!=e.standalone&&(i+=' standalone="'+e.standalone+'"'),t.state=r.CloseTag,i+=t.spaceBeforeSlash+"?>",i+=this.endline(e,t,n),t.state=r.None,this.closeNode(e,t,n),i},e.prototype.docType=function(e,t,n){var i,o,a,s,u;if(n||(n=0),this.openNode(e,t,n),t.state=r.OpenTag,s=this.indent(e,t,n),s+="<!DOCTYPE "+e.root().name,e.pubID&&e.sysID?s+=' PUBLIC "'+e.pubID+'" "'+e.sysID+'"':e.sysID&&(s+=' SYSTEM "'+e.sysID+'"'),e.children.length>0){for(s+=" [",s+=this.endline(e,t,n),t.state=r.InsideTag,o=0,a=(u=e.children).length;o<a;o++)i=u[o],s+=this.writeChildNode(i,t,n+1);t.state=r.CloseTag,s+="]"}return t.state=r.CloseTag,s+=t.spaceBeforeSlash+">",s+=this.endline(e,t,n),t.state=r.None,this.closeNode(e,t,n),s},e.prototype.element=function(e,n,i){var a,s,u,c,l,h,p,f,d,m,v,g,y,b;for(d in i||(i=0),m=!1,v="",this.openNode(e,n,i),n.state=r.OpenTag,v+=this.indent(e,n,i)+"<"+e.name,g=e.attribs)o.call(g,d)&&(a=g[d],v+=this.attribute(a,n,i));if(c=0===(u=e.children.length)?null:e.children[0],0===u||e.children.every((function(e){return(e.type===t.Text||e.type===t.Raw)&&""===e.value})))n.allowEmpty?(v+=">",n.state=r.CloseTag,v+="</"+e.name+">"+this.endline(e,n,i)):(n.state=r.CloseTag,v+=n.spaceBeforeSlash+"/>"+this.endline(e,n,i));else if(!n.pretty||1!==u||c.type!==t.Text&&c.type!==t.Raw||null==c.value){if(n.dontPrettyTextNodes)for(l=0,p=(y=e.children).length;l<p;l++)if(((s=y[l]).type===t.Text||s.type===t.Raw)&&null!=s.value){n.suppressPrettyCount++,m=!0;break}for(v+=">"+this.endline(e,n,i),n.state=r.InsideTag,h=0,f=(b=e.children).length;h<f;h++)s=b[h],v+=this.writeChildNode(s,n,i+1);n.state=r.CloseTag,v+=this.indent(e,n,i)+"</"+e.name+">",m&&n.suppressPrettyCount--,v+=this.endline(e,n,i),n.state=r.None}else v+=">",n.state=r.InsideTag,n.suppressPrettyCount++,m=!0,v+=this.writeChildNode(c,n,i+1),n.suppressPrettyCount--,m=!1,n.state=r.CloseTag,v+="</"+e.name+">"+this.endline(e,n,i);return this.closeNode(e,n,i),v},e.prototype.writeChildNode=function(e,n,r){switch(e.type){case t.CData:return this.cdata(e,n,r);case t.Comment:return this.comment(e,n,r);case t.Element:return this.element(e,n,r);case t.Raw:return this.raw(e,n,r);case t.Text:return this.text(e,n,r);case t.ProcessingInstruction:return this.processingInstruction(e,n,r);case t.Dummy:return"";case t.Declaration:return this.declaration(e,n,r);case t.DocType:return this.docType(e,n,r);case t.AttributeDeclaration:return this.dtdAttList(e,n,r);case t.ElementDeclaration:return this.dtdElement(e,n,r);case t.EntityDeclaration:return this.dtdEntity(e,n,r);case t.NotationDeclaration:return this.dtdNotation(e,n,r);default:throw new Error("Unknown XML node type: "+e.constructor.name)}},e.prototype.processingInstruction=function(e,t,n){var i;return this.openNode(e,t,n),t.state=r.OpenTag,i=this.indent(e,t,n)+"<?",t.state=r.InsideTag,i+=e.target,e.value&&(i+=" "+e.value),t.state=r.CloseTag,i+=t.spaceBeforeSlash+"?>",i+=this.endline(e,t,n),t.state=r.None,this.closeNode(e,t,n),i},e.prototype.raw=function(e,t,n){var i;return this.openNode(e,t,n),t.state=r.OpenTag,i=this.indent(e,t,n),t.state=r.InsideTag,i+=e.value,t.state=r.CloseTag,i+=this.endline(e,t,n),t.state=r.None,this.closeNode(e,t,n),i},e.prototype.text=function(e,t,n){var i;return this.openNode(e,t,n),t.state=r.OpenTag,i=this.indent(e,t,n),t.state=r.InsideTag,i+=e.value,t.state=r.CloseTag,i+=this.endline(e,t,n),t.state=r.None,this.closeNode(e,t,n),i},e.prototype.dtdAttList=function(e,t,n){var i;return this.openNode(e,t,n),t.state=r.OpenTag,i=this.indent(e,t,n)+"<!ATTLIST",t.state=r.InsideTag,i+=" "+e.elementName+" "+e.attributeName+" "+e.attributeType,"#DEFAULT"!==e.defaultValueType&&(i+=" "+e.defaultValueType),e.defaultValue&&(i+=' "'+e.defaultValue+'"'),t.state=r.CloseTag,i+=t.spaceBeforeSlash+">"+this.endline(e,t,n),t.state=r.None,this.closeNode(e,t,n),i},e.prototype.dtdElement=function(e,t,n){var i;return this.openNode(e,t,n),t.state=r.OpenTag,i=this.indent(e,t,n)+"<!ELEMENT",t.state=r.InsideTag,i+=" "+e.name+" "+e.value,t.state=r.CloseTag,i+=t.spaceBeforeSlash+">"+this.endline(e,t,n),t.state=r.None,this.closeNode(e,t,n),i},e.prototype.dtdEntity=function(e,t,n){var i;return this.openNode(e,t,n),t.state=r.OpenTag,i=this.indent(e,t,n)+"<!ENTITY",t.state=r.InsideTag,e.pe&&(i+=" %"),i+=" "+e.name,e.value?i+=' "'+e.value+'"':(e.pubID&&e.sysID?i+=' PUBLIC "'+e.pubID+'" "'+e.sysID+'"':e.sysID&&(i+=' SYSTEM "'+e.sysID+'"'),e.nData&&(i+=" NDATA "+e.nData)),t.state=r.CloseTag,i+=t.spaceBeforeSlash+">"+this.endline(e,t,n),t.state=r.None,this.closeNode(e,t,n),i},e.prototype.dtdNotation=function(e,t,n){var i;return this.openNode(e,t,n),t.state=r.OpenTag,i=this.indent(e,t,n)+"<!NOTATION",t.state=r.InsideTag,i+=" "+e.name,e.pubID&&e.sysID?i+=' PUBLIC "'+e.pubID+'" "'+e.sysID+'"':e.pubID?i+=' PUBLIC "'+e.pubID+'"':e.sysID&&(i+=' SYSTEM "'+e.sysID+'"'),t.state=r.CloseTag,i+=t.spaceBeforeSlash+">"+this.endline(e,t,n),t.state=r.None,this.closeNode(e,t,n),i},e.prototype.openNode=function(e,t,n){},e.prototype.closeNode=function(e,t,n){},e.prototype.openAttribute=function(e,t,n){},e.prototype.closeAttribute=function(e,t,n){},e}()}).call(this)},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";(function(t,r){var i=n(76);e.exports=b;var o,a=n(168);b.ReadableState=y;n(75).EventEmitter;var s=function(e,t){return e.listeners(t).length},u=n(170),c=n(122).Buffer,l=t.Uint8Array||function(){};var h=n(58);h.inherits=n(51);var p=n(397),f=void 0;f=p&&p.debuglog?p.debuglog("stream"):function(){};var d,m=n(398),v=n(171);h.inherits(b,u);var g=["error","close","destroy","pause","resume"];function y(e,t){e=e||{};var r=t instanceof(o=o||n(43));this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,a=e.readableHighWaterMark,s=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(a||0===a)?a:s,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(d||(d=n(124).StringDecoder),this.decoder=new d(e.encoding),this.encoding=e.encoding)}function b(e){if(o=o||n(43),!(this instanceof b))return new b(e);this._readableState=new y(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),u.call(this)}function x(e,t,n,r,i){var o,a=e._readableState;null===t?(a.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,S(e)}(e,a)):(i||(o=function(e,t){var n;r=t,c.isBuffer(r)||r instanceof l||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk"));var r;return n}(a,t)),o?e.emit("error",o):a.objectMode||t&&t.length>0?("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===c.prototype||(t=function(e){return c.from(e)}(t)),r?a.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):w(e,a,t,!0):a.ended?e.emit("error",new Error("stream.push() after EOF")):(a.reading=!1,a.decoder&&!n?(t=a.decoder.write(t),a.objectMode||0!==t.length?w(e,a,t,!1):E(e,a)):w(e,a,t,!1))):r||(a.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(a)}function w(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&S(e)),E(e,t)}Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),b.prototype.destroy=v.destroy,b.prototype._undestroy=v.undestroy,b.prototype._destroy=function(e,t){this.push(null),t(e)},b.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=c.from(e,t),t=""),n=!0),x(this,e,t,!1,n)},b.prototype.unshift=function(e){return x(this,e,null,!0,!1)},b.prototype.isPaused=function(){return!1===this._readableState.flowing},b.prototype.setEncoding=function(e){return d||(d=n(124).StringDecoder),this._readableState.decoder=new d(e),this._readableState.encoding=e,this};var _=8388608;function T(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=_?e=_:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function S(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(M,e):M(e))}function M(e){f("emit readable"),e.emit("readable"),L(e)}function E(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(A,e,t))}function A(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(f("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function P(e){f("readable nexttick read 0"),e.read(0)}function O(e,t){t.reading||(f("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),L(e),t.flowing&&!t.reading&&e.read(0)}function L(e){var t=e._readableState;for(f("flow",t.flowing);t.flowing&&null!==e.read(););}function I(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;e-=i.length;for(;n=n.next;){var o=n.data,a=e>o.length?o.length:e;if(a===o.length?i+=o:i+=o.slice(0,e),0===(e-=a)){a===o.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(a));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=c.allocUnsafe(e),r=t.head,i=1;r.data.copy(n),e-=r.data.length;for(;r=r.next;){var o=r.data,a=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,a),0===(e-=a)){a===o.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(a));break}++i}return t.length-=i,n}(e,t);return r}(e,t.buffer,t.decoder),n);var n}function C(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(R,t,e))}function R(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function D(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}b.prototype.read=function(e){f("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?C(this):S(this),null;if(0===(e=T(e,t))&&t.ended)return 0===t.length&&C(this),null;var r,i=t.needReadable;return f("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",i=!0),t.ended||t.reading?f("reading or ended",i=!1):i&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=T(n,t))),null===(r=e>0?I(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&C(this)),null!==r&&this.emit("data",r),r},b.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},b.prototype.pipe=function(e,t){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,f("pipe count=%d opts=%j",o.pipesCount,t);var u=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?l:b;function c(t,r){f("onunpipe"),t===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,f("cleanup"),e.removeListener("close",g),e.removeListener("finish",y),e.removeListener("drain",h),e.removeListener("error",v),e.removeListener("unpipe",c),n.removeListener("end",l),n.removeListener("end",b),n.removeListener("data",m),p=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||h())}function l(){f("onend"),e.end()}o.endEmitted?i.nextTick(u):n.once("end",u),e.on("unpipe",c);var h=function(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,L(e))}}(n);e.on("drain",h);var p=!1;var d=!1;function m(t){f("ondata"),d=!1,!1!==e.write(t)||d||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==D(o.pipes,e))&&!p&&(f("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,d=!0),n.pause())}function v(t){f("onerror",t),b(),e.removeListener("error",v),0===s(e,"error")&&e.emit("error",t)}function g(){e.removeListener("finish",y),b()}function y(){f("onfinish"),e.removeListener("close",g),b()}function b(){f("unpipe"),n.unpipe(e)}return n.on("data",m),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?a(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",v),e.once("close",g),e.once("finish",y),e.emit("pipe",n),o.flowing||(f("pipe resume"),n.resume()),e},b.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n),this);if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,n);return this}var a=D(t.pipes,e);return-1===a?this:(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n),this)},b.prototype.on=function(e,t){var n=u.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&S(this):i.nextTick(P,this))}return n},b.prototype.addListener=b.prototype.on,b.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(O,e,t))}(this,e)),this},b.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},b.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",(function(){if(f("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){(f("wrapped data"),n.decoder&&(i=n.decoder.write(i)),n.objectMode&&null==i)||(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<g.length;o++)e.on(g[o],this.emit.bind(this,g[o]));return this._read=function(t){f("wrapped _read",t),r&&(r=!1,e.resume())},this},Object.defineProperty(b.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),b._fromList=I}).call(this,n(42),n(50))},function(e,t,n){e.exports=n(75).EventEmitter},function(e,t,n){"use strict";var r=n(76);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,o=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;return o||a?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||r.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(r.nextTick(i,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(400),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(42))},function(e,t,n){"use strict";e.exports=a;var r=n(43),i=n(58);function o(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function a(e){if(!(this instanceof a))return new a(e);r.call(this,e),this._transformState={afterTransform:o.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",s)}function s(){var e=this;"function"==typeof this._flush?this._flush((function(t,n){u(e,t,n)})):u(this,null,null)}function u(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=n(51),i.inherits(a,r),a.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},a.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},a.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},a.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},a.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,(function(e){t(e),n.emit("close")}))}},function(e,t){(function(){"use strict";var e;e=new RegExp(/(?!xmlns)^.*:/),t.normalize=function(e){return e.toLowerCase()},t.firstCharLowerCase=function(e){return e.charAt(0).toLowerCase()+e.slice(1)},t.stripPrefix=function(t){return t.replace(e,"")},t.parseNumbers=function(e){return isNaN(e)||(e=e%1==0?parseInt(e,10):parseFloat(e)),e},t.parseBooleans=function(e){return/^(?:true|false)$/i.test(e)&&(e="true"===e.toLowerCase()),e}}).call(this)},function(e,t,n){"use strict";var r=Array.prototype.slice,i=n(176),o=Object.keys,a=o?function(e){return o(e)}:n(410),s=Object.keys;a.shim=function(){Object.keys?function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2)||(Object.keys=function(e){return i(e)?s(r.call(e)):s(e)}):Object.keys=a;return Object.keys||a},e.exports=a},function(e,t,n){"use strict";var r=Object.prototype.toString;e.exports=function(e){var t=r.call(e),n="[object Arguments]"===t;return n||(n="[object Array]"!==t&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===r.call(e.callee)),n}},function(e,t,n){"use strict";if(!("function"==typeof Object.defineProperty&&"function"==typeof Object.defineProperties&&"function"==typeof Object.getPrototypeOf&&"function"==typeof Object.setPrototypeOf))throw new TypeError("util.promisify requires a true ES5 environment");var r=n(413);if("function"!=typeof Promise)throw new TypeError("`Promise` must be globally available for util.promisify to work.");var i=Function.call.bind(Array.prototype.slice),o=Function.call.bind(Array.prototype.concat),a=Function.call.bind(Array.prototype.forEach),s="function"==typeof Symbol&&"symbol"==typeof Symbol(""),u=s?Symbol("util.promisify.custom"):null,c=s?Symbol("customPromisifyArgs"):null;e.exports=function(e){if("function"!=typeof e){var t=new TypeError('The "original" argument must be of type function');throw t.name="TypeError [ERR_INVALID_ARG_TYPE]",t.code="ERR_INVALID_ARG_TYPE",t}if(s&&e[u]){var n=e[u];if("function"!=typeof n)throw new TypeError("The [util.promisify.custom] property must be a function");return Object.defineProperty(n,u,{configurable:!0,enumerable:!1,value:n,writable:!1}),n}var l=e[c],h=function(){var t=i(arguments),n=this;return new Promise((function(r,s){e.apply(n,o(t,(function(e){var t=arguments.length>1?i(arguments,1):[];if(e)s(e);else if(void 0!==l&&t.length>1){var n={};a(l,(function(e,r){n[e]=t[r]})),r(n)}else r(t[0])})))}))};return Object.setPrototypeOf(h,Object.getPrototypeOf(e)),Object.defineProperty(h,u,{configurable:!0,enumerable:!1,value:h,writable:!1}),Object.defineProperties(h,r(e))},e.exports.custom=u,e.exports.customPromisifyArgs=c},function(e,t,n){"use strict";var r=n(414),i=Object.defineProperty,o=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,s=Object.getOwnPropertySymbols,u=Function.call.bind(Array.prototype.concat),c=Function.call.bind(Array.prototype.reduce),l=s?function(e){return u(a(e),s(e))}:a,h=r.IsCallable(o)&&r.IsCallable(a);e.exports=function(e){if(r.RequireObjectCoercible(e),!h)throw new TypeError("getOwnPropertyDescriptors requires Object.getOwnPropertyDescriptor");var t=r.ToObject(e);return c(l(t),(function(e,n){var r,a,s,u=o(t,n);return void 0!==u&&(r=e,a=n,s=u,i&&a in r?i(r,a,{configurable:!0,enumerable:!0,value:s,writable:!0}):r[a]=s),e}),{})}},function(e,t,n){"use strict";e.exports=function(e){return null===e||"function"!=typeof e&&"object"!=typeof e}},function(e,t,n){"use strict";var r=n(12),i=r("%TypeError%"),o=r("%SyntaxError%"),a=n(52),s={"Property Descriptor":function(e,t){if("Object"!==e.Type(t))return!1;var n={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};for(var r in t)if(a(t,r)&&!n[r])return!1;var o=a(t,"[[Value]]"),s=a(t,"[[Get]]")||a(t,"[[Set]]");if(o&&s)throw new i("Property Descriptors may not be both accessor and data descriptors");return!0}};e.exports=function(e,t,n,r){var a=s[t];if("function"!=typeof a)throw new o("unknown record type: "+t);if(!a(e,r))throw new i(n+" must be a "+t)}},function(e,t,n){"use strict";e.exports=Number.isNaN||function(e){return e!=e}},function(e,t,n){"use strict";var r=Number.isNaN||function(e){return e!=e};e.exports=Number.isFinite||function(e){return"number"==typeof e&&!r(e)&&e!==1/0&&e!==-1/0}},function(e,t,n){"use strict";var r=n(12),i=n(52),o=r("%Object%").assign;e.exports=function(e,t){if(o)return o(e,t);for(var n in t)i(t,n)&&(e[n]=t[n]);return e}},function(e,t,n){"use strict";e.exports=function(e){return e>=0?1:-1}},function(e,t,n){"use strict";e.exports=function(e,t){var n=e%t;return Math.floor(n>=0?n:n+t)}},function(e,t,n){"use strict";e.exports=function(e,t){for(var n=0;n<e.length;n+=1)if(!t(e[n],n,e))return!1;return!0}},function(e,t,n){"use strict";var r=n(12),i=n(52),o=r("%TypeError%");e.exports=function(e,t){if("Object"!==e.Type(t))return!1;var n={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};for(var r in t)if(i(t,r)&&!n[r])return!1;if(e.IsDataDescriptor(t)&&e.IsAccessorDescriptor(t))throw new o("Property Descriptors may not be both accessor and data descriptors");return!0}},function(e,t,n){"use strict";var r=n(127),i=n(12)("%Function%"),o=i.apply,a=i.call;e.exports=function(){return r.apply(a,arguments)},e.exports.apply=function(){return r.apply(o,arguments)}},function(e,t,n){"use strict";var r=n(77)(),i=n(12),o=n(53),a=i("%Symbol.iterator%",!0),s=o("Array.prototype.slice"),u=o("Array.prototype.join");e.exports=function(e,t){var n;return r?n=e.GetMethod(t,a):e.IsArray(t)?n=function(){var e=-1,t=this;return{next:function(){return{done:(e+=1)>=t.length,value:t[e]}}}}:"String"===e.Type(t)&&(n=function(){var n=0;return{next:function(){var r=e.AdvanceStringIndex(t,n,!0),i=u(s(t,n,r),"");return n=r,{done:r>t.length,value:i}}}}),n}},function(e,t,n){"use strict";var r=n(12),i=r("%Object.setPrototypeOf%",!0),o=r("%Array.prototype%");e.exports=i||([].__proto__!==o?null:function(e,t){return e.__proto__=t,e})},function(e,t,n){"use strict";var r=n(178);e.exports=function(){return"function"==typeof Object.getOwnPropertyDescriptors?Object.getOwnPropertyDescriptors:r}},function(e,t,n){"use strict";var r=n(126),i=n(177);e.exports=function(){return"function"==typeof r.promisify?r.promisify:i}},function(e,t,n){(function(){"use strict";var e,r,i,o,a={}.hasOwnProperty;r=n(106),e=n(383),i=n(392),o=n(174),t.defaults=r.defaults,t.processors=o,t.ValidationError=function(e){function t(e){this.message=e}return function(e,t){for(var n in t)a.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,Error),t}(),t.Builder=e.Builder,t.Parser=i.Parser,t.parseString=i.parseString,t.parseStringPromise=i.parseStringPromise}).call(this)},function(e,t,n){n(195),e.exports=n(440)},function(e,t,n){"use strict";n(196);var r,i=(r=n(368))&&r.__esModule?r:{default:r};i.default._babelPolyfill&&"undefined"!=typeof console&&console.warn&&console.warn("@babel/polyfill is loaded more than once on this page. This is probably not desirable/intended and may have consequences if different versions of the polyfills are applied sequentially. If you do need to load the polyfill more than once, use @babel/polyfill/noConflict instead to bypass the warning."),i.default._babelPolyfill=!0},function(e,t,n){"use strict";n(197),n(340),n(342),n(345),n(347),n(349),n(351),n(353),n(355),n(357),n(359),n(361),n(363),n(367)},function(e,t,n){n(198),n(201),n(202),n(203),n(204),n(205),n(206),n(207),n(208),n(209),n(210),n(211),n(212),n(213),n(214),n(215),n(216),n(217),n(218),n(219),n(220),n(221),n(222),n(223),n(224),n(225),n(226),n(227),n(228),n(229),n(230),n(231),n(232),n(233),n(234),n(235),n(236),n(237),n(238),n(239),n(240),n(241),n(242),n(244),n(245),n(246),n(247),n(248),n(249),n(250),n(251),n(252),n(253),n(254),n(255),n(256),n(257),n(258),n(259),n(260),n(261),n(262),n(263),n(264),n(265),n(266),n(267),n(268),n(269),n(270),n(271),n(272),n(273),n(274),n(275),n(276),n(277),n(279),n(280),n(282),n(283),n(284),n(285),n(286),n(287),n(288),n(290),n(291),n(292),n(293),n(294),n(295),n(296),n(297),n(298),n(299),n(300),n(301),n(302),n(98),n(303),n(149),n(304),n(150),n(305),n(306),n(307),n(308),n(151),n(311),n(312),n(313),n(314),n(315),n(316),n(317),n(318),n(319),n(320),n(321),n(322),n(323),n(324),n(325),n(326),n(327),n(328),n(329),n(330),n(331),n(332),n(333),n(334),n(335),n(336),n(337),n(338),n(339),e.exports=n(7)},function(e,t,n){"use strict";var r=n(1),i=n(15),o=n(9),a=n(0),s=n(13),u=n(31).KEY,c=n(2),l=n(60),h=n(44),p=n(33),f=n(5),d=n(79),m=n(130),v=n(200),g=n(63),y=n(3),b=n(4),x=n(11),w=n(17),_=n(30),T=n(32),S=n(37),M=n(133),E=n(23),A=n(62),P=n(10),O=n(35),L=E.f,I=P.f,C=M.f,R=r.Symbol,D=r.JSON,N=D&&D.stringify,F=f("_hidden"),j=f("toPrimitive"),U={}.propertyIsEnumerable,B=l("symbol-registry"),k=l("symbols"),z=l("op-symbols"),G=Object.prototype,V="function"==typeof R&&!!A.f,H=r.QObject,W=!H||!H.prototype||!H.prototype.findChild,X=o&&c((function(){return 7!=S(I({},"a",{get:function(){return I(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=L(G,t);r&&delete G[t],I(e,t,n),r&&e!==G&&I(G,t,r)}:I,Y=function(e){var t=k[e]=S(R.prototype);return t._k=e,t},q=V&&"symbol"==typeof R.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof R},Q=function(e,t,n){return e===G&&Q(z,t,n),y(e),t=_(t,!0),y(n),i(k,t)?(n.enumerable?(i(e,F)&&e[F][t]&&(e[F][t]=!1),n=S(n,{enumerable:T(0,!1)})):(i(e,F)||I(e,F,T(1,{})),e[F][t]=!0),X(e,t,n)):I(e,t,n)},Z=function(e,t){y(e);for(var n,r=v(t=w(t)),i=0,o=r.length;o>i;)Q(e,n=r[i++],t[n]);return e},K=function(e){var t=U.call(this,e=_(e,!0));return!(this===G&&i(k,e)&&!i(z,e))&&(!(t||!i(this,e)||!i(k,e)||i(this,F)&&this[F][e])||t)},J=function(e,t){if(e=w(e),t=_(t,!0),e!==G||!i(k,t)||i(z,t)){var n=L(e,t);return!n||!i(k,t)||i(e,F)&&e[F][t]||(n.enumerable=!0),n}},$=function(e){for(var t,n=C(w(e)),r=[],o=0;n.length>o;)i(k,t=n[o++])||t==F||t==u||r.push(t);return r},ee=function(e){for(var t,n=e===G,r=C(n?z:w(e)),o=[],a=0;r.length>a;)!i(k,t=r[a++])||n&&!i(G,t)||o.push(k[t]);return o};V||(s((R=function(){if(this instanceof R)throw TypeError("Symbol is not a constructor!");var e=p(arguments.length>0?arguments[0]:void 0),t=function(n){this===G&&t.call(z,n),i(this,F)&&i(this[F],e)&&(this[F][e]=!1),X(this,e,T(1,n))};return o&&W&&X(G,e,{configurable:!0,set:t}),Y(e)}).prototype,"toString",(function(){return this._k})),E.f=J,P.f=Q,n(38).f=M.f=$,n(55).f=K,A.f=ee,o&&!n(34)&&s(G,"propertyIsEnumerable",K,!0),d.f=function(e){return Y(f(e))}),a(a.G+a.W+a.F*!V,{Symbol:R});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)f(te[ne++]);for(var re=O(f.store),ie=0;re.length>ie;)m(re[ie++]);a(a.S+a.F*!V,"Symbol",{for:function(e){return i(B,e+="")?B[e]:B[e]=R(e)},keyFor:function(e){if(!q(e))throw TypeError(e+" is not a symbol!");for(var t in B)if(B[t]===e)return t},useSetter:function(){W=!0},useSimple:function(){W=!1}}),a(a.S+a.F*!V,"Object",{create:function(e,t){return void 0===t?S(e):Z(S(e),t)},defineProperty:Q,defineProperties:Z,getOwnPropertyDescriptor:J,getOwnPropertyNames:$,getOwnPropertySymbols:ee});var oe=c((function(){A.f(1)}));a(a.S+a.F*oe,"Object",{getOwnPropertySymbols:function(e){return A.f(x(e))}}),D&&a(a.S+a.F*(!V||c((function(){var e=R();return"[null]"!=N([e])||"{}"!=N({a:e})||"{}"!=N(Object(e))}))),"JSON",{stringify:function(e){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=t=r[1],(b(t)||void 0!==e)&&!q(e))return g(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!q(t))return t}),r[1]=t,N.apply(D,r)}}),R.prototype[j]||n(16)(R.prototype,j,R.prototype.valueOf),h(R,"Symbol"),h(Math,"Math",!0),h(r.JSON,"JSON",!0)},function(e,t,n){e.exports=n(60)("native-function-to-string",Function.toString)},function(e,t,n){var r=n(35),i=n(62),o=n(55);e.exports=function(e){var t=r(e),n=i.f;if(n)for(var a,s=n(e),u=o.f,c=0;s.length>c;)u.call(e,a=s[c++])&&t.push(a);return t}},function(e,t,n){var r=n(0);r(r.S,"Object",{create:n(37)})},function(e,t,n){var r=n(0);r(r.S+r.F*!n(9),"Object",{defineProperty:n(10).f})},function(e,t,n){var r=n(0);r(r.S+r.F*!n(9),"Object",{defineProperties:n(132)})},function(e,t,n){var r=n(17),i=n(23).f;n(24)("getOwnPropertyDescriptor",(function(){return function(e,t){return i(r(e),t)}}))},function(e,t,n){var r=n(11),i=n(39);n(24)("getPrototypeOf",(function(){return function(e){return i(r(e))}}))},function(e,t,n){var r=n(11),i=n(35);n(24)("keys",(function(){return function(e){return i(r(e))}}))},function(e,t,n){n(24)("getOwnPropertyNames",(function(){return n(133).f}))},function(e,t,n){var r=n(4),i=n(31).onFreeze;n(24)("freeze",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},function(e,t,n){var r=n(4),i=n(31).onFreeze;n(24)("seal",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},function(e,t,n){var r=n(4),i=n(31).onFreeze;n(24)("preventExtensions",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},function(e,t,n){var r=n(4);n(24)("isFrozen",(function(e){return function(t){return!r(t)||!!e&&e(t)}}))},function(e,t,n){var r=n(4);n(24)("isSealed",(function(e){return function(t){return!r(t)||!!e&&e(t)}}))},function(e,t,n){var r=n(4);n(24)("isExtensible",(function(e){return function(t){return!!r(t)&&(!e||e(t))}}))},function(e,t,n){var r=n(0);r(r.S+r.F,"Object",{assign:n(134)})},function(e,t,n){var r=n(0);r(r.S,"Object",{is:n(135)})},function(e,t,n){var r=n(0);r(r.S,"Object",{setPrototypeOf:n(83).set})},function(e,t,n){"use strict";var r=n(56),i={};i[n(5)("toStringTag")]="z",i+""!="[object z]"&&n(13)(Object.prototype,"toString",(function(){return"[object "+r(this)+"]"}),!0)},function(e,t,n){var r=n(0);r(r.P,"Function",{bind:n(136)})},function(e,t,n){var r=n(10).f,i=Function.prototype,o=/^\s*function ([^ (]*)/;"name"in i||n(9)&&r(i,"name",{configurable:!0,get:function(){try{return(""+this).match(o)[1]}catch(e){return""}}})},function(e,t,n){"use strict";var r=n(4),i=n(39),o=n(5)("hasInstance"),a=Function.prototype;o in a||n(10).f(a,o,{value:function(e){if("function"!=typeof this||!r(e))return!1;if(!r(this.prototype))return e instanceof this;for(;e=i(e);)if(this.prototype===e)return!0;return!1}})},function(e,t,n){var r=n(0),i=n(138);r(r.G+r.F*(parseInt!=i),{parseInt:i})},function(e,t,n){var r=n(0),i=n(139);r(r.G+r.F*(parseFloat!=i),{parseFloat:i})},function(e,t,n){"use strict";var r=n(1),i=n(15),o=n(26),a=n(85),s=n(30),u=n(2),c=n(38).f,l=n(23).f,h=n(10).f,p=n(45).trim,f=r.Number,d=f,m=f.prototype,v="Number"==o(n(37)(m)),g="trim"in String.prototype,y=function(e){var t=s(e,!1);if("string"==typeof t&&t.length>2){var n,r,i,o=(t=g?t.trim():p(t,3)).charCodeAt(0);if(43===o||45===o){if(88===(n=t.charCodeAt(2))||120===n)return NaN}else if(48===o){switch(t.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+t}for(var a,u=t.slice(2),c=0,l=u.length;c<l;c++)if((a=u.charCodeAt(c))<48||a>i)return NaN;return parseInt(u,r)}}return+t};if(!f(" 0o1")||!f("0b1")||f("+0x1")){f=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof f&&(v?u((function(){m.valueOf.call(n)})):"Number"!=o(n))?a(new d(y(t)),n,f):y(t)};for(var b,x=n(9)?c(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),w=0;x.length>w;w++)i(d,b=x[w])&&!i(f,b)&&h(f,b,l(d,b));f.prototype=m,m.constructor=f,n(13)(r,"Number",f)}},function(e,t,n){"use strict";var r=n(0),i=n(22),o=n(140),a=n(86),s=1..toFixed,u=Math.floor,c=[0,0,0,0,0,0],l="Number.toFixed: incorrect invocation!",h=function(e,t){for(var n=-1,r=t;++n<6;)r+=e*c[n],c[n]=r%1e7,r=u(r/1e7)},p=function(e){for(var t=6,n=0;--t>=0;)n+=c[t],c[t]=u(n/e),n=n%e*1e7},f=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==c[e]){var n=String(c[e]);t=""===t?n:t+a.call("0",7-n.length)+n}return t},d=function(e,t,n){return 0===t?n:t%2==1?d(e,t-1,n*e):d(e*e,t/2,n)};r(r.P+r.F*(!!s&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!n(2)((function(){s.call({})}))),"Number",{toFixed:function(e){var t,n,r,s,u=o(this,l),c=i(e),m="",v="0";if(c<0||c>20)throw RangeError(l);if(u!=u)return"NaN";if(u<=-1e21||u>=1e21)return String(u);if(u<0&&(m="-",u=-u),u>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(u*d(2,69,1))-69)<0?u*d(2,-t,1):u/d(2,t,1),n*=4503599627370496,(t=52-t)>0){for(h(0,n),r=c;r>=7;)h(1e7,0),r-=7;for(h(d(10,r,1),0),r=t-1;r>=23;)p(1<<23),r-=23;p(1<<r),h(1,1),p(2),v=f()}else h(0,n),h(1<<-t,0),v=f()+a.call("0",c);return v=c>0?m+((s=v.length)<=c?"0."+a.call("0",c-s)+v:v.slice(0,s-c)+"."+v.slice(s-c)):m+v}})},function(e,t,n){"use strict";var r=n(0),i=n(2),o=n(140),a=1..toPrecision;r(r.P+r.F*(i((function(){return"1"!==a.call(1,void 0)}))||!i((function(){a.call({})}))),"Number",{toPrecision:function(e){var t=o(this,"Number#toPrecision: incorrect invocation!");return void 0===e?a.call(t):a.call(t,e)}})},function(e,t,n){var r=n(0);r(r.S,"Number",{EPSILON:Math.pow(2,-52)})},function(e,t,n){var r=n(0),i=n(1).isFinite;r(r.S,"Number",{isFinite:function(e){return"number"==typeof e&&i(e)}})},function(e,t,n){var r=n(0);r(r.S,"Number",{isInteger:n(141)})},function(e,t,n){var r=n(0);r(r.S,"Number",{isNaN:function(e){return e!=e}})},function(e,t,n){var r=n(0),i=n(141),o=Math.abs;r(r.S,"Number",{isSafeInteger:function(e){return i(e)&&o(e)<=9007199254740991}})},function(e,t,n){var r=n(0);r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,n){var r=n(0);r(r.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(e,t,n){var r=n(0),i=n(139);r(r.S+r.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(e,t,n){var r=n(0),i=n(138);r(r.S+r.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(e,t,n){var r=n(0),i=n(142),o=Math.sqrt,a=Math.acosh;r(r.S+r.F*!(a&&710==Math.floor(a(Number.MAX_VALUE))&&a(1/0)==1/0),"Math",{acosh:function(e){return(e=+e)<1?NaN:e>94906265.62425156?Math.log(e)+Math.LN2:i(e-1+o(e-1)*o(e+1))}})},function(e,t,n){var r=n(0),i=Math.asinh;r(r.S+r.F*!(i&&1/i(0)>0),"Math",{asinh:function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}})},function(e,t,n){var r=n(0),i=Math.atanh;r(r.S+r.F*!(i&&1/i(-0)<0),"Math",{atanh:function(e){return 0==(e=+e)?e:Math.log((1+e)/(1-e))/2}})},function(e,t,n){var r=n(0),i=n(87);r(r.S,"Math",{cbrt:function(e){return i(e=+e)*Math.pow(Math.abs(e),1/3)}})},function(e,t,n){var r=n(0);r(r.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}})},function(e,t,n){var r=n(0),i=Math.exp;r(r.S,"Math",{cosh:function(e){return(i(e=+e)+i(-e))/2}})},function(e,t,n){var r=n(0),i=n(88);r(r.S+r.F*(i!=Math.expm1),"Math",{expm1:i})},function(e,t,n){var r=n(0);r(r.S,"Math",{fround:n(243)})},function(e,t,n){var r=n(87),i=Math.pow,o=i(2,-52),a=i(2,-23),s=i(2,127)*(2-a),u=i(2,-126);e.exports=Math.fround||function(e){var t,n,i=Math.abs(e),c=r(e);return i<u?c*(i/u/a+1/o-1/o)*u*a:(n=(t=(1+a/o)*i)-(t-i))>s||n!=n?c*(1/0):c*n}},function(e,t,n){var r=n(0),i=Math.abs;r(r.S,"Math",{hypot:function(e,t){for(var n,r,o=0,a=0,s=arguments.length,u=0;a<s;)u<(n=i(arguments[a++]))?(o=o*(r=u/n)*r+1,u=n):o+=n>0?(r=n/u)*r:n;return u===1/0?1/0:u*Math.sqrt(o)}})},function(e,t,n){var r=n(0),i=Math.imul;r(r.S+r.F*n(2)((function(){return-5!=i(4294967295,5)||2!=i.length})),"Math",{imul:function(e,t){var n=+e,r=+t,i=65535&n,o=65535&r;return 0|i*o+((65535&n>>>16)*o+i*(65535&r>>>16)<<16>>>0)}})},function(e,t,n){var r=n(0);r(r.S,"Math",{log10:function(e){return Math.log(e)*Math.LOG10E}})},function(e,t,n){var r=n(0);r(r.S,"Math",{log1p:n(142)})},function(e,t,n){var r=n(0);r(r.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}})},function(e,t,n){var r=n(0);r(r.S,"Math",{sign:n(87)})},function(e,t,n){var r=n(0),i=n(88),o=Math.exp;r(r.S+r.F*n(2)((function(){return-2e-17!=!Math.sinh(-2e-17)})),"Math",{sinh:function(e){return Math.abs(e=+e)<1?(i(e)-i(-e))/2:(o(e-1)-o(-e-1))*(Math.E/2)}})},function(e,t,n){var r=n(0),i=n(88),o=Math.exp;r(r.S,"Math",{tanh:function(e){var t=i(e=+e),n=i(-e);return t==1/0?1:n==1/0?-1:(t-n)/(o(e)+o(-e))}})},function(e,t,n){var r=n(0);r(r.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}})},function(e,t,n){var r=n(0),i=n(36),o=String.fromCharCode,a=String.fromCodePoint;r(r.S+r.F*(!!a&&1!=a.length),"String",{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,a=0;r>a;){if(t=+arguments[a++],i(t,1114111)!==t)throw RangeError(t+" is not a valid code point");n.push(t<65536?o(t):o(55296+((t-=65536)>>10),t%1024+56320))}return n.join("")}})},function(e,t,n){var r=n(0),i=n(17),o=n(6);r(r.S,"String",{raw:function(e){for(var t=i(e.raw),n=o(t.length),r=arguments.length,a=[],s=0;n>s;)a.push(String(t[s++])),s<r&&a.push(String(arguments[s]));return a.join("")}})},function(e,t,n){"use strict";n(45)("trim",(function(e){return function(){return e(this,3)}}))},function(e,t,n){"use strict";var r=n(89)(!0);n(90)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})}))},function(e,t,n){"use strict";var r=n(0),i=n(89)(!1);r(r.P,"String",{codePointAt:function(e){return i(this,e)}})},function(e,t,n){"use strict";var r=n(0),i=n(6),o=n(91),a="".endsWith;r(r.P+r.F*n(93)("endsWith"),"String",{endsWith:function(e){var t=o(this,e,"endsWith"),n=arguments.length>1?arguments[1]:void 0,r=i(t.length),s=void 0===n?r:Math.min(i(n),r),u=String(e);return a?a.call(t,u,s):t.slice(s-u.length,s)===u}})},function(e,t,n){"use strict";var r=n(0),i=n(91);r(r.P+r.F*n(93)("includes"),"String",{includes:function(e){return!!~i(this,e,"includes").indexOf(e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){var r=n(0);r(r.P,"String",{repeat:n(86)})},function(e,t,n){"use strict";var r=n(0),i=n(6),o=n(91),a="".startsWith;r(r.P+r.F*n(93)("startsWith"),"String",{startsWith:function(e){var t=o(this,e,"startsWith"),n=i(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return a?a.call(t,r,n):t.slice(n,n+r.length)===r}})},function(e,t,n){"use strict";n(14)("anchor",(function(e){return function(t){return e(this,"a","name",t)}}))},function(e,t,n){"use strict";n(14)("big",(function(e){return function(){return e(this,"big","","")}}))},function(e,t,n){"use strict";n(14)("blink",(function(e){return function(){return e(this,"blink","","")}}))},function(e,t,n){"use strict";n(14)("bold",(function(e){return function(){return e(this,"b","","")}}))},function(e,t,n){"use strict";n(14)("fixed",(function(e){return function(){return e(this,"tt","","")}}))},function(e,t,n){"use strict";n(14)("fontcolor",(function(e){return function(t){return e(this,"font","color",t)}}))},function(e,t,n){"use strict";n(14)("fontsize",(function(e){return function(t){return e(this,"font","size",t)}}))},function(e,t,n){"use strict";n(14)("italics",(function(e){return function(){return e(this,"i","","")}}))},function(e,t,n){"use strict";n(14)("link",(function(e){return function(t){return e(this,"a","href",t)}}))},function(e,t,n){"use strict";n(14)("small",(function(e){return function(){return e(this,"small","","")}}))},function(e,t,n){"use strict";n(14)("strike",(function(e){return function(){return e(this,"strike","","")}}))},function(e,t,n){"use strict";n(14)("sub",(function(e){return function(){return e(this,"sub","","")}}))},function(e,t,n){"use strict";n(14)("sup",(function(e){return function(){return e(this,"sup","","")}}))},function(e,t,n){var r=n(0);r(r.S,"Date",{now:function(){return(new Date).getTime()}})},function(e,t,n){"use strict";var r=n(0),i=n(11),o=n(30);r(r.P+r.F*n(2)((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})})),"Date",{toJSON:function(e){var t=i(this),n=o(t);return"number"!=typeof n||isFinite(n)?t.toISOString():null}})},function(e,t,n){var r=n(0),i=n(278);r(r.P+r.F*(Date.prototype.toISOString!==i),"Date",{toISOString:i})},function(e,t,n){"use strict";var r=n(2),i=Date.prototype.getTime,o=Date.prototype.toISOString,a=function(e){return e>9?e:"0"+e};e.exports=r((function(){return"0385-07-25T07:06:39.999Z"!=o.call(new Date(-5e13-1))}))||!r((function(){o.call(new Date(NaN))}))?function(){if(!isFinite(i.call(this)))throw RangeError("Invalid time value");var e=this,t=e.getUTCFullYear(),n=e.getUTCMilliseconds(),r=t<0?"-":t>9999?"+":"";return r+("00000"+Math.abs(t)).slice(r?-6:-4)+"-"+a(e.getUTCMonth()+1)+"-"+a(e.getUTCDate())+"T"+a(e.getUTCHours())+":"+a(e.getUTCMinutes())+":"+a(e.getUTCSeconds())+"."+(n>99?n:"0"+a(n))+"Z"}:o},function(e,t,n){var r=Date.prototype,i=r.toString,o=r.getTime;new Date(NaN)+""!="Invalid Date"&&n(13)(r,"toString",(function(){var e=o.call(this);return e==e?i.call(this):"Invalid Date"}))},function(e,t,n){var r=n(5)("toPrimitive"),i=Date.prototype;r in i||n(16)(i,r,n(281))},function(e,t,n){"use strict";var r=n(3),i=n(30);e.exports=function(e){if("string"!==e&&"number"!==e&&"default"!==e)throw TypeError("Incorrect hint");return i(r(this),"number"!=e)}},function(e,t,n){var r=n(0);r(r.S,"Array",{isArray:n(63)})},function(e,t,n){"use strict";var r=n(20),i=n(0),o=n(11),a=n(144),s=n(94),u=n(6),c=n(95),l=n(96);i(i.S+i.F*!n(64)((function(e){Array.from(e)})),"Array",{from:function(e){var t,n,i,h,p=o(e),f="function"==typeof this?this:Array,d=arguments.length,m=d>1?arguments[1]:void 0,v=void 0!==m,g=0,y=l(p);if(v&&(m=r(m,d>2?arguments[2]:void 0,2)),null==y||f==Array&&s(y))for(n=new f(t=u(p.length));t>g;g++)c(n,g,v?m(p[g],g):p[g]);else for(h=y.call(p),n=new f;!(i=h.next()).done;g++)c(n,g,v?a(h,m,[i.value,g],!0):i.value);return n.length=g,n}})},function(e,t,n){"use strict";var r=n(0),i=n(95);r(r.S+r.F*n(2)((function(){function e(){}return!(Array.of.call(e)instanceof e)})),"Array",{of:function(){for(var e=0,t=arguments.length,n=new("function"==typeof this?this:Array)(t);t>e;)i(n,e,arguments[e++]);return n.length=t,n}})},function(e,t,n){"use strict";var r=n(0),i=n(17),o=[].join;r(r.P+r.F*(n(54)!=Object||!n(19)(o)),"Array",{join:function(e){return o.call(i(this),void 0===e?",":e)}})},function(e,t,n){"use strict";var r=n(0),i=n(82),o=n(26),a=n(36),s=n(6),u=[].slice;r(r.P+r.F*n(2)((function(){i&&u.call(i)})),"Array",{slice:function(e,t){var n=s(this.length),r=o(this);if(t=void 0===t?n:t,"Array"==r)return u.call(this,e,t);for(var i=a(e,n),c=a(t,n),l=s(c-i),h=new Array(l),p=0;p<l;p++)h[p]="String"==r?this.charAt(i+p):this[i+p];return h}})},function(e,t,n){"use strict";var r=n(0),i=n(21),o=n(11),a=n(2),s=[].sort,u=[1,2,3];r(r.P+r.F*(a((function(){u.sort(void 0)}))||!a((function(){u.sort(null)}))||!n(19)(s)),"Array",{sort:function(e){return void 0===e?s.call(o(this)):s.call(o(this),i(e))}})},function(e,t,n){"use strict";var r=n(0),i=n(25)(0),o=n(19)([].forEach,!0);r(r.P+r.F*!o,"Array",{forEach:function(e){return i(this,e,arguments[1])}})},function(e,t,n){var r=n(4),i=n(63),o=n(5)("species");e.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&null===(t=t[o])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){"use strict";var r=n(0),i=n(25)(1);r(r.P+r.F*!n(19)([].map,!0),"Array",{map:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(0),i=n(25)(2);r(r.P+r.F*!n(19)([].filter,!0),"Array",{filter:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(0),i=n(25)(3);r(r.P+r.F*!n(19)([].some,!0),"Array",{some:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(0),i=n(25)(4);r(r.P+r.F*!n(19)([].every,!0),"Array",{every:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(0),i=n(146);r(r.P+r.F*!n(19)([].reduce,!0),"Array",{reduce:function(e){return i(this,e,arguments.length,arguments[1],!1)}})},function(e,t,n){"use strict";var r=n(0),i=n(146);r(r.P+r.F*!n(19)([].reduceRight,!0),"Array",{reduceRight:function(e){return i(this,e,arguments.length,arguments[1],!0)}})},function(e,t,n){"use strict";var r=n(0),i=n(61)(!1),o=[].indexOf,a=!!o&&1/[1].indexOf(1,-0)<0;r(r.P+r.F*(a||!n(19)(o)),"Array",{indexOf:function(e){return a?o.apply(this,arguments)||0:i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(0),i=n(17),o=n(22),a=n(6),s=[].lastIndexOf,u=!!s&&1/[1].lastIndexOf(1,-0)<0;r(r.P+r.F*(u||!n(19)(s)),"Array",{lastIndexOf:function(e){if(u)return s.apply(this,arguments)||0;var t=i(this),n=a(t.length),r=n-1;for(arguments.length>1&&(r=Math.min(r,o(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}})},function(e,t,n){var r=n(0);r(r.P,"Array",{copyWithin:n(147)}),n(40)("copyWithin")},function(e,t,n){var r=n(0);r(r.P,"Array",{fill:n(97)}),n(40)("fill")},function(e,t,n){"use strict";var r=n(0),i=n(25)(5),o=!0;"find"in[]&&Array(1).find((function(){o=!1})),r(r.P+r.F*o,"Array",{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(40)("find")},function(e,t,n){"use strict";var r=n(0),i=n(25)(6),o="findIndex",a=!0;o in[]&&Array(1)[o]((function(){a=!1})),r(r.P+r.F*a,"Array",{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(40)(o)},function(e,t,n){n(47)("Array")},function(e,t,n){var r=n(1),i=n(85),o=n(10).f,a=n(38).f,s=n(92),u=n(65),c=r.RegExp,l=c,h=c.prototype,p=/a/g,f=/a/g,d=new c(p)!==p;if(n(9)&&(!d||n(2)((function(){return f[n(5)("match")]=!1,c(p)!=p||c(f)==f||"/a/i"!=c(p,"i")})))){c=function(e,t){var n=this instanceof c,r=s(e),o=void 0===t;return!n&&r&&e.constructor===c&&o?e:i(d?new l(r&&!o?e.source:e,t):l((r=e instanceof c)?e.source:e,r&&o?u.call(e):t),n?this:h,c)};for(var m=function(e){e in c||o(c,e,{configurable:!0,get:function(){return l[e]},set:function(t){l[e]=t}})},v=a(l),g=0;v.length>g;)m(v[g++]);h.constructor=c,c.prototype=h,n(13)(r,"RegExp",c)}n(47)("RegExp")},function(e,t,n){"use strict";n(150);var r=n(3),i=n(65),o=n(9),a=/./.toString,s=function(e){n(13)(RegExp.prototype,"toString",e,!0)};n(2)((function(){return"/a/b"!=a.call({source:"a",flags:"b"})}))?s((function(){var e=r(this);return"/".concat(e.source,"/","flags"in e?e.flags:!o&&e instanceof RegExp?i.call(e):void 0)})):"toString"!=a.name&&s((function(){return a.call(this)}))},function(e,t,n){"use strict";var r=n(3),i=n(6),o=n(100),a=n(66);n(67)("match",1,(function(e,t,n,s){return[function(n){var r=e(this),i=null==n?void 0:n[t];return void 0!==i?i.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=s(n,e,this);if(t.done)return t.value;var u=r(e),c=String(this);if(!u.global)return a(u,c);var l=u.unicode;u.lastIndex=0;for(var h,p=[],f=0;null!==(h=a(u,c));){var d=String(h[0]);p[f]=d,""===d&&(u.lastIndex=o(c,i(u.lastIndex),l)),f++}return 0===f?null:p}]}))},function(e,t,n){"use strict";var r=n(3),i=n(11),o=n(6),a=n(22),s=n(100),u=n(66),c=Math.max,l=Math.min,h=Math.floor,p=/\$([$&`']|\d\d?|<[^>]*>)/g,f=/\$([$&`']|\d\d?)/g;n(67)("replace",2,(function(e,t,n,d){return[function(r,i){var o=e(this),a=null==r?void 0:r[t];return void 0!==a?a.call(r,o,i):n.call(String(o),r,i)},function(e,t){var i=d(n,e,this,t);if(i.done)return i.value;var h=r(e),p=String(this),f="function"==typeof t;f||(t=String(t));var v=h.global;if(v){var g=h.unicode;h.lastIndex=0}for(var y=[];;){var b=u(h,p);if(null===b)break;if(y.push(b),!v)break;""===String(b[0])&&(h.lastIndex=s(p,o(h.lastIndex),g))}for(var x,w="",_=0,T=0;T<y.length;T++){b=y[T];for(var S=String(b[0]),M=c(l(a(b.index),p.length),0),E=[],A=1;A<b.length;A++)E.push(void 0===(x=b[A])?x:String(x));var P=b.groups;if(f){var O=[S].concat(E,M,p);void 0!==P&&O.push(P);var L=String(t.apply(void 0,O))}else L=m(S,p,M,E,P,t);M>=_&&(w+=p.slice(_,M)+L,_=M+S.length)}return w+p.slice(_)}];function m(e,t,r,o,a,s){var u=r+e.length,c=o.length,l=f;return void 0!==a&&(a=i(a),l=p),n.call(s,l,(function(n,i){var s;switch(i.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,r);case"'":return t.slice(u);case"<":s=a[i.slice(1,-1)];break;default:var l=+i;if(0===l)return n;if(l>c){var p=h(l/10);return 0===p?n:p<=c?void 0===o[p-1]?i.charAt(1):o[p-1]+i.charAt(1):n}s=o[l-1]}return void 0===s?"":s}))}}))},function(e,t,n){"use strict";var r=n(3),i=n(135),o=n(66);n(67)("search",1,(function(e,t,n,a){return[function(n){var r=e(this),i=null==n?void 0:n[t];return void 0!==i?i.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=a(n,e,this);if(t.done)return t.value;var s=r(e),u=String(this),c=s.lastIndex;i(c,0)||(s.lastIndex=0);var l=o(s,u);return i(s.lastIndex,c)||(s.lastIndex=c),null===l?-1:l.index}]}))},function(e,t,n){"use strict";var r=n(92),i=n(3),o=n(57),a=n(100),s=n(6),u=n(66),c=n(99),l=n(2),h=Math.min,p=[].push,f=!l((function(){RegExp(4294967295,"y")}));n(67)("split",2,(function(e,t,n,l){var d;return d="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,t){var i=String(this);if(void 0===e&&0===t)return[];if(!r(e))return n.call(i,e,t);for(var o,a,s,u=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),h=0,f=void 0===t?4294967295:t>>>0,d=new RegExp(e.source,l+"g");(o=c.call(d,i))&&!((a=d.lastIndex)>h&&(u.push(i.slice(h,o.index)),o.length>1&&o.index<i.length&&p.apply(u,o.slice(1)),s=o[0].length,h=a,u.length>=f));)d.lastIndex===o.index&&d.lastIndex++;return h===i.length?!s&&d.test("")||u.push(""):u.push(i.slice(h)),u.length>f?u.slice(0,f):u}:"0".split(void 0,0).length?function(e,t){return void 0===e&&0===t?[]:n.call(this,e,t)}:n,[function(n,r){var i=e(this),o=null==n?void 0:n[t];return void 0!==o?o.call(n,i,r):d.call(String(i),n,r)},function(e,t){var r=l(d,e,this,t,d!==n);if(r.done)return r.value;var c=i(e),p=String(this),m=o(c,RegExp),v=c.unicode,g=(c.ignoreCase?"i":"")+(c.multiline?"m":"")+(c.unicode?"u":"")+(f?"y":"g"),y=new m(f?c:"^(?:"+c.source+")",g),b=void 0===t?4294967295:t>>>0;if(0===b)return[];if(0===p.length)return null===u(y,p)?[p]:[];for(var x=0,w=0,_=[];w<p.length;){y.lastIndex=f?w:0;var T,S=u(y,f?p:p.slice(w));if(null===S||(T=h(s(y.lastIndex+(f?0:w)),p.length))===x)w=a(p,w,v);else{if(_.push(p.slice(x,w)),_.length===b)return _;for(var M=1;M<=S.length-1;M++)if(_.push(S[M]),_.length===b)return _;w=x=T}}return _.push(p.slice(x)),_}]}))},function(e,t,n){var r=n(1),i=n(101).set,o=r.MutationObserver||r.WebKitMutationObserver,a=r.process,s=r.Promise,u="process"==n(26)(a);e.exports=function(){var e,t,n,c=function(){var r,i;for(u&&(r=a.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(u)n=function(){a.nextTick(c)};else if(!o||r.navigator&&r.navigator.standalone)if(s&&s.resolve){var l=s.resolve(void 0);n=function(){l.then(c)}}else n=function(){i.call(r,c)};else{var h=!0,p=document.createTextNode("");new o(c).observe(p,{characterData:!0}),n=function(){p.data=h=!h}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,n){"use strict";var r=n(154),i=n(41);e.exports=n(70)("Map",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=r.getEntry(i(this,"Map"),e);return t&&t.v},set:function(e,t){return r.def(i(this,"Map"),0===e?0:e,t)}},r,!0)},function(e,t,n){"use strict";var r=n(154),i=n(41);e.exports=n(70)("Set",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return r.def(i(this,"Set"),e=0===e?0:e,e)}},r)},function(e,t,n){"use strict";var r,i=n(1),o=n(25)(0),a=n(13),s=n(31),u=n(134),c=n(155),l=n(4),h=n(41),p=n(41),f=!i.ActiveXObject&&"ActiveXObject"in i,d=s.getWeak,m=Object.isExtensible,v=c.ufstore,g=function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},y={get:function(e){if(l(e)){var t=d(e);return!0===t?v(h(this,"WeakMap")).get(e):t?t[this._i]:void 0}},set:function(e,t){return c.def(h(this,"WeakMap"),e,t)}},b=e.exports=n(70)("WeakMap",g,y,c,!0,!0);p&&f&&(u((r=c.getConstructor(g,"WeakMap")).prototype,y),s.NEED=!0,o(["delete","has","get","set"],(function(e){var t=b.prototype,n=t[e];a(t,e,(function(t,i){if(l(t)&&!m(t)){this._f||(this._f=new r);var o=this._f[e](t,i);return"set"==e?this:o}return n.call(this,t,i)}))})))},function(e,t,n){"use strict";var r=n(155),i=n(41);n(70)("WeakSet",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return r.def(i(this,"WeakSet"),e,!0)}},r,!1,!0)},function(e,t,n){"use strict";var r=n(0),i=n(71),o=n(102),a=n(3),s=n(36),u=n(6),c=n(4),l=n(1).ArrayBuffer,h=n(57),p=o.ArrayBuffer,f=o.DataView,d=i.ABV&&l.isView,m=p.prototype.slice,v=i.VIEW;r(r.G+r.W+r.F*(l!==p),{ArrayBuffer:p}),r(r.S+r.F*!i.CONSTR,"ArrayBuffer",{isView:function(e){return d&&d(e)||c(e)&&v in e}}),r(r.P+r.U+r.F*n(2)((function(){return!new p(2).slice(1,void 0).byteLength})),"ArrayBuffer",{slice:function(e,t){if(void 0!==m&&void 0===t)return m.call(a(this),e);for(var n=a(this).byteLength,r=s(e,n),i=s(void 0===t?n:t,n),o=new(h(this,p))(u(i-r)),c=new f(this),l=new f(o),d=0;r<i;)l.setUint8(d++,c.getUint8(r++));return o}}),n(47)("ArrayBuffer")},function(e,t,n){var r=n(0);r(r.G+r.W+r.F*!n(71).ABV,{DataView:n(102).DataView})},function(e,t,n){n(28)("Int8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(28)("Uint8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(28)("Uint8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}),!0)},function(e,t,n){n(28)("Int16",2,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(28)("Uint16",2,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(28)("Int32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(28)("Uint32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(28)("Float32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(28)("Float64",8,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){var r=n(0),i=n(21),o=n(3),a=(n(1).Reflect||{}).apply,s=Function.apply;r(r.S+r.F*!n(2)((function(){a((function(){}))})),"Reflect",{apply:function(e,t,n){var r=i(e),u=o(n);return a?a(r,t,u):s.call(r,t,u)}})},function(e,t,n){var r=n(0),i=n(37),o=n(21),a=n(3),s=n(4),u=n(2),c=n(136),l=(n(1).Reflect||{}).construct,h=u((function(){function e(){}return!(l((function(){}),[],e)instanceof e)})),p=!u((function(){l((function(){}))}));r(r.S+r.F*(h||p),"Reflect",{construct:function(e,t){o(e),a(t);var n=arguments.length<3?e:o(arguments[2]);if(p&&!h)return l(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(c.apply(e,r))}var u=n.prototype,f=i(s(u)?u:Object.prototype),d=Function.apply.call(e,f,t);return s(d)?d:f}})},function(e,t,n){var r=n(10),i=n(0),o=n(3),a=n(30);i(i.S+i.F*n(2)((function(){Reflect.defineProperty(r.f({},1,{value:1}),1,{value:2})})),"Reflect",{defineProperty:function(e,t,n){o(e),t=a(t,!0),o(n);try{return r.f(e,t,n),!0}catch(e){return!1}}})},function(e,t,n){var r=n(0),i=n(23).f,o=n(3);r(r.S,"Reflect",{deleteProperty:function(e,t){var n=i(o(e),t);return!(n&&!n.configurable)&&delete e[t]}})},function(e,t,n){"use strict";var r=n(0),i=n(3),o=function(e){this._t=i(e),this._i=0;var t,n=this._k=[];for(t in e)n.push(t)};n(143)(o,"Object",(function(){var e,t=this._k;do{if(this._i>=t.length)return{value:void 0,done:!0}}while(!((e=t[this._i++])in this._t));return{value:e,done:!1}})),r(r.S,"Reflect",{enumerate:function(e){return new o(e)}})},function(e,t,n){var r=n(23),i=n(39),o=n(15),a=n(0),s=n(4),u=n(3);a(a.S,"Reflect",{get:function e(t,n){var a,c,l=arguments.length<3?t:arguments[2];return u(t)===l?t[n]:(a=r.f(t,n))?o(a,"value")?a.value:void 0!==a.get?a.get.call(l):void 0:s(c=i(t))?e(c,n,l):void 0}})},function(e,t,n){var r=n(23),i=n(0),o=n(3);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(e,t){return r.f(o(e),t)}})},function(e,t,n){var r=n(0),i=n(39),o=n(3);r(r.S,"Reflect",{getPrototypeOf:function(e){return i(o(e))}})},function(e,t,n){var r=n(0);r(r.S,"Reflect",{has:function(e,t){return t in e}})},function(e,t,n){var r=n(0),i=n(3),o=Object.isExtensible;r(r.S,"Reflect",{isExtensible:function(e){return i(e),!o||o(e)}})},function(e,t,n){var r=n(0);r(r.S,"Reflect",{ownKeys:n(157)})},function(e,t,n){var r=n(0),i=n(3),o=Object.preventExtensions;r(r.S,"Reflect",{preventExtensions:function(e){i(e);try{return o&&o(e),!0}catch(e){return!1}}})},function(e,t,n){var r=n(10),i=n(23),o=n(39),a=n(15),s=n(0),u=n(32),c=n(3),l=n(4);s(s.S,"Reflect",{set:function e(t,n,s){var h,p,f=arguments.length<4?t:arguments[3],d=i.f(c(t),n);if(!d){if(l(p=o(t)))return e(p,n,s,f);d=u(0)}if(a(d,"value")){if(!1===d.writable||!l(f))return!1;if(h=i.f(f,n)){if(h.get||h.set||!1===h.writable)return!1;h.value=s,r.f(f,n,h)}else r.f(f,n,u(0,s));return!0}return void 0!==d.set&&(d.set.call(f,s),!0)}})},function(e,t,n){var r=n(0),i=n(83);i&&r(r.S,"Reflect",{setPrototypeOf:function(e,t){i.check(e,t);try{return i.set(e,t),!0}catch(e){return!1}}})},function(e,t,n){n(341),e.exports=n(7).Array.includes},function(e,t,n){"use strict";var r=n(0),i=n(61)(!0);r(r.P,"Array",{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(40)("includes")},function(e,t,n){n(343),e.exports=n(7).Array.flatMap},function(e,t,n){"use strict";var r=n(0),i=n(344),o=n(11),a=n(6),s=n(21),u=n(145);r(r.P,"Array",{flatMap:function(e){var t,n,r=o(this);return s(e),t=a(r.length),n=u(r,0),i(n,r,r,t,0,1,e,arguments[1]),n}}),n(40)("flatMap")},function(e,t,n){"use strict";var r=n(63),i=n(4),o=n(6),a=n(20),s=n(5)("isConcatSpreadable");e.exports=function e(t,n,u,c,l,h,p,f){for(var d,m,v=l,g=0,y=!!p&&a(p,f,3);g<c;){if(g in u){if(d=y?y(u[g],g,n):u[g],m=!1,i(d)&&(m=void 0!==(m=d[s])?!!m:r(d)),m&&h>0)v=e(t,n,d,o(d.length),v,h-1)-1;else{if(v>=9007199254740991)throw TypeError();t[v]=d}v++}g++}return v}},function(e,t,n){n(346),e.exports=n(7).String.padStart},function(e,t,n){"use strict";var r=n(0),i=n(158),o=n(69),a=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);r(r.P+r.F*a,"String",{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!0)}})},function(e,t,n){n(348),e.exports=n(7).String.padEnd},function(e,t,n){"use strict";var r=n(0),i=n(158),o=n(69),a=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);r(r.P+r.F*a,"String",{padEnd:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!1)}})},function(e,t,n){n(350),e.exports=n(7).String.trimLeft},function(e,t,n){"use strict";n(45)("trimLeft",(function(e){return function(){return e(this,1)}}),"trimStart")},function(e,t,n){n(352),e.exports=n(7).String.trimRight},function(e,t,n){"use strict";n(45)("trimRight",(function(e){return function(){return e(this,2)}}),"trimEnd")},function(e,t,n){n(354),e.exports=n(79).f("asyncIterator")},function(e,t,n){n(130)("asyncIterator")},function(e,t,n){n(356),e.exports=n(7).Object.getOwnPropertyDescriptors},function(e,t,n){var r=n(0),i=n(157),o=n(17),a=n(23),s=n(95);r(r.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,n,r=o(e),u=a.f,c=i(r),l={},h=0;c.length>h;)void 0!==(n=u(r,t=c[h++]))&&s(l,t,n);return l}})},function(e,t,n){n(358),e.exports=n(7).Object.values},function(e,t,n){var r=n(0),i=n(159)(!1);r(r.S,"Object",{values:function(e){return i(e)}})},function(e,t,n){n(360),e.exports=n(7).Object.entries},function(e,t,n){var r=n(0),i=n(159)(!0);r(r.S,"Object",{entries:function(e){return i(e)}})},function(e,t,n){"use strict";n(151),n(362),e.exports=n(7).Promise.finally},function(e,t,n){"use strict";var r=n(0),i=n(7),o=n(1),a=n(57),s=n(153);r(r.P+r.R,"Promise",{finally:function(e){var t=a(this,i.Promise||o.Promise),n="function"==typeof e;return this.then(n?function(n){return s(t,e()).then((function(){return n}))}:e,n?function(n){return s(t,e()).then((function(){throw n}))}:e)}})},function(e,t,n){n(364),n(365),n(366),e.exports=n(7)},function(e,t,n){var r=n(1),i=n(0),o=n(69),a=[].slice,s=/MSIE .\./.test(o),u=function(e){return function(t,n){var r=arguments.length>2,i=!!r&&a.call(arguments,2);return e(r?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,n)}};i(i.G+i.B+i.F*s,{setTimeout:u(r.setTimeout),setInterval:u(r.setInterval)})},function(e,t,n){var r=n(0),i=n(101);r(r.G+r.B,{setImmediate:i.set,clearImmediate:i.clear})},function(e,t,n){for(var r=n(98),i=n(35),o=n(13),a=n(1),s=n(16),u=n(46),c=n(5),l=c("iterator"),h=c("toStringTag"),p=u.Array,f={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},d=i(f),m=0;m<d.length;m++){var v,g=d[m],y=f[g],b=a[g],x=b&&b.prototype;if(x&&(x[l]||s(x,l,p),x[h]||s(x,h,g),u[g]=p,y))for(v in r)x[v]||o(x,v,r[v],!0)}},function(e,t,n){var r=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,n,r){var i=t&&t.prototype instanceof m?t:m,o=Object.create(i.prototype),a=new A(r||[]);return o._invoke=function(e,t,n){var r=l;return function(i,o){if(r===p)throw new Error("Generator is already running");if(r===f){if("throw"===i)throw o;return O()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=S(a,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===l)throw r=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=p;var u=c(e,t,n);if("normal"===u.type){if(r=n.done?f:h,u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=f,n.method="throw",n.arg=u.arg)}}}(e,n,a),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l="suspendedStart",h="suspendedYield",p="executing",f="completed",d={};function m(){}function v(){}function g(){}var y={};y[o]=function(){return this};var b=Object.getPrototypeOf,x=b&&b(b(P([])));x&&x!==n&&r.call(x,o)&&(y=x);var w=g.prototype=m.prototype=Object.create(y);function _(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function T(e){var t;this._invoke=function(n,i){function o(){return new Promise((function(t,o){!function t(n,i,o,a){var s=c(e[n],e,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==typeof l&&r.call(l,"__await")?Promise.resolve(l.__await).then((function(e){t("next",e,o,a)}),(function(e){t("throw",e,o,a)})):Promise.resolve(l).then((function(e){u.value=e,o(u)}),(function(e){return t("throw",e,o,a)}))}a(s.arg)}(n,i,t,o)}))}return t=t?t.then(o,o):o()}}function S(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,S(e,n),"throw"===n.method))return d;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var i=c(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,d;var o=i.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,d):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,d)}function M(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(M,this),this.reset(!0)}function P(e){if(e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:O}}function O(){return{value:t,done:!0}}return v.prototype=w.constructor=g,g.constructor=v,g[s]=v.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},_(T.prototype),T.prototype[a]=function(){return this},e.AsyncIterator=T,e.async=function(t,n,r,i){var o=new T(u(t,n,r,i));return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},_(w),w[s]="Generator",w[o]=function(){return this},w.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=P,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:P(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),d}},e}(e.exports);try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}},function(e,t,n){n(369),e.exports=n(160).global},function(e,t,n){var r=n(370);r(r.G,{global:n(103)})},function(e,t,n){var r=n(103),i=n(160),o=n(371),a=n(373),s=n(380),u=function(e,t,n){var c,l,h,p=e&u.F,f=e&u.G,d=e&u.S,m=e&u.P,v=e&u.B,g=e&u.W,y=f?i:i[t]||(i[t]={}),b=y.prototype,x=f?r:d?r[t]:(r[t]||{}).prototype;for(c in f&&(n=t),n)(l=!p&&x&&void 0!==x[c])&&s(y,c)||(h=l?x[c]:n[c],y[c]=f&&"function"!=typeof x[c]?n[c]:v&&l?o(h,r):g&&x[c]==h?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(h):m&&"function"==typeof h?o(Function.call,h):h,m&&((y.virtual||(y.virtual={}))[c]=h,e&u.R&&b&&!b[c]&&a(b,c,h)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t,n){var r=n(372);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var r=n(374),i=n(379);e.exports=n(105)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var r=n(375),i=n(376),o=n(378),a=Object.defineProperty;t.f=n(105)?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),i)try{return a(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var r=n(104);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){e.exports=!n(105)&&!n(161)((function(){return 7!=Object.defineProperty(n(377)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,n){var r=n(104),i=n(103).document,o=r(i)&&r(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,n){var r=n(104);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var r,i;
/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 0.7.4 - Build: 252 (2012/02/24 10:30 PM)
 */!function(o){var a={VERSION:"0.7.4"};function s(e,t,n,r,i){this._listener=t,this._isOnce=n,this.context=r,this._signal=e,this._priority=i||0}function u(e,t){if("function"!=typeof e)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}s.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},getListener:function(){return this._listener},_destroy:function(){delete this._signal,delete this._listener,delete this.context},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},a.Signal=function(){this._bindings=[],this._prevParams=null},a.Signal.prototype={memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,n,r){var i,o=this._indexOfListener(e,n);if(-1!==o){if((i=this._bindings[o]).isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else i=new s(this,e,t,n,r),this._addBinding(i);return this.memorize&&this._prevParams&&i.execute(this._prevParams),i},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var n,r=this._bindings.length;r--;)if((n=this._bindings[r])._listener===e&&n.context===t)return r;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,n){return u(e,"add"),this._registerListener(e,!1,t,n)},addOnce:function(e,t,n){return u(e,"addOnce"),this._registerListener(e,!0,t,n)},remove:function(e,t){u(e,"remove");var n=this._indexOfListener(e,t);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,n=Array.prototype.slice.call(arguments),r=this._bindings.length;if(this.memorize&&(this._prevParams=n),r){t=this._bindings.slice(),this._shouldPropagate=!0;do{r--}while(t[r]&&this._shouldPropagate&&!1!==t[r].execute(n))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},void 0===(i="function"==typeof(r=a)?r.call(t,n,t,e):r)||(e.exports=i)}()},function(e,t,n){"use strict";var r,i={browser:(r=navigator.userAgent,/Arora/i.test(r)?"Arora":/Chrome/i.test(r)?"Chrome":/Epiphany/i.test(r)?"Epiphany":/Firefox/i.test(r)?"Firefox":/Mobile(\/.*)? Safari/i.test(r)?"Mobile Safari":/MSIE/i.test(r)?"Internet Explorer":/Midori/i.test(r)?"Midori":/Opera/.test(r)?"Opera":!!/Safari/i.test(r)&&"Safari"),os:function(){var e=navigator.userAgent;return/Android/i.test(e)?"Android":/CrOS/i.test(e)?"Chrome OS":/iP[ao]d|iPhone/i.test(e)?"iOS":/Linux/i.test(e)?"Linux":/Mac OS/i.test(e)?"Mac OS":!!/windows/i.test(e)&&"Windows"}(),support:{canvas:!!window.CanvasRenderingContext2D,localStorage:function(){try{return!!window.localStorage.getItem}catch(e){return!1}}(),file:!!(window.File&&window.FileReader&&window.FileList&&window.Blob),fileSystem:!!window.requestFileSystem||!!window.webkitRequestFileSystem,getUserMedia:!!(window.navigator.getUserMedia||window.navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia||window.navigator.msGetUserMedia),requestAnimationFrame:!!(window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame),sessionStorage:function(){try{return!!window.sessionStorage.getItem}catch(e){return!1}}(),webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}(),worker:!!window.Worker}};e.exports=i},function(e,t,n){(function(){"use strict";var e,r,i,o,a,s={}.hasOwnProperty;e=n(384),r=n(106).defaults,o=function(e){return"string"==typeof e&&(e.indexOf("&")>=0||e.indexOf(">")>=0||e.indexOf("<")>=0)},a=function(e){return"<![CDATA["+i(e)+"]]>"},i=function(e){return e.replace("]]>","]]]]><![CDATA[>")},t.Builder=function(){function t(e){var t,n,i;for(t in this.options={},n=r[.2])s.call(n,t)&&(i=n[t],this.options[t]=i);for(t in e)s.call(e,t)&&(i=e[t],this.options[t]=i)}return t.prototype.buildObject=function(t){var n,i,u,c,l,h;return n=this.options.attrkey,i=this.options.charkey,1===Object.keys(t).length&&this.options.rootName===r[.2].rootName?t=t[l=Object.keys(t)[0]]:l=this.options.rootName,h=this,u=function(e,t){var r,c,l,p,f,d;if("object"!=typeof t)h.options.cdata&&o(t)?e.raw(a(t)):e.txt(t);else if(Array.isArray(t)){for(p in t)if(s.call(t,p))for(f in c=t[p])l=c[f],e=u(e.ele(f),l).up()}else for(f in t)if(s.call(t,f))if(c=t[f],f===n){if("object"==typeof c)for(r in c)d=c[r],e=e.att(r,d)}else if(f===i)e=h.options.cdata&&o(c)?e.raw(a(c)):e.txt(c);else if(Array.isArray(c))for(p in c)s.call(c,p)&&(e="string"==typeof(l=c[p])?h.options.cdata&&o(l)?e.ele(f).raw(a(l)).up():e.ele(f,l).up():u(e.ele(f),l).up());else"object"==typeof c?e=u(e.ele(f),c).up():"string"==typeof c&&h.options.cdata&&o(c)?e=e.ele(f).raw(a(c)).up():(null==c&&(c=""),e=e.ele(f,c.toString()).up());return e},c=e.create(l,this.options.xmldec,this.options.doctype,{headless:this.options.headless,allowSurrogateChars:this.options.allowSurrogateChars}),u(c,t).end(this.options.renderOpts)},t}()}).call(this)},function(e,t,n){(function(){var t,r,i,o,a,s,u,c,l,h;h=n(29),c=h.assign,l=h.isFunction,i=n(162),o=n(163),a=n(390),u=n(120),s=n(391),t=n(8),r=n(73),e.exports.create=function(e,t,n,r){var i,a;if(null==e)throw new Error("Root element needs a name.");return r=c({},t,n,r),a=(i=new o(r)).element(e),r.headless||(i.declaration(r),null==r.pubID&&null==r.sysID||i.dtd(r)),a},e.exports.begin=function(e,t,n){var r;return l(e)&&(t=(r=[e,t])[0],n=r[1],e={}),t?new a(e,t,n):new o(e)},e.exports.stringWriter=function(e){return new u(e)},e.exports.streamWriter=function(e,t){return new s(e,t)},e.exports.implementation=new i,e.exports.nodeType=t,e.exports.writerState=r}).call(this)},function(e,t,n){(function(){var t,r;t=n(386),r=n(387),e.exports=function(){function e(){this.defaultParams={"canonical-form":!1,"cdata-sections":!1,comments:!1,"datatype-normalization":!1,"element-content-whitespace":!0,entities:!0,"error-handler":new t,infoset:!0,"validate-if-schema":!1,namespaces:!0,"namespace-declarations":!0,"normalize-characters":!1,"schema-location":"","schema-type":"","split-cdata-sections":!0,validate:!1,"well-formed":!0},this.params=Object.create(this.defaultParams)}return Object.defineProperty(e.prototype,"parameterNames",{get:function(){return new r(Object.keys(this.defaultParams))}}),e.prototype.getParameter=function(e){return this.params.hasOwnProperty(e)?this.params[e]:null},e.prototype.canSetParameter=function(e,t){return!0},e.prototype.setParameter=function(e,t){return null!=t?this.params[e]=t:delete this.params[e]},e}()}).call(this)},function(e,t){(function(){e.exports=function(){function e(){}return e.prototype.handleError=function(e){throw new Error(e)},e}()}).call(this)},function(e,t){(function(){e.exports=function(){function e(e){this.arr=e||[]}return Object.defineProperty(e.prototype,"length",{get:function(){return this.arr.length}}),e.prototype.item=function(e){return this.arr[e]||null},e.prototype.contains=function(e){return-1!==this.arr.indexOf(e)},e}()}).call(this)},function(e,t){(function(){e.exports=function(){function e(e){this.nodes=e}return Object.defineProperty(e.prototype,"length",{get:function(){return this.nodes.length||0}}),e.prototype.clone=function(){return this.nodes=null},e.prototype.item=function(e){return this.nodes[e]||null},e}()}).call(this)},function(e,t){(function(){e.exports={Disconnected:1,Preceding:2,Following:4,Contains:8,ContainedBy:16,ImplementationSpecific:32}}).call(this)},function(e,t,n){(function(){var t,r,i,o,a,s,u,c,l,h,p,f,d,m,v,g,y,b,x,w,_,T,S,M={}.hasOwnProperty;S=n(29),_=S.isObject,w=S.isFunction,T=S.isPlainObject,x=S.getValue,t=n(8),f=n(163),d=n(107),o=n(109),a=n(110),v=n(117),b=n(118),m=n(119),h=n(111),p=n(112),s=n(113),c=n(114),u=n(115),l=n(116),i=n(164),y=n(166),g=n(120),r=n(73),e.exports=function(){function e(e,n,r){var i;this.name="?xml",this.type=t.Document,e||(e={}),i={},e.writer?T(e.writer)&&(i=e.writer,e.writer=new g):e.writer=new g,this.options=e,this.writer=e.writer,this.writerOptions=this.writer.filterOptions(i),this.stringify=new y(e),this.onDataCallback=n||function(){},this.onEndCallback=r||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}return e.prototype.createChildNode=function(e){var n,r,i,o,a,s,u,c;switch(e.type){case t.CData:this.cdata(e.value);break;case t.Comment:this.comment(e.value);break;case t.Element:for(r in i={},u=e.attribs)M.call(u,r)&&(n=u[r],i[r]=n.value);this.node(e.name,i);break;case t.Dummy:this.dummy();break;case t.Raw:this.raw(e.value);break;case t.Text:this.text(e.value);break;case t.ProcessingInstruction:this.instruction(e.target,e.value);break;default:throw new Error("This XML node type is not supported in a JS object: "+e.constructor.name)}for(a=0,s=(c=e.children).length;a<s;a++)o=c[a],this.createChildNode(o),o.type===t.Element&&this.up();return this},e.prototype.dummy=function(){return this},e.prototype.node=function(e,t,n){var r;if(null==e)throw new Error("Missing node name.");if(this.root&&-1===this.currentLevel)throw new Error("Document can only have one root node. "+this.debugInfo(e));return this.openCurrent(),e=x(e),null==t&&(t={}),t=x(t),_(t)||(n=(r=[t,n])[0],t=r[1]),this.currentNode=new d(this,e,t),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,null!=n&&this.text(n),this},e.prototype.element=function(e,n,r){var i,o,a,s,u,c;if(this.currentNode&&this.currentNode.type===t.DocType)this.dtdElement.apply(this,arguments);else if(Array.isArray(e)||_(e)||w(e))for(s=this.options.noValidation,this.options.noValidation=!0,(c=new f(this.options).element("TEMP_ROOT")).element(e),this.options.noValidation=s,o=0,a=(u=c.children).length;o<a;o++)i=u[o],this.createChildNode(i),i.type===t.Element&&this.up();else this.node(e,n,r);return this},e.prototype.attribute=function(e,t){var n,r;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode. "+this.debugInfo(e));if(null!=e&&(e=x(e)),_(e))for(n in e)M.call(e,n)&&(r=e[n],this.attribute(n,r));else w(t)&&(t=t.apply()),this.options.keepNullAttributes&&null==t?this.currentNode.attribs[e]=new i(this,e,""):null!=t&&(this.currentNode.attribs[e]=new i(this,e,t));return this},e.prototype.text=function(e){var t;return this.openCurrent(),t=new b(this,e),this.onData(this.writer.text(t,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},e.prototype.cdata=function(e){var t;return this.openCurrent(),t=new o(this,e),this.onData(this.writer.cdata(t,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},e.prototype.comment=function(e){var t;return this.openCurrent(),t=new a(this,e),this.onData(this.writer.comment(t,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},e.prototype.raw=function(e){var t;return this.openCurrent(),t=new v(this,e),this.onData(this.writer.raw(t,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},e.prototype.instruction=function(e,t){var n,r,i,o,a;if(this.openCurrent(),null!=e&&(e=x(e)),null!=t&&(t=x(t)),Array.isArray(e))for(n=0,o=e.length;n<o;n++)r=e[n],this.instruction(r);else if(_(e))for(r in e)M.call(e,r)&&(i=e[r],this.instruction(r,i));else w(t)&&(t=t.apply()),a=new m(this,e,t),this.onData(this.writer.processingInstruction(a,this.writerOptions,this.currentLevel+1),this.currentLevel+1);return this},e.prototype.declaration=function(e,t,n){var r;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node.");return r=new h(this,e,t,n),this.onData(this.writer.declaration(r,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},e.prototype.doctype=function(e,t,n){if(this.openCurrent(),null==e)throw new Error("Missing root node name.");if(this.root)throw new Error("dtd() must come before the root node.");return this.currentNode=new p(this,t,n),this.currentNode.rootNodeName=e,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this},e.prototype.dtdElement=function(e,t){var n;return this.openCurrent(),n=new u(this,e,t),this.onData(this.writer.dtdElement(n,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},e.prototype.attList=function(e,t,n,r,i){var o;return this.openCurrent(),o=new s(this,e,t,n,r,i),this.onData(this.writer.dtdAttList(o,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},e.prototype.entity=function(e,t){var n;return this.openCurrent(),n=new c(this,!1,e,t),this.onData(this.writer.dtdEntity(n,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},e.prototype.pEntity=function(e,t){var n;return this.openCurrent(),n=new c(this,!0,e,t),this.onData(this.writer.dtdEntity(n,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},e.prototype.notation=function(e,t){var n;return this.openCurrent(),n=new l(this,e,t),this.onData(this.writer.dtdNotation(n,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},e.prototype.up=function(){if(this.currentLevel<0)throw new Error("The document node has no parent.");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this},e.prototype.end=function(){for(;this.currentLevel>=0;)this.up();return this.onEnd()},e.prototype.openCurrent=function(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)},e.prototype.openNode=function(e){var n,i,o,a;if(!e.isOpen){if(this.root||0!==this.currentLevel||e.type!==t.Element||(this.root=e),i="",e.type===t.Element){for(o in this.writerOptions.state=r.OpenTag,i=this.writer.indent(e,this.writerOptions,this.currentLevel)+"<"+e.name,a=e.attribs)M.call(a,o)&&(n=a[o],i+=this.writer.attribute(n,this.writerOptions,this.currentLevel));i+=(e.children?">":"/>")+this.writer.endline(e,this.writerOptions,this.currentLevel),this.writerOptions.state=r.InsideTag}else this.writerOptions.state=r.OpenTag,i=this.writer.indent(e,this.writerOptions,this.currentLevel)+"<!DOCTYPE "+e.rootNodeName,e.pubID&&e.sysID?i+=' PUBLIC "'+e.pubID+'" "'+e.sysID+'"':e.sysID&&(i+=' SYSTEM "'+e.sysID+'"'),e.children?(i+=" [",this.writerOptions.state=r.InsideTag):(this.writerOptions.state=r.CloseTag,i+=">"),i+=this.writer.endline(e,this.writerOptions,this.currentLevel);return this.onData(i,this.currentLevel),e.isOpen=!0}},e.prototype.closeNode=function(e){var n;if(!e.isClosed)return n="",this.writerOptions.state=r.CloseTag,n=e.type===t.Element?this.writer.indent(e,this.writerOptions,this.currentLevel)+"</"+e.name+">"+this.writer.endline(e,this.writerOptions,this.currentLevel):this.writer.indent(e,this.writerOptions,this.currentLevel)+"]>"+this.writer.endline(e,this.writerOptions,this.currentLevel),this.writerOptions.state=r.None,this.onData(n,this.currentLevel),e.isClosed=!0},e.prototype.onData=function(e,t){return this.documentStarted=!0,this.onDataCallback(e,t+1)},e.prototype.onEnd=function(){return this.documentCompleted=!0,this.onEndCallback()},e.prototype.debugInfo=function(e){return null==e?"":"node: <"+e+">"},e.prototype.ele=function(){return this.element.apply(this,arguments)},e.prototype.nod=function(e,t,n){return this.node(e,t,n)},e.prototype.txt=function(e){return this.text(e)},e.prototype.dat=function(e){return this.cdata(e)},e.prototype.com=function(e){return this.comment(e)},e.prototype.ins=function(e,t){return this.instruction(e,t)},e.prototype.dec=function(e,t,n){return this.declaration(e,t,n)},e.prototype.dtd=function(e,t,n){return this.doctype(e,t,n)},e.prototype.e=function(e,t,n){return this.element(e,t,n)},e.prototype.n=function(e,t,n){return this.node(e,t,n)},e.prototype.t=function(e){return this.text(e)},e.prototype.d=function(e){return this.cdata(e)},e.prototype.c=function(e){return this.comment(e)},e.prototype.r=function(e){return this.raw(e)},e.prototype.i=function(e,t){return this.instruction(e,t)},e.prototype.att=function(){return this.currentNode&&this.currentNode.type===t.DocType?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},e.prototype.a=function(){return this.currentNode&&this.currentNode.type===t.DocType?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},e.prototype.ent=function(e,t){return this.entity(e,t)},e.prototype.pent=function(e,t){return this.pEntity(e,t)},e.prototype.not=function(e,t){return this.notation(e,t)},e}()}).call(this)},function(e,t,n){(function(){var t,r,i,o={}.hasOwnProperty;t=n(8),i=n(167),r=n(73),e.exports=function(e){function n(e,t){this.stream=e,n.__super__.constructor.call(this,t)}return function(e,t){for(var n in t)o.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(n,e),n.prototype.endline=function(e,t,i){return e.isLastRootNode&&t.state===r.CloseTag?"":n.__super__.endline.call(this,e,t,i)},n.prototype.document=function(e,t){var n,r,i,o,a,s,u,c,l;for(r=i=0,a=(u=e.children).length;i<a;r=++i)(n=u[r]).isLastRootNode=r===e.children.length-1;for(t=this.filterOptions(t),l=[],o=0,s=(c=e.children).length;o<s;o++)n=c[o],l.push(this.writeChildNode(n,t,0));return l},n.prototype.attribute=function(e,t,r){return this.stream.write(n.__super__.attribute.call(this,e,t,r))},n.prototype.cdata=function(e,t,r){return this.stream.write(n.__super__.cdata.call(this,e,t,r))},n.prototype.comment=function(e,t,r){return this.stream.write(n.__super__.comment.call(this,e,t,r))},n.prototype.declaration=function(e,t,r){return this.stream.write(n.__super__.declaration.call(this,e,t,r))},n.prototype.docType=function(e,t,n){var i,o,a,s;if(n||(n=0),this.openNode(e,t,n),t.state=r.OpenTag,this.stream.write(this.indent(e,t,n)),this.stream.write("<!DOCTYPE "+e.root().name),e.pubID&&e.sysID?this.stream.write(' PUBLIC "'+e.pubID+'" "'+e.sysID+'"'):e.sysID&&this.stream.write(' SYSTEM "'+e.sysID+'"'),e.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline(e,t,n)),t.state=r.InsideTag,o=0,a=(s=e.children).length;o<a;o++)i=s[o],this.writeChildNode(i,t,n+1);t.state=r.CloseTag,this.stream.write("]")}return t.state=r.CloseTag,this.stream.write(t.spaceBeforeSlash+">"),this.stream.write(this.endline(e,t,n)),t.state=r.None,this.closeNode(e,t,n)},n.prototype.element=function(e,n,i){var a,s,u,c,l,h,p,f,d;for(p in i||(i=0),this.openNode(e,n,i),n.state=r.OpenTag,this.stream.write(this.indent(e,n,i)+"<"+e.name),f=e.attribs)o.call(f,p)&&(a=f[p],this.attribute(a,n,i));if(c=0===(u=e.children.length)?null:e.children[0],0===u||e.children.every((function(e){return(e.type===t.Text||e.type===t.Raw)&&""===e.value})))n.allowEmpty?(this.stream.write(">"),n.state=r.CloseTag,this.stream.write("</"+e.name+">")):(n.state=r.CloseTag,this.stream.write(n.spaceBeforeSlash+"/>"));else if(!n.pretty||1!==u||c.type!==t.Text&&c.type!==t.Raw||null==c.value){for(this.stream.write(">"+this.endline(e,n,i)),n.state=r.InsideTag,l=0,h=(d=e.children).length;l<h;l++)s=d[l],this.writeChildNode(s,n,i+1);n.state=r.CloseTag,this.stream.write(this.indent(e,n,i)+"</"+e.name+">")}else this.stream.write(">"),n.state=r.InsideTag,n.suppressPrettyCount++,!0,this.writeChildNode(c,n,i+1),n.suppressPrettyCount--,!1,n.state=r.CloseTag,this.stream.write("</"+e.name+">");return this.stream.write(this.endline(e,n,i)),n.state=r.None,this.closeNode(e,n,i)},n.prototype.processingInstruction=function(e,t,r){return this.stream.write(n.__super__.processingInstruction.call(this,e,t,r))},n.prototype.raw=function(e,t,r){return this.stream.write(n.__super__.raw.call(this,e,t,r))},n.prototype.text=function(e,t,r){return this.stream.write(n.__super__.text.call(this,e,t,r))},n.prototype.dtdAttList=function(e,t,r){return this.stream.write(n.__super__.dtdAttList.call(this,e,t,r))},n.prototype.dtdElement=function(e,t,r){return this.stream.write(n.__super__.dtdElement.call(this,e,t,r))},n.prototype.dtdEntity=function(e,t,r){return this.stream.write(n.__super__.dtdEntity.call(this,e,t,r))},n.prototype.dtdNotation=function(e,t,r){return this.stream.write(n.__super__.dtdNotation.call(this,e,t,r))},n}(i)}).call(this)},function(e,t,n){(function(){"use strict";var e,r,i,o,a,s,u,c,l,h=function(e,t){return function(){return e.apply(t,arguments)}},p={}.hasOwnProperty;c=n(393),i=n(75),e=n(408),s=n(174),l=n(172).setImmediate,r=n(106).defaults,u=n(409),o=function(e){return"object"==typeof e&&null!=e&&0===Object.keys(e).length},a=function(e,t,n){var r,i;for(r=0,i=e.length;r<i;r++)t=(0,e[r])(t,n);return t},t.Parser=function(n){function i(e){var n,i,o;if(this.parseStringPromise=h(this.parseStringPromise,this),this.parseString=h(this.parseString,this),this.reset=h(this.reset,this),this.assignOrPush=h(this.assignOrPush,this),this.processAsync=h(this.processAsync,this),!(this instanceof t.Parser))return new t.Parser(e);for(n in this.options={},i=r[.2])p.call(i,n)&&(o=i[n],this.options[n]=o);for(n in e)p.call(e,n)&&(o=e[n],this.options[n]=o);this.options.xmlns&&(this.options.xmlnskey=this.options.attrkey+"ns"),this.options.normalizeTags&&(this.options.tagNameProcessors||(this.options.tagNameProcessors=[]),this.options.tagNameProcessors.unshift(s.normalize)),this.reset()}return function(e,t){for(var n in t)p.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(i,n),i.prototype.processAsync=function(){var e,t;try{return this.remaining.length<=this.options.chunkSize?(e=this.remaining,this.remaining="",this.saxParser=this.saxParser.write(e),this.saxParser.close()):(e=this.remaining.substr(0,this.options.chunkSize),this.remaining=this.remaining.substr(this.options.chunkSize,this.remaining.length),this.saxParser=this.saxParser.write(e),l(this.processAsync))}catch(e){if(t=e,!this.saxParser.errThrown)return this.saxParser.errThrown=!0,this.emit(t)}},i.prototype.assignOrPush=function(e,t,n){return t in e?(e[t]instanceof Array||(e[t]=[e[t]]),e[t].push(n)):this.options.explicitArray?e[t]=[n]:e[t]=n},i.prototype.reset=function(){var e,t,n,r,i;return this.removeAllListeners(),this.saxParser=c.parser(this.options.strict,{trim:!1,normalize:!1,xmlns:this.options.xmlns}),this.saxParser.errThrown=!1,this.saxParser.onerror=(i=this,function(e){if(i.saxParser.resume(),!i.saxParser.errThrown)return i.saxParser.errThrown=!0,i.emit("error",e)}),this.saxParser.onend=function(e){return function(){if(!e.saxParser.ended)return e.saxParser.ended=!0,e.emit("end",e.resultObject)}}(this),this.saxParser.ended=!1,this.EXPLICIT_CHARKEY=this.options.explicitCharkey,this.resultObject=null,r=[],e=this.options.attrkey,t=this.options.charkey,this.saxParser.onopentag=function(n){return function(i){var o,s,u,c,l;if((u={})[t]="",!n.options.ignoreAttrs)for(o in l=i.attributes)p.call(l,o)&&(e in u||n.options.mergeAttrs||(u[e]={}),s=n.options.attrValueProcessors?a(n.options.attrValueProcessors,i.attributes[o],o):i.attributes[o],c=n.options.attrNameProcessors?a(n.options.attrNameProcessors,o):o,n.options.mergeAttrs?n.assignOrPush(u,c,s):u[e][c]=s);return u["#name"]=n.options.tagNameProcessors?a(n.options.tagNameProcessors,i.name):i.name,n.options.xmlns&&(u[n.options.xmlnskey]={uri:i.uri,local:i.local}),r.push(u)}}(this),this.saxParser.onclosetag=function(e){return function(){var n,i,s,u,c,l,h,f,d,m;if(l=r.pop(),c=l["#name"],e.options.explicitChildren&&e.options.preserveChildrenOrder||delete l["#name"],!0===l.cdata&&(n=l.cdata,delete l.cdata),d=r[r.length-1],l[t].match(/^\s*$/)&&!n?(i=l[t],delete l[t]):(e.options.trim&&(l[t]=l[t].trim()),e.options.normalize&&(l[t]=l[t].replace(/\s{2,}/g," ").trim()),l[t]=e.options.valueProcessors?a(e.options.valueProcessors,l[t],c):l[t],1===Object.keys(l).length&&t in l&&!e.EXPLICIT_CHARKEY&&(l=l[t])),o(l)&&(l=""!==e.options.emptyTag?e.options.emptyTag:i),null!=e.options.validator&&(m="/"+function(){var e,t,n;for(n=[],e=0,t=r.length;e<t;e++)u=r[e],n.push(u["#name"]);return n}().concat(c).join("/"),function(){var t;try{l=e.options.validator(m,d&&d[c],l)}catch(n){return t=n,e.emit("error",t)}}()),e.options.explicitChildren&&!e.options.mergeAttrs&&"object"==typeof l)if(e.options.preserveChildrenOrder){if(d){for(s in d[e.options.childkey]=d[e.options.childkey]||[],h={},l)p.call(l,s)&&(h[s]=l[s]);d[e.options.childkey].push(h),delete l["#name"],1===Object.keys(l).length&&t in l&&!e.EXPLICIT_CHARKEY&&(l=l[t])}}else u={},e.options.attrkey in l&&(u[e.options.attrkey]=l[e.options.attrkey],delete l[e.options.attrkey]),!e.options.charsAsChildren&&e.options.charkey in l&&(u[e.options.charkey]=l[e.options.charkey],delete l[e.options.charkey]),Object.getOwnPropertyNames(l).length>0&&(u[e.options.childkey]=l),l=u;return r.length>0?e.assignOrPush(d,c,l):(e.options.explicitRoot&&(f=l,(l={})[c]=f),e.resultObject=l,e.saxParser.ended=!0,e.emit("end",e.resultObject))}}(this),n=function(e){return function(n){var i,o;if(o=r[r.length-1])return o[t]+=n,e.options.explicitChildren&&e.options.preserveChildrenOrder&&e.options.charsAsChildren&&(e.options.includeWhiteChars||""!==n.replace(/\\n/g,"").trim())&&(o[e.options.childkey]=o[e.options.childkey]||[],(i={"#name":"__text__"})[t]=n,e.options.normalize&&(i[t]=i[t].replace(/\s{2,}/g," ").trim()),o[e.options.childkey].push(i)),o}}(this),this.saxParser.ontext=n,this.saxParser.oncdata=function(e){var t;if(t=n(e))return t.cdata=!0}},i.prototype.parseString=function(t,n){var r;null!=n&&"function"==typeof n&&(this.on("end",(function(e){return this.reset(),n(null,e)})),this.on("error",(function(e){return this.reset(),n(e)})));try{return""===(t=t.toString()).trim()?(this.emit("end",null),!0):(t=e.stripBOM(t),this.options.async?(this.remaining=t,l(this.processAsync),this.saxParser):this.saxParser.write(t).close())}catch(e){if(r=e,!this.saxParser.errThrown&&!this.saxParser.ended)return this.emit("error",r),this.saxParser.errThrown=!0;if(this.saxParser.ended)throw r}},i.prototype.parseStringPromise=function(e){return u(this.parseString)(e)},i}(i),t.parseString=function(e,n,r){var i,o;return null!=r?("function"==typeof r&&(i=r),"object"==typeof n&&(o=n)):("function"==typeof n&&(i=n),o={}),new t.Parser(o).parseString(e,i)},t.parseStringPromise=function(e,n){var r;return"object"==typeof n&&(r=n),new t.Parser(r).parseStringPromise(e)}}).call(this)},function(e,t,n){(function(e){!function(t){t.parser=function(e,t){return new o(e,t)},t.SAXParser=o,t.SAXStream=s,t.createStream=function(e,t){return new s(e,t)},t.MAX_BUFFER_LENGTH=65536;var r,i=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function o(e,n){if(!(this instanceof o))return new o(e,n);!function(e){for(var t=0,n=i.length;t<n;t++)e[i[t]]=""}(this),this.q=this.c="",this.bufferCheckPosition=t.MAX_BUFFER_LENGTH,this.opt=n||{},this.opt.lowercase=this.opt.lowercase||this.opt.lowercasetags,this.looseCase=this.opt.lowercase?"toLowerCase":"toUpperCase",this.tags=[],this.closed=this.closedRoot=this.sawRoot=!1,this.tag=this.error=null,this.strict=!!e,this.noscript=!(!e&&!this.opt.noscript),this.state=M.BEGIN,this.strictEntities=this.opt.strictEntities,this.ENTITIES=this.strictEntities?Object.create(t.XML_ENTITIES):Object.create(t.ENTITIES),this.attribList=[],this.opt.xmlns&&(this.ns=Object.create(p)),this.trackPosition=!1!==this.opt.position,this.trackPosition&&(this.position=this.line=this.column=0),A(this,"onready")}t.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),o.prototype={end:function(){C(this)},write:function(e){if(this.error)throw this.error;if(this.closed)return I(this,"Cannot write after close. Assign an onready handler.");if(null===e)return C(this);"object"==typeof e&&(e=e.toString());var n=0,r="";for(;r=z(e,n++),this.c=r,r;)switch(this.trackPosition&&(this.position++,"\n"===r?(this.line++,this.column=0):this.column++),this.state){case M.BEGIN:if(this.state=M.BEGIN_WHITESPACE,"\ufeff"===r)continue;k(this,r);continue;case M.BEGIN_WHITESPACE:k(this,r);continue;case M.TEXT:if(this.sawRoot&&!this.closedRoot){for(var o=n-1;r&&"<"!==r&&"&"!==r;)(r=z(e,n++))&&this.trackPosition&&(this.position++,"\n"===r?(this.line++,this.column=0):this.column++);this.textNode+=e.substring(o,n-1)}"<"!==r||this.sawRoot&&this.closedRoot&&!this.strict?(g(r)||this.sawRoot&&!this.closedRoot||R(this,"Text data outside of root node."),"&"===r?this.state=M.TEXT_ENTITY:this.textNode+=r):(this.state=M.OPEN_WAKA,this.startTagPosition=this.position);continue;case M.SCRIPT:"<"===r?this.state=M.SCRIPT_ENDING:this.script+=r;continue;case M.SCRIPT_ENDING:"/"===r?this.state=M.CLOSE_TAG:(this.script+="<"+r,this.state=M.SCRIPT);continue;case M.OPEN_WAKA:if("!"===r)this.state=M.SGML_DECL,this.sgmlDecl="";else if(g(r));else if(x(f,r))this.state=M.OPEN_TAG,this.tagName=r;else if("/"===r)this.state=M.CLOSE_TAG,this.tagName="";else if("?"===r)this.state=M.PROC_INST,this.procInstName=this.procInstBody="";else{if(R(this,"Unencoded <"),this.startTagPosition+1<this.position){var a=this.position-this.startTagPosition;r=new Array(a).join(" ")+r}this.textNode+="<"+r,this.state=M.TEXT}continue;case M.SGML_DECL:(this.sgmlDecl+r).toUpperCase()===u?(P(this,"onopencdata"),this.state=M.CDATA,this.sgmlDecl="",this.cdata=""):this.sgmlDecl+r==="--"?(this.state=M.COMMENT,this.comment="",this.sgmlDecl=""):(this.sgmlDecl+r).toUpperCase()===c?(this.state=M.DOCTYPE,(this.doctype||this.sawRoot)&&R(this,"Inappropriately located doctype declaration"),this.doctype="",this.sgmlDecl=""):">"===r?(P(this,"onsgmldeclaration",this.sgmlDecl),this.sgmlDecl="",this.state=M.TEXT):y(r)?(this.state=M.SGML_DECL_QUOTED,this.sgmlDecl+=r):this.sgmlDecl+=r;continue;case M.SGML_DECL_QUOTED:r===this.q&&(this.state=M.SGML_DECL,this.q=""),this.sgmlDecl+=r;continue;case M.DOCTYPE:">"===r?(this.state=M.TEXT,P(this,"ondoctype",this.doctype),this.doctype=!0):(this.doctype+=r,"["===r?this.state=M.DOCTYPE_DTD:y(r)&&(this.state=M.DOCTYPE_QUOTED,this.q=r));continue;case M.DOCTYPE_QUOTED:this.doctype+=r,r===this.q&&(this.q="",this.state=M.DOCTYPE);continue;case M.DOCTYPE_DTD:this.doctype+=r,"]"===r?this.state=M.DOCTYPE:y(r)&&(this.state=M.DOCTYPE_DTD_QUOTED,this.q=r);continue;case M.DOCTYPE_DTD_QUOTED:this.doctype+=r,r===this.q&&(this.state=M.DOCTYPE_DTD,this.q="");continue;case M.COMMENT:"-"===r?this.state=M.COMMENT_ENDING:this.comment+=r;continue;case M.COMMENT_ENDING:"-"===r?(this.state=M.COMMENT_ENDED,this.comment=L(this.opt,this.comment),this.comment&&P(this,"oncomment",this.comment),this.comment=""):(this.comment+="-"+r,this.state=M.COMMENT);continue;case M.COMMENT_ENDED:">"!==r?(R(this,"Malformed comment"),this.comment+="--"+r,this.state=M.COMMENT):this.state=M.TEXT;continue;case M.CDATA:"]"===r?this.state=M.CDATA_ENDING:this.cdata+=r;continue;case M.CDATA_ENDING:"]"===r?this.state=M.CDATA_ENDING_2:(this.cdata+="]"+r,this.state=M.CDATA);continue;case M.CDATA_ENDING_2:">"===r?(this.cdata&&P(this,"oncdata",this.cdata),P(this,"onclosecdata"),this.cdata="",this.state=M.TEXT):"]"===r?this.cdata+="]":(this.cdata+="]]"+r,this.state=M.CDATA);continue;case M.PROC_INST:"?"===r?this.state=M.PROC_INST_ENDING:g(r)?this.state=M.PROC_INST_BODY:this.procInstName+=r;continue;case M.PROC_INST_BODY:if(!this.procInstBody&&g(r))continue;"?"===r?this.state=M.PROC_INST_ENDING:this.procInstBody+=r;continue;case M.PROC_INST_ENDING:">"===r?(P(this,"onprocessinginstruction",{name:this.procInstName,body:this.procInstBody}),this.procInstName=this.procInstBody="",this.state=M.TEXT):(this.procInstBody+="?"+r,this.state=M.PROC_INST_BODY);continue;case M.OPEN_TAG:x(d,r)?this.tagName+=r:(D(this),">"===r?j(this):"/"===r?this.state=M.OPEN_TAG_SLASH:(g(r)||R(this,"Invalid character in tag name"),this.state=M.ATTRIB));continue;case M.OPEN_TAG_SLASH:">"===r?(j(this,!0),U(this)):(R(this,"Forward-slash in opening tag not followed by >"),this.state=M.ATTRIB);continue;case M.ATTRIB:if(g(r))continue;">"===r?j(this):"/"===r?this.state=M.OPEN_TAG_SLASH:x(f,r)?(this.attribName=r,this.attribValue="",this.state=M.ATTRIB_NAME):R(this,"Invalid attribute name");continue;case M.ATTRIB_NAME:"="===r?this.state=M.ATTRIB_VALUE:">"===r?(R(this,"Attribute without value"),this.attribValue=this.attribName,F(this),j(this)):g(r)?this.state=M.ATTRIB_NAME_SAW_WHITE:x(d,r)?this.attribName+=r:R(this,"Invalid attribute name");continue;case M.ATTRIB_NAME_SAW_WHITE:if("="===r)this.state=M.ATTRIB_VALUE;else{if(g(r))continue;R(this,"Attribute without value"),this.tag.attributes[this.attribName]="",this.attribValue="",P(this,"onattribute",{name:this.attribName,value:""}),this.attribName="",">"===r?j(this):x(f,r)?(this.attribName=r,this.state=M.ATTRIB_NAME):(R(this,"Invalid attribute name"),this.state=M.ATTRIB)}continue;case M.ATTRIB_VALUE:if(g(r))continue;y(r)?(this.q=r,this.state=M.ATTRIB_VALUE_QUOTED):(R(this,"Unquoted attribute value"),this.state=M.ATTRIB_VALUE_UNQUOTED,this.attribValue=r);continue;case M.ATTRIB_VALUE_QUOTED:if(r!==this.q){"&"===r?this.state=M.ATTRIB_VALUE_ENTITY_Q:this.attribValue+=r;continue}F(this),this.q="",this.state=M.ATTRIB_VALUE_CLOSED;continue;case M.ATTRIB_VALUE_CLOSED:g(r)?this.state=M.ATTRIB:">"===r?j(this):"/"===r?this.state=M.OPEN_TAG_SLASH:x(f,r)?(R(this,"No whitespace between attributes"),this.attribName=r,this.attribValue="",this.state=M.ATTRIB_NAME):R(this,"Invalid attribute name");continue;case M.ATTRIB_VALUE_UNQUOTED:if(!b(r)){"&"===r?this.state=M.ATTRIB_VALUE_ENTITY_U:this.attribValue+=r;continue}F(this),">"===r?j(this):this.state=M.ATTRIB;continue;case M.CLOSE_TAG:if(this.tagName)">"===r?U(this):x(d,r)?this.tagName+=r:this.script?(this.script+="</"+this.tagName,this.tagName="",this.state=M.SCRIPT):(g(r)||R(this,"Invalid tagname in closing tag"),this.state=M.CLOSE_TAG_SAW_WHITE);else{if(g(r))continue;w(f,r)?this.script?(this.script+="</"+r,this.state=M.SCRIPT):R(this,"Invalid tagname in closing tag."):this.tagName=r}continue;case M.CLOSE_TAG_SAW_WHITE:if(g(r))continue;">"===r?U(this):R(this,"Invalid characters in closing tag");continue;case M.TEXT_ENTITY:case M.ATTRIB_VALUE_ENTITY_Q:case M.ATTRIB_VALUE_ENTITY_U:var s,l;switch(this.state){case M.TEXT_ENTITY:s=M.TEXT,l="textNode";break;case M.ATTRIB_VALUE_ENTITY_Q:s=M.ATTRIB_VALUE_QUOTED,l="attribValue";break;case M.ATTRIB_VALUE_ENTITY_U:s=M.ATTRIB_VALUE_UNQUOTED,l="attribValue"}";"===r?(this[l]+=B(this),this.entity="",this.state=s):x(this.entity.length?v:m,r)?this.entity+=r:(R(this,"Invalid character in entity name"),this[l]+="&"+this.entity+r,this.entity="",this.state=s);continue;default:throw new Error(this,"Unknown state: "+this.state)}this.position>=this.bufferCheckPosition&&function(e){for(var n=Math.max(t.MAX_BUFFER_LENGTH,10),r=0,o=0,a=i.length;o<a;o++){var s=e[i[o]].length;if(s>n)switch(i[o]){case"textNode":O(e);break;case"cdata":P(e,"oncdata",e.cdata),e.cdata="";break;case"script":P(e,"onscript",e.script),e.script="";break;default:I(e,"Max buffer length exceeded: "+i[o])}r=Math.max(r,s)}var u=t.MAX_BUFFER_LENGTH-r;e.bufferCheckPosition=u+e.position}(this);return this}
/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var e;O(e=this),""!==e.cdata&&(P(e,"oncdata",e.cdata),e.cdata=""),""!==e.script&&(P(e,"onscript",e.script),e.script="")}};try{r=n(396).Stream}catch(e){r=function(){}}var a=t.EVENTS.filter((function(e){return"error"!==e&&"end"!==e}));function s(e,t){if(!(this instanceof s))return new s(e,t);r.apply(this),this._parser=new o(e,t),this.writable=!0,this.readable=!0;var n=this;this._parser.onend=function(){n.emit("end")},this._parser.onerror=function(e){n.emit("error",e),n._parser.error=null},this._decoder=null,a.forEach((function(e){Object.defineProperty(n,"on"+e,{get:function(){return n._parser["on"+e]},set:function(t){if(!t)return n.removeAllListeners(e),n._parser["on"+e]=t,t;n.on(e,t)},enumerable:!0,configurable:!1})}))}s.prototype=Object.create(r.prototype,{constructor:{value:s}}),s.prototype.write=function(t){if("function"==typeof e&&"function"==typeof e.isBuffer&&e.isBuffer(t)){if(!this._decoder){var r=n(124).StringDecoder;this._decoder=new r("utf8")}t=this._decoder.write(t)}return this._parser.write(t.toString()),this.emit("data",t),!0},s.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},s.prototype.on=function(e,t){var n=this;return n._parser["on"+e]||-1===a.indexOf(e)||(n._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),n.emit.apply(n,t)}),r.prototype.on.call(n,e,t)};var u="[CDATA[",c="DOCTYPE",l="http://www.w3.org/XML/1998/namespace",h="http://www.w3.org/2000/xmlns/",p={xml:l,xmlns:h},f=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,d=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,m=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,v=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function g(e){return" "===e||"\n"===e||"\r"===e||"\t"===e}function y(e){return'"'===e||"'"===e}function b(e){return">"===e||g(e)}function x(e,t){return e.test(t)}function w(e,t){return!x(e,t)}var _,T,S,M=0;for(var E in t.STATE={BEGIN:M++,BEGIN_WHITESPACE:M++,TEXT:M++,TEXT_ENTITY:M++,OPEN_WAKA:M++,SGML_DECL:M++,SGML_DECL_QUOTED:M++,DOCTYPE:M++,DOCTYPE_QUOTED:M++,DOCTYPE_DTD:M++,DOCTYPE_DTD_QUOTED:M++,COMMENT_STARTING:M++,COMMENT:M++,COMMENT_ENDING:M++,COMMENT_ENDED:M++,CDATA:M++,CDATA_ENDING:M++,CDATA_ENDING_2:M++,PROC_INST:M++,PROC_INST_BODY:M++,PROC_INST_ENDING:M++,OPEN_TAG:M++,OPEN_TAG_SLASH:M++,ATTRIB:M++,ATTRIB_NAME:M++,ATTRIB_NAME_SAW_WHITE:M++,ATTRIB_VALUE:M++,ATTRIB_VALUE_QUOTED:M++,ATTRIB_VALUE_CLOSED:M++,ATTRIB_VALUE_UNQUOTED:M++,ATTRIB_VALUE_ENTITY_Q:M++,ATTRIB_VALUE_ENTITY_U:M++,CLOSE_TAG:M++,CLOSE_TAG_SAW_WHITE:M++,SCRIPT:M++,SCRIPT_ENDING:M++},t.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},t.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(t.ENTITIES).forEach((function(e){var n=t.ENTITIES[e],r="number"==typeof n?String.fromCharCode(n):n;t.ENTITIES[e]=r})),t.STATE)t.STATE[t.STATE[E]]=E;function A(e,t,n){e[t]&&e[t](n)}function P(e,t,n){e.textNode&&O(e),A(e,t,n)}function O(e){e.textNode=L(e.opt,e.textNode),e.textNode&&A(e,"ontext",e.textNode),e.textNode=""}function L(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function I(e,t){return O(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),t=new Error(t),e.error=t,A(e,"onerror",t),e}function C(e){return e.sawRoot&&!e.closedRoot&&R(e,"Unclosed root tag"),e.state!==M.BEGIN&&e.state!==M.BEGIN_WHITESPACE&&e.state!==M.TEXT&&I(e,"Unexpected end"),O(e),e.c="",e.closed=!0,A(e,"onend"),o.call(e,e.strict,e.opt),e}function R(e,t){if("object"!=typeof e||!(e instanceof o))throw new Error("bad call to strictFail");e.strict&&I(e,t)}function D(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,n=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(n.ns=t.ns),e.attribList.length=0,P(e,"onopentagstart",n)}function N(e,t){var n=e.indexOf(":")<0?["",e]:e.split(":"),r=n[0],i=n[1];return t&&"xmlns"===e&&(r="xmlns",i=""),{prefix:r,local:i}}function F(e){if(e.strict||(e.attribName=e.attribName[e.looseCase]()),-1!==e.attribList.indexOf(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName))e.attribName=e.attribValue="";else{if(e.opt.xmlns){var t=N(e.attribName,!0),n=t.prefix,r=t.local;if("xmlns"===n)if("xml"===r&&e.attribValue!==l)R(e,"xml: prefix must be bound to "+l+"\nActual: "+e.attribValue);else if("xmlns"===r&&e.attribValue!==h)R(e,"xmlns: prefix must be bound to "+h+"\nActual: "+e.attribValue);else{var i=e.tag,o=e.tags[e.tags.length-1]||e;i.ns===o.ns&&(i.ns=Object.create(o.ns)),i.ns[r]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,P(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}}function j(e,t){if(e.opt.xmlns){var n=e.tag,r=N(e.tagName);n.prefix=r.prefix,n.local=r.local,n.uri=n.ns[r.prefix]||"",n.prefix&&!n.uri&&(R(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),n.uri=r.prefix);var i=e.tags[e.tags.length-1]||e;n.ns&&i.ns!==n.ns&&Object.keys(n.ns).forEach((function(t){P(e,"onopennamespace",{prefix:t,uri:n.ns[t]})}));for(var o=0,a=e.attribList.length;o<a;o++){var s=e.attribList[o],u=s[0],c=s[1],l=N(u,!0),h=l.prefix,p=l.local,f=""===h?"":n.ns[h]||"",d={name:u,value:c,prefix:h,local:p,uri:f};h&&"xmlns"!==h&&!f&&(R(e,"Unbound namespace prefix: "+JSON.stringify(h)),d.uri=h),e.tag.attributes[u]=d,P(e,"onattribute",d)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),P(e,"onopentag",e.tag),t||(e.noscript||"script"!==e.tagName.toLowerCase()?e.state=M.TEXT:e.state=M.SCRIPT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function U(e){if(!e.tagName)return R(e,"Weird empty close tag."),e.textNode+="</>",void(e.state=M.TEXT);if(e.script){if("script"!==e.tagName)return e.script+="</"+e.tagName+">",e.tagName="",void(e.state=M.SCRIPT);P(e,"onscript",e.script),e.script=""}var t=e.tags.length,n=e.tagName;e.strict||(n=n[e.looseCase]());for(var r=n;t--;){if(e.tags[t].name===r)break;R(e,"Unexpected close tag")}if(t<0)return R(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",void(e.state=M.TEXT);e.tagName=n;for(var i=e.tags.length;i-- >t;){var o=e.tag=e.tags.pop();e.tagName=e.tag.name,P(e,"onclosetag",e.tagName);var a={};for(var s in o.ns)a[s]=o.ns[s];var u=e.tags[e.tags.length-1]||e;e.opt.xmlns&&o.ns!==u.ns&&Object.keys(o.ns).forEach((function(t){var n=o.ns[t];P(e,"onclosenamespace",{prefix:t,uri:n})}))}0===t&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=M.TEXT}function B(e){var t,n=e.entity,r=n.toLowerCase(),i="";return e.ENTITIES[n]?e.ENTITIES[n]:e.ENTITIES[r]?e.ENTITIES[r]:("#"===(n=r).charAt(0)&&("x"===n.charAt(1)?(n=n.slice(2),i=(t=parseInt(n,16)).toString(16)):(n=n.slice(1),i=(t=parseInt(n,10)).toString(10))),n=n.replace(/^0+/,""),isNaN(t)||i.toLowerCase()!==n?(R(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(t))}function k(e,t){"<"===t?(e.state=M.OPEN_WAKA,e.startTagPosition=e.position):g(t)||(R(e,"Non-whitespace before first tag."),e.textNode=t,e.state=M.TEXT)}function z(e,t){var n="";return t<e.length&&(n=e.charAt(t)),n}M=t.STATE,String.fromCodePoint||(_=String.fromCharCode,T=Math.floor,S=function(){var e,t,n=16384,r=[],i=-1,o=arguments.length;if(!o)return"";for(var a="";++i<o;){var s=Number(arguments[i]);if(!isFinite(s)||s<0||s>1114111||T(s)!==s)throw RangeError("Invalid code point: "+s);s<=65535?r.push(s):(e=55296+((s-=65536)>>10),t=s%1024+56320,r.push(e,t)),(i+1===o||r.length>n)&&(a+=_.apply(null,r),r.length=0)}return a},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:S,configurable:!0,writable:!0}):String.fromCodePoint=S)}(t)}).call(this,n(74).Buffer)},function(e,t,n){"use strict";t.byteLength=function(e){var t=c(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=c(e),a=r[0],s=r[1],u=new o(function(e,t,n){return 3*(t+n)/4-n}(0,a,s)),l=0,h=s>0?a-4:a;for(n=0;n<h;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;2===s&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,u[l++]=255&t);1===s&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t);return u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],a=0,s=n-i;a<s;a+=16383)o.push(l(e,a,a+16383>s?s:a+16383));1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=a.length;s<u;++s)r[s]=a[s],i[a.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var i,o,a=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,h=n?i-1:0,p=n?-1:1,f=e[t+h];for(h+=p,o=f&(1<<-l)-1,f>>=-l,l+=s;l>0;o=256*o+e[t+h],h+=p,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=r;l>0;a=256*a+e[t+h],h+=p,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),o-=c}return(f?-1:1)*a*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,h=l>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,d=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=l?(s=0,a=l):a+h>=1?(s=(t*u-1)*Math.pow(2,i),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;e[n+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;e[n+f]=255&a,f+=d,a/=256,c-=8);e[n+f-d]|=128*m}},function(e,t,n){e.exports=i;var r=n(75).EventEmitter;function i(){r.call(this)}n(51)(i,r),i.Readable=n(121),i.Writable=n(404),i.Duplex=n(405),i.Transform=n(406),i.PassThrough=n(407),i.Stream=i,i.prototype.pipe=function(e,t){var n=this;function i(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function o(){n.readable&&n.resume&&n.resume()}n.on("data",i),e.on("drain",o),e._isStdio||t&&!1===t.end||(n.on("end",s),n.on("close",u));var a=!1;function s(){a||(a=!0,e.end())}function u(){a||(a=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(l(),0===r.listenerCount(this,"error"))throw e}function l(){n.removeListener("data",i),e.removeListener("drain",o),n.removeListener("end",s),n.removeListener("close",u),n.removeListener("error",c),e.removeListener("error",c),n.removeListener("end",l),n.removeListener("close",l),e.removeListener("close",l)}return n.on("error",c),e.on("error",c),n.on("end",l),n.on("close",l),e.on("close",l),e.emit("pipe",n),e}},function(e,t){},function(e,t,n){"use strict";var r=n(122).Buffer,i=n(399);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t,n,i,o=r.allocUnsafe(e>>>0),a=this.head,s=0;a;)t=a.data,n=o,i=s,t.copy(n,i),s+=a.data.length,a=a.next;return o},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,i,o,a,s,u=1,c={},l=!1,h=e.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(e);p=p&&p.setTimeout?p:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick((function(){d(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){d(e.data)},r=function(e){o.port2.postMessage(e)}):h&&"onreadystatechange"in h.createElement("script")?(i=h.documentElement,r=function(e){var t=h.createElement("script");t.onreadystatechange=function(){d(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):r=function(e){setTimeout(d,0,e)}:(a="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&d(+t.data.slice(a.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),r=function(t){e.postMessage(a+t,"*")}),p.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return c[u]=i,r(u),u++},p.clearImmediate=f}function f(e){delete c[e]}function d(e){if(l)setTimeout(d,0,e);else{var t=c[e];if(t){l=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}(t)}finally{f(e),l=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(42),n(50))},function(e,t,n){(function(t){function n(e){try{if(!t.localStorage)return!1}catch(e){return!1}var n=t.localStorage[e];return null!=n&&"true"===String(n).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(this,n(42))},function(e,t,n){var r=n(74),i=r.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function a(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(o(r,t),t.Buffer=a),a.prototype=Object.create(i.prototype),o(i,a),a.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},a.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t,n){"use strict";e.exports=o;var r=n(173),i=n(58);function o(e){if(!(this instanceof o))return new o(e);r.call(this,e)}i.inherits=n(51),i.inherits(o,r),o.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){e.exports=n(123)},function(e,t,n){e.exports=n(43)},function(e,t,n){e.exports=n(121).Transform},function(e,t,n){e.exports=n(121).PassThrough},function(e,t){(function(){"use strict";t.stripBOM=function(e){return"\ufeff"===e[0]?e.substring(1):e}}).call(this)},function(e,t,n){"use strict";var r=n(125),i=n(126),o=n(177),a=n(192),s=a(),u=n(438),c=function(e){return s.apply(i,arguments)};r(c,{custom:s.custom,customPromisifyArgs:s.customPromisifyArgs,getPolyfill:a,implementation:o,shim:u}),e.exports=c},function(e,t,n){"use strict";var r;if(!Object.keys){var i=Object.prototype.hasOwnProperty,o=Object.prototype.toString,a=n(176),s=Object.prototype.propertyIsEnumerable,u=!s.call({toString:null},"toString"),c=s.call((function(){}),"prototype"),l=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],h=function(e){var t=e.constructor;return t&&t.prototype===e},p={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!p["$"+e]&&i.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{h(window[e])}catch(e){return!0}}catch(e){return!0}return!1}();r=function(e){var t=null!==e&&"object"==typeof e,n="[object Function]"===o.call(e),r=a(e),s=t&&"[object String]"===o.call(e),p=[];if(!t&&!n&&!r)throw new TypeError("Object.keys called on a non-object");var d=c&&n;if(s&&e.length>0&&!i.call(e,0))for(var m=0;m<e.length;++m)p.push(String(m));if(r&&e.length>0)for(var v=0;v<e.length;++v)p.push(String(v));else for(var g in e)d&&"prototype"===g||!i.call(e,g)||p.push(String(g));if(u)for(var y=function(e){if("undefined"==typeof window||!f)return h(e);try{return h(e)}catch(e){return!1}}(e),b=0;b<l.length;++b)y&&"constructor"===l[b]||!i.call(e,l[b])||p.push(l[b]);return p}}e.exports=r},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";var r=n(125),i=n(178);r(i,{getPolyfill:n(191),implementation:i,shim:n(437)}),e.exports=i},function(e,t,n){"use strict";e.exports=n(415)},function(e,t,n){"use strict";var r=n(416),i=n(12),o=n(183),a=n(190),s=n(53),u=n(189),c=i("%TypeError%"),l=s("Array.prototype.push"),h=n(436),p=o(o({},r),{SameValueNonNumber:function(e,t){if("number"==typeof e||typeof e!=typeof t)throw new TypeError("SameValueNonNumber requires two non-number values of the same type.");return this.SameValue(e,t)},IterableToArrayLike:function(e){var t=u(this,e);if(void 0!==t){for(var n=this.GetIterator(e,t),r=[],i=!0;i;)if(i=this.IteratorStep(n)){var o=this.IteratorValue(i);l(r,o)}return r}return this.ToObject(e)},OrdinaryGetPrototypeOf:function(e){if("Object"!==this.Type(e))throw new c("Assertion failed: O must be an Object");if(!h)throw new c("This environment does not support fetching prototypes.");return h(e)},OrdinarySetPrototypeOf:function(e,t){if("Object"!==this.Type(t)&&"Null"!==this.Type(t))throw new c("Assertion failed: V must be Object or Null");try{a(e,t)}catch(e){return!1}return this.OrdinaryGetPrototypeOf(e)===t}});e.exports=p},function(e,t,n){"use strict";var r=n(52),i=n(418),o=n(175),a=n(423),s=n(12),u=s("%TypeError%"),c=s("%RangeError%"),l=s("%SyntaxError%"),h=s("%Array%"),p=h.prototype,f=s("%String%"),d=s("%Object%"),m=s("%Number%"),v=s("%Symbol%",!0),g=s("%RegExp%"),y=s("%Date%"),b=s("%Function%"),x=d.preventExtensions,w=n(77)(),_=n(180),T=n(181),S=n(182),M=Math.pow(2,32)-1,E=n(425),A=n(183),P=n(184),O=n(185),L=n(426),I=n(427),C=n(186),R=n(428),D=n(187),N=parseInt,F=n(53),j=n(429),U=n(189),B=n(430),k=F("Promise.prototype.then",!0),z=F("Array.prototype.slice"),G=F("String.prototype.slice"),V=F("Array.prototype.indexOf"),H=F("Array.prototype.push"),W=j(/^0b[01]+$/i),X=j(/^0o[0-7]+$/i),Y=j(/^[0-9]$/),q=F("RegExp.prototype.exec"),Q=j(new g("["+["","​","￾"].join("")+"]","g")),Z=j(/^[-+]0x[0-9a-f]+$/i),K=F("String.prototype.charCodeAt"),J=F("Object.prototype.propertyIsEnumerable"),$=F("Object.prototype.toString"),ee=F("Number.prototype.valueOf"),te=F("Boolean.prototype.valueOf"),ne=F("String.prototype.valueOf"),re=F("Date.prototype.valueOf"),ie=F("Symbol.prototype.toString",!0),oe=Math.floor,ae=Math.abs,se=d.create,ue=d.getOwnPropertyDescriptor,ce=d.getOwnPropertyNames,le=d.getOwnPropertySymbols,he=d.isExtensible,pe=d.defineProperty,fe=n(190),de=function(e,t,n,r){if(!pe){if(!e.IsDataDescriptor(r))return!1;if(!r["[[Configurable]]"]||!r["[[Writable]]"])return!1;if(n in t&&J(t,n)!==!!r["[[Enumerable]]"])return!1;var i=r["[[Value]]"];return t[n]=i,e.SameValue(t[n],i)}return pe(t,n,e.FromPropertyDescriptor(r)),!0},me=["\t\n\v\f\r   ᠎    ","         　\u2028","\u2029\ufeff"].join(""),ve=new RegExp("(^["+me+"]+)|(["+me+"]+$)","g"),ge=F("String.prototype.replace"),ye=n(432),be=n(435),xe=A(A({},ye),{Call:function(e,t){var n=arguments.length>2?arguments[2]:[];if(!this.IsCallable(e))throw new u(a(e)+" is not a function");return e.apply(t,n)},ToPrimitive:i,ToNumber:function(e){var t=L(e)?e:i(e,m);if("symbol"==typeof t)throw new u("Cannot convert a Symbol value to a number");if("string"==typeof t){if(W(t))return this.ToNumber(N(G(t,2),2));if(X(t))return this.ToNumber(N(G(t,2),8));if(Q(t)||Z(t))return NaN;var n=function(e){return ge(e,ve,"")}(t);if(n!==t)return this.ToNumber(n)}return m(t)},ToInt16:function(e){var t=this.ToUint16(e);return t>=32768?t-65536:t},ToInt8:function(e){var t=this.ToUint8(e);return t>=128?t-256:t},ToUint8:function(e){var t=this.ToNumber(e);if(T(t)||0===t||!S(t))return 0;var n=P(t)*oe(ae(t));return O(n,256)},ToUint8Clamp:function(e){var t=this.ToNumber(e);if(T(t)||t<=0)return 0;if(t>=255)return 255;var n=oe(e);return n+.5<t?n+1:t<n+.5?n:n%2!=0?n+1:n},ToString:function(e){if("symbol"==typeof e)throw new u("Cannot convert a Symbol value to a string");return f(e)},ToObject:function(e){return this.RequireObjectCoercible(e),d(e)},ToPropertyKey:function(e){var t=this.ToPrimitive(e,f);return"symbol"==typeof t?t:this.ToString(t)},ToLength:function(e){var t=this.ToInteger(e);return t<=0?0:t>E?E:t},CanonicalNumericIndexString:function(e){if("[object String]"!==$(e))throw new u("must be a string");if("-0"===e)return-0;var t=this.ToNumber(e);return this.SameValue(this.ToString(t),e)?t:void 0},RequireObjectCoercible:ye.CheckObjectCoercible,IsArray:h.isArray||function(e){return"[object Array]"===$(e)},IsConstructor:function(e){return"function"==typeof e&&!!e.prototype},IsExtensible:x?function(e){return!L(e)&&he(e)}:function(e){return!0},IsInteger:function(e){if("number"!=typeof e||T(e)||!S(e))return!1;var t=ae(e);return oe(t)===t},IsPropertyKey:function(e){return"string"==typeof e||"symbol"==typeof e},IsRegExp:function(e){if(!e||"object"!=typeof e)return!1;if(w){var t=e[v.match];if(void 0!==t)return ye.ToBoolean(t)}return be(e)},SameValueZero:function(e,t){return e===t||T(e)&&T(t)},GetV:function(e,t){if(!this.IsPropertyKey(t))throw new u("Assertion failed: IsPropertyKey(P) is not true");return this.ToObject(e)[t]},GetMethod:function(e,t){if(!this.IsPropertyKey(t))throw new u("Assertion failed: IsPropertyKey(P) is not true");var n=this.GetV(e,t);if(null!=n){if(!this.IsCallable(n))throw new u(t+"is not a function");return n}},Get:function(e,t){if("Object"!==this.Type(e))throw new u("Assertion failed: Type(O) is not Object");if(!this.IsPropertyKey(t))throw new u("Assertion failed: IsPropertyKey(P) is not true, got "+a(t));return e[t]},Type:function(e){return"symbol"==typeof e?"Symbol":ye.Type(e)},SpeciesConstructor:function(e,t){if("Object"!==this.Type(e))throw new u("Assertion failed: Type(O) is not Object");var n=e.constructor;if(void 0===n)return t;if("Object"!==this.Type(n))throw new u("O.constructor is not an Object");var r=w&&v.species?n[v.species]:void 0;if(null==r)return t;if(this.IsConstructor(r))return r;throw new u("no constructor found")},FromPropertyDescriptor:function(e){if(void 0===e)return e;_(this,"Property Descriptor","Desc",e);var t={};return"[[Value]]"in e&&(t.value=e["[[Value]]"]),"[[Writable]]"in e&&(t.writable=e["[[Writable]]"]),"[[Get]]"in e&&(t.get=e["[[Get]]"]),"[[Set]]"in e&&(t.set=e["[[Set]]"]),"[[Enumerable]]"in e&&(t.enumerable=e["[[Enumerable]]"]),"[[Configurable]]"in e&&(t.configurable=e["[[Configurable]]"]),t},CompletePropertyDescriptor:function(e){return _(this,"Property Descriptor","Desc",e),this.IsGenericDescriptor(e)||this.IsDataDescriptor(e)?(r(e,"[[Value]]")||(e["[[Value]]"]=void 0),r(e,"[[Writable]]")||(e["[[Writable]]"]=!1)):(r(e,"[[Get]]")||(e["[[Get]]"]=void 0),r(e,"[[Set]]")||(e["[[Set]]"]=void 0)),r(e,"[[Enumerable]]")||(e["[[Enumerable]]"]=!1),r(e,"[[Configurable]]")||(e["[[Configurable]]"]=!1),e},Set:function(e,t,n,r){if("Object"!==this.Type(e))throw new u("O must be an Object");if(!this.IsPropertyKey(t))throw new u("P must be a Property Key");if("Boolean"!==this.Type(r))throw new u("Throw must be a Boolean");if(r)return e[t]=n,!0;try{e[t]=n}catch(e){return!1}},HasOwnProperty:function(e,t){if("Object"!==this.Type(e))throw new u("O must be an Object");if(!this.IsPropertyKey(t))throw new u("P must be a Property Key");return r(e,t)},HasProperty:function(e,t){if("Object"!==this.Type(e))throw new u("O must be an Object");if(!this.IsPropertyKey(t))throw new u("P must be a Property Key");return t in e},IsConcatSpreadable:function(e){if("Object"!==this.Type(e))return!1;if(w&&"symbol"==typeof v.isConcatSpreadable){var t=this.Get(e,Symbol.isConcatSpreadable);if(void 0!==t)return this.ToBoolean(t)}return this.IsArray(e)},Invoke:function(e,t){if(!this.IsPropertyKey(t))throw new u("P must be a Property Key");var n=z(arguments,2),r=this.GetV(e,t);return this.Call(r,e,n)},GetIterator:function(e,t){var n=t;arguments.length<2&&(n=U(this,e));var r=this.Call(n,e);if("Object"!==this.Type(r))throw new u("iterator must return an object");return r},IteratorNext:function(e,t){var n=this.Invoke(e,"next",arguments.length<2?[]:[t]);if("Object"!==this.Type(n))throw new u("iterator next must return an object");return n},IteratorComplete:function(e){if("Object"!==this.Type(e))throw new u("Assertion failed: Type(iterResult) is not Object");return this.ToBoolean(this.Get(e,"done"))},IteratorValue:function(e){if("Object"!==this.Type(e))throw new u("Assertion failed: Type(iterResult) is not Object");return this.Get(e,"value")},IteratorStep:function(e){var t=this.IteratorNext(e);return!0!==this.IteratorComplete(t)&&t},IteratorClose:function(e,t){if("Object"!==this.Type(e))throw new u("Assertion failed: Type(iterator) is not Object");if(!this.IsCallable(t))throw new u("Assertion failed: completion is not a thunk for a Completion Record");var n,r=t,i=this.GetMethod(e,"return");if(void 0===i)return r();try{var o=this.Call(i,e,[])}catch(e){throw n=r(),r=null,e}if(n=r(),r=null,"Object"!==this.Type(o))throw new u("iterator .return must return an object");return n},CreateIterResultObject:function(e,t){if("Boolean"!==this.Type(t))throw new u("Assertion failed: Type(done) is not Boolean");return{value:e,done:t}},RegExpExec:function(e,t){if("Object"!==this.Type(e))throw new u("R must be an Object");if("String"!==this.Type(t))throw new u("S must be a String");var n=this.Get(e,"exec");if(this.IsCallable(n)){var r=this.Call(n,e,[t]);if(null===r||"Object"===this.Type(r))return r;throw new u('"exec" method must return `null` or an Object')}return q(e,t)},ArraySpeciesCreate:function(e,t){if(!this.IsInteger(t)||t<0)throw new u("Assertion failed: length must be an integer >= 0");var n,r=0===t?0:t;if(this.IsArray(e)&&(n=this.Get(e,"constructor"),"Object"===this.Type(n)&&w&&v.species&&null===(n=this.Get(n,v.species))&&(n=void 0)),void 0===n)return h(r);if(!this.IsConstructor(n))throw new u("C must be a constructor");return new n(r)},CreateDataProperty:function(e,t,n){if("Object"!==this.Type(e))throw new u("Assertion failed: Type(O) is not Object");if(!this.IsPropertyKey(t))throw new u("Assertion failed: IsPropertyKey(P) is not true");var r=ue(e,t),i=r||this.IsExtensible(e);return!(r&&(!r.writable||!r.configurable)||!i)&&de(this,e,t,{"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Value]]":n,"[[Writable]]":!0})},CreateDataPropertyOrThrow:function(e,t,n){if("Object"!==this.Type(e))throw new u("Assertion failed: Type(O) is not Object");if(!this.IsPropertyKey(t))throw new u("Assertion failed: IsPropertyKey(P) is not true");var r=this.CreateDataProperty(e,t,n);if(!r)throw new u("unable to create data property");return r},ObjectCreate:function(e,t){if(null!==e&&"Object"!==this.Type(e))throw new u("Assertion failed: proto must be null or an object");var n=arguments.length<2?[]:t;if(n.length>0)throw new l("es-abstract does not yet support internal slots");if(null===e&&!se)throw new l("native Object.create support is required to create null objects");return se(e)},AdvanceStringIndex:function(e,t,n){if("String"!==this.Type(e))throw new u("S must be a String");if(!this.IsInteger(t)||t<0||t>E)throw new u("Assertion failed: length must be an integer >= 0 and <= 2**53");if("Boolean"!==this.Type(n))throw new u("Assertion failed: unicode must be a Boolean");if(!n)return t+1;if(t+1>=e.length)return t+1;var r=K(e,t);if(r<55296||r>56319)return t+1;var i=K(e,t+1);return i<56320||i>57343?t+1:t+2},CreateMethodProperty:function(e,t,n){if("Object"!==this.Type(e))throw new u("Assertion failed: Type(O) is not Object");if(!this.IsPropertyKey(t))throw new u("Assertion failed: IsPropertyKey(P) is not true");return de(this,e,t,{"[[Configurable]]":!0,"[[Enumerable]]":!1,"[[Value]]":n,"[[Writable]]":!0})},DefinePropertyOrThrow:function(e,t,n){if("Object"!==this.Type(e))throw new u("Assertion failed: Type(O) is not Object");if(!this.IsPropertyKey(t))throw new u("Assertion failed: IsPropertyKey(P) is not true");var r=D(this,n)?n:this.ToPropertyDescriptor(n);if(!D(this,r))throw new u("Assertion failed: Desc is not a valid Property Descriptor");return de(this,e,t,r)},DeletePropertyOrThrow:function(e,t){if("Object"!==this.Type(e))throw new u("Assertion failed: Type(O) is not Object");if(!this.IsPropertyKey(t))throw new u("Assertion failed: IsPropertyKey(P) is not true");var n=delete e[t];if(!n)throw new TypeError("Attempt to delete property failed.");return n},EnumerableOwnNames:function(e){if("Object"!==this.Type(e))throw new u("Assertion failed: Type(O) is not Object");return o(e)},thisNumberValue:function(e){return"Number"===this.Type(e)?e:ee(e)},thisBooleanValue:function(e){return"Boolean"===this.Type(e)?e:te(e)},thisStringValue:function(e){return"String"===this.Type(e)?e:ne(e)},thisTimeValue:function(e){return re(e)},SetIntegrityLevel:function(e,t){if("Object"!==this.Type(e))throw new u("Assertion failed: Type(O) is not Object");if("sealed"!==t&&"frozen"!==t)throw new u('Assertion failed: `level` must be `"sealed"` or `"frozen"`');if(!x)throw new l("SetIntegrityLevel requires native `Object.preventExtensions` support");if(!x(e))return!1;if(!ce)throw new l("SetIntegrityLevel requires native `Object.getOwnPropertyNames` support");var n=ce(e),r=this;return"sealed"===t?I(n,(function(t){r.DefinePropertyOrThrow(e,t,{configurable:!1})})):"frozen"===t&&I(n,(function(t){var n,i=ue(e,t);void 0!==i&&(n=r.IsAccessorDescriptor(r.ToPropertyDescriptor(i))?{configurable:!1}:{configurable:!1,writable:!1},r.DefinePropertyOrThrow(e,t,n))})),!0},TestIntegrityLevel:function(e,t){if("Object"!==this.Type(e))throw new u("Assertion failed: Type(O) is not Object");if("sealed"!==t&&"frozen"!==t)throw new u('Assertion failed: `level` must be `"sealed"` or `"frozen"`');if(this.IsExtensible(e))return!1;var n=ce(e),r=this;return 0===n.length||C(n,(function(n){var i=ue(e,n);if(void 0!==i){if(i.configurable)return!1;if("frozen"===t&&r.IsDataDescriptor(r.ToPropertyDescriptor(i))&&i.writable)return!1}return!0}))},OrdinaryHasInstance:function(e,t){if(!1===this.IsCallable(e))return!1;if("Object"!==this.Type(t))return!1;var n=this.Get(e,"prototype");if("Object"!==this.Type(n))throw new u("OrdinaryHasInstance called on an object with an invalid prototype property.");return t instanceof e},OrdinaryHasProperty:function(e,t){if("Object"!==this.Type(e))throw new u("Assertion failed: Type(O) is not Object");if(!this.IsPropertyKey(t))throw new u("Assertion failed: P must be a Property Key");return t in e},InstanceofOperator:function(e,t){if("Object"!==this.Type(e))throw new u("Assertion failed: Type(O) is not Object");var n=w&&v.hasInstance?this.GetMethod(t,v.hasInstance):void 0;if(void 0!==n)return this.ToBoolean(this.Call(n,t,[e]));if(!this.IsCallable(t))throw new u("`C` is not Callable");return this.OrdinaryHasInstance(t,e)},IsPromise:function(e){if("Object"!==this.Type(e))return!1;if(!k)return!1;try{k(e)}catch(e){return!1}return!0},"Abstract Equality Comparison":function(e,t){var n=this.Type(e),r=this.Type(t);return n===r?e===t:null==e&&null==t||("Number"===n&&"String"===r?this["Abstract Equality Comparison"](e,this.ToNumber(t)):"String"===n&&"Number"===r?this["Abstract Equality Comparison"](this.ToNumber(e),t):"Boolean"===n?this["Abstract Equality Comparison"](this.ToNumber(e),t):"Boolean"===r?this["Abstract Equality Comparison"](e,this.ToNumber(t)):"String"!==n&&"Number"!==n&&"Symbol"!==n||"Object"!==r?"Object"===n&&("String"===r||"Number"===r||"Symbol"===r)&&this["Abstract Equality Comparison"](this.ToPrimitive(e),t):this["Abstract Equality Comparison"](e,this.ToPrimitive(t)))},ValidateAndApplyPropertyDescriptor:function(e,t,n,r,i){var o=this.Type(e);if("Undefined"!==o&&"Object"!==o)throw new u("Assertion failed: O must be undefined or an Object");if("Boolean"!==this.Type(n))throw new u("Assertion failed: extensible must be a Boolean");if(!D(this,r))throw new u("Assertion failed: Desc must be a Property Descriptor");if("Undefined"!==this.Type(i)&&!D(this,i))throw new u("Assertion failed: current must be a Property Descriptor, or undefined");if("Undefined"!==o&&!this.IsPropertyKey(t))throw new u("Assertion failed: if O is not undefined, P must be a Property Key");if("Undefined"===this.Type(i)){if(!n)return!1;if(this.IsGenericDescriptor(r)||this.IsDataDescriptor(r))"Undefined"!==o&&de(this,e,t,{"[[Configurable]]":r["[[Configurable]]"],"[[Enumerable]]":r["[[Enumerable]]"],"[[Value]]":r["[[Value]]"],"[[Writable]]":r["[[Writable]]"]});else{if(!this.IsAccessorDescriptor(r))throw new u("Assertion failed: Desc is not an accessor descriptor");if("Undefined"!==o)return de(this,e,t,r)}return!0}if(this.IsGenericDescriptor(r)&&!("[[Configurable]]"in r)&&!("[[Enumerable]]"in r))return!0;if(R(this,r,i))return!0;if(!i["[[Configurable]]"]){if(r["[[Configurable]]"])return!1;if("[[Enumerable]]"in r&&!r["[[Enumerable]]"]==!!i["[[Enumerable]]"])return!1}if(this.IsGenericDescriptor(r));else if(this.IsDataDescriptor(i)!==this.IsDataDescriptor(r)){if(!i["[[Configurable]]"])return!1;this.IsDataDescriptor(i)?"Undefined"!==o&&de(this,e,t,{"[[Configurable]]":i["[[Configurable]]"],"[[Enumerable]]":i["[[Enumerable]]"],"[[Get]]":void 0}):"Undefined"!==o&&de(this,e,t,{"[[Configurable]]":i["[[Configurable]]"],"[[Enumerable]]":i["[[Enumerable]]"],"[[Value]]":void 0})}else if(this.IsDataDescriptor(i)&&this.IsDataDescriptor(r)){if(!i["[[Configurable]]"]&&!i["[[Writable]]"])return!("[[Writable]]"in r&&r["[[Writable]]"])&&!("[[Value]]"in r&&!this.SameValue(r["[[Value]]"],i["[[Value]]"]))}else{if(!this.IsAccessorDescriptor(i)||!this.IsAccessorDescriptor(r))throw new u("Assertion failed: current and Desc are not both data, both accessors, or one accessor and one data.");if(!i["[[Configurable]]"])return!("[[Set]]"in r&&!this.SameValue(r["[[Set]]"],i["[[Set]]"]))&&!("[[Get]]"in r&&!this.SameValue(r["[[Get]]"],i["[[Get]]"]))}return"Undefined"===o||de(this,e,t,r)},OrdinaryDefineOwnProperty:function(e,t,n){if("Object"!==this.Type(e))throw new u("Assertion failed: O must be an Object");if(!this.IsPropertyKey(t))throw new u("Assertion failed: P must be a Property Key");if(!D(this,n))throw new u("Assertion failed: Desc must be a Property Descriptor");var r=ue(e,t),i=r&&this.ToPropertyDescriptor(r),o=this.IsExtensible(e);return this.ValidateAndApplyPropertyDescriptor(e,t,o,n,i)},OrdinaryGetOwnProperty:function(e,t){if("Object"!==this.Type(e))throw new u("Assertion failed: O must be an Object");if(!this.IsPropertyKey(t))throw new u("Assertion failed: P must be a Property Key");if(r(e,t)){if(!ue){var n=this.IsArray(e)&&"length"===t,i=this.IsRegExp(e)&&"lastIndex"===t;return{"[[Configurable]]":!(n||i),"[[Enumerable]]":J(e,t),"[[Value]]":e[t],"[[Writable]]":!0}}return this.ToPropertyDescriptor(ue(e,t))}},ArrayCreate:function(e){if(!this.IsInteger(e)||e<0)throw new u("Assertion failed: `length` must be an integer Number >= 0");if(e>M)throw new c("length is greater than (2**32 - 1)");var t=arguments.length>1?arguments[1]:p,n=[];if(t!==p){if(!fe)throw new l("ArrayCreate: a `proto` argument that is not `Array.prototype` is not supported in an environment that does not support setting the [[Prototype]]");fe(n,t)}return 0!==e&&(n.length=e),n},ArraySetLength:function(e,t){if(!this.IsArray(e))throw new u("Assertion failed: A must be an Array");if(!D(this,t))throw new u("Assertion failed: Desc must be a Property Descriptor");if(!("[[Value]]"in t))return this.OrdinaryDefineOwnProperty(e,"length",t);var n=A({},t),r=this.ToUint32(t["[[Value]]"]);if(r!==this.ToNumber(t["[[Value]]"]))throw new c("Invalid array length");n["[[Value]]"]=r;var i=this.OrdinaryGetOwnProperty(e,"length");if(!this.IsDataDescriptor(i))throw new u("Assertion failed: an array had a non-data descriptor on `length`");var o,a=i["[[Value]]"];if(r>=a)return this.OrdinaryDefineOwnProperty(e,"length",n);if(!i["[[Writable]]"])return!1;if("[[Writable]]"in n&&!n["[[Writable]]"]?(o=!1,n["[[Writable]]"]=!0):o=!0,!this.OrdinaryDefineOwnProperty(e,"length",n))return!1;for(;r<a;){if(a-=1,!delete e[this.ToString(a)]&&(n["[[Value]]"]=a+1,!o))return n["[[Writable]]"]=!1,this.OrdinaryDefineOwnProperty(e,"length",n),!1}return!!o||this.OrdinaryDefineOwnProperty(e,"length",{"[[Writable]]":!1})},CreateHTML:function(e,t,n,r){if("String"!==this.Type(t)||"String"!==this.Type(n))throw new u("Assertion failed: `tag` and `attribute` must be strings");var i=this.RequireObjectCoercible(e),o=this.ToString(i),a="<"+t;if(""!==n){var s=this.ToString(r);a+=" "+n+'="'+ge(s,/\x22/g,"&quot;")+'"'}return a+">"+o+"</"+t+">"},GetOwnPropertyKeys:function(e,t){if("Object"!==this.Type(e))throw new u("Assertion failed: Type(O) is not Object");if("Symbol"===t)return w&&le?le(e):[];if("String"===t)return ce?ce(e):o(e);throw new u('Assertion failed: `Type` must be `"String"` or `"Symbol"`')},SymbolDescriptiveString:function(e){if("Symbol"!==this.Type(e))throw new u("Assertion failed: `sym` must be a Symbol");return ie(e)},GetSubstitution:function(e,t,n,r,i){if("String"!==this.Type(e))throw new u("Assertion failed: `matched` must be a String");var o=e.length;if("String"!==this.Type(t))throw new u("Assertion failed: `str` must be a String");var s=t.length;if(!this.IsInteger(n)||n<0||n>s)throw new u("Assertion failed: `position` must be a nonnegative integer, and less than or equal to the length of `string`, got "+a(n));var c=this;if(!this.IsArray(r)||!C(r,(function(e,t,n){return"String"===c.Type(e)||!(t in n)})))throw new u("Assertion failed: `captures` must be a List of Strings, got "+a(r));if("String"!==this.Type(i))throw new u("Assertion failed: `replacement` must be a String");for(var l=n+o,h=r.length,p="",f=0;f<i.length;f+=1){var d=i[f],m=f+1>=i.length,v=f+2>=i.length;if("$"!==d||m)p+=i[f];else{var g=i[f+1];if("$"===g)p+="$",f+=1;else if("&"===g)p+=e,f+=1;else if("`"===g)p+=0===n?"":G(t,0,n-1),f+=1;else if("'"===g)p+=l>=s?"":G(t,l),f+=1;else{var y=v?null:i[f+2];if(!Y(g)||"0"===g||!v&&Y(y))if(Y(g)&&(v||Y(y))){var b=g+y,x=N(b,10)-1;p+=b<=h&&"Undefined"===this.Type(r[x])?"":r[x],f+=2}else p+="$";else{var w=N(g,10);p+=w<=h&&"Undefined"===this.Type(r[w-1])?"":r[w-1],f+=1}}}}return p},ToDateString:function(e){if("Number"!==this.Type(e))throw new u("Assertion failed: `tv` must be a Number");return T(e)?"Invalid Date":y(e)},CreateListFromArrayLike:function(e){var t=arguments.length>1?arguments[1]:["Undefined","Null","Boolean","String","Symbol","Number","Object"];if("Object"!==this.Type(e))throw new u("Assertion failed: `obj` must be an Object");if(!this.IsArray(t))throw new u("Assertion failed: `elementTypes`, if provided, must be an array");for(var n=this.ToLength(this.Get(e,"length")),r=[],i=0;i<n;){var o=this.ToString(i),a=this.Get(e,o),s=this.Type(a);if(V(t,s)<0)throw new u("item type "+s+" is not a valid elementType");H(r,a),i+=1}return r},GetPrototypeFromConstructor:function(e,t){var n=s(t);if(!this.IsConstructor(e))throw new u("Assertion failed: `constructor` must be a constructor");var r=this.Get(e,"prototype");if("Object"!==this.Type(r)){if(!(e instanceof b))throw new u("cross-realm constructors not currently supported");r=n}return r},SetFunctionName:function(e,t){if("function"!=typeof e)throw new u("Assertion failed: `F` must be a function");if(!this.IsExtensible(e)||r(e,"name"))throw new u("Assertion failed: `F` must be extensible, and must not have a `name` own property");var n=this.Type(t);if("Symbol"!==n&&"String"!==n)throw new u("Assertion failed: `name` must be a Symbol or a String");if("Symbol"===n){var i=B(t);t=void 0===i?"":"["+i+"]"}if(arguments.length>2){var o=arguments[2];t=o+" "+t}return this.DefinePropertyOrThrow(e,"name",{"[[Value]]":t,"[[Writable]]":!1,"[[Enumerable]]":!1,"[[Configurable]]":!0})}});delete xe.CheckObjectCoercible,e.exports=xe},function(e,t,n){"use strict";var r="Function.prototype.bind called on incompatible ",i=Array.prototype.slice,o=Object.prototype.toString;e.exports=function(e){var t=this;if("function"!=typeof t||"[object Function]"!==o.call(t))throw new TypeError(r+t);for(var n,a=i.call(arguments,1),s=function(){if(this instanceof n){var r=t.apply(this,a.concat(i.call(arguments)));return Object(r)===r?r:this}return t.apply(e,a.concat(i.call(arguments)))},u=Math.max(0,t.length-a.length),c=[],l=0;l<u;l++)c.push("$"+l);if(n=Function("binder","return function ("+c.join(",")+"){ return binder.apply(this,arguments); }")(s),t.prototype){var h=function(){};h.prototype=t.prototype,n.prototype=new h,h.prototype=null}return n}},function(e,t,n){"use strict";e.exports=n(419)},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator,i=n(179),o=n(128),a=n(420),s=n(421),u=function(e,t){if(null==e)throw new TypeError("Cannot call method on "+e);if("string"!=typeof t||"number"!==t&&"string"!==t)throw new TypeError('hint must be "string" or "number"');var n,r,a,s="string"===t?["toString","valueOf"]:["valueOf","toString"];for(a=0;a<s.length;++a)if(n=e[s[a]],o(n)&&(r=n.call(e),i(r)))return r;throw new TypeError("No default value")},c=function(e,t){var n=e[t];if(null!=n){if(!o(n))throw new TypeError(n+" returned for property "+t+" of object "+e+" is not a function");return n}};e.exports=function(e){if(i(e))return e;var t,n="default";if(arguments.length>1&&(arguments[1]===String?n="string":arguments[1]===Number&&(n="number")),r&&(Symbol.toPrimitive?t=c(e,Symbol.toPrimitive):s(e)&&(t=Symbol.prototype.valueOf)),void 0!==t){var o=t.call(e,n);if(i(o))return o;throw new TypeError("unable to convert exotic object to primitive")}return"default"===n&&(a(e)||s(e))&&(n="string"),u(e,"default"===n?"number":n)}},function(e,t,n){"use strict";var r=Date.prototype.getDay,i=Object.prototype.toString,o="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;e.exports=function(e){return"object"==typeof e&&null!==e&&(o?function(e){try{return r.call(e),!0}catch(e){return!1}}(e):"[object Date]"===i.call(e))}},function(e,t,n){"use strict";var r=Object.prototype.toString;if(n(77)()){var i=Symbol.prototype.toString,o=/^Symbol\(.*\)$/;e.exports=function(e){if("symbol"==typeof e)return!0;if("[object Symbol]"!==r.call(e))return!1;try{return function(e){return"symbol"==typeof e.valueOf()&&o.test(i.call(e))}(e)}catch(e){return!1}}}else e.exports=function(e){return!1}},function(e,t,n){"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(e,t);if(42!==i.value||!0!==i.enumerable)return!1}return!0}},function(e,t,n){var r="function"==typeof Map&&Map.prototype,i=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,o=r&&i&&"function"==typeof i.get?i.get:null,a=r&&Map.prototype.forEach,s="function"==typeof Set&&Set.prototype,u=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,c=s&&u&&"function"==typeof u.get?u.get:null,l=s&&Set.prototype.forEach,h="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,p="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,f=Boolean.prototype.valueOf,d=Object.prototype.toString,m=String.prototype.match,v="function"==typeof BigInt?BigInt.prototype.valueOf:null,g=n(424).custom,y=g&&_(g)?g:null;function b(e,t,n){var r="double"===(n.quoteStyle||t)?'"':"'";return r+e+r}function x(e){return String(e).replace(/"/g,"&quot;")}function w(e){return"[object Array]"===M(e)}function _(e){return"[object Symbol]"===M(e)}e.exports=function e(t,n,r,i){var s=n||{};if(S(s,"quoteStyle")&&"single"!==s.quoteStyle&&"double"!==s.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return function(e,t){return b(e.replace(/(['\\])/g,"\\$1").replace(/[\x00-\x1f]/g,E),"single",t)}(t,s);if("number"==typeof t)return 0===t?1/0/t>0?"0":"-0":String(t);if("bigint"==typeof t)return String(t)+"n";var u=void 0===s.depth?5:s.depth;if(void 0===r&&(r=0),r>=u&&u>0&&"object"==typeof t)return"[Object]";if(void 0===i)i=[];else if(function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}(i,t)>=0)return"[Circular]";function d(t,n){return n&&(i=i.slice()).push(n),e(t,s,r+1,i)}if("function"==typeof t){var g=function(e){if(e.name)return e.name;var t=m.call(e,/^function\s*([\w$]+)/);if(t)return t[1];return null}(t);return"[Function"+(g?": "+g:"")+"]"}if(_(t)){var T=Symbol.prototype.toString.call(t);return"object"==typeof t?A(T):T}if(function(e){if(!e||"object"!=typeof e)return!1;if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return!0;return"string"==typeof e.nodeName&&"function"==typeof e.getAttribute}(t)){for(var I="<"+String(t.nodeName).toLowerCase(),C=t.attributes||[],R=0;R<C.length;R++)I+=" "+C[R].name+"="+b(x(C[R].value),"double",s);return I+=">",t.childNodes&&t.childNodes.length&&(I+="..."),I+="</"+String(t.nodeName).toLowerCase()+">"}if(w(t))return 0===t.length?"[]":"[ "+L(t,d).join(", ")+" ]";if(function(e){return"[object Error]"===M(e)}(t)){var D=L(t,d);return 0===D.length?"["+String(t)+"]":"{ ["+String(t)+"] "+D.join(", ")+" }"}if("object"==typeof t){if(y&&"function"==typeof t[y])return t[y]();if("function"==typeof t.inspect)return t.inspect()}if(function(e){if(!o||!e||"object"!=typeof e)return!1;try{o.call(e);try{c.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var N=[];return a.call(t,(function(e,n){N.push(d(n,t)+" => "+d(e,t))})),O("Map",o.call(t),N)}if(function(e){if(!c||!e||"object"!=typeof e)return!1;try{c.call(e);try{o.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var F=[];return l.call(t,(function(e){F.push(d(e,t))})),O("Set",c.call(t),F)}if(function(e){if(!h||!e||"object"!=typeof e)return!1;try{h.call(e,h);try{p.call(e,p)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return P("WeakMap");if(function(e){if(!p||!e||"object"!=typeof e)return!1;try{p.call(e,p);try{h.call(e,h)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return P("WeakSet");if(function(e){return"[object Number]"===M(e)}(t))return A(d(Number(t)));if(function(e){return"[object BigInt]"===M(e)}(t))return A(d(v.call(t)));if(function(e){return"[object Boolean]"===M(e)}(t))return A(f.call(t));if(function(e){return"[object String]"===M(e)}(t))return A(d(String(t)));if(!function(e){return"[object Date]"===M(e)}(t)&&!function(e){return"[object RegExp]"===M(e)}(t)){var j=L(t,d);return 0===j.length?"{}":"{ "+j.join(", ")+" }"}return String(t)};var T=Object.prototype.hasOwnProperty||function(e){return e in this};function S(e,t){return T.call(e,t)}function M(e){return d.call(e)}function E(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+t.toString(16)}function A(e){return"Object("+e+")"}function P(e){return e+" { ? }"}function O(e,t,n){return e+" ("+t+") {"+n.join(", ")+"}"}function L(e,t){var n=w(e),r=[];if(n){r.length=e.length;for(var i=0;i<e.length;i++)r[i]=S(e,i)?t(e[i],e):""}for(var o in e)S(e,o)&&(n&&String(Number(o))===o&&o<e.length||(/[^\w$]/.test(o)?r.push(t(o,e)+": "+t(e[o],e)):r.push(o+": "+t(e[o],e))));return r}},function(e,t){},function(e,t,n){"use strict";var r=n(12),i=r("%Math%"),o=r("%Number%");e.exports=o.MAX_SAFE_INTEGER||i.pow(2,53)-1},function(e,t,n){"use strict";e.exports=function(e){return null===e||"function"!=typeof e&&"object"!=typeof e}},function(e,t,n){"use strict";e.exports=function(e,t){for(var n=0;n<e.length;n+=1)t(e[n],n,e)}},function(e,t,n){"use strict";var r=n(186);e.exports=function(e,t,n){return r(["[[Configurable]]","[[Enumerable]]","[[Get]]","[[Set]]","[[Value]]","[[Writable]]"],(function(r){return r in t==r in n&&e.SameValue(t[r],n[r])}))}},function(e,t,n){"use strict";var r=n(12)("RegExp.prototype.test"),i=n(188);e.exports=function(e){return i(r,e)}},function(e,t,n){"use strict";var r=n(12),i=n(53),o=r("%SyntaxError%"),a=i("Symbol.prototype.toString",!0),s=n(431);e.exports=function(e){if(!a)throw new o("Symbols are not supported in this environment");var t=a(e);if(s){var n=s(e);if(""===n)return;return n.slice(1,-1)}var r=t.slice(7,-1);if(r)return r}},function(e,t,n){"use strict";var r;try{r=Function("s","return { [s]() {} }[s].name;")}catch(e){}e.exports=r&&"inferred"===function(){}.name?r:null},function(e,t,n){"use strict";var r=n(12),i=r("%Object%"),o=r("%EvalError%"),a=r("%TypeError%"),s=r("%String%"),u=r("%Date%"),c=r("%Number%"),l=r("%Math.floor%"),h=r("%Date.UTC%"),p=r("%Math.abs%"),f=n(180),d=n(187),m=n(181),v=n(182),g=n(184),y=n(185),b=n(433),x=n(53),w=n(128),_=n(434),T=n(52),S=x("Date.prototype.getUTCFullYear"),M={ToPrimitive:_,ToBoolean:function(e){return!!e},ToNumber:function(e){return+e},ToInteger:function(e){var t=this.ToNumber(e);return m(t)?0:0!==t&&v(t)?g(t)*Math.floor(Math.abs(t)):t},ToInt32:function(e){return this.ToNumber(e)>>0},ToUint32:function(e){return this.ToNumber(e)>>>0},ToUint16:function(e){var t=this.ToNumber(e);if(m(t)||0===t||!v(t))return 0;var n=g(t)*Math.floor(Math.abs(t));return y(n,65536)},ToString:function(e){return s(e)},ToObject:function(e){return this.CheckObjectCoercible(e),i(e)},CheckObjectCoercible:function(e,t){if(null==e)throw new a(t||"Cannot call method on "+e);return e},IsCallable:w,SameValue:function(e,t){return e===t?0!==e||1/e==1/t:m(e)&&m(t)},Type:function(e){return null===e?"Null":void 0===e?"Undefined":"function"==typeof e||"object"==typeof e?"Object":"number"==typeof e?"Number":"boolean"==typeof e?"Boolean":"string"==typeof e?"String":void 0},IsPropertyDescriptor:function(e){return d(this,e)},IsAccessorDescriptor:function(e){return void 0!==e&&(f(this,"Property Descriptor","Desc",e),!(!T(e,"[[Get]]")&&!T(e,"[[Set]]")))},IsDataDescriptor:function(e){return void 0!==e&&(f(this,"Property Descriptor","Desc",e),!(!T(e,"[[Value]]")&&!T(e,"[[Writable]]")))},IsGenericDescriptor:function(e){return void 0!==e&&(f(this,"Property Descriptor","Desc",e),!this.IsAccessorDescriptor(e)&&!this.IsDataDescriptor(e))},FromPropertyDescriptor:function(e){if(void 0===e)return e;if(f(this,"Property Descriptor","Desc",e),this.IsDataDescriptor(e))return{value:e["[[Value]]"],writable:!!e["[[Writable]]"],enumerable:!!e["[[Enumerable]]"],configurable:!!e["[[Configurable]]"]};if(this.IsAccessorDescriptor(e))return{get:e["[[Get]]"],set:e["[[Set]]"],enumerable:!!e["[[Enumerable]]"],configurable:!!e["[[Configurable]]"]};throw new a("FromPropertyDescriptor must be called with a fully populated Property Descriptor")},ToPropertyDescriptor:function(e){if("Object"!==this.Type(e))throw new a("ToPropertyDescriptor requires an object");var t={};if(T(e,"enumerable")&&(t["[[Enumerable]]"]=this.ToBoolean(e.enumerable)),T(e,"configurable")&&(t["[[Configurable]]"]=this.ToBoolean(e.configurable)),T(e,"value")&&(t["[[Value]]"]=e.value),T(e,"writable")&&(t["[[Writable]]"]=this.ToBoolean(e.writable)),T(e,"get")){var n=e.get;if(void 0!==n&&!this.IsCallable(n))throw new TypeError("getter must be a function");t["[[Get]]"]=n}if(T(e,"set")){var r=e.set;if(void 0!==r&&!this.IsCallable(r))throw new a("setter must be a function");t["[[Set]]"]=r}if((T(t,"[[Get]]")||T(t,"[[Set]]"))&&(T(t,"[[Value]]")||T(t,"[[Writable]]")))throw new a("Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");return t},"Abstract Equality Comparison":function(e,t){var n=this.Type(e),r=this.Type(t);return n===r?e===t:null==e&&null==t||("Number"===n&&"String"===r?this["Abstract Equality Comparison"](e,this.ToNumber(t)):"String"===n&&"Number"===r?this["Abstract Equality Comparison"](this.ToNumber(e),t):"Boolean"===n?this["Abstract Equality Comparison"](this.ToNumber(e),t):"Boolean"===r?this["Abstract Equality Comparison"](e,this.ToNumber(t)):"String"!==n&&"Number"!==n||"Object"!==r?"Object"===n&&("String"===r||"Number"===r)&&this["Abstract Equality Comparison"](this.ToPrimitive(e),t):this["Abstract Equality Comparison"](e,this.ToPrimitive(t)))},"Strict Equality Comparison":function(e,t){var n=this.Type(e);return n===this.Type(t)&&("Undefined"===n||"Null"===n||e===t)},"Abstract Relational Comparison":function(e,t,n){if("Boolean"!==this.Type(n))throw new a("Assertion failed: LeftFirst argument must be a Boolean");var r,i;if(n?(r=this.ToPrimitive(e,c),i=this.ToPrimitive(t,c)):(i=this.ToPrimitive(t,c),r=this.ToPrimitive(e,c)),!("String"===this.Type(r)&&"String"===this.Type(i))){var o=this.ToNumber(r),s=this.ToNumber(i);if(m(o)||m(s))return;return(!v(o)||!v(s)||o!==s)&&((0!==o||0!==s)&&(o!==1/0&&(s===1/0||s!==-1/0&&(o===-1/0||o<s))))}return!b(i,r)&&(!!b(r,i)||r<i)},msFromTime:function(e){return y(e,1e3)},SecFromTime:function(e){return y(l(e/1e3),60)},MinFromTime:function(e){return y(l(e/6e4),60)},HourFromTime:function(e){return y(l(e/36e5),24)},Day:function(e){return l(e/864e5)},TimeWithinDay:function(e){return y(e,864e5)},DayFromYear:function(e){return 365*(e-1970)+l((e-1969)/4)-l((e-1901)/100)+l((e-1601)/400)},TimeFromYear:function(e){return 864e5*this.DayFromYear(e)},YearFromTime:function(e){return S(new u(e))},WeekDay:function(e){return y(this.Day(e)+4,7)},DaysInYear:function(e){return 0!==y(e,4)?365:0!==y(e,100)?366:0!==y(e,400)?365:366},InLeapYear:function(e){var t=this.DaysInYear(this.YearFromTime(e));if(365===t)return 0;if(366===t)return 1;throw new o("Assertion failed: there are not 365 or 366 days in a year, got: "+t)},DayWithinYear:function(e){return this.Day(e)-this.DayFromYear(this.YearFromTime(e))},MonthFromTime:function(e){var t=this.DayWithinYear(e);if(0<=t&&t<31)return 0;var n=this.InLeapYear(e);return 31<=t&&t<59+n?1:59+n<=t&&t<90+n?2:90+n<=t&&t<120+n?3:120+n<=t&&t<151+n?4:151+n<=t&&t<181+n?5:181+n<=t&&t<212+n?6:212+n<=t&&t<243+n?7:243+n<=t&&t<273+n?8:273+n<=t&&t<304+n?9:304+n<=t&&t<334+n?10:334+n<=t&&t<365+n?11:void 0},DateFromTime:function(e){var t=this.MonthFromTime(e),n=this.DayWithinYear(e);if(0===t)return n+1;if(1===t)return n-30;var r=this.InLeapYear(e);if(2===t)return n-58-r;if(3===t)return n-89-r;if(4===t)return n-119-r;if(5===t)return n-150-r;if(6===t)return n-180-r;if(7===t)return n-211-r;if(8===t)return n-242-r;if(9===t)return n-272-r;if(10===t)return n-303-r;if(11===t)return n-333-r;throw new o("Assertion failed: MonthFromTime returned an impossible value: "+t)},MakeDay:function(e,t,n){if(!v(e)||!v(t)||!v(n))return NaN;var r=this.ToInteger(e),i=this.ToInteger(t),o=this.ToInteger(n),a=r+l(i/12),s=y(i,12),u=h(a,s,1);return this.YearFromTime(u)!==a||this.MonthFromTime(u)!==s||1!==this.DateFromTime(u)?NaN:this.Day(u)+o-1},MakeDate:function(e,t){return v(e)&&v(t)?864e5*e+t:NaN},MakeTime:function(e,t,n,r){return v(e)&&v(t)&&v(n)&&v(r)?36e5*this.ToInteger(e)+6e4*this.ToInteger(t)+1e3*this.ToInteger(n)+this.ToInteger(r):NaN},TimeClip:function(e){return!v(e)||p(e)>864e13?NaN:c(new u(this.ToNumber(e)))},modulo:function(e,t){return y(e,t)}};e.exports=M},function(e,t,n){"use strict";var r=n(53)("String.prototype.slice");e.exports=function(e,t){return e===t||!(e.length>t.length)&&r(t,0,e.length)===e}},function(e,t,n){"use strict";var r=Object.prototype.toString,i=n(179),o=n(128),a=function(e){var t;if((t=arguments.length>1?arguments[1]:"[object Date]"===r.call(e)?String:Number)===String||t===Number){var n,a,s=t===String?["toString","valueOf"]:["valueOf","toString"];for(a=0;a<s.length;++a)if(o(e[s[a]])&&(n=e[s[a]](),i(n)))return n;throw new TypeError("No default value")}throw new TypeError("invalid [[DefaultValue]] hint supplied")};e.exports=function(e){return i(e)?e:arguments.length>1?a(e,arguments[1]):a(e)}},function(e,t,n){"use strict";var r=n(52),i=RegExp.prototype.exec,o=Object.getOwnPropertyDescriptor,a=Object.prototype.toString,s="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;e.exports=function(e){if(!e||"object"!=typeof e)return!1;if(!s)return"[object RegExp]"===a.call(e);var t=o(e,"lastIndex");return!(!t||!r(t,"value"))&&function(e){try{var t=e.lastIndex;return e.lastIndex=0,i.call(e),!0}catch(e){return!1}finally{e.lastIndex=t}}(e)}},function(e,t,n){"use strict";var r=n(12),i=r("%Object.getPrototypeOf%",!0),o=r("%Array.prototype%");e.exports=i||([].__proto__===o?function(e){return e.__proto__}:null)},function(e,t,n){"use strict";var r=n(191),i=n(125);e.exports=function(){var e=r();return i(Object,{getOwnPropertyDescriptors:e},{getOwnPropertyDescriptors:function(){return Object.getOwnPropertyDescriptors!==e}}),e}},function(e,t,n){"use strict";var r=n(126),i=n(192);e.exports=function(){var e=i();return e!==r.promisify&&(r.promisify=e,Object.defineProperty(r,"promisify",{value:e})),e}},function(e){e.exports=JSON.parse('{"name":"soonspacejs","version":"1.6.2","description":"","main":"dist/index.js","types":"types/index.d.ts","unpkg":"dist/index.js","scripts":{"build":"webpack --config ./script/webpack.js --mode=production","build:sbm":"webpack --config ./script/webpack.sbm.js --mode=production","build:sbmDev":"webpack --config ./script/webpack.sbm.js --mode=development","build:example":"webpack --config ./script/webpack.example.js --mode=production","build:exampleDev":"webpack --config ./script/webpack.example.js --mode=development","docs:dev":"vuepress dev docs","docs:build":"vuepress build docs"},"author":"xuek","license":"ISC","devDependencies":{"@babel/core":"^7.7.7","@babel/polyfill":"^7.7.0","@babel/preset-env":"^7.7.7","@tweenjs/tween.js":"^18.4.2","@vuepress/plugin-back-to-top":"^1.4.1","@vuepress/plugin-nprogress":"^1.4.1","@vuepress/plugin-pwa":"^1.5.2","babel-eslint":"^10.1.0","babel-loader":"^8.0.6","eslint":"^6.6.0","maptalks":"^0.45.1","moment":"^2.27.0","signals":"0.7.4","three":"^0.113.2","vuepress":"1.5.2","vuepress-plugin-right-anchor":"^0.1.7","webpack":"4.42.0","webpack-bundle-analyzer":"^3.6.0","webpack-cli":"^3.3.10","webpackbar":"^4.0.0","xml2js":"^0.4.22"}}')},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"ACESFilmicToneMapping",(function(){return le})),n.d(r,"AddEquation",(function(){return C})),n.d(r,"AddOperation",(function(){return ie})),n.d(r,"AdditiveBlending",(function(){return P})),n.d(r,"AlphaFormat",(function(){return He})),n.d(r,"AlwaysDepth",(function(){return Q})),n.d(r,"AlwaysStencilFunc",(function(){return fn})),n.d(r,"AmbientLight",(function(){return ih})),n.d(r,"AmbientLightProbe",(function(){return Ah})),n.d(r,"AnimationClip",(function(){return hl})),n.d(r,"AnimationLoader",(function(){return bl})),n.d(r,"AnimationMixer",(function(){return rp})),n.d(r,"AnimationObjectGroup",(function(){return tp})),n.d(r,"AnimationUtils",(function(){return Jc})),n.d(r,"ArcCurve",(function(){return Al})),n.d(r,"ArrayCamera",(function(){return _s})),n.d(r,"ArrowHelper",(function(){return Wp})),n.d(r,"Audio",(function(){return jh})),n.d(r,"AudioAnalyser",(function(){return Vh})),n.d(r,"AudioContext",(function(){return _h})),n.d(r,"AudioListener",(function(){return Fh})),n.d(r,"AudioLoader",(function(){return Th})),n.d(r,"AxesHelper",(function(){return Xp})),n.d(r,"AxisHelper",(function(){return nd})),n.d(r,"BackSide",(function(){return b})),n.d(r,"BasicDepthPacking",(function(){return Yt})),n.d(r,"BasicShadowMap",(function(){return d})),n.d(r,"BinaryTextureLoader",(function(){return sd})),n.d(r,"Bone",(function(){return eu})),n.d(r,"BooleanKeyframeTrack",(function(){return il})),n.d(r,"BoundingBoxHelper",(function(){return rd})),n.d(r,"Box2",(function(){return pp})),n.d(r,"Box3",(function(){return Er})),n.d(r,"Box3Helper",(function(){return kp})),n.d(r,"BoxBufferGeometry",(function(){return ro})),n.d(r,"BoxGeometry",(function(){return no})),n.d(r,"BoxHelper",(function(){return Bp})),n.d(r,"BufferAttribute",(function(){return hi})),n.d(r,"BufferGeometry",(function(){return Li})),n.d(r,"BufferGeometryLoader",(function(){return lh})),n.d(r,"ByteType",(function(){return Re})),n.d(r,"Cache",(function(){return fl})),n.d(r,"Camera",(function(){return lo})),n.d(r,"CameraHelper",(function(){return Fp})),n.d(r,"CanvasRenderer",(function(){return ld})),n.d(r,"CanvasTexture",(function(){return Eu})),n.d(r,"CatmullRomCurve3",(function(){return Rl})),n.d(r,"CineonToneMapping",(function(){return ce})),n.d(r,"CircleBufferGeometry",(function(){return Bc})),n.d(r,"CircleGeometry",(function(){return Uc})),n.d(r,"ClampToEdgeWrapping",(function(){return xe})),n.d(r,"Clock",(function(){return Ih})),n.d(r,"ClosedSplineCurve3",(function(){return $f})),n.d(r,"Color",(function(){return ni})),n.d(r,"ColorKeyframeTrack",(function(){return ol})),n.d(r,"CompressedTexture",(function(){return Mu})),n.d(r,"CompressedTextureLoader",(function(){return xl})),n.d(r,"ConeBufferGeometry",(function(){return jc})),n.d(r,"ConeGeometry",(function(){return Fc})),n.d(r,"CubeCamera",(function(){return mo})),n.d(r,"CubeGeometry",(function(){return no})),n.d(r,"CubeReflectionMapping",(function(){return pe})),n.d(r,"CubeRefractionMapping",(function(){return fe})),n.d(r,"CubeTexture",(function(){return Bo})),n.d(r,"CubeTextureLoader",(function(){return Tl})),n.d(r,"CubeUVReflectionMapping",(function(){return ge})),n.d(r,"CubeUVRefractionMapping",(function(){return ye})),n.d(r,"CubicBezierCurve",(function(){return jl})),n.d(r,"CubicBezierCurve3",(function(){return Ul})),n.d(r,"CubicInterpolant",(function(){return el})),n.d(r,"CullFaceBack",(function(){return c})),n.d(r,"CullFaceFront",(function(){return l})),n.d(r,"CullFaceFrontBack",(function(){return h})),n.d(r,"CullFaceNone",(function(){return u})),n.d(r,"Curve",(function(){return Ml})),n.d(r,"CurvePath",(function(){return Wl})),n.d(r,"CustomBlending",(function(){return I})),n.d(r,"CylinderBufferGeometry",(function(){return Nc})),n.d(r,"CylinderGeometry",(function(){return Dc})),n.d(r,"Cylindrical",(function(){return lp})),n.d(r,"DataTexture",(function(){return go})),n.d(r,"DataTexture2DArray",(function(){return ko})),n.d(r,"DataTexture3D",(function(){return zo})),n.d(r,"DataTextureLoader",(function(){return wl})),n.d(r,"DecrementStencilOp",(function(){return tn})),n.d(r,"DecrementWrapStencilOp",(function(){return rn})),n.d(r,"DefaultLoadingManager",(function(){return ml})),n.d(r,"DepthFormat",(function(){return Ze})),n.d(r,"DepthStencilFormat",(function(){return Ke})),n.d(r,"DepthTexture",(function(){return Au})),n.d(r,"DirectionalLight",(function(){return rh})),n.d(r,"DirectionalLightHelper",(function(){return Rp})),n.d(r,"DirectionalLightShadow",(function(){return nh})),n.d(r,"DiscreteInterpolant",(function(){return nl})),n.d(r,"DodecahedronBufferGeometry",(function(){return ku})),n.d(r,"DodecahedronGeometry",(function(){return Bu})),n.d(r,"DoubleSide",(function(){return x})),n.d(r,"DstAlphaFactor",(function(){return V})),n.d(r,"DstColorFactor",(function(){return W})),n.d(r,"DynamicBufferAttribute",(function(){return Vf})),n.d(r,"DynamicCopyUsage",(function(){return wn})),n.d(r,"DynamicDrawUsage",(function(){return mn})),n.d(r,"DynamicReadUsage",(function(){return yn})),n.d(r,"EdgesGeometry",(function(){return Rc})),n.d(r,"EdgesHelper",(function(){return id})),n.d(r,"EllipseCurve",(function(){return El})),n.d(r,"EqualDepth",(function(){return J})),n.d(r,"EqualStencilFunc",(function(){return un})),n.d(r,"EquirectangularReflectionMapping",(function(){return de})),n.d(r,"EquirectangularRefractionMapping",(function(){return me})),n.d(r,"Euler",(function(){return Zn})),n.d(r,"EventDispatcher",(function(){return Tn})),n.d(r,"ExtrudeBufferGeometry",(function(){return bc})),n.d(r,"ExtrudeGeometry",(function(){return yc})),n.d(r,"Face3",(function(){return ai})),n.d(r,"Face4",(function(){return If})),n.d(r,"FaceColors",(function(){return S})),n.d(r,"FileLoader",(function(){return yl})),n.d(r,"FlatShading",(function(){return w})),n.d(r,"Float32Attribute",(function(){return Kf})),n.d(r,"Float32BufferAttribute",(function(){return bi})),n.d(r,"Float64Attribute",(function(){return Jf})),n.d(r,"Float64BufferAttribute",(function(){return xi})),n.d(r,"FloatType",(function(){return Ue})),n.d(r,"Fog",(function(){return As})),n.d(r,"FogExp2",(function(){return Es})),n.d(r,"Font",(function(){return bh})),n.d(r,"FontLoader",(function(){return wh})),n.d(r,"FrontFaceDirectionCCW",(function(){return f})),n.d(r,"FrontFaceDirectionCW",(function(){return p})),n.d(r,"FrontSide",(function(){return y})),n.d(r,"Frustum",(function(){return xo})),n.d(r,"GammaEncoding",(function(){return zt})),n.d(r,"Geometry",(function(){return to})),n.d(r,"GeometryUtils",(function(){return cd})),n.d(r,"GreaterDepth",(function(){return ee})),n.d(r,"GreaterEqualDepth",(function(){return $})),n.d(r,"GreaterEqualStencilFunc",(function(){return pn})),n.d(r,"GreaterStencilFunc",(function(){return ln})),n.d(r,"GridHelper",(function(){return Pp})),n.d(r,"Group",(function(){return Ts})),n.d(r,"HalfFloatType",(function(){return Be})),n.d(r,"HemisphereLight",(function(){return Ql})),n.d(r,"HemisphereLightHelper",(function(){return Ap})),n.d(r,"HemisphereLightProbe",(function(){return Eh})),n.d(r,"IcosahedronBufferGeometry",(function(){return Uu})),n.d(r,"IcosahedronGeometry",(function(){return ju})),n.d(r,"ImageBitmapLoader",(function(){return gh})),n.d(r,"ImageLoader",(function(){return _l})),n.d(r,"ImageUtils",(function(){return Ln})),n.d(r,"ImmediateRenderObject",(function(){return vp})),n.d(r,"IncrementStencilOp",(function(){return en})),n.d(r,"IncrementWrapStencilOp",(function(){return nn})),n.d(r,"InstancedBufferAttribute",(function(){return ch})),n.d(r,"InstancedBufferGeometry",(function(){return uh})),n.d(r,"InstancedInterleavedBuffer",(function(){return op})),n.d(r,"InstancedMesh",(function(){return ou})),n.d(r,"Int16Attribute",(function(){return Yf})),n.d(r,"Int16BufferAttribute",(function(){return mi})),n.d(r,"Int32Attribute",(function(){return Qf})),n.d(r,"Int32BufferAttribute",(function(){return gi})),n.d(r,"Int8Attribute",(function(){return Hf})),n.d(r,"Int8BufferAttribute",(function(){return pi})),n.d(r,"IntType",(function(){return Fe})),n.d(r,"InterleavedBuffer",(function(){return Ps})),n.d(r,"InterleavedBufferAttribute",(function(){return Is})),n.d(r,"Interpolant",(function(){return $c})),n.d(r,"InterpolateDiscrete",(function(){return Lt})),n.d(r,"InterpolateLinear",(function(){return It})),n.d(r,"InterpolateSmooth",(function(){return Ct})),n.d(r,"InvertStencilOp",(function(){return on})),n.d(r,"JSONLoader",(function(){return hd})),n.d(r,"KeepStencilOp",(function(){return Jt})),n.d(r,"KeyframeTrack",(function(){return rl})),n.d(r,"LOD",(function(){return Qs})),n.d(r,"LatheBufferGeometry",(function(){return Oc})),n.d(r,"LatheGeometry",(function(){return Pc})),n.d(r,"Layers",(function(){return Kn})),n.d(r,"LensFlare",(function(){return fd})),n.d(r,"LessDepth",(function(){return Z})),n.d(r,"LessEqualDepth",(function(){return K})),n.d(r,"LessEqualStencilFunc",(function(){return cn})),n.d(r,"LessStencilFunc",(function(){return sn})),n.d(r,"Light",(function(){return ql})),n.d(r,"LightProbe",(function(){return Mh})),n.d(r,"LightShadow",(function(){return Zl})),n.d(r,"Line",(function(){return pu})),n.d(r,"Line3",(function(){return mp})),n.d(r,"LineBasicMaterial",(function(){return au})),n.d(r,"LineCurve",(function(){return Bl})),n.d(r,"LineCurve3",(function(){return kl})),n.d(r,"LineDashedMaterial",(function(){return Zc})),n.d(r,"LineLoop",(function(){return vu})),n.d(r,"LinePieces",(function(){return Rf})),n.d(r,"LineSegments",(function(){return mu})),n.d(r,"LineStrip",(function(){return Cf})),n.d(r,"LinearEncoding",(function(){return Bt})),n.d(r,"LinearFilter",(function(){return Ae})),n.d(r,"LinearInterpolant",(function(){return tl})),n.d(r,"LinearMipMapLinearFilter",(function(){return Ie})),n.d(r,"LinearMipMapNearestFilter",(function(){return Oe})),n.d(r,"LinearMipmapLinearFilter",(function(){return Le})),n.d(r,"LinearMipmapNearestFilter",(function(){return Pe})),n.d(r,"LinearToneMapping",(function(){return ae})),n.d(r,"Loader",(function(){return vl})),n.d(r,"LoaderUtils",(function(){return sh})),n.d(r,"LoadingManager",(function(){return dl})),n.d(r,"LogLuvEncoding",(function(){return Vt})),n.d(r,"LoopOnce",(function(){return At})),n.d(r,"LoopPingPong",(function(){return Ot})),n.d(r,"LoopRepeat",(function(){return Pt})),n.d(r,"LuminanceAlphaFormat",(function(){return qe})),n.d(r,"LuminanceFormat",(function(){return Ye})),n.d(r,"MOUSE",(function(){return a})),n.d(r,"Material",(function(){return ui})),n.d(r,"MaterialLoader",(function(){return ah})),n.d(r,"Math",(function(){return An})),n.d(r,"MathUtils",(function(){return An})),n.d(r,"Matrix3",(function(){return On})),n.d(r,"Matrix4",(function(){return Yn})),n.d(r,"MaxEquation",(function(){return F})),n.d(r,"Mesh",(function(){return qi})),n.d(r,"MeshBasicMaterial",(function(){return ci})),n.d(r,"MeshDepthMaterial",(function(){return ps})),n.d(r,"MeshDistanceMaterial",(function(){return fs})),n.d(r,"MeshFaceMaterial",(function(){return Df})),n.d(r,"MeshLambertMaterial",(function(){return qc})),n.d(r,"MeshMatcapMaterial",(function(){return Qc})),n.d(r,"MeshNormalMaterial",(function(){return Yc})),n.d(r,"MeshPhongMaterial",(function(){return Wc})),n.d(r,"MeshPhysicalMaterial",(function(){return Hc})),n.d(r,"MeshStandardMaterial",(function(){return Vc})),n.d(r,"MeshToonMaterial",(function(){return Xc})),n.d(r,"MinEquation",(function(){return N})),n.d(r,"MirroredRepeatWrapping",(function(){return we})),n.d(r,"MixOperation",(function(){return re})),n.d(r,"MultiMaterial",(function(){return Nf})),n.d(r,"MultiplyBlending",(function(){return L})),n.d(r,"MultiplyOperation",(function(){return ne})),n.d(r,"NearestFilter",(function(){return _e})),n.d(r,"NearestMipMapLinearFilter",(function(){return Ee})),n.d(r,"NearestMipMapNearestFilter",(function(){return Se})),n.d(r,"NearestMipmapLinearFilter",(function(){return Me})),n.d(r,"NearestMipmapNearestFilter",(function(){return Te})),n.d(r,"NeverDepth",(function(){return q})),n.d(r,"NeverStencilFunc",(function(){return an})),n.d(r,"NoBlending",(function(){return E})),n.d(r,"NoColors",(function(){return T})),n.d(r,"NoToneMapping",(function(){return oe})),n.d(r,"NormalBlending",(function(){return A})),n.d(r,"NotEqualDepth",(function(){return te})),n.d(r,"NotEqualStencilFunc",(function(){return hn})),n.d(r,"NumberKeyframeTrack",(function(){return al})),n.d(r,"Object3D",(function(){return hr})),n.d(r,"ObjectLoader",(function(){return ph})),n.d(r,"ObjectSpaceNormalMap",(function(){return Zt})),n.d(r,"OctahedronBufferGeometry",(function(){return Fu})),n.d(r,"OctahedronGeometry",(function(){return Nu})),n.d(r,"OneFactor",(function(){return U})),n.d(r,"OneMinusDstAlphaFactor",(function(){return H})),n.d(r,"OneMinusDstColorFactor",(function(){return X})),n.d(r,"OneMinusSrcAlphaFactor",(function(){return G})),n.d(r,"OneMinusSrcColorFactor",(function(){return k})),n.d(r,"OrthographicCamera",(function(){return th})),n.d(r,"PCFShadowMap",(function(){return m})),n.d(r,"PCFSoftShadowMap",(function(){return v})),n.d(r,"PMREMGenerator",(function(){return yf})),n.d(r,"ParametricBufferGeometry",(function(){return Lu})),n.d(r,"ParametricGeometry",(function(){return Ou})),n.d(r,"Particle",(function(){return jf})),n.d(r,"ParticleBasicMaterial",(function(){return kf})),n.d(r,"ParticleSystem",(function(){return Uf})),n.d(r,"ParticleSystemMaterial",(function(){return zf})),n.d(r,"Path",(function(){return Xl})),n.d(r,"PerspectiveCamera",(function(){return ho})),n.d(r,"Plane",(function(){return zr})),n.d(r,"PlaneBufferGeometry",(function(){return Mo})),n.d(r,"PlaneGeometry",(function(){return So})),n.d(r,"PlaneHelper",(function(){return zp})),n.d(r,"PointCloud",(function(){return Ff})),n.d(r,"PointCloudMaterial",(function(){return Bf})),n.d(r,"PointLight",(function(){return eh})),n.d(r,"PointLightHelper",(function(){return Tp})),n.d(r,"Points",(function(){return _u})),n.d(r,"PointsMaterial",(function(){return gu})),n.d(r,"PolarGridHelper",(function(){return Op})),n.d(r,"PolyhedronBufferGeometry",(function(){return Cu})),n.d(r,"PolyhedronGeometry",(function(){return Iu})),n.d(r,"PositionalAudio",(function(){return Gh})),n.d(r,"PropertyBinding",(function(){return ep})),n.d(r,"PropertyMixer",(function(){return Hh})),n.d(r,"QuadraticBezierCurve",(function(){return zl})),n.d(r,"QuadraticBezierCurve3",(function(){return Gl})),n.d(r,"Quaternion",(function(){return Fn})),n.d(r,"QuaternionKeyframeTrack",(function(){return ul})),n.d(r,"QuaternionLinearInterpolant",(function(){return sl})),n.d(r,"REVISION",(function(){return o})),n.d(r,"RGBADepthPacking",(function(){return qt})),n.d(r,"RGBAFormat",(function(){return Xe})),n.d(r,"RGBAIntegerFormat",(function(){return rt})),n.d(r,"RGBA_ASTC_10x10_Format",(function(){return St})),n.d(r,"RGBA_ASTC_10x5_Format",(function(){return wt})),n.d(r,"RGBA_ASTC_10x6_Format",(function(){return _t})),n.d(r,"RGBA_ASTC_10x8_Format",(function(){return Tt})),n.d(r,"RGBA_ASTC_12x10_Format",(function(){return Mt})),n.d(r,"RGBA_ASTC_12x12_Format",(function(){return Et})),n.d(r,"RGBA_ASTC_4x4_Format",(function(){return ft})),n.d(r,"RGBA_ASTC_5x4_Format",(function(){return dt})),n.d(r,"RGBA_ASTC_5x5_Format",(function(){return mt})),n.d(r,"RGBA_ASTC_6x5_Format",(function(){return vt})),n.d(r,"RGBA_ASTC_6x6_Format",(function(){return gt})),n.d(r,"RGBA_ASTC_8x5_Format",(function(){return yt})),n.d(r,"RGBA_ASTC_8x6_Format",(function(){return bt})),n.d(r,"RGBA_ASTC_8x8_Format",(function(){return xt})),n.d(r,"RGBA_PVRTC_2BPPV1_Format",(function(){return ht})),n.d(r,"RGBA_PVRTC_4BPPV1_Format",(function(){return lt})),n.d(r,"RGBA_S3TC_DXT1_Format",(function(){return ot})),n.d(r,"RGBA_S3TC_DXT3_Format",(function(){return at})),n.d(r,"RGBA_S3TC_DXT5_Format",(function(){return st})),n.d(r,"RGBDEncoding",(function(){return Xt})),n.d(r,"RGBEEncoding",(function(){return Gt})),n.d(r,"RGBEFormat",(function(){return Qe})),n.d(r,"RGBFormat",(function(){return We})),n.d(r,"RGBIntegerFormat",(function(){return nt})),n.d(r,"RGBM16Encoding",(function(){return Wt})),n.d(r,"RGBM7Encoding",(function(){return Ht})),n.d(r,"RGB_ETC1_Format",(function(){return pt})),n.d(r,"RGB_PVRTC_2BPPV1_Format",(function(){return ct})),n.d(r,"RGB_PVRTC_4BPPV1_Format",(function(){return ut})),n.d(r,"RGB_S3TC_DXT1_Format",(function(){return it})),n.d(r,"RGFormat",(function(){return et})),n.d(r,"RGIntegerFormat",(function(){return tt})),n.d(r,"RawShaderMaterial",(function(){return Gc})),n.d(r,"Ray",(function(){return jr})),n.d(r,"Raycaster",(function(){return ap})),n.d(r,"RectAreaLight",(function(){return oh})),n.d(r,"RedFormat",(function(){return Je})),n.d(r,"RedIntegerFormat",(function(){return $e})),n.d(r,"ReinhardToneMapping",(function(){return se})),n.d(r,"RepeatWrapping",(function(){return be})),n.d(r,"ReplaceStencilOp",(function(){return $t})),n.d(r,"ReverseSubtractEquation",(function(){return D})),n.d(r,"RingBufferGeometry",(function(){return Ac})),n.d(r,"RingGeometry",(function(){return Ec})),n.d(r,"Scene",(function(){return pr})),n.d(r,"SceneUtils",(function(){return pd})),n.d(r,"ShaderChunk",(function(){return Eo})),n.d(r,"ShaderLib",(function(){return Ao})),n.d(r,"ShaderMaterial",(function(){return co})),n.d(r,"ShadowMaterial",(function(){return zc})),n.d(r,"Shape",(function(){return Yl})),n.d(r,"ShapeBufferGeometry",(function(){return Ic})),n.d(r,"ShapeGeometry",(function(){return Lc})),n.d(r,"ShapePath",(function(){return yh})),n.d(r,"ShapeUtils",(function(){return mc})),n.d(r,"ShortType",(function(){return De})),n.d(r,"Skeleton",(function(){return $s})),n.d(r,"SkeletonHelper",(function(){return _p})),n.d(r,"SkinnedMesh",(function(){return Zs})),n.d(r,"SmoothShading",(function(){return _})),n.d(r,"Sphere",(function(){return Or})),n.d(r,"SphereBufferGeometry",(function(){return Mc})),n.d(r,"SphereGeometry",(function(){return Sc})),n.d(r,"Spherical",(function(){return cp})),n.d(r,"SphericalHarmonics3",(function(){return Sh})),n.d(r,"SphericalReflectionMapping",(function(){return ve})),n.d(r,"Spline",(function(){return td})),n.d(r,"SplineCurve",(function(){return Vl})),n.d(r,"SplineCurve3",(function(){return ed})),n.d(r,"SpotLight",(function(){return Jl})),n.d(r,"SpotLightHelper",(function(){return yp})),n.d(r,"SpotLightShadow",(function(){return Kl})),n.d(r,"Sprite",(function(){return Ws})),n.d(r,"SpriteMaterial",(function(){return Cs})),n.d(r,"SrcAlphaFactor",(function(){return z})),n.d(r,"SrcAlphaSaturateFactor",(function(){return Y})),n.d(r,"SrcColorFactor",(function(){return B})),n.d(r,"StaticCopyUsage",(function(){return xn})),n.d(r,"StaticDrawUsage",(function(){return dn})),n.d(r,"StaticReadUsage",(function(){return gn})),n.d(r,"StereoCamera",(function(){return Lh})),n.d(r,"StreamCopyUsage",(function(){return _n})),n.d(r,"StreamDrawUsage",(function(){return vn})),n.d(r,"StreamReadUsage",(function(){return bn})),n.d(r,"StringKeyframeTrack",(function(){return cl})),n.d(r,"SubtractEquation",(function(){return R})),n.d(r,"SubtractiveBlending",(function(){return O})),n.d(r,"TOUCH",(function(){return s})),n.d(r,"TangentSpaceNormalMap",(function(){return Qt})),n.d(r,"TetrahedronBufferGeometry",(function(){return Du})),n.d(r,"TetrahedronGeometry",(function(){return Ru})),n.d(r,"TextBufferGeometry",(function(){return Tc})),n.d(r,"TextGeometry",(function(){return _c})),n.d(r,"Texture",(function(){return Cn})),n.d(r,"TextureLoader",(function(){return Sl})),n.d(r,"TorusBufferGeometry",(function(){return Xu})),n.d(r,"TorusGeometry",(function(){return Wu})),n.d(r,"TorusKnotBufferGeometry",(function(){return Hu})),n.d(r,"TorusKnotGeometry",(function(){return Vu})),n.d(r,"Triangle",(function(){return Jr})),n.d(r,"TriangleFanDrawMode",(function(){return Ut})),n.d(r,"TriangleStripDrawMode",(function(){return jt})),n.d(r,"TrianglesDrawMode",(function(){return Ft})),n.d(r,"TubeBufferGeometry",(function(){return Gu})),n.d(r,"TubeGeometry",(function(){return zu})),n.d(r,"UVMapping",(function(){return he})),n.d(r,"Uint16Attribute",(function(){return qf})),n.d(r,"Uint16BufferAttribute",(function(){return vi})),n.d(r,"Uint32Attribute",(function(){return Zf})),n.d(r,"Uint32BufferAttribute",(function(){return yi})),n.d(r,"Uint8Attribute",(function(){return Wf})),n.d(r,"Uint8BufferAttribute",(function(){return fi})),n.d(r,"Uint8ClampedAttribute",(function(){return Xf})),n.d(r,"Uint8ClampedBufferAttribute",(function(){return di})),n.d(r,"Uncharted2ToneMapping",(function(){return ue})),n.d(r,"Uniform",(function(){return ip})),n.d(r,"UniformsLib",(function(){return wo})),n.d(r,"UniformsUtils",(function(){return ao})),n.d(r,"UnsignedByteType",(function(){return Ce})),n.d(r,"UnsignedInt248Type",(function(){return Ve})),n.d(r,"UnsignedIntType",(function(){return je})),n.d(r,"UnsignedShort4444Type",(function(){return ke})),n.d(r,"UnsignedShort5551Type",(function(){return ze})),n.d(r,"UnsignedShort565Type",(function(){return Ge})),n.d(r,"UnsignedShortType",(function(){return Ne})),n.d(r,"VSMShadowMap",(function(){return g})),n.d(r,"Vector2",(function(){return Pn})),n.d(r,"Vector3",(function(){return Bn})),n.d(r,"Vector4",(function(){return Rn})),n.d(r,"VectorKeyframeTrack",(function(){return ll})),n.d(r,"Vertex",(function(){return Gf})),n.d(r,"VertexColors",(function(){return M})),n.d(r,"VideoTexture",(function(){return Su})),n.d(r,"WebGLCubeRenderTarget",(function(){return vo})),n.d(r,"WebGLMultisampleRenderTarget",(function(){return Nn})),n.d(r,"WebGLRenderTarget",(function(){return Dn})),n.d(r,"WebGLRenderTargetCube",(function(){return ud})),n.d(r,"WebGLRenderer",(function(){return Ms})),n.d(r,"WebGLUtils",(function(){return bs})),n.d(r,"WireframeGeometry",(function(){return Pu})),n.d(r,"WireframeHelper",(function(){return od})),n.d(r,"WrapAroundEnding",(function(){return Nt})),n.d(r,"XHRLoader",(function(){return ad})),n.d(r,"ZeroCurvatureEnding",(function(){return Rt})),n.d(r,"ZeroFactor",(function(){return j})),n.d(r,"ZeroSlopeEnding",(function(){return Dt})),n.d(r,"ZeroStencilOp",(function(){return Kt})),n.d(r,"sRGBEncoding",(function(){return kt}));var i={};n.r(i),n.d(i,"SceneManager",(function(){return bg})),n.d(i,"Group",(function(){return Fg})),n.d(i,"Sbm",(function(){return Gg})),n.d(i,"SbmChild",(function(){return qg})),n.d(i,"Poi",(function(){return yy})),n.d(i,"PoiNode",(function(){return Sy})),n.d(i,"Icon",(function(){return $g})),n.d(i,"Text2D",(function(){return oy})),n.d(i,"Link",(function(){return Oy})),n.d(i,"Node",(function(){return Ny})),n.d(i,"Topology",(function(){return ky})),n.d(i,"Topologyold",(function(){return Wy})),n.d(i,"Ground",(function(){return Zy})),n.d(i,"Transform",(function(){return nb})),n.d(i,"Model",(function(){return ub})),n.d(i,"Painter",(function(){return hy})),n.d(i,"Fire",(function(){return db})),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t});var o="113",a={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},s={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},u=0,c=1,l=2,h=3,p=0,f=1,d=0,m=1,v=2,g=3,y=0,b=1,x=2,w=1,_=2,T=0,S=1,M=2,E=0,A=1,P=2,O=3,L=4,I=5,C=100,R=101,D=102,N=103,F=104,j=200,U=201,B=202,k=203,z=204,G=205,V=206,H=207,W=208,X=209,Y=210,q=0,Q=1,Z=2,K=3,J=4,$=5,ee=6,te=7,ne=0,re=1,ie=2,oe=0,ae=1,se=2,ue=3,ce=4,le=5,he=300,pe=301,fe=302,de=303,me=304,ve=305,ge=306,ye=307,be=1e3,xe=1001,we=1002,_e=1003,Te=1004,Se=1004,Me=1005,Ee=1005,Ae=1006,Pe=1007,Oe=1007,Le=1008,Ie=1008,Ce=1009,Re=1010,De=1011,Ne=1012,Fe=1013,je=1014,Ue=1015,Be=1016,ke=1017,ze=1018,Ge=1019,Ve=1020,He=1021,We=1022,Xe=1023,Ye=1024,qe=1025,Qe=Xe,Ze=1026,Ke=1027,Je=1028,$e=1029,et=1030,tt=1031,nt=1032,rt=1033,it=33776,ot=33777,at=33778,st=33779,ut=35840,ct=35841,lt=35842,ht=35843,pt=36196,ft=37808,dt=37809,mt=37810,vt=37811,gt=37812,yt=37813,bt=37814,xt=37815,wt=37816,_t=37817,Tt=37818,St=37819,Mt=37820,Et=37821,At=2200,Pt=2201,Ot=2202,Lt=2300,It=2301,Ct=2302,Rt=2400,Dt=2401,Nt=2402,Ft=0,jt=1,Ut=2,Bt=3e3,kt=3001,zt=3007,Gt=3002,Vt=3003,Ht=3004,Wt=3005,Xt=3006,Yt=3200,qt=3201,Qt=0,Zt=1,Kt=0,Jt=7680,$t=7681,en=7682,tn=7683,nn=34055,rn=34056,on=5386,an=512,sn=513,un=514,cn=515,ln=516,hn=517,pn=518,fn=519,dn=35044,mn=35048,vn=35040,gn=35045,yn=35049,bn=35041,xn=35046,wn=35050,_n=35042;function Tn(){}Object.assign(Tn.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,e)}}}});for(var Sn=[],Mn=0;Mn<256;Mn++)Sn[Mn]=(Mn<16?"0":"")+Mn.toString(16);var En,An={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Sn[255&e]+Sn[e>>8&255]+Sn[e>>16&255]+Sn[e>>24&255]+"-"+Sn[255&t]+Sn[t>>8&255]+"-"+Sn[t>>16&15|64]+Sn[t>>24&255]+"-"+Sn[63&n|128]+Sn[n>>8&255]+"-"+Sn[n>>16&255]+Sn[n>>24&255]+Sn[255&r]+Sn[r>>8&255]+Sn[r>>16&255]+Sn[r>>24&255]).toUpperCase()},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*An.DEG2RAD},radToDeg:function(e){return e*An.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,r,i){var o=Math.cos,a=Math.sin,s=o(n/2),u=a(n/2),c=o((t+r)/2),l=a((t+r)/2),h=o((t-r)/2),p=a((t-r)/2),f=o((r-t)/2),d=a((r-t)/2);"XYX"===i?e.set(s*l,u*h,u*p,s*c):"YZY"===i?e.set(u*p,s*l,u*h,s*c):"ZXZ"===i?e.set(u*h,u*p,s*l,s*c):"XZX"===i?e.set(s*l,u*d,u*f,s*c):"YXY"===i?e.set(u*f,s*l,u*d,s*c):"ZYZ"===i?e.set(u*d,u*f,s*l,s*c):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};function Pn(e,t){this.x=e||0,this.y=t||0}function On(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(Pn.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Pn.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*n-o*r+e.x,this.y=i*r+o*n+e.y,this}}),Object.assign(On.prototype,{isMatrix3:!0,set:function(e,t,n,r,i,o,a,s,u){var c=this.elements;return c[0]=e,c[1]=r,c[2]=a,c[3]=t,c[4]=i,c[5]=s,c[6]=n,c[7]=o,c[8]=u,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,o=n[0],a=n[3],s=n[6],u=n[1],c=n[4],l=n[7],h=n[2],p=n[5],f=n[8],d=r[0],m=r[3],v=r[6],g=r[1],y=r[4],b=r[7],x=r[2],w=r[5],_=r[8];return i[0]=o*d+a*g+s*x,i[3]=o*m+a*y+s*w,i[6]=o*v+a*b+s*_,i[1]=u*d+c*g+l*x,i[4]=u*m+c*y+l*w,i[7]=u*v+c*b+l*_,i[2]=h*d+p*g+f*x,i[5]=h*m+p*y+f*w,i[8]=h*v+p*b+f*_,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],u=e[7],c=e[8];return t*o*c-t*a*u-n*i*c+n*a*s+r*i*u-r*o*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=e.elements,r=this.elements,i=n[0],o=n[1],a=n[2],s=n[3],u=n[4],c=n[5],l=n[6],h=n[7],p=n[8],f=p*u-c*h,d=c*l-p*s,m=h*s-u*l,v=i*f+o*d+a*m;if(0===v){var g="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return r[0]=f*y,r[1]=(a*h-p*o)*y,r[2]=(c*o-a*u)*y,r[3]=d*y,r[4]=(p*i-a*l)*y,r[5]=(a*s-c*i)*y,r[6]=m*y,r[7]=(o*l-h*i)*y,r[8]=(u*i-o*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,n,r,i,o,a){var s=Math.cos(i),u=Math.sin(i);this.set(n*s,n*u,-n*(s*o+u*a)+o+e,-r*u,r*s,-r*(-u*o+s*a)+a+t,0,0,1)},scale:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],o=r[3],a=r[6],s=r[1],u=r[4],c=r[7];return r[0]=t*i+n*s,r[3]=t*o+n*u,r[6]=t*a+n*c,r[1]=-n*i+t*s,r[4]=-n*o+t*u,r[7]=-n*a+t*c,this},translate:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this},equals:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<9;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}});var Ln={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===En&&(En=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),En.width=e.width,En.height=e.height;var n=En.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=En}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},In=0;function Cn(e,t,n,r,i,o,a,s,u,c){Object.defineProperty(this,"id",{value:In++}),this.uuid=An.generateUUID(),this.name="",this.image=void 0!==e?e:Cn.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Cn.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:xe,this.wrapT=void 0!==r?r:xe,this.magFilter=void 0!==i?i:Ae,this.minFilter=void 0!==o?o:Le,this.anisotropy=void 0!==u?u:1,this.format=void 0!==a?a:Xe,this.internalFormat=null,this.type=void 0!==s?s:Ce,this.offset=new Pn(0,0),this.repeat=new Pn(1,1),this.center=new Pn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new On,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:Bt,this.version=0,this.onUpdate=null}function Rn(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1}function Dn(e,t,n){this.width=e,this.height=t,this.scissor=new Rn(0,0,e,t),this.scissorTest=!1,this.viewport=new Rn(0,0,e,t),n=n||{},this.texture=new Cn(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:Ae,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function Nn(e,t,n){Dn.call(this,e,t,n),this.samples=4}function Fn(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==r?r:1}Cn.DEFAULT_IMAGE=void 0,Cn.DEFAULT_MAPPING=he,Cn.prototype=Object.assign(Object.create(Tn.prototype),{constructor:Cn,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=An.generateUUID()),!t&&void 0===e.images[r.uuid]){var i;if(Array.isArray(r)){i=[];for(var o=0,a=r.length;o<a;o++)i.push(Ln.getDataURL(r[o]))}else i=Ln.getDataURL(r);e.images[r.uuid]={uuid:r.uuid,url:i}}n.image=r.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==he)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case be:e.x=e.x-Math.floor(e.x);break;case xe:e.x=e.x<0?0:1;break;case we:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case be:e.y=e.y-Math.floor(e.y);break;case xe:e.y=e.y<0?0:1;break;case we:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Cn.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.defineProperties(Rn.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(Rn.prototype,{isVector4:!0,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,r,i,o=e.elements,a=o[0],s=o[4],u=o[8],c=o[1],l=o[5],h=o[9],p=o[2],f=o[6],d=o[10];if(Math.abs(s-c)<.01&&Math.abs(u-p)<.01&&Math.abs(h-f)<.01){if(Math.abs(s+c)<.1&&Math.abs(u+p)<.1&&Math.abs(h+f)<.1&&Math.abs(a+l+d-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,v=(l+1)/2,g=(d+1)/2,y=(s+c)/4,b=(u+p)/4,x=(h+f)/4;return m>v&&m>g?m<.01?(n=0,r=.707106781,i=.707106781):(r=y/(n=Math.sqrt(m)),i=b/n):v>g?v<.01?(n=.707106781,r=0,i=.707106781):(n=y/(r=Math.sqrt(v)),i=x/r):g<.01?(n=.707106781,r=.707106781,i=0):(n=b/(i=Math.sqrt(g)),r=x/i),this.set(n,r,i,t),this}var w=Math.sqrt((f-h)*(f-h)+(u-p)*(u-p)+(c-s)*(c-s));return Math.abs(w)<.001&&(w=1),this.x=(f-h)/w,this.y=(u-p)/w,this.z=(c-s)/w,this.w=Math.acos((a+l+d-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Dn.prototype=Object.assign(Object.create(Tn.prototype),{constructor:Dn,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Nn.prototype=Object.assign(Object.create(Dn.prototype),{constructor:Nn,isWebGLMultisampleRenderTarget:!0,copy:function(e){return Dn.prototype.copy.call(this,e),this.samples=e.samples,this}}),Object.assign(Fn,{slerp:function(e,t,n,r){return n.copy(e).slerp(t,r)},slerpFlat:function(e,t,n,r,i,o,a){var s=n[r+0],u=n[r+1],c=n[r+2],l=n[r+3],h=i[o+0],p=i[o+1],f=i[o+2],d=i[o+3];if(l!==d||s!==h||u!==p||c!==f){var m=1-a,v=s*h+u*p+c*f+l*d,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var b=Math.sqrt(y),x=Math.atan2(b,v*g);m=Math.sin(m*x)/b,a=Math.sin(a*x)/b}var w=a*g;if(s=s*m+h*w,u=u*m+p*w,c=c*m+f*w,l=l*m+d*w,m===1-a){var _=1/Math.sqrt(s*s+u*u+c*c+l*l);s*=_,u*=_,c*=_,l*=_}}e[t]=s,e[t+1]=u,e[t+2]=c,e[t+3]=l}}),Object.defineProperties(Fn.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(Fn.prototype,{isQuaternion:!0,set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,r=e._y,i=e._z,o=e.order,a=Math.cos,s=Math.sin,u=a(n/2),c=a(r/2),l=a(i/2),h=s(n/2),p=s(r/2),f=s(i/2);return"XYZ"===o?(this._x=h*c*l+u*p*f,this._y=u*p*l-h*c*f,this._z=u*c*f+h*p*l,this._w=u*c*l-h*p*f):"YXZ"===o?(this._x=h*c*l+u*p*f,this._y=u*p*l-h*c*f,this._z=u*c*f-h*p*l,this._w=u*c*l+h*p*f):"ZXY"===o?(this._x=h*c*l-u*p*f,this._y=u*p*l+h*c*f,this._z=u*c*f+h*p*l,this._w=u*c*l-h*p*f):"ZYX"===o?(this._x=h*c*l-u*p*f,this._y=u*p*l+h*c*f,this._z=u*c*f-h*p*l,this._w=u*c*l+h*p*f):"YZX"===o?(this._x=h*c*l+u*p*f,this._y=u*p*l+h*c*f,this._z=u*c*f-h*p*l,this._w=u*c*l-h*p*f):"XZY"===o&&(this._x=h*c*l-u*p*f,this._y=u*p*l-h*c*f,this._z=u*c*f+h*p*l,this._w=u*c*l+h*p*f),!1!==t&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t,n=e.elements,r=n[0],i=n[4],o=n[8],a=n[1],s=n[5],u=n[9],c=n[2],l=n[6],h=n[10],p=r+s+h;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(l-u)*t,this._y=(o-c)*t,this._z=(a-i)*t):r>s&&r>h?(t=2*Math.sqrt(1+r-s-h),this._w=(l-u)/t,this._x=.25*t,this._y=(i+a)/t,this._z=(o+c)/t):s>h?(t=2*Math.sqrt(1+s-r-h),this._w=(o-c)/t,this._x=(i+a)/t,this._y=.25*t,this._z=(u+l)/t):(t=2*Math.sqrt(1+h-r-s),this._w=(a-i)/t,this._x=(o+c)/t,this._y=(u+l)/t,this._z=.25*t),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var n=e.dot(t)+1;return n<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(An.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var n=this.angleTo(e);if(0===n)return this;var r=Math.min(1,t/n);return this.slerp(e,r),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var n=e._x,r=e._y,i=e._z,o=e._w,a=t._x,s=t._y,u=t._z,c=t._w;return this._x=n*c+o*a+r*u-i*s,this._y=r*c+o*s+i*a-n*u,this._z=i*c+o*u+n*s-r*a,this._w=o*c-n*a-r*s-i*u,this._onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,i=this._z,o=this._w,a=o*e._w+n*e._x+r*e._y+i*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;var s=1-a*a;if(s<=Number.EPSILON){var u=1-t;return this._w=u*o+t*this._w,this._x=u*n+t*this._x,this._y=u*r+t*this._y,this._z=u*i+t*this._z,this.normalize(),this._onChangeCallback(),this}var c=Math.sqrt(s),l=Math.atan2(c,a),h=Math.sin((1-t)*l)/c,p=Math.sin(t*l)/c;return this._w=o*h+this._w*p,this._x=n*h+this._x*p,this._y=r*h+this._y*p,this._z=i*h+this._z*p,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var jn=new Bn,Un=new Fn;function Bn(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}Object.assign(Bn.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Un.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(Un.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,o=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*o,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,a=e.z,s=e.w,u=s*t+o*r-a*n,c=s*n+a*t-i*r,l=s*r+i*n-o*t,h=-i*t-o*n-a*r;return this.x=u*s+h*-i+c*-a-l*-o,this.y=c*s+h*-o+l*-i-u*-a,this.z=l*s+h*-a+u*-o-c*-i,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var n=e.x,r=e.y,i=e.z,o=t.x,a=t.y,s=t.z;return this.x=r*s-i*a,this.y=i*o-n*s,this.z=n*a-r*o,this},projectOnVector:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)},projectOnPlane:function(e){return jn.copy(this).projectOnVector(e),this.sub(jn)},reflect:function(e){return this.sub(jn.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(An.clamp(n,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,n){var r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},setFromMatrix3Column:function(e,t){return this.fromArray(e.elements,3*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});var kn=new Bn,zn=new Yn,Gn=new Bn(0,0,0),Vn=new Bn(1,1,1),Hn=new Bn,Wn=new Bn,Xn=new Bn;function Yn(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Yn.prototype,{isMatrix4:!0,set:function(e,t,n,r,i,o,a,s,u,c,l,h,p,f,d,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=r,v[1]=i,v[5]=o,v[9]=a,v[13]=s,v[2]=u,v[6]=c,v[10]=l,v[14]=h,v[3]=p,v[7]=f,v[11]=d,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Yn).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(e){var t=this.elements,n=e.elements,r=1/kn.setFromMatrixColumn(e,0).length(),i=1/kn.setFromMatrixColumn(e,1).length(),o=1/kn.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,r=e.y,i=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(r),u=Math.sin(r),c=Math.cos(i),l=Math.sin(i);if("XYZ"===e.order){var h=o*c,p=o*l,f=a*c,d=a*l;t[0]=s*c,t[4]=-s*l,t[8]=u,t[1]=p+f*u,t[5]=h-d*u,t[9]=-a*s,t[2]=d-h*u,t[6]=f+p*u,t[10]=o*s}else if("YXZ"===e.order){var m=s*c,v=s*l,g=u*c,y=u*l;t[0]=m+y*a,t[4]=g*a-v,t[8]=o*u,t[1]=o*l,t[5]=o*c,t[9]=-a,t[2]=v*a-g,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order){m=s*c,v=s*l,g=u*c,y=u*l;t[0]=m-y*a,t[4]=-o*l,t[8]=g+v*a,t[1]=v+g*a,t[5]=o*c,t[9]=y-m*a,t[2]=-o*u,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){h=o*c,p=o*l,f=a*c,d=a*l;t[0]=s*c,t[4]=f*u-p,t[8]=h*u+d,t[1]=s*l,t[5]=d*u+h,t[9]=p*u-f,t[2]=-u,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var b=o*s,x=o*u,w=a*s,_=a*u;t[0]=s*c,t[4]=_-b*l,t[8]=w*l+x,t[1]=l,t[5]=o*c,t[9]=-a*c,t[2]=-u*c,t[6]=x*l+w,t[10]=b-_*l}else if("XZY"===e.order){b=o*s,x=o*u,w=a*s,_=a*u;t[0]=s*c,t[4]=-l,t[8]=u*c,t[1]=b*l+_,t[5]=o*c,t[9]=x*l-w,t[2]=w*l-x,t[6]=a*c,t[10]=_*l+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(Gn,e,Vn)},lookAt:function(e,t,n){var r=this.elements;return Xn.subVectors(e,t),0===Xn.lengthSq()&&(Xn.z=1),Xn.normalize(),Hn.crossVectors(n,Xn),0===Hn.lengthSq()&&(1===Math.abs(n.z)?Xn.x+=1e-4:Xn.z+=1e-4,Xn.normalize(),Hn.crossVectors(n,Xn)),Hn.normalize(),Wn.crossVectors(Xn,Hn),r[0]=Hn.x,r[4]=Wn.x,r[8]=Xn.x,r[1]=Hn.y,r[5]=Wn.y,r[9]=Xn.y,r[2]=Hn.z,r[6]=Wn.z,r[10]=Xn.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,o=n[0],a=n[4],s=n[8],u=n[12],c=n[1],l=n[5],h=n[9],p=n[13],f=n[2],d=n[6],m=n[10],v=n[14],g=n[3],y=n[7],b=n[11],x=n[15],w=r[0],_=r[4],T=r[8],S=r[12],M=r[1],E=r[5],A=r[9],P=r[13],O=r[2],L=r[6],I=r[10],C=r[14],R=r[3],D=r[7],N=r[11],F=r[15];return i[0]=o*w+a*M+s*O+u*R,i[4]=o*_+a*E+s*L+u*D,i[8]=o*T+a*A+s*I+u*N,i[12]=o*S+a*P+s*C+u*F,i[1]=c*w+l*M+h*O+p*R,i[5]=c*_+l*E+h*L+p*D,i[9]=c*T+l*A+h*I+p*N,i[13]=c*S+l*P+h*C+p*F,i[2]=f*w+d*M+m*O+v*R,i[6]=f*_+d*E+m*L+v*D,i[10]=f*T+d*A+m*I+v*N,i[14]=f*S+d*P+m*C+v*F,i[3]=g*w+y*M+b*O+x*R,i[7]=g*_+y*E+b*L+x*D,i[11]=g*T+y*A+b*I+x*N,i[15]=g*S+y*P+b*C+x*F,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],a=e[5],s=e[9],u=e[13],c=e[2],l=e[6],h=e[10],p=e[14];return e[3]*(+i*s*l-r*u*l-i*a*h+n*u*h+r*a*p-n*s*p)+e[7]*(+t*s*p-t*u*h+i*o*h-r*o*p+r*u*c-i*s*c)+e[11]*(+t*u*l-t*a*p-i*o*l+n*o*p+i*a*c-n*u*c)+e[15]*(-r*a*c-t*s*l+t*a*h+r*o*l-n*o*h+n*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e,t,n){var r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this},getInverse:function(e,t){var n=this.elements,r=e.elements,i=r[0],o=r[1],a=r[2],s=r[3],u=r[4],c=r[5],l=r[6],h=r[7],p=r[8],f=r[9],d=r[10],m=r[11],v=r[12],g=r[13],y=r[14],b=r[15],x=f*y*h-g*d*h+g*l*m-c*y*m-f*l*b+c*d*b,w=v*d*h-p*y*h-v*l*m+u*y*m+p*l*b-u*d*b,_=p*g*h-v*f*h+v*c*m-u*g*m-p*c*b+u*f*b,T=v*f*l-p*g*l-v*c*d+u*g*d+p*c*y-u*f*y,S=i*x+o*w+a*_+s*T;if(0===S){var M="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(M);return console.warn(M),this.identity()}var E=1/S;return n[0]=x*E,n[1]=(g*d*s-f*y*s-g*a*m+o*y*m+f*a*b-o*d*b)*E,n[2]=(c*y*s-g*l*s+g*a*h-o*y*h-c*a*b+o*l*b)*E,n[3]=(f*l*s-c*d*s-f*a*h+o*d*h+c*a*m-o*l*m)*E,n[4]=w*E,n[5]=(p*y*s-v*d*s+v*a*m-i*y*m-p*a*b+i*d*b)*E,n[6]=(v*l*s-u*y*s-v*a*h+i*y*h+u*a*b-i*l*b)*E,n[7]=(u*d*s-p*l*s+p*a*h-i*d*h-u*a*m+i*l*m)*E,n[8]=_*E,n[9]=(v*f*s-p*g*s-v*o*m+i*g*m+p*o*b-i*f*b)*E,n[10]=(u*g*s-v*c*s+v*o*h-i*g*h-u*o*b+i*c*b)*E,n[11]=(p*c*s-u*f*s-p*o*h+i*f*h+u*o*m-i*c*m)*E,n[12]=T*E,n[13]=(p*g*a-v*f*a+v*o*d-i*g*d-p*o*y+i*f*y)*E,n[14]=(v*c*a-u*g*a-v*o*l+i*g*l+u*o*y-i*c*y)*E,n[15]=(u*f*a-p*c*a+p*o*l-i*f*l-u*o*d+i*c*d)*E,this},scale:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,o=e.x,a=e.y,s=e.z,u=i*o,c=i*a;return this.set(u*o+n,u*a-r*s,u*s+r*a,0,u*a+r*s,c*a+n,c*s-r*o,0,u*s-r*a,c*s+r*o,i*s*s+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){var r=this.elements,i=t._x,o=t._y,a=t._z,s=t._w,u=i+i,c=o+o,l=a+a,h=i*u,p=i*c,f=i*l,d=o*c,m=o*l,v=a*l,g=s*u,y=s*c,b=s*l,x=n.x,w=n.y,_=n.z;return r[0]=(1-(d+v))*x,r[1]=(p+b)*x,r[2]=(f-y)*x,r[3]=0,r[4]=(p-b)*w,r[5]=(1-(h+v))*w,r[6]=(m+g)*w,r[7]=0,r[8]=(f+y)*_,r[9]=(m-g)*_,r[10]=(1-(h+d))*_,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this},decompose:function(e,t,n){var r=this.elements,i=kn.set(r[0],r[1],r[2]).length(),o=kn.set(r[4],r[5],r[6]).length(),a=kn.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],zn.copy(this);var s=1/i,u=1/o,c=1/a;return zn.elements[0]*=s,zn.elements[1]*=s,zn.elements[2]*=s,zn.elements[4]*=u,zn.elements[5]*=u,zn.elements[6]*=u,zn.elements[8]*=c,zn.elements[9]*=c,zn.elements[10]*=c,t.setFromRotationMatrix(zn),n.x=i,n.y=o,n.z=a,this},makePerspective:function(e,t,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*i/(t-e),u=2*i/(n-r),c=(t+e)/(t-e),l=(n+r)/(n-r),h=-(o+i)/(o-i),p=-2*o*i/(o-i);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=u,a[9]=l,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(e,t,n,r,i,o){var a=this.elements,s=1/(t-e),u=1/(n-r),c=1/(o-i),l=(t+e)*s,h=(n+r)*u,p=(o+i)*c;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-l,a[1]=0,a[5]=2*u,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,n=e.elements,r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}});var qn=new Yn,Qn=new Fn;function Zn(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._order=r||Zn.DefaultOrder}function Kn(){this.mask=1}Zn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Zn.DefaultOrder="XYZ",Object.defineProperties(Zn.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(Zn.prototype,{isEuler:!0,set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var r=An.clamp,i=e.elements,o=i[0],a=i[4],s=i[8],u=i[1],c=i[5],l=i[9],h=i[2],p=i[6],f=i[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(r(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-l,f),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(p,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(s,f),this._z=Math.atan2(u,c)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(u,o))):"ZYX"===t?(this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(p,f),this._z=Math.atan2(u,o)):(this._x=0,this._z=Math.atan2(-a,c))):"YZX"===t?(this._z=Math.asin(r(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-l,c),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,f))):"XZY"===t?(this._z=Math.asin(-r(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(p,c),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-l,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==n&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,n){return qn.makeRotationFromQuaternion(e),this.setFromRotationMatrix(qn,t,n)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return Qn.setFromEuler(this),this.setFromQuaternion(Qn,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Bn(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(Kn.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},disableAll:function(){this.mask=0},test:function(e){return 0!=(this.mask&e.mask)}});var Jn=0,$n=new Bn,er=new Fn,tr=new Yn,nr=new Bn,rr=new Bn,ir=new Bn,or=new Fn,ar=new Bn(1,0,0),sr=new Bn(0,1,0),ur=new Bn(0,0,1),cr={type:"added"},lr={type:"removed"};function hr(){Object.defineProperty(this,"id",{value:Jn++}),this.uuid=An.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=hr.DefaultUp.clone();var e=new Bn,t=new Zn,n=new Fn,r=new Bn(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Yn},normalMatrix:{value:new On}}),this.matrix=new Yn,this.matrixWorld=new Yn,this.matrixAutoUpdate=hr.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Kn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function pr(){hr.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}hr.DefaultUp=new Bn(0,1,0),hr.DefaultMatrixAutoUpdate=!0,hr.prototype=Object.assign(Object.create(Tn.prototype),{constructor:hr,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return er.setFromAxisAngle(e,t),this.quaternion.multiply(er),this},rotateOnWorldAxis:function(e,t){return er.setFromAxisAngle(e,t),this.quaternion.premultiply(er),this},rotateX:function(e){return this.rotateOnAxis(ar,e)},rotateY:function(e){return this.rotateOnAxis(sr,e)},rotateZ:function(e){return this.rotateOnAxis(ur,e)},translateOnAxis:function(e,t){return $n.copy(e).applyQuaternion(this.quaternion),this.position.add($n.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(ar,e)},translateY:function(e){return this.translateOnAxis(sr,e)},translateZ:function(e){return this.translateOnAxis(ur,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(tr.getInverse(this.matrixWorld))},lookAt:function(e,t,n){e.isVector3?nr.copy(e):nr.set(e,t,n);var r=this.parent;this.updateWorldMatrix(!0,!1),rr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?tr.lookAt(rr,nr,this.up):tr.lookAt(nr,rr,this.up),this.quaternion.setFromRotationMatrix(tr),r&&(tr.extractRotation(r.matrixWorld),er.setFromRotationMatrix(tr),this.quaternion.premultiply(er.inverse()))},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(cr)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(lr)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),tr.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),tr.multiply(e.parent.matrixWorld)),e.applyMatrix4(tr),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Bn),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Fn),this.updateMatrixWorld(!0),this.matrixWorld.decompose(rr,e,ir),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new Bn),this.updateMatrixWorld(!0),this.matrixWorld.decompose(rr,or,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Bn),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,i=0,o=r.length;i<o;i++)r[i].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,u=a.length;s<u;s++){var c=a[s];i(e.shapes,c)}else i(e.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var l=[];for(s=0,u=this.material.length;s<u;s++)l.push(i(e.materials,this.material[s]));r.material=l}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(s=0;s<this.children.length;s++)r.children.push(this.children[s].toJSON(e).object)}if(t){var h=m(e.geometries),p=m(e.materials),f=m(e.textures),d=m(e.images);a=m(e.shapes);h.length>0&&(n.geometries=h),p.length>0&&(n.materials=p),f.length>0&&(n.textures=f),d.length>0&&(n.images=d),a.length>0&&(n.shapes=a)}return n.object=r,n;function m(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var r=e.children[n];this.add(r.clone())}return this}}),pr.prototype=Object.assign(Object.create(hr.prototype),{constructor:pr,isScene:!0,copy:function(e,t){return hr.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=hr.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});var fr=[new Bn,new Bn,new Bn,new Bn,new Bn,new Bn,new Bn,new Bn],dr=new Bn,mr=new Er,vr=new Bn,gr=new Bn,yr=new Bn,br=new Bn,xr=new Bn,wr=new Bn,_r=new Bn,Tr=new Bn,Sr=new Bn,Mr=new Bn;function Er(e,t){this.min=void 0!==e?e:new Bn(1/0,1/0,1/0),this.max=void 0!==t?t:new Bn(-1/0,-1/0,-1/0)}function Ar(e,t,n,r,i){var o,a;for(o=0,a=e.length-3;o<=a;o+=3){Mr.fromArray(e,o);var s=i.x*Math.abs(Mr.x)+i.y*Math.abs(Mr.y)+i.z*Math.abs(Mr.z),u=t.dot(Mr),c=n.dot(Mr),l=r.dot(Mr);if(Math.max(-Math.max(u,c,l),Math.min(u,c,l))>s)return!1}return!0}Object.assign(Er.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,u=e.length;s<u;s+=3){var c=e[s],l=e[s+1],h=e[s+2];c<t&&(t=c),l<n&&(n=l),h<r&&(r=h),c>i&&(i=c),l>o&&(o=l),h>a&&(a=h)}return this.min.set(t,n,r),this.max.set(i,o,a),this},setFromBufferAttribute:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,u=e.count;s<u;s++){var c=e.getX(s),l=e.getY(s),h=e.getZ(s);c<t&&(t=c),l<n&&(n=l),h<r&&(r=h),c>i&&(i=c),l>o&&(o=l),h>a&&(a=h)}return this.min.set(t,n,r),this.max.set(i,o,a),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var n=dr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Bn),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Bn),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),mr.copy(t.boundingBox),mr.applyMatrix4(e.matrixWorld),this.expandByPoint(mr.min),this.expandByPoint(mr.max));for(var n=e.children,r=0,i=n.length;r<i;r++)this.expandByObject(n[r]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Bn),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,dr),dr.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(_r),Tr.subVectors(this.max,_r),vr.subVectors(e.a,_r),gr.subVectors(e.b,_r),yr.subVectors(e.c,_r),br.subVectors(gr,vr),xr.subVectors(yr,gr),wr.subVectors(vr,yr);var t=[0,-br.z,br.y,0,-xr.z,xr.y,0,-wr.z,wr.y,br.z,0,-br.x,xr.z,0,-xr.x,wr.z,0,-wr.x,-br.y,br.x,0,-xr.y,xr.x,0,-wr.y,wr.x,0];return!!Ar(t,vr,gr,yr,Tr)&&(!!Ar(t=[1,0,0,0,1,0,0,0,1],vr,gr,yr,Tr)&&(Sr.crossVectors(br,xr),Ar(t=[Sr.x,Sr.y,Sr.z],vr,gr,yr,Tr)))},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Bn),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return dr.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(dr).length(),e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()?this:(fr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),fr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),fr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),fr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),fr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),fr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),fr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),fr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(fr),this)},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Pr=new Er;function Or(e,t){this.center=void 0!==e?e:new Bn,this.radius=void 0!==t?t:0}Object.assign(Or.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){var n=this.center;void 0!==t?n.copy(t):Pr.setFromPoints(e).getCenter(n);for(var r=0,i=0,o=e.length;i<o;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Bn),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Er),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});var Lr=new Bn,Ir=new Bn,Cr=new Bn,Rr=new Bn,Dr=new Bn,Nr=new Bn,Fr=new Bn;function jr(e,t){this.origin=void 0!==e?e:new Bn,this.direction=void 0!==t?t:new Bn(0,0,-1)}Object.assign(jr.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new Bn),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,Lr)),this},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Bn),t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){var t=Lr.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Lr.copy(this.direction).multiplyScalar(t).add(this.origin),Lr.distanceToSquared(e))},distanceSqToSegment:function(e,t,n,r){Ir.copy(e).add(t).multiplyScalar(.5),Cr.copy(t).sub(e).normalize(),Rr.copy(this.origin).sub(Ir);var i,o,a,s,u=.5*e.distanceTo(t),c=-this.direction.dot(Cr),l=Rr.dot(this.direction),h=-Rr.dot(Cr),p=Rr.lengthSq(),f=Math.abs(1-c*c);if(f>0)if(o=c*l-h,s=u*f,(i=c*h-l)>=0)if(o>=-s)if(o<=s){var d=1/f;a=(i*=d)*(i+c*(o*=d)+2*l)+o*(c*i+o+2*h)+p}else o=u,a=-(i=Math.max(0,-(c*o+l)))*i+o*(o+2*h)+p;else o=-u,a=-(i=Math.max(0,-(c*o+l)))*i+o*(o+2*h)+p;else o<=-s?a=-(i=Math.max(0,-(-c*u+l)))*i+(o=i>0?-u:Math.min(Math.max(-u,-h),u))*(o+2*h)+p:o<=s?(i=0,a=(o=Math.min(Math.max(-u,-h),u))*(o+2*h)+p):a=-(i=Math.max(0,-(c*u+l)))*i+(o=i>0?u:Math.min(Math.max(-u,-h),u))*(o+2*h)+p;else o=c>0?-u:u,a=-(i=Math.max(0,-(c*o+l)))*i+o*(o+2*h)+p;return n&&n.copy(this.direction).multiplyScalar(i).add(this.origin),r&&r.copy(Cr).multiplyScalar(o).add(Ir),a},intersectSphere:function(e,t){Lr.subVectors(e.center,this.origin);var n=Lr.dot(this.direction),r=Lr.dot(Lr)-n*n,i=e.radius*e.radius;if(r>i)return null;var o=Math.sqrt(i-r),a=n-o,s=n+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var n,r,i,o,a,s,u=1/this.direction.x,c=1/this.direction.y,l=1/this.direction.z,h=this.origin;return u>=0?(n=(e.min.x-h.x)*u,r=(e.max.x-h.x)*u):(n=(e.max.x-h.x)*u,r=(e.min.x-h.x)*u),c>=0?(i=(e.min.y-h.y)*c,o=(e.max.y-h.y)*c):(i=(e.max.y-h.y)*c,o=(e.min.y-h.y)*c),n>o||i>r?null:((i>n||n!=n)&&(n=i),(o<r||r!=r)&&(r=o),l>=0?(a=(e.min.z-h.z)*l,s=(e.max.z-h.z)*l):(a=(e.max.z-h.z)*l,s=(e.min.z-h.z)*l),n>s||a>r?null:((a>n||n!=n)&&(n=a),(s<r||r!=r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))},intersectsBox:function(e){return null!==this.intersectBox(e,Lr)},intersectTriangle:function(e,t,n,r,i){Dr.subVectors(t,e),Nr.subVectors(n,e),Fr.crossVectors(Dr,Nr);var o,a=this.direction.dot(Fr);if(a>0){if(r)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}Rr.subVectors(this.origin,e);var s=o*this.direction.dot(Nr.crossVectors(Rr,Nr));if(s<0)return null;var u=o*this.direction.dot(Dr.cross(Rr));if(u<0)return null;if(s+u>a)return null;var c=-o*Rr.dot(Fr);return c<0?null:this.at(c/a,i)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});var Ur=new Bn,Br=new Bn,kr=new On;function zr(e,t){this.normal=void 0!==e?e:new Bn(1,0,0),this.constant=void 0!==t?t:0}Object.assign(zr.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,n){var r=Ur.subVectors(n,t).cross(Br.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Bn),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new Bn);var n=e.delta(Ur),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;var i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?void 0:t.copy(n).multiplyScalar(i).add(e.start)},intersectsLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Bn),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){var n=t||kr.getNormalMatrix(e),r=this.coplanarPoint(Ur).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var Gr=new Bn,Vr=new Bn,Hr=new Bn,Wr=new Bn,Xr=new Bn,Yr=new Bn,qr=new Bn,Qr=new Bn,Zr=new Bn,Kr=new Bn;function Jr(e,t,n){this.a=void 0!==e?e:new Bn,this.b=void 0!==t?t:new Bn,this.c=void 0!==n?n:new Bn}Object.assign(Jr,{getNormal:function(e,t,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new Bn),r.subVectors(n,t),Gr.subVectors(e,t),r.cross(Gr);var i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)},getBarycoord:function(e,t,n,r,i){Gr.subVectors(r,t),Vr.subVectors(n,t),Hr.subVectors(e,t);var o=Gr.dot(Gr),a=Gr.dot(Vr),s=Gr.dot(Hr),u=Vr.dot(Vr),c=Vr.dot(Hr),l=o*u-a*a;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new Bn),0===l)return i.set(-2,-1,-1);var h=1/l,p=(u*s-a*c)*h,f=(o*c-a*s)*h;return i.set(1-p-f,f,p)},containsPoint:function(e,t,n,r){return Jr.getBarycoord(e,t,n,r,Wr),Wr.x>=0&&Wr.y>=0&&Wr.x+Wr.y<=1},getUV:function(e,t,n,r,i,o,a,s){return this.getBarycoord(e,t,n,r,Wr),s.set(0,0),s.addScaledVector(i,Wr.x),s.addScaledVector(o,Wr.y),s.addScaledVector(a,Wr.z),s},isFrontFacing:function(e,t,n,r){return Gr.subVectors(n,t),Vr.subVectors(e,t),Gr.cross(Vr).dot(r)<0}}),Object.assign(Jr.prototype,{set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return Gr.subVectors(this.c,this.b),Vr.subVectors(this.a,this.b),.5*Gr.cross(Vr).length()},getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Bn),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return Jr.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new zr),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return Jr.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,n,r,i){return Jr.getUV(e,this.a,this.b,this.c,t,n,r,i)},containsPoint:function(e){return Jr.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return Jr.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new Bn);var n,r,i=this.a,o=this.b,a=this.c;Xr.subVectors(o,i),Yr.subVectors(a,i),Qr.subVectors(e,i);var s=Xr.dot(Qr),u=Yr.dot(Qr);if(s<=0&&u<=0)return t.copy(i);Zr.subVectors(e,o);var c=Xr.dot(Zr),l=Yr.dot(Zr);if(c>=0&&l<=c)return t.copy(o);var h=s*l-c*u;if(h<=0&&s>=0&&c<=0)return n=s/(s-c),t.copy(i).addScaledVector(Xr,n);Kr.subVectors(e,a);var p=Xr.dot(Kr),f=Yr.dot(Kr);if(f>=0&&p<=f)return t.copy(a);var d=p*u-s*f;if(d<=0&&u>=0&&f<=0)return r=u/(u-f),t.copy(i).addScaledVector(Yr,r);var m=c*f-p*l;if(m<=0&&l-c>=0&&p-f>=0)return qr.subVectors(a,o),r=(l-c)/(l-c+(p-f)),t.copy(o).addScaledVector(qr,r);var v=1/(m+d+h);return n=d*v,r=h*v,t.copy(i).addScaledVector(Xr,n).addScaledVector(Yr,r)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var $r={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ei={h:0,s:0,l:0},ti={h:0,s:0,l:0};function ni(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}function ri(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function ii(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function oi(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function ai(e,t,n,r,i,o){this.a=e,this.b=t,this.c=n,this.normal=r&&r.isVector3?r:new Bn,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new ni,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==o?o:0}Object.assign(ni.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(e=An.euclideanModulo(e,1),t=An.clamp(t,0,1),n=An.clamp(n,0,1),0===t)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=ri(i,r,e+1/3),this.g=ri(i,r,e),this.b=ri(i,r,e-1/3)}return this},setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var r,i=n[1],o=n[2];switch(i){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(r[1])/360,s=parseInt(r[2],10)/100,u=parseInt(r[3],10)/100;return t(r[5]),this.setHSL(a,s,u)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(e)){var c=n[1],l=c.length;if(3===l)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===l)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this},setColorName:function(e){var t=$r[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=ii(e.r),this.g=ii(e.g),this.b=ii(e.b),this},copyLinearToSRGB:function(e){return this.r=oi(e.r),this.g=oi(e.g),this.b=oi(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,n,r=this.r,i=this.g,o=this.b,a=Math.max(r,i,o),s=Math.min(r,i,o),u=(s+a)/2;if(s===a)t=0,n=0;else{var c=a-s;switch(n=u<=.5?c/(a+s):c/(2-a-s),a){case r:t=(i-o)/c+(i<o?6:0);break;case i:t=(o-r)/c+2;break;case o:t=(r-i)/c+4}t/=6}return e.h=t,e.s=n,e.l=u,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){return this.getHSL(ei),ei.h+=e,ei.s+=t,ei.l+=n,this.setHSL(ei.h,ei.s,ei.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(ei),e.getHSL(ti);var n=An.lerp(ei.h,ti.h,t),r=An.lerp(ei.s,ti.s,t),i=An.lerp(ei.l,ti.l,t);return this.setHSL(n,r,i),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),ni.NAMES=$r,Object.assign(ai.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var si=0;function ui(){Object.defineProperty(this,"id",{value:si++}),this.uuid=An.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=A,this.side=y,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=T,this.opacity=1,this.transparent=!1,this.blendSrc=z,this.blendDst=G,this.blendEquation=C,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=K,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=fn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Jt,this.stencilZFail=Jt,this.stencilZPass=Jt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function ci(e){ui.call(this),this.type="MeshBasicMaterial",this.color=new ni(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ne,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}ui.prototype=Object.assign(Object.create(Tn.prototype),{constructor:ui,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===w;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==A&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==y&&(n.side=this.side),this.vertexColors!==T&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var i=r(e.textures),o=r(e.images);i.length>0&&(n.textures=i),o.length>0&&(n.images=o)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var r=t.length;n=new Array(r);for(var i=0;i!==r;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(ui.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),ci.prototype=Object.create(ui.prototype),ci.prototype.constructor=ci,ci.prototype.isMeshBasicMaterial=!0,ci.prototype.copy=function(e){return ui.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};var li=new Bn;function hi(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=dn,this.updateRange={offset:0,count:-1},this.version=0}function pi(e,t,n){hi.call(this,new Int8Array(e),t,n)}function fi(e,t,n){hi.call(this,new Uint8Array(e),t,n)}function di(e,t,n){hi.call(this,new Uint8ClampedArray(e),t,n)}function mi(e,t,n){hi.call(this,new Int16Array(e),t,n)}function vi(e,t,n){hi.call(this,new Uint16Array(e),t,n)}function gi(e,t,n){hi.call(this,new Int32Array(e),t,n)}function yi(e,t,n){hi.call(this,new Uint32Array(e),t,n)}function bi(e,t,n){hi.call(this,new Float32Array(e),t,n)}function xi(e,t,n){hi.call(this,new Float64Array(e),t,n)}function wi(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function _i(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}Object.defineProperty(hi.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(hi.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),o=new ni),t[n++]=o.r,t[n++]=o.g,t[n++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new Pn),t[n++]=o.x,t[n++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new Bn),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new Rn),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z,t[n++]=o.w}return this},applyMatrix3:function(e){for(var t=0,n=this.count;t<n;t++)li.x=this.getX(t),li.y=this.getY(t),li.z=this.getZ(t),li.applyMatrix3(e),this.setXYZ(t,li.x,li.y,li.z);return this},applyMatrix4:function(e){for(var t=0,n=this.count;t<n;t++)li.x=this.getX(t),li.y=this.getY(t),li.z=this.getZ(t),li.applyMatrix4(e),this.setXYZ(t,li.x,li.y,li.z);return this},applyNormalMatrix:function(e){for(var t=0,n=this.count;t<n;t++)li.x=this.getX(t),li.y=this.getY(t),li.z=this.getZ(t),li.applyNormalMatrix(e),this.setXYZ(t,li.x,li.y,li.z);return this},transformDirection:function(e){for(var t=0,n=this.count;t<n;t++)li.x=this.getX(t),li.y=this.getY(t),li.z=this.getZ(t),li.transformDirection(e),this.setXYZ(t,li.x,li.y,li.z);return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),pi.prototype=Object.create(hi.prototype),pi.prototype.constructor=pi,fi.prototype=Object.create(hi.prototype),fi.prototype.constructor=fi,di.prototype=Object.create(hi.prototype),di.prototype.constructor=di,mi.prototype=Object.create(hi.prototype),mi.prototype.constructor=mi,vi.prototype=Object.create(hi.prototype),vi.prototype.constructor=vi,gi.prototype=Object.create(hi.prototype),gi.prototype.constructor=gi,yi.prototype=Object.create(hi.prototype),yi.prototype.constructor=yi,bi.prototype=Object.create(hi.prototype),bi.prototype.constructor=bi,xi.prototype=Object.create(hi.prototype),xi.prototype.constructor=xi,Object.assign(wi.prototype,{computeGroups:function(e){for(var t,n=[],r=void 0,i=e.faces,o=0;o<i.length;o++){var a=i[o];a.materialIndex!==r&&(r=a.materialIndex,void 0!==t&&(t.count=3*o-t.start,n.push(t)),t={start:3*o,materialIndex:r})}void 0!==t&&(t.count=3*o-t.start,n.push(t)),this.groups=n},fromGeometry:function(e){var t,n=e.faces,r=e.vertices,i=e.faceVertexUvs,o=i[0]&&i[0].length>0,a=i[1]&&i[1].length>0,s=e.morphTargets,u=s.length;if(u>0){t=[];for(var c=0;c<u;c++)t[c]={name:s[c].name,data:[]};this.morphTargets.position=t}var l,h=e.morphNormals,p=h.length;if(p>0){l=[];for(c=0;c<p;c++)l[c]={name:h[c].name,data:[]};this.morphTargets.normal=l}var f=e.skinIndices,d=e.skinWeights,m=f.length===r.length,v=d.length===r.length;r.length>0&&0===n.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(c=0;c<n.length;c++){var g=n[c];this.vertices.push(r[g.a],r[g.b],r[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var b=g.normal;this.normals.push(b,b,b)}var x,w=g.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var _=g.color;this.colors.push(_,_,_)}if(!0===o)void 0!==(x=i[0][c])?this.uvs.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new Pn,new Pn,new Pn));if(!0===a)void 0!==(x=i[1][c])?this.uvs2.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new Pn,new Pn,new Pn));for(var T=0;T<u;T++){var S=s[T].vertices;t[T].data.push(S[g.a],S[g.b],S[g.c])}for(T=0;T<p;T++){var M=h[T].vertexNormals[c];l[T].data.push(M.a,M.b,M.c)}m&&this.skinIndices.push(f[g.a],f[g.b],f[g.c]),v&&this.skinWeights.push(d[g.a],d[g.b],d[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}});var Ti=1,Si=new Yn,Mi=new hr,Ei=new Bn,Ai=new Er,Pi=new Er,Oi=new Bn;function Li(){Object.defineProperty(this,"id",{value:Ti+=2}),this.uuid=An.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Li.prototype=Object.assign(Object.create(Tn.prototype),{constructor:Li,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(_i(e)>65535?yi:vi)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new On).getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}var i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return Si.makeRotationX(e),this.applyMatrix4(Si),this},rotateY:function(e){return Si.makeRotationY(e),this.applyMatrix4(Si),this},rotateZ:function(e){return Si.makeRotationZ(e),this.applyMatrix4(Si),this},translate:function(e,t,n){return Si.makeTranslation(e,t,n),this.applyMatrix4(Si),this},scale:function(e,t,n){return Si.makeScale(e,t,n),this.applyMatrix4(Si),this},lookAt:function(e){return Mi.lookAt(e),Mi.updateMatrix(),this.applyMatrix4(Mi.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ei).negate(),this.translate(Ei.x,Ei.y,Ei.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var n=new bi(3*t.vertices.length,3),r=new bi(3*t.colors.length,3);if(this.setAttribute("position",n.copyVector3sArray(t.vertices)),this.setAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var i=new bi(t.lineDistances.length,1);this.setAttribute("lineDistance",i.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new bi(t,3)),this},updateFromObject:function(e){var t,n=e.geometry;if(e.isMesh){var r=n.__directGeometry;if(!0===n.elementsNeedUpdate&&(r=void 0,n.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(n);r.verticesNeedUpdate=n.verticesNeedUpdate,r.normalsNeedUpdate=n.normalsNeedUpdate,r.colorsNeedUpdate=n.colorsNeedUpdate,r.uvsNeedUpdate=n.uvsNeedUpdate,r.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=r}return!0===n.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(n.vertices),t.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(n.normals),t.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(n.colors),t.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(n.uvs),t.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(n.lineDistances),t.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(e.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new wi).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new hi(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var n=new Float32Array(3*e.normals.length);this.setAttribute("normal",new hi(n,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var r=new Float32Array(3*e.colors.length);this.setAttribute("color",new hi(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var i=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new hi(i,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new hi(o,2).copyVector2sArray(e.uvs2))}for(var a in this.groups=e.groups,e.morphTargets){for(var s=[],u=e.morphTargets[a],c=0,l=u.length;c<l;c++){var h=u[c],p=new bi(3*h.data.length,3);p.name=h.name,s.push(p.copyVector3sArray(h.data))}this.morphAttributes[a]=s}if(e.skinIndices.length>0){var f=new bi(4*e.skinIndices.length,4);this.setAttribute("skinIndex",f.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var d=new bi(4*e.skinWeights.length,4);this.setAttribute("skinWeight",d.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Er);var e=this.attributes.position,t=this.morphAttributes.position;if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,r=t.length;n<r;n++){var i=t[n];Ai.setFromBufferAttribute(i),this.morphTargetsRelative?(Oi.addVectors(this.boundingBox.min,Ai.min),this.boundingBox.expandByPoint(Oi),Oi.addVectors(this.boundingBox.max,Ai.max),this.boundingBox.expandByPoint(Oi)):(this.boundingBox.expandByPoint(Ai.min),this.boundingBox.expandByPoint(Ai.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Or);var e=this.attributes.position,t=this.morphAttributes.position;if(e){var n=this.boundingSphere.center;if(Ai.setFromBufferAttribute(e),t)for(var r=0,i=t.length;r<i;r++){var o=t[r];Pi.setFromBufferAttribute(o),this.morphTargetsRelative?(Oi.addVectors(Ai.min,Pi.min),Ai.expandByPoint(Oi),Oi.addVectors(Ai.max,Pi.max),Ai.expandByPoint(Oi)):(Ai.expandByPoint(Pi.min),Ai.expandByPoint(Pi.max))}Ai.getCenter(n);var a=0;for(r=0,i=e.count;r<i;r++)Oi.fromBufferAttribute(e,r),a=Math.max(a,n.distanceToSquared(Oi));if(t)for(r=0,i=t.length;r<i;r++){o=t[r];for(var s=this.morphTargetsRelative,u=0,c=o.count;u<c;u++)Oi.fromBufferAttribute(o,u),s&&(Ei.fromBufferAttribute(e,u),Oi.add(Ei)),a=Math.max(a,n.distanceToSquared(Oi))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var n=t.position.array;if(void 0===t.normal)this.setAttribute("normal",new hi(new Float32Array(n.length),3));else for(var r=t.normal.array,i=0,o=r.length;i<o;i++)r[i]=0;var a,s,u,c=t.normal.array,l=new Bn,h=new Bn,p=new Bn,f=new Bn,d=new Bn;if(e){var m=e.array;for(i=0,o=e.count;i<o;i+=3)a=3*m[i+0],s=3*m[i+1],u=3*m[i+2],l.fromArray(n,a),h.fromArray(n,s),p.fromArray(n,u),f.subVectors(p,h),d.subVectors(l,h),f.cross(d),c[a]+=f.x,c[a+1]+=f.y,c[a+2]+=f.z,c[s]+=f.x,c[s+1]+=f.y,c[s+2]+=f.z,c[u]+=f.x,c[u+1]+=f.y,c[u+2]+=f.z}else for(i=0,o=n.length;i<o;i+=9)l.fromArray(n,i),h.fromArray(n,i+3),p.fromArray(n,i+6),f.subVectors(p,h),d.subVectors(l,h),f.cross(d),c[i]=f.x,c[i+1]=f.y,c[i+2]=f.z,c[i+3]=f.x,c[i+4]=f.y,c[i+5]=f.z,c[i+6]=f.x,c[i+7]=f.y,c[i+8]=f.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(void 0!==e.attributes[r])for(var i=n[r].array,o=e.attributes[r],a=o.array,s=o.itemSize*t,u=Math.min(a.length,i.length-s),c=0,l=s;c<u;c++,l++)i[l]=a[c];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)Oi.x=e.getX(t),Oi.y=e.getY(t),Oi.z=e.getZ(t),Oi.normalize(),e.setXYZ(t,Oi.x,Oi.y,Oi.z)},toNonIndexed:function(){function e(e,t){for(var n=e.array,r=e.itemSize,i=new n.constructor(t.length*r),o=0,a=0,s=0,u=t.length;s<u;s++){o=t[s]*r;for(var c=0;c<r;c++)i[a++]=n[o++]}return new hi(i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new Li,n=this.index.array,r=this.attributes;for(var i in r){var o=e(r[i],n);t.setAttribute(i,o)}var a=this.morphAttributes;for(i in a){for(var s=[],u=a[i],c=0,l=u.length;c<l;c++){o=e(u[c],n);s.push(o)}t.morphAttributes[i]=s}t.morphTargetsRelative=this.morphTargetsRelative;for(var h=this.groups,p=(c=0,h.length);c<p;c++){var f=h[c];t.addGroup(f.start,f.count,f.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var r=this.index;null!==r&&(e.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var i=this.attributes;for(var n in i){var o=(p=i[n]).toJSON();""!==p.name&&(o.name=p.name),e.data.attributes[n]=o}var a={},s=!1;for(var n in this.morphAttributes){for(var u=this.morphAttributes[n],c=[],l=0,h=u.length;l<h;l++){var p;o=(p=u[l]).toJSON();""!==p.name&&(o.name=p.name),c.push(o)}c.length>0&&(a[n]=c,s=!0)}s&&(e.data.morphAttributes=a,e.data.morphTargetsRelative=this.morphTargetsRelative);var f=this.groups;f.length>0&&(e.data.groups=JSON.parse(JSON.stringify(f)));var d=this.boundingSphere;return null!==d&&(e.data.boundingSphere={center:d.center.toArray(),radius:d.radius}),e},clone:function(){return(new Li).copy(this)},copy:function(e){var t,n,r;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var i=e.index;null!==i&&this.setIndex(i.clone());var o=e.attributes;for(t in o){var a=o[t];this.setAttribute(t,a.clone())}var s=e.morphAttributes;for(t in s){var u=[],c=s[t];for(n=0,r=c.length;n<r;n++)u.push(c[n].clone());this.morphAttributes[t]=u}this.morphTargetsRelative=e.morphTargetsRelative;var l=e.groups;for(n=0,r=l.length;n<r;n++){var h=l[n];this.addGroup(h.start,h.count,h.materialIndex)}var p=e.boundingBox;null!==p&&(this.boundingBox=p.clone());var f=e.boundingSphere;return null!==f&&(this.boundingSphere=f.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Ii=new Yn,Ci=new jr,Ri=new Or,Di=new Bn,Ni=new Bn,Fi=new Bn,ji=new Bn,Ui=new Bn,Bi=new Bn,ki=new Bn,zi=new Bn,Gi=new Bn,Vi=new Pn,Hi=new Pn,Wi=new Pn,Xi=new Bn,Yi=new Bn;function qi(e,t){hr.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Li,this.material=void 0!==t?t:new ci,this.updateMorphTargets()}function Qi(e,t,n,r,i,o,a,s){if(null===(t.side===b?r.intersectTriangle(a,o,i,!0,s):r.intersectTriangle(i,o,a,t.side!==x,s)))return null;Yi.copy(s),Yi.applyMatrix4(e.matrixWorld);var u=n.ray.origin.distanceTo(Yi);return u<n.near||u>n.far?null:{distance:u,point:Yi.clone(),object:e}}function Zi(e,t,n,r,i,o,a,s,u,c,l,h){Di.fromBufferAttribute(i,c),Ni.fromBufferAttribute(i,l),Fi.fromBufferAttribute(i,h);var p=e.morphTargetInfluences;if(t.morphTargets&&o&&p){ki.set(0,0,0),zi.set(0,0,0),Gi.set(0,0,0);for(var f=0,d=o.length;f<d;f++){var m=p[f],v=o[f];0!==m&&(ji.fromBufferAttribute(v,c),Ui.fromBufferAttribute(v,l),Bi.fromBufferAttribute(v,h),a?(ki.addScaledVector(ji,m),zi.addScaledVector(Ui,m),Gi.addScaledVector(Bi,m)):(ki.addScaledVector(ji.sub(Di),m),zi.addScaledVector(Ui.sub(Ni),m),Gi.addScaledVector(Bi.sub(Fi),m)))}Di.add(ki),Ni.add(zi),Fi.add(Gi)}var g=Qi(e,t,n,r,Di,Ni,Fi,Xi);if(g){s&&(Vi.fromBufferAttribute(s,c),Hi.fromBufferAttribute(s,l),Wi.fromBufferAttribute(s,h),g.uv=Jr.getUV(Xi,Di,Ni,Fi,Vi,Hi,Wi,new Pn)),u&&(Vi.fromBufferAttribute(u,c),Hi.fromBufferAttribute(u,l),Wi.fromBufferAttribute(u,h),g.uv2=Jr.getUV(Xi,Di,Ni,Fi,Vi,Hi,Wi,new Pn));var y=new ai(c,l,h);Jr.getNormal(Di,Ni,Fi,y.normal),g.face=y}return g}qi.prototype=Object.assign(Object.create(hr.prototype),{constructor:qi,isMesh:!0,copy:function(e){return hr.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,n,r=this.geometry;if(r.isBufferGeometry){var i=r.morphAttributes,o=Object.keys(i);if(o.length>0){var a=i[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)n=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var s=r.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var n,r=this.geometry,i=this.material,o=this.matrixWorld;if(void 0!==i&&(null===r.boundingSphere&&r.computeBoundingSphere(),Ri.copy(r.boundingSphere),Ri.applyMatrix4(o),!1!==e.ray.intersectsSphere(Ri)&&(Ii.getInverse(o),Ci.copy(e.ray).applyMatrix4(Ii),null===r.boundingBox||!1!==Ci.intersectsBox(r.boundingBox))))if(r.isBufferGeometry){var a,s,u,c,l,h,p,f,d,m=r.index,v=r.attributes.position,g=r.morphAttributes.position,y=r.morphTargetsRelative,b=r.attributes.uv,x=r.attributes.uv2,w=r.groups,_=r.drawRange;if(null!==m)if(Array.isArray(i))for(c=0,h=w.length;c<h;c++)for(d=i[(f=w[c]).materialIndex],l=Math.max(f.start,_.start),p=Math.min(f.start+f.count,_.start+_.count);l<p;l+=3)a=m.getX(l),s=m.getX(l+1),u=m.getX(l+2),(n=Zi(this,d,e,Ci,v,g,y,b,x,a,s,u))&&(n.faceIndex=Math.floor(l/3),n.face.materialIndex=f.materialIndex,t.push(n));else for(c=Math.max(0,_.start),h=Math.min(m.count,_.start+_.count);c<h;c+=3)a=m.getX(c),s=m.getX(c+1),u=m.getX(c+2),(n=Zi(this,i,e,Ci,v,g,y,b,x,a,s,u))&&(n.faceIndex=Math.floor(c/3),t.push(n));else if(void 0!==v)if(Array.isArray(i))for(c=0,h=w.length;c<h;c++)for(d=i[(f=w[c]).materialIndex],l=Math.max(f.start,_.start),p=Math.min(f.start+f.count,_.start+_.count);l<p;l+=3)(n=Zi(this,d,e,Ci,v,g,y,b,x,a=l,s=l+1,u=l+2))&&(n.faceIndex=Math.floor(l/3),n.face.materialIndex=f.materialIndex,t.push(n));else for(c=Math.max(0,_.start),h=Math.min(v.count,_.start+_.count);c<h;c+=3)(n=Zi(this,i,e,Ci,v,g,y,b,x,a=c,s=c+1,u=c+2))&&(n.faceIndex=Math.floor(c/3),t.push(n))}else if(r.isGeometry){var T,S,M,E,A=Array.isArray(i),P=r.vertices,O=r.faces,L=r.faceVertexUvs[0];L.length>0&&(E=L);for(var I=0,C=O.length;I<C;I++){var R=O[I],D=A?i[R.materialIndex]:i;if(void 0!==D&&(T=P[R.a],S=P[R.b],M=P[R.c],n=Qi(this,D,e,Ci,T,S,M,Xi))){if(E&&E[I]){var N=E[I];Vi.copy(N[0]),Hi.copy(N[1]),Wi.copy(N[2]),n.uv=Jr.getUV(Xi,T,S,M,Vi,Hi,Wi,new Pn)}n.face=R,n.faceIndex=I,t.push(n)}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Ki=0,Ji=new Yn,$i=new hr,eo=new Bn;function to(){Object.defineProperty(this,"id",{value:Ki+=2}),this.uuid=An.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}to.prototype=Object.assign(Object.create(Tn.prototype),{constructor:to,isGeometry:!0,applyMatrix4:function(e){for(var t=(new On).getNormalMatrix(e),n=0,r=this.vertices.length;n<r;n++){this.vertices[n].applyMatrix4(e)}for(n=0,r=this.faces.length;n<r;n++){var i=this.faces[n];i.normal.applyMatrix3(t).normalize();for(var o=0,a=i.vertexNormals.length;o<a;o++)i.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return Ji.makeRotationX(e),this.applyMatrix4(Ji),this},rotateY:function(e){return Ji.makeRotationY(e),this.applyMatrix4(Ji),this},rotateZ:function(e){return Ji.makeRotationZ(e),this.applyMatrix4(Ji),this},translate:function(e,t,n){return Ji.makeTranslation(e,t,n),this.applyMatrix4(Ji),this},scale:function(e,t,n){return Ji.makeScale(e,t,n),this.applyMatrix4(Ji),this},lookAt:function(e){return $i.lookAt(e),$i.updateMatrix(),this.applyMatrix4($i.matrix),this},fromBufferGeometry:function(e){var t=this,n=null!==e.index?e.index.array:void 0,r=e.attributes;if(void 0===r.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var i=r.position.array,o=void 0!==r.normal?r.normal.array:void 0,a=void 0!==r.color?r.color.array:void 0,s=void 0!==r.uv?r.uv.array:void 0,u=void 0!==r.uv2?r.uv2.array:void 0;void 0!==u&&(this.faceVertexUvs[1]=[]);for(var c=0;c<i.length;c+=3)t.vertices.push((new Bn).fromArray(i,c)),void 0!==a&&t.colors.push((new ni).fromArray(a,c));function l(e,n,r,i){var c=void 0===a?[]:[t.colors[e].clone(),t.colors[n].clone(),t.colors[r].clone()],l=new ai(e,n,r,void 0===o?[]:[(new Bn).fromArray(o,3*e),(new Bn).fromArray(o,3*n),(new Bn).fromArray(o,3*r)],c,i);t.faces.push(l),void 0!==s&&t.faceVertexUvs[0].push([(new Pn).fromArray(s,2*e),(new Pn).fromArray(s,2*n),(new Pn).fromArray(s,2*r)]),void 0!==u&&t.faceVertexUvs[1].push([(new Pn).fromArray(u,2*e),(new Pn).fromArray(u,2*n),(new Pn).fromArray(u,2*r)])}var h=e.groups;if(h.length>0)for(c=0;c<h.length;c++)for(var p=h[c],f=p.start,d=f,m=f+p.count;d<m;d+=3)void 0!==n?l(n[d],n[d+1],n[d+2],p.materialIndex):l(d,d+1,d+2,p.materialIndex);else if(void 0!==n)for(c=0;c<n.length;c+=3)l(n[c],n[c+1],n[c+2]);else for(c=0;c<i.length/3;c+=3)l(c,c+1,c+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(eo).negate(),this.translate(eo.x,eo.y,eo.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,r=new Yn;return r.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix4(r),this},computeFaceNormals:function(){for(var e=new Bn,t=new Bn,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],o=this.vertices[i.a],a=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,n,r,i,o,a;for(void 0===e&&(e=!0),a=new Array(this.vertices.length),t=0,n=this.vertices.length;t<n;t++)a[t]=new Bn;if(e){var s,u,c,l=new Bn,h=new Bn;for(r=0,i=this.faces.length;r<i;r++)o=this.faces[r],s=this.vertices[o.a],u=this.vertices[o.b],c=this.vertices[o.c],l.subVectors(c,u),h.subVectors(s,u),l.cross(h),a[o.a].add(l),a[o.b].add(l),a[o.c].add(l)}else for(this.computeFaceNormals(),r=0,i=this.faces.length;r<i;r++)a[(o=this.faces[r]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,n=this.vertices.length;t<n;t++)a[t].normalize();for(r=0,i=this.faces.length;r<i;r++){var p=(o=this.faces[r]).vertexNormals;3===p.length?(p[0].copy(a[o.a]),p[1].copy(a[o.b]),p[2].copy(a[o.c])):(p[0]=a[o.a].clone(),p[1]=a[o.b].clone(),p[2]=a[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,n;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var r=(n=this.faces[e]).vertexNormals;3===r.length?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,n,r,i;for(n=0,r=this.faces.length;n<r;n++)for((i=this.faces[n]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var o=new to;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(n=0,r=this.faces.length;n<r;n++)u=new Bn,c={a:new Bn,b:new Bn,c:new Bn},a.push(u),s.push(c)}var u,c,l=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),n=0,r=this.faces.length;n<r;n++)i=this.faces[n],u=l.faceNormals[n],c=l.vertexNormals[n],u.copy(i.normal),c.a.copy(i.vertexNormals[0]),c.b.copy(i.vertexNormals[1]),c.c.copy(i.vertexNormals[2])}for(n=0,r=this.faces.length;n<r;n++)(i=this.faces[n]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Er),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Or),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e&&e.isGeometry){var r,i=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,u=e.faces,c=this.colors,l=e.colors;void 0===n&&(n=0),void 0!==t&&(r=(new On).getNormalMatrix(t));for(var h=0,p=a.length;h<p;h++){var f=a[h].clone();void 0!==t&&f.applyMatrix4(t),o.push(f)}for(h=0,p=l.length;h<p;h++)c.push(l[h].clone());for(h=0,p=u.length;h<p;h++){var d,m,v,g=u[h],y=g.vertexNormals,b=g.vertexColors;(d=new ai(g.a+i,g.b+i,g.c+i)).normal.copy(g.normal),void 0!==r&&d.normal.applyMatrix3(r).normalize();for(var x=0,w=y.length;x<w;x++)m=y[x].clone(),void 0!==r&&m.applyMatrix3(r).normalize(),d.vertexNormals.push(m);d.color.copy(g.color);for(x=0,w=b.length;x<w;x++)v=b[x],d.vertexColors.push(v.clone());d.materialIndex=g.materialIndex+n,s.push(d)}for(h=0,p=e.faceVertexUvs.length;h<p;h++){var _=e.faceVertexUvs[h];void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]);for(x=0,w=_.length;x<w;x++){for(var T=_[x],S=[],M=0,E=T.length;M<E;M++)S.push(T[M].clone());this.faceVertexUvs[h].push(S)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,n,r,i,o,a,s,u={},c=[],l=[],h=Math.pow(10,4);for(n=0,r=this.vertices.length;n<r;n++)e=this.vertices[n],void 0===u[t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h)]?(u[t]=n,c.push(this.vertices[n]),l[n]=c.length-1):l[n]=l[u[t]];var p=[];for(n=0,r=this.faces.length;n<r;n++){(i=this.faces[n]).a=l[i.a],i.b=l[i.b],i.c=l[i.c],o=[i.a,i.b,i.c];for(var f=0;f<3;f++)if(o[f]===o[(f+1)%3]){p.push(n);break}}for(n=p.length-1;n>=0;n--){var d=p[n];for(this.faces.splice(d,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(d,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},setFromPoints:function(e){this.vertices=[];for(var t=0,n=e.length;t<n;t++){var r=e[t];this.vertices.push(new Bn(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,n=0;n<t;n++)e[n]._id=n;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));var r,i,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];o&&o.length===t&&(r=[]),a&&a.length===t&&(i=[]);for(n=0;n<t;n++){var s=e[n]._id;r&&r.push(o[s]),i&&i.push(a[s])}r&&(this.faceVertexUvs[0]=r),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}for(var r=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];r.push(o.x,o.y,o.z)}var a=[],s=[],u={},c=[],l={},h=[],p={};for(i=0;i<this.faces.length;i++){var f=this.faces[i],d=void 0!==this.faceVertexUvs[0][i],m=f.normal.length()>0,v=f.vertexNormals.length>0,g=1!==f.color.r||1!==f.color.g||1!==f.color.b,y=f.vertexColors.length>0,b=0;if(b=T(b,0,0),b=T(b,1,!0),b=T(b,2,!1),b=T(b,3,d),b=T(b,4,m),b=T(b,5,v),b=T(b,6,g),b=T(b,7,y),a.push(b),a.push(f.a,f.b,f.c),a.push(f.materialIndex),d){var x=this.faceVertexUvs[0][i];a.push(E(x[0]),E(x[1]),E(x[2]))}if(m&&a.push(S(f.normal)),v){var w=f.vertexNormals;a.push(S(w[0]),S(w[1]),S(w[2]))}if(g&&a.push(M(f.color)),y){var _=f.vertexColors;a.push(M(_[0]),M(_[1]),M(_[2]))}}function T(e,t,n){return n?e|1<<t:e&~(1<<t)}function S(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==u[t]?u[t]:(u[t]=s.length/3,s.push(e.x,e.y,e.z),u[t])}function M(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==l[t]?l[t]:(l[t]=c.length,c.push(e.getHex()),l[t])}function E(e){var t=e.x.toString()+e.y.toString();return void 0!==p[t]?p[t]:(p[t]=h.length/2,h.push(e.x,e.y),p[t])}return e.data={},e.data.vertices=r,e.data.normals=s,c.length>0&&(e.data.colors=c),h.length>0&&(e.data.uvs=[h]),e.data.faces=a,e},clone:function(){return(new to).copy(this)},copy:function(e){var t,n,r,i,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,n=s.length;t<n;t++)this.vertices.push(s[t].clone());var u=e.colors;for(t=0,n=u.length;t<n;t++)this.colors.push(u[t].clone());var c=e.faces;for(t=0,n=c.length;t<n;t++)this.faces.push(c[t].clone());for(t=0,n=e.faceVertexUvs.length;t<n;t++){var l=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),r=0,i=l.length;r<i;r++){var h=l[r],p=[];for(o=0,a=h.length;o<a;o++){var f=h[o];p.push(f.clone())}this.faceVertexUvs[t].push(p)}}var d=e.morphTargets;for(t=0,n=d.length;t<n;t++){var m={};if(m.name=d[t].name,void 0!==d[t].vertices)for(m.vertices=[],r=0,i=d[t].vertices.length;r<i;r++)m.vertices.push(d[t].vertices[r].clone());if(void 0!==d[t].normals)for(m.normals=[],r=0,i=d[t].normals.length;r<i;r++)m.normals.push(d[t].normals[r].clone());this.morphTargets.push(m)}var v=e.morphNormals;for(t=0,n=v.length;t<n;t++){var g={};if(void 0!==v[t].vertexNormals)for(g.vertexNormals=[],r=0,i=v[t].vertexNormals.length;r<i;r++){var y=v[t].vertexNormals[r],b={};b.a=y.a.clone(),b.b=y.b.clone(),b.c=y.c.clone(),g.vertexNormals.push(b)}if(void 0!==v[t].faceNormals)for(g.faceNormals=[],r=0,i=v[t].faceNormals.length;r<i;r++)g.faceNormals.push(v[t].faceNormals[r].clone());this.morphNormals.push(g)}var x=e.skinWeights;for(t=0,n=x.length;t<n;t++)this.skinWeights.push(x[t].clone());var w=e.skinIndices;for(t=0,n=w.length;t<n;t++)this.skinIndices.push(w[t].clone());var _=e.lineDistances;for(t=0,n=_.length;t<n;t++)this.lineDistances.push(_[t]);var T=e.boundingBox;null!==T&&(this.boundingBox=T.clone());var S=e.boundingSphere;return null!==S&&(this.boundingSphere=S.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class no extends to{constructor(e,t,n,r,i,o){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o},this.fromBufferGeometry(new ro(e,t,n,r,i,o)),this.mergeVertices()}}class ro extends Li{constructor(e,t,n,r,i,o){super(),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};var a=this;e=e||1,t=t||1,n=n||1,r=Math.floor(r)||1,i=Math.floor(i)||1,o=Math.floor(o)||1;var s=[],u=[],c=[],l=[],h=0,p=0;function f(e,t,n,r,i,o,f,d,m,v,g){var y,b,x=o/m,w=f/v,_=o/2,T=f/2,S=d/2,M=m+1,E=v+1,A=0,P=0,O=new Bn;for(b=0;b<E;b++){var L=b*w-T;for(y=0;y<M;y++){var I=y*x-_;O[e]=I*r,O[t]=L*i,O[n]=S,u.push(O.x,O.y,O.z),O[e]=0,O[t]=0,O[n]=d>0?1:-1,c.push(O.x,O.y,O.z),l.push(y/m),l.push(1-b/v),A+=1}}for(b=0;b<v;b++)for(y=0;y<m;y++){var C=h+y+M*b,R=h+y+M*(b+1),D=h+(y+1)+M*(b+1),N=h+(y+1)+M*b;s.push(C,R,N),s.push(R,D,N),P+=6}a.addGroup(p,P,g),p+=P,h+=A}f("z","y","x",-1,-1,n,t,e,o,i,0),f("z","y","x",1,-1,n,t,-e,o,i,1),f("x","z","y",1,1,e,n,t,r,o,2),f("x","z","y",1,-1,e,n,-t,r,o,3),f("x","y","z",1,-1,e,t,n,r,i,4),f("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(s),this.setAttribute("position",new bi(u,3)),this.setAttribute("normal",new bi(c,3)),this.setAttribute("uv",new bi(l,2))}}function io(e){var t={};for(var n in e)for(var r in t[n]={},e[n]){var i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}return t}function oo(e){for(var t={},n=0;n<e.length;n++){var r=io(e[n]);for(var i in r)t[i]=r[i]}return t}var ao={clone:io,merge:oo},so="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",uo="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function co(e){ui.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=so,this.fragmentShader=uo,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function lo(){hr.call(this),this.type="Camera",this.matrixWorldInverse=new Yn,this.projectionMatrix=new Yn,this.projectionMatrixInverse=new Yn}function ho(e,t,n,r){lo.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}co.prototype=Object.create(ui.prototype),co.prototype.constructor=co,co.prototype.isShaderMaterial=!0,co.prototype.copy=function(e){return ui.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=io(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},co.prototype.toJSON=function(e){var t=ui.prototype.toJSON.call(this,e);for(var n in t.uniforms={},this.uniforms){var r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var i={};for(var o in this.extensions)!0===this.extensions[o]&&(i[o]=!0);return Object.keys(i).length>0&&(t.extensions=i),t},lo.prototype=Object.assign(Object.create(hr.prototype),{constructor:lo,isCamera:!0,copy:function(e,t){return hr.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Bn),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){hr.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(e,t){hr.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),ho.prototype=Object.assign(Object.create(lo.prototype),{constructor:ho,isPerspectiveCamera:!0,copy:function(e,t){return lo.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*An.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*An.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*An.RAD2DEG*Math.atan(Math.tan(.5*An.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,r,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*An.DEG2RAD*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;i+=o.offsetX*r/a,t-=o.offsetY*n/s,r*=o.width/a,n*=o.height/s}var u=this.filmOffset;0!==u&&(i+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=hr.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});var po=90,fo=1;function mo(e,t,n,r){hr.call(this),this.type="CubeCamera";var i=new ho(po,fo,e,t);i.up.set(0,-1,0),i.lookAt(new Bn(1,0,0)),this.add(i);var o=new ho(po,fo,e,t);o.up.set(0,-1,0),o.lookAt(new Bn(-1,0,0)),this.add(o);var a=new ho(po,fo,e,t);a.up.set(0,0,1),a.lookAt(new Bn(0,1,0)),this.add(a);var s=new ho(po,fo,e,t);s.up.set(0,0,-1),s.lookAt(new Bn(0,-1,0)),this.add(s);var u=new ho(po,fo,e,t);u.up.set(0,-1,0),u.lookAt(new Bn(0,0,1)),this.add(u);var c=new ho(po,fo,e,t);c.up.set(0,-1,0),c.lookAt(new Bn(0,0,-1)),this.add(c),r=r||{format:We,magFilter:Ae,minFilter:Ae},this.renderTarget=new vo(n,r),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var n=e.getRenderTarget(),r=this.renderTarget,l=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(t,i),e.setRenderTarget(r,1),e.render(t,o),e.setRenderTarget(r,2),e.render(t,a),e.setRenderTarget(r,3),e.render(t,s),e.setRenderTarget(r,4),e.render(t,u),r.texture.generateMipmaps=l,e.setRenderTarget(r,5),e.render(t,c),e.setRenderTarget(n)},this.clear=function(e,t,n,r){for(var i=e.getRenderTarget(),o=this.renderTarget,a=0;a<6;a++)e.setRenderTarget(o,a),e.clear(t,n,r);e.setRenderTarget(i)}}function vo(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),Dn.call(this,e,e,t)}function go(e,t,n,r,i,o,a,s,u,c,l,h){Cn.call(this,null,o,a,s,u,c,r,i,l,h),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==u?u:_e,this.minFilter=void 0!==c?c:_e,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}mo.prototype=Object.create(hr.prototype),mo.prototype.constructor=mo,vo.prototype=Object.create(Dn.prototype),vo.prototype.constructor=vo,vo.prototype.isWebGLCubeRenderTarget=!0,vo.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var n=new pr,r={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},i=new co({type:"CubemapFromEquirect",uniforms:io(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:b,blending:E});i.uniforms.tEquirect.value=t;var o=new qi(new ro(5,5,5),i);n.add(o);var a=new mo(1,10,1);return a.renderTarget=this,a.renderTarget.texture.name="CubeCameraTexture",a.update(e,n),o.geometry.dispose(),o.material.dispose(),this},go.prototype=Object.create(Cn.prototype),go.prototype.constructor=go,go.prototype.isDataTexture=!0;var yo=new Or,bo=new Bn;function xo(e,t,n,r,i,o){this.planes=[void 0!==e?e:new zr,void 0!==t?t:new zr,void 0!==n?n:new zr,void 0!==r?r:new zr,void 0!==i?i:new zr,void 0!==o?o:new zr]}Object.assign(xo.prototype,{set:function(e,t,n,r,i,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromProjectionMatrix:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],u=n[5],c=n[6],l=n[7],h=n[8],p=n[9],f=n[10],d=n[11],m=n[12],v=n[13],g=n[14],y=n[15];return t[0].setComponents(a-r,l-s,d-h,y-m).normalize(),t[1].setComponents(a+r,l+s,d+h,y+m).normalize(),t[2].setComponents(a+i,l+u,d+p,y+v).normalize(),t[3].setComponents(a-i,l-u,d-p,y-v).normalize(),t[4].setComponents(a-o,l-c,d-f,y-g).normalize(),t[5].setComponents(a+o,l+c,d+f,y+g).normalize(),this},intersectsObject:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),yo.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(yo)},intersectsSprite:function(e){return yo.center.set(0,0,0),yo.radius=.7071067811865476,yo.applyMatrix4(e.matrixWorld),this.intersectsSphere(yo)},intersectsSphere:function(e){for(var t=this.planes,n=e.center,r=-e.radius,i=0;i<6;i++){if(t[i].distanceToPoint(n)<r)return!1}return!0},intersectsBox:function(e){for(var t=this.planes,n=0;n<6;n++){var r=t[n];if(bo.x=r.normal.x>0?e.max.x:e.min.x,bo.y=r.normal.y>0?e.max.y:e.min.y,bo.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(bo)<0)return!1}return!0},containsPoint:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}});var wo={common:{diffuse:{value:new ni(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new On},uv2Transform:{value:new On},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Pn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ni(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new ni(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new On}},sprite:{diffuse:{value:new ni(15658734)},opacity:{value:1},center:{value:new Pn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new On}}};function _o(){var e=null,t=!1,n=null;function r(i,o){!1!==t&&(n(i,o),e.requestAnimationFrame(r))}return{start:function(){!0!==t&&null!==n&&(e.requestAnimationFrame(r),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function To(e,t){var n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){t.isInterleavedBufferAttribute&&(t=t.data);var o=r.get(t);void 0===o?r.set(t,function(t,n){var r=t.array,i=t.usage,o=e.createBuffer();e.bindBuffer(n,o),e.bufferData(n,r,i),t.onUploadCallback();var a=5126;return r instanceof Float32Array?a=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?a=5123:r instanceof Int16Array?a=5122:r instanceof Uint32Array?a=5125:r instanceof Int32Array?a=5124:r instanceof Int8Array?a=5120:r instanceof Uint8Array&&(a=5121),{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,i)):o.version<t.version&&(!function(t,r,i){var o=r.array,a=r.updateRange;e.bindBuffer(i,t),-1===a.count?e.bufferSubData(i,0,o):(n?e.bufferSubData(i,a.offset*o.BYTES_PER_ELEMENT,o,a.offset,a.count):e.bufferSubData(i,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1)}(o.buffer,t,i),o.version=t.version)}}}function So(e,t,n,r){to.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new Mo(e,t,n,r)),this.mergeVertices()}function Mo(e,t,n,r){Li.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};var i,o,a=(e=e||1)/2,s=(t=t||1)/2,u=Math.floor(n)||1,c=Math.floor(r)||1,l=u+1,h=c+1,p=e/u,f=t/c,d=[],m=[],v=[],g=[];for(o=0;o<h;o++){var y=o*f-s;for(i=0;i<l;i++){var b=i*p-a;m.push(b,-y,0),v.push(0,0,1),g.push(i/u),g.push(1-o/c)}}for(o=0;o<c;o++)for(i=0;i<u;i++){var x=i+l*o,w=i+l*(o+1),_=i+1+l*(o+1),T=i+1+l*o;d.push(x,w,T),d.push(w,_,T)}this.setIndex(d),this.setAttribute("position",new bi(m,3)),this.setAttribute("normal",new bi(v,3)),this.setAttribute("uv",new bi(g,2))}So.prototype=Object.create(to.prototype),So.prototype.constructor=So,Mo.prototype=Object.create(Li.prototype),Mo.prototype.constructor=Mo;var Eo={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);\n    } else if (face == 1.0) {\n      uv = vec2(direction.x, -direction.z) / abs(direction.y);\n    } else if (face == 2.0) {\n      uv = direction.xy / abs(direction.z);\n    } else if (face == 3.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);\n    } else if (face == 4.0) {\n      uv = direction.xz / abs(direction.y);\n    } else {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);\n    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\ttransformedNormal = mat3( instanceMatrix ) * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = saturate( clearcoat );\tmaterial.clearcoatRoughness = max( clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_normalmap_pars_fragment:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= all( bvec2( spotLight.shadow, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= all( bvec2( pointLight.shadow, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Ao={basic:{uniforms:oo([wo.common,wo.specularmap,wo.envmap,wo.aomap,wo.lightmap,wo.fog]),vertexShader:Eo.meshbasic_vert,fragmentShader:Eo.meshbasic_frag},lambert:{uniforms:oo([wo.common,wo.specularmap,wo.envmap,wo.aomap,wo.lightmap,wo.emissivemap,wo.fog,wo.lights,{emissive:{value:new ni(0)}}]),vertexShader:Eo.meshlambert_vert,fragmentShader:Eo.meshlambert_frag},phong:{uniforms:oo([wo.common,wo.specularmap,wo.envmap,wo.aomap,wo.lightmap,wo.emissivemap,wo.bumpmap,wo.normalmap,wo.displacementmap,wo.fog,wo.lights,{emissive:{value:new ni(0)},specular:{value:new ni(1118481)},shininess:{value:30}}]),vertexShader:Eo.meshphong_vert,fragmentShader:Eo.meshphong_frag},standard:{uniforms:oo([wo.common,wo.envmap,wo.aomap,wo.lightmap,wo.emissivemap,wo.bumpmap,wo.normalmap,wo.displacementmap,wo.roughnessmap,wo.metalnessmap,wo.fog,wo.lights,{emissive:{value:new ni(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Eo.meshphysical_vert,fragmentShader:Eo.meshphysical_frag},toon:{uniforms:oo([wo.common,wo.specularmap,wo.aomap,wo.lightmap,wo.emissivemap,wo.bumpmap,wo.normalmap,wo.displacementmap,wo.gradientmap,wo.fog,wo.lights,{emissive:{value:new ni(0)},specular:{value:new ni(1118481)},shininess:{value:30}}]),vertexShader:Eo.meshtoon_vert,fragmentShader:Eo.meshtoon_frag},matcap:{uniforms:oo([wo.common,wo.bumpmap,wo.normalmap,wo.displacementmap,wo.fog,{matcap:{value:null}}]),vertexShader:Eo.meshmatcap_vert,fragmentShader:Eo.meshmatcap_frag},points:{uniforms:oo([wo.points,wo.fog]),vertexShader:Eo.points_vert,fragmentShader:Eo.points_frag},dashed:{uniforms:oo([wo.common,wo.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Eo.linedashed_vert,fragmentShader:Eo.linedashed_frag},depth:{uniforms:oo([wo.common,wo.displacementmap]),vertexShader:Eo.depth_vert,fragmentShader:Eo.depth_frag},normal:{uniforms:oo([wo.common,wo.bumpmap,wo.normalmap,wo.displacementmap,{opacity:{value:1}}]),vertexShader:Eo.normal_vert,fragmentShader:Eo.normal_frag},sprite:{uniforms:oo([wo.sprite,wo.fog]),vertexShader:Eo.sprite_vert,fragmentShader:Eo.sprite_frag},background:{uniforms:{uvTransform:{value:new On},t2D:{value:null}},vertexShader:Eo.background_vert,fragmentShader:Eo.background_frag},cube:{uniforms:oo([wo.envmap,{opacity:{value:1}}]),vertexShader:Eo.cube_vert,fragmentShader:Eo.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Eo.equirect_vert,fragmentShader:Eo.equirect_frag},distanceRGBA:{uniforms:oo([wo.common,wo.displacementmap,{referencePosition:{value:new Bn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Eo.distanceRGBA_vert,fragmentShader:Eo.distanceRGBA_frag},shadow:{uniforms:oo([wo.lights,wo.fog,{color:{value:new ni(0)},opacity:{value:1}}]),vertexShader:Eo.shadow_vert,fragmentShader:Eo.shadow_frag}};function Po(e,t,n,r){var i,o,a=new ni(0),s=0,u=null,c=0,l=null;function h(e,n){t.buffers.color.setClear(e.r,e.g,e.b,n,r)}return{getClearColor:function(){return a},setClearColor:function(e,t){a.set(e),h(a,s=void 0!==t?t:1)},getClearAlpha:function(){return s},setClearAlpha:function(e){h(a,s=e)},render:function(t,r,p,f){var d=r.background,m=e.xr,v=m.getSession&&m.getSession();if(v&&"additive"===v.environmentBlendMode&&(d=null),null===d?h(a,s):d&&d.isColor&&(h(d,1),f=!0),(e.autoClear||f)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),d&&(d.isCubeTexture||d.isWebGLCubeRenderTarget||d.mapping===ge)){void 0===o&&((o=new qi(new ro(1,1,1),new co({type:"BackgroundCubeMaterial",uniforms:io(Ao.cube.uniforms),vertexShader:Ao.cube.vertexShader,fragmentShader:Ao.cube.fragmentShader,side:b,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(o));var g=d.isWebGLCubeRenderTarget?d.texture:d;o.material.uniforms.envMap.value=g,o.material.uniforms.flipEnvMap.value=g.isCubeTexture?-1:1,u===d&&c===g.version&&l===e.toneMapping||(o.material.needsUpdate=!0,u=d,c=g.version,l=e.toneMapping),t.unshift(o,o.geometry,o.material,0,0,null)}else d&&d.isTexture&&(void 0===i&&((i=new qi(new Mo(2,2),new co({type:"BackgroundMaterial",uniforms:io(Ao.background.uniforms),vertexShader:Ao.background.vertexShader,fragmentShader:Ao.background.fragmentShader,side:y,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(i.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(i)),i.material.uniforms.t2D.value=d,!0===d.matrixAutoUpdate&&d.updateMatrix(),i.material.uniforms.uvTransform.value.copy(d.matrix),u===d&&c===d.version&&l===e.toneMapping||(i.material.needsUpdate=!0,u=d,c=d.version,l=e.toneMapping),t.unshift(i,i.geometry,i.material,0,0,null))}}}function Oo(e,t,n,r){var i,o=r.isWebGL2;this.setMode=function(e){i=e},this.render=function(t,r){e.drawArrays(i,t,r),n.update(r,i)},this.renderInstances=function(r,a,s,u){if(0!==u){var c,l;if(o)c=e,l="drawArraysInstanced";else if(l="drawArraysInstancedANGLE",null===(c=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[l](i,a,s,u),n.update(s,i,u)}}}function Lo(e,t,n){var r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,a=void 0!==n.precision?n.precision:"highp",s=i(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var u=!0===n.logarithmicDepthBuffer,c=e.getParameter(34930),l=e.getParameter(35660),h=e.getParameter(3379),p=e.getParameter(34076),f=e.getParameter(34921),d=e.getParameter(36347),m=e.getParameter(36348),v=e.getParameter(36349),g=l>0,y=o||!!t.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==r)return r;var n=t.get("EXT_texture_filter_anisotropic");return r=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:a,logarithmicDepthBuffer:u,maxTextures:c,maxVertexTextures:l,maxTextureSize:h,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:d,maxVaryings:m,maxFragmentUniforms:v,vertexTextures:g,floatFragmentTextures:y,floatVertexTextures:g&&y,maxSamples:o?e.getParameter(36183):0}}function Io(){var e=this,t=null,n=0,r=!1,i=!1,o=new zr,a=new On,s={value:null,needsUpdate:!1};function u(){s.value!==t&&(s.value=t,s.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function c(t,n,r,i){var u=null!==t?t.length:0,c=null;if(0!==u){if(c=s.value,!0!==i||null===c){var l=r+4*u,h=n.matrixWorldInverse;a.getNormalMatrix(h),(null===c||c.length<l)&&(c=new Float32Array(l));for(var p=0,f=r;p!==u;++p,f+=4)o.copy(t[p]).applyMatrix4(h,a),o.normal.toArray(c,f),c[f+3]=o.constant}s.value=c,s.needsUpdate=!0}return e.numPlanes=u,c}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,i,o){var a=0!==e.length||i||0!==n||r;return r=i,t=c(e,o,0),n=e.length,a},this.beginShadows=function(){i=!0,c(null)},this.endShadows=function(){i=!1,u()},this.setState=function(e,o,a,l,h,p){if(!r||null===e||0===e.length||i&&!a)i?c(null):u();else{var f=i?0:n,d=4*f,m=h.clippingState||null;s.value=m,m=c(e,l,d,p);for(var v=0;v!==d;++v)m[v]=t[v];h.clippingState=m,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=f}}}function Co(e){var t={};return{get:function(n){if(void 0!==t[n])return t[n];var r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return null===r&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),t[n]=r,r}}}function Ro(e,t,n){var r=new WeakMap,i=new WeakMap;function o(e){var a=e.target,s=r.get(a);for(var u in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[u]);a.removeEventListener("dispose",o),r.delete(a);var c=i.get(s);c&&(t.remove(c),i.delete(s)),n.memory.geometries--}function a(e){var n=[],r=e.index,o=e.attributes.position,a=0;if(null!==r){var s=r.array;a=r.version;for(var u=0,c=s.length;u<c;u+=3){var l=s[u+0],h=s[u+1],p=s[u+2];n.push(l,h,h,p,p,l)}}else{s=o.array;a=o.version;for(u=0,c=s.length/3-1;u<c;u+=3){l=u+0,h=u+1,p=u+2;n.push(l,h,h,p,p,l)}}var f=new(_i(n)>65535?yi:vi)(n,1);f.version=a,t.update(f,34963);var d=i.get(e);d&&t.remove(d),i.set(e,f)}return{get:function(e,t){var i=r.get(t);return i||(t.addEventListener("dispose",o),t.isBufferGeometry?i=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new Li).setFromObject(e)),i=t._bufferGeometry),r.set(t,i),n.memory.geometries++,i)},update:function(e){var n=e.index,r=e.attributes;for(var i in null!==n&&t.update(n,34963),r)t.update(r[i],34962);var o=e.morphAttributes;for(var i in o)for(var a=o[i],s=0,u=a.length;s<u;s++)t.update(a[s],34962)},getWireframeAttribute:function(e){var t=i.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&a(e)}else a(e);return i.get(e)}}}function Do(e,t,n,r){var i,o,a,s=r.isWebGL2;this.setMode=function(e){i=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,r){e.drawElements(i,r,o,t*a),n.update(r,i)},this.renderInstances=function(r,u,c,l){if(0!==l){var h,p;if(s)h=e,p="drawElementsInstanced";else if(p="drawElementsInstancedANGLE",null===(h=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[p](i,c,o,u*a,l),n.update(c,i,l)}}}function No(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,r){switch(r=r||1,t.calls++,n){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Fo(e,t){return Math.abs(t[1])-Math.abs(e[1])}function jo(e){var t={},n=new Float32Array(8);return{update:function(r,i,o,a){var s=r.morphTargetInfluences,u=void 0===s?0:s.length,c=t[i.id];if(void 0===c){c=[];for(var l=0;l<u;l++)c[l]=[l,0];t[i.id]=c}var h=o.morphTargets&&i.morphAttributes.position,p=o.morphNormals&&i.morphAttributes.normal;for(l=0;l<u;l++){0!==(d=c[l])[1]&&(h&&i.deleteAttribute("morphTarget"+l),p&&i.deleteAttribute("morphNormal"+l))}for(l=0;l<u;l++){(d=c[l])[0]=l,d[1]=s[l]}c.sort(Fo);var f=0;for(l=0;l<8;l++){var d;if(d=c[l]){var m=d[0],v=d[1];if(v){h&&i.setAttribute("morphTarget"+l,h[m]),p&&i.setAttribute("morphNormal"+l,p[m]),n[l]=v,f+=v;continue}}n[l]=0}var g=i.morphTargetsRelative?1:1-f;a.getUniforms().setValue(e,"morphTargetBaseInfluence",g),a.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function Uo(e,t,n,r){var i={};return{update:function(e){var o=r.render.frame,a=e.geometry,s=t.get(e,a);return i[s.id]!==o&&(a.isGeometry&&s.updateFromObject(e),t.update(s),i[s.id]=o),e.isInstancedMesh&&n.update(e.instanceMatrix,34962),s},dispose:function(){i={}}}}function Bo(e,t,n,r,i,o,a,s,u,c){e=void 0!==e?e:[],t=void 0!==t?t:pe,a=void 0!==a?a:We,Cn.call(this,e,t,n,r,i,o,a,s,u,c),this.flipY=!1}function ko(e,t,n,r){Cn.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:r||1},this.magFilter=_e,this.minFilter=_e,this.wrapR=xe,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function zo(e,t,n,r){Cn.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:r||1},this.magFilter=_e,this.minFilter=_e,this.wrapR=xe,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Ao.physical={uniforms:oo([Ao.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new ni(0)},clearcoatNormalScale:{value:new Pn(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:Eo.meshphysical_vert,fragmentShader:Eo.meshphysical_frag},Bo.prototype=Object.create(Cn.prototype),Bo.prototype.constructor=Bo,Bo.prototype.isCubeTexture=!0,Object.defineProperty(Bo.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),ko.prototype=Object.create(Cn.prototype),ko.prototype.constructor=ko,ko.prototype.isDataTexture2DArray=!0,zo.prototype=Object.create(Cn.prototype),zo.prototype.constructor=zo,zo.prototype.isDataTexture3D=!0;var Go=new Cn,Vo=new ko,Ho=new zo,Wo=new Bo,Xo=[],Yo=[],qo=new Float32Array(16),Qo=new Float32Array(9),Zo=new Float32Array(4);function Ko(e,t,n){var r=e[0];if(r<=0||r>0)return e;var i=t*n,o=Xo[i];if(void 0===o&&(o=new Float32Array(i),Xo[i]=o),0!==t){r.toArray(o,0);for(var a=1,s=0;a!==t;++a)s+=n,e[a].toArray(o,s)}return o}function Jo(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function $o(e,t){for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}function ea(e,t){var n=Yo[t];void 0===n&&(n=new Int32Array(t),Yo[t]=n);for(var r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function ta(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function na(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Jo(n,t))return;e.uniform2fv(this.addr,t),$o(n,t)}}function ra(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Jo(n,t))return;e.uniform3fv(this.addr,t),$o(n,t)}}function ia(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Jo(n,t))return;e.uniform4fv(this.addr,t),$o(n,t)}}function oa(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Jo(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),$o(n,t)}else{if(Jo(n,r))return;Zo.set(r),e.uniformMatrix2fv(this.addr,!1,Zo),$o(n,r)}}function aa(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Jo(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),$o(n,t)}else{if(Jo(n,r))return;Qo.set(r),e.uniformMatrix3fv(this.addr,!1,Qo),$o(n,r)}}function sa(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Jo(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),$o(n,t)}else{if(Jo(n,r))return;qo.set(r),e.uniformMatrix4fv(this.addr,!1,qo),$o(n,r)}}function ua(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(t||Go,i)}function ca(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||Vo,i)}function la(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||Ho,i)}function ha(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(t||Wo,i)}function pa(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function fa(e,t){var n=this.cache;Jo(n,t)||(e.uniform2iv(this.addr,t),$o(n,t))}function da(e,t){var n=this.cache;Jo(n,t)||(e.uniform3iv(this.addr,t),$o(n,t))}function ma(e,t){var n=this.cache;Jo(n,t)||(e.uniform4iv(this.addr,t),$o(n,t))}function va(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function ga(e,t){e.uniform1fv(this.addr,t)}function ya(e,t){e.uniform1iv(this.addr,t)}function ba(e,t){e.uniform2iv(this.addr,t)}function xa(e,t){e.uniform3iv(this.addr,t)}function wa(e,t){e.uniform4iv(this.addr,t)}function _a(e,t){var n=Ko(t,this.size,2);e.uniform2fv(this.addr,n)}function Ta(e,t){var n=Ko(t,this.size,3);e.uniform3fv(this.addr,n)}function Sa(e,t){var n=Ko(t,this.size,4);e.uniform4fv(this.addr,n)}function Ma(e,t){var n=Ko(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Ea(e,t){var n=Ko(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Aa(e,t){var n=Ko(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Pa(e,t,n){var r=t.length,i=ea(n,r);e.uniform1iv(this.addr,i);for(var o=0;o!==r;++o)n.safeSetTexture2D(t[o]||Go,i[o])}function Oa(e,t,n){var r=t.length,i=ea(n,r);e.uniform1iv(this.addr,i);for(var o=0;o!==r;++o)n.safeSetTextureCube(t[o]||Wo,i[o])}function La(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return ta;case 35664:return na;case 35665:return ra;case 35666:return ia;case 35674:return oa;case 35675:return aa;case 35676:return sa;case 5124:case 35670:return pa;case 35667:case 35671:return fa;case 35668:case 35672:return da;case 35669:case 35673:return ma;case 5125:return va;case 35678:case 36198:case 36298:case 36306:case 35682:return ua;case 35679:case 36299:case 36307:return la;case 35680:case 36300:case 36308:case 36293:return ha;case 36289:case 36303:case 36311:case 36292:return ca}}(t.type)}function Ia(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return ga;case 35664:return _a;case 35665:return Ta;case 35666:return Sa;case 35674:return Ma;case 35675:return Ea;case 35676:return Aa;case 5124:case 35670:return ya;case 35667:case 35671:return ba;case 35668:case 35672:return xa;case 35669:case 35673:return wa;case 35678:case 36198:case 36298:case 36306:case 35682:return Pa;case 35680:case 36300:case 36308:case 36293:return Oa}}(t.type)}function Ca(e){this.id=e,this.seq=[],this.map={}}Ia.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),$o(t,e)},Ca.prototype.setValue=function(e,t,n){for(var r=this.seq,i=0,o=r.length;i!==o;++i){var a=r[i];a.setValue(e,t[a.id],n)}};var Ra=/([\w\d_]+)(\])?(\[|\.)?/g;function Da(e,t){e.seq.push(t),e.map[t.id]=t}function Na(e,t,n){var r=e.name,i=r.length;for(Ra.lastIndex=0;;){var o=Ra.exec(r),a=Ra.lastIndex,s=o[1],u="]"===o[2],c=o[3];if(u&&(s|=0),void 0===c||"["===c&&a+2===i){Da(n,void 0===c?new La(s,e,t):new Ia(s,e,t));break}var l=n.map[s];void 0===l&&Da(n,l=new Ca(s)),n=l}}function Fa(e,t){this.seq=[],this.map={};for(var n=e.getProgramParameter(t,35718),r=0;r<n;++r){var i=e.getActiveUniform(t,r);Na(i,e.getUniformLocation(t,i.name),this)}}function ja(e,t,n){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}Fa.prototype.setValue=function(e,t,n,r){var i=this.map[t];void 0!==i&&i.setValue(e,n,r)},Fa.prototype.setOptional=function(e,t,n){var r=t[n];void 0!==r&&this.setValue(e,n,r)},Fa.upload=function(e,t,n,r){for(var i=0,o=t.length;i!==o;++i){var a=t[i],s=n[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,r)}},Fa.seqWithValue=function(e,t){for(var n=[],r=0,i=e.length;r!==i;++r){var o=e[r];o.id in t&&n.push(o)}return n};var Ua=0;function Ba(e){switch(e){case Bt:return["Linear","( value )"];case kt:return["sRGB","( value )"];case Gt:return["RGBE","( value )"];case Ht:return["RGBM","( value, 7.0 )"];case Wt:return["RGBM","( value, 16.0 )"];case Xt:return["RGBD","( value, 256.0 )"];case zt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case Vt:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+e)}}function ka(e,t,n){var r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();return r&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(e.getShaderSource(t))}function za(e,t){var n=Ba(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Ga(e,t){var n;switch(t){case ae:n="Linear";break;case se:n="Reinhard";break;case ue:n="Uncharted2";break;case ce:n="OptimizedCineon";break;case le:n="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Va(e){return""!==e}function Ha(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Wa(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Xa=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ya(e){return e.replace(Xa,qa)}function qa(e,t){var n=Eo[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return Ya(n)}var Qa=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function Za(e){return e.replace(Qa,Ka)}function Ka(e,t,n,r){for(var i="",o=parseInt(t);o<parseInt(n);o++)i+=r.replace(/\[ i \]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return i}function Ja(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function $a(e,t,n){var r,i,o,a,s,u=e.getContext(),c=n.defines,l=n.vertexShader,h=n.fragmentShader,p=function(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===m?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===v?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===g&&(t="SHADOWMAP_TYPE_VSM"),t}(n),f=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case pe:case fe:t="ENVMAP_TYPE_CUBE";break;case ge:case ye:t="ENVMAP_TYPE_CUBE_UV";break;case de:case me:t="ENVMAP_TYPE_EQUIREC";break;case ve:t="ENVMAP_TYPE_SPHERE"}return t}(n),d=function(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case fe:case me:t="ENVMAP_MODE_REFRACTION"}return t}(n),y=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case ne:t="ENVMAP_BLENDING_MULTIPLY";break;case re:t="ENVMAP_BLENDING_MIX";break;case ie:t="ENVMAP_BLENDING_ADD"}return t}(n),b=e.gammaFactor>0?e.gammaFactor:1,x=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Va).join("\n")}(n),w=function(e){var t=[];for(var n in e){var r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(c),_=u.createProgram(),T=n.numMultiviewViews;if(n.isRawShaderMaterial?((r=[w].filter(Va).join("\n")).length>0&&(r+="\n"),(i=[x,w].filter(Va).join("\n")).length>0&&(i+="\n")):(r=[Ja(n),"#define SHADER_NAME "+n.shaderName,w,n.instancing?"#define USE_INSTANCING":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+b,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+p:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Va).join("\n"),i=[x,Ja(n),"#define SHADER_NAME "+n.shaderName,w,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+b,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+f:"",n.envMap?"#define "+d:"",n.envMap?"#define "+y:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+p:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==oe?"#define TONE_MAPPING":"",n.toneMapping!==oe?Eo.tonemapping_pars_fragment:"",n.toneMapping!==oe?Ga("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.outputEncoding||n.mapEncoding||n.matcapEncoding||n.envMapEncoding||n.emissiveMapEncoding||n.lightMapEncoding?Eo.encodings_pars_fragment:"",n.mapEncoding?za("mapTexelToLinear",n.mapEncoding):"",n.matcapEncoding?za("matcapTexelToLinear",n.matcapEncoding):"",n.envMapEncoding?za("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMapEncoding?za("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMapEncoding?za("lightMapTexelToLinear",n.lightMapEncoding):"",n.outputEncoding?(o="linearToOutputTexel",a=n.outputEncoding,s=Ba(a),"vec4 "+o+"( vec4 value ) { return LinearTo"+s[0]+s[1]+"; }"):"",n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Va).join("\n")),l=Wa(l=Ha(l=Ya(l),n),n),h=Wa(h=Ha(h=Ya(h),n),n),l=Za(l),h=Za(h),n.isWebGL2&&!n.isRawShaderMaterial){var S=!1,M=/^\s*#version\s+300\s+es\s*\n/;n.isShaderMaterial&&null!==l.match(M)&&null!==h.match(M)&&(S=!0,l=l.replace(M,""),h=h.replace(M,"")),r=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+r,i=["#version 300 es\n","#define varying in",S?"":"out highp vec4 pc_fragColor;",S?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+i,T>0&&(r=(r=r.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","layout(num_views = "+T+") in;","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join("\n"),["uniform mat4 modelViewMatrices["+T+"];","uniform mat4 projectionMatrices["+T+"];","uniform mat4 viewMatrices["+T+"];","uniform mat3 normalMatrices["+T+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join("\n")),i=(i=i.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+T+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join("\n")))}var E,A,P=i+h,O=ja(u,35633,r+l),L=ja(u,35632,P);if(u.attachShader(_,O),u.attachShader(_,L),void 0!==n.index0AttributeName?u.bindAttribLocation(_,0,n.index0AttributeName):!0===n.morphTargets&&u.bindAttribLocation(_,0,"position"),u.linkProgram(_),e.debug.checkShaderErrors){var I=u.getProgramInfoLog(_).trim(),C=u.getShaderInfoLog(O).trim(),R=u.getShaderInfoLog(L).trim(),D=!0,N=!0;if(!1===u.getProgramParameter(_,35714)){D=!1;var F=ka(u,O,"vertex"),j=ka(u,L,"fragment");console.error("THREE.WebGLProgram: shader error: ",u.getError(),"35715",u.getProgramParameter(_,35715),"gl.getProgramInfoLog",I,F,j)}else""!==I?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",I):""!==C&&""!==R||(N=!1);N&&(this.diagnostics={runnable:D,programLog:I,vertexShader:{log:C,prefix:r},fragmentShader:{log:R,prefix:i}})}return u.deleteShader(O),u.deleteShader(L),this.getUniforms=function(){return void 0===E&&(E=new Fa(u,_)),E},this.getAttributes=function(){return void 0===A&&(A=function(e,t){for(var n={},r=e.getProgramParameter(t,35721),i=0;i<r;i++){var o=e.getActiveAttrib(t,i).name;n[o]=e.getAttribLocation(t,o)}return n}(u,_)),A},this.destroy=function(){u.deleteProgram(_),this.program=void 0},this.name=n.shaderName,this.id=Ua++,this.cacheKey=t,this.usedTimes=1,this.program=_,this.vertexShader=O,this.fragmentShader=L,this.numMultiviewViews=T,this}function es(e,t,n){var r=[],i=n.isWebGL2,o=n.logarithmicDepthBuffer,a=n.floatVertexTextures,s=n.precision,u=n.maxVertexUniforms,c=n.vertexTextures,l={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},h=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","numMultiviewViews","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function p(e){var t;return e?e.isTexture?t=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=Bt,t}this.getParameters=function(r,h,f,d,m,v,g){var y=d.fog,w=r.isMeshStandardMaterial?d.environment:null,_=r.envMap||w,T=l[r.type],S=g.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(a)return 1024;var n=u,r=Math.floor((n-20)/4),i=Math.min(r,t.length);return i<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+i+"."),0):i}(g):0;null!==r.precision&&(s=n.getMaxPrecision(r.precision))!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",s,"instead.");var M=function(e,t){var n;if(t){var r=Ao[t];n={name:e.type,uniforms:ao.clone(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}}else n={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};return n}(r,T);r.onBeforeCompile(M,e);var E=e.getRenderTarget(),A=E&&E.isWebGLMultiviewRenderTarget?E.numViews:0;return{isWebGL2:i,shaderID:T,shaderName:M.name,uniforms:M.uniforms,vertexShader:M.vertexShader,fragmentShader:M.fragmentShader,defines:r.defines,isRawShaderMaterial:r.isRawShaderMaterial,isShaderMaterial:r.isShaderMaterial,precision:s,instancing:!0===g.isInstancedMesh,supportsVertexTextures:c,numMultiviewViews:A,outputEncoding:null!==E?p(E.texture):e.outputEncoding,map:!!r.map,mapEncoding:p(r.map),matcap:!!r.matcap,matcapEncoding:p(r.matcap),envMap:!!_,envMapMode:_&&_.mapping,envMapEncoding:p(_),envMapCubeUV:!!_&&(_.mapping===ge||_.mapping===ye),lightMap:!!r.lightMap,lightMapEncoding:p(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:p(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:r.normalMapType===Zt,tangentSpaceNormalMap:r.normalMapType===Qt,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexUvs:!!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.displacementMap),uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||!r.displacementMap),fog:!!y,useFog:r.fog,fogExp2:y&&y.isFogExp2,flatShading:r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:o,skinning:r.skinning&&S>0,maxBones:S,useVertexTexture:a,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:h.directional.length,numPointLights:h.point.length,numSpotLights:h.spot.length,numRectAreaLights:h.rectArea.length,numHemiLights:h.hemi.length,numDirLightShadows:h.directionalShadowMap.length,numPointLightShadows:h.pointShadowMap.length,numSpotLightShadows:h.spotShadowMap.length,numClippingPlanes:m,numClipIntersection:v,dithering:r.dithering,shadowMapEnabled:e.shadowMap.enabled&&f.length>0,shadowMapType:e.shadowMap.type,toneMapping:r.toneMapped?e.toneMapping:oe,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===x,flipSided:r.side===b,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.frawbuffers,extensionDrawbuffers:r.extensions&&r.extensions.drawbuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:i||null!==t.get("EXT_frag_depth"),rendererExtensionDrawBuffers:i||null!==t.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:i||null!==t.get("EXT_shader_texture_lod"),onBeforeCompile:r.onBeforeCompile}},this.getProgramCacheKey=function(t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var r in t.defines)n.push(r),n.push(t.defines[r]);if(void 0===t.isRawShaderMaterial){for(var i=0;i<h.length;i++)n.push(t[h[i]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.onBeforeCompile.toString()),n.join()},this.acquireProgram=function(t,n){for(var i,o=0,a=r.length;o<a;o++){var s=r[o];if(s.cacheKey===n){++(i=s).usedTimes;break}}return void 0===i&&(i=new $a(e,n,t),r.push(i)),i},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),e.destroy()}},this.programs=r}function ts(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function ns(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function rs(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function is(){var e=[],t=0,n=[],r=[],i={id:-1};function o(n,r,o,a,s,u){var c=e[t];return void 0===c?(c={id:n.id,object:n,geometry:r,material:o,program:o.program||i,groupOrder:a,renderOrder:n.renderOrder,z:s,group:u},e[t]=c):(c.id=n.id,c.object=n,c.geometry=r,c.material=o,c.program=o.program||i,c.groupOrder=a,c.renderOrder=n.renderOrder,c.z=s,c.group=u),t++,c}return{opaque:n,transparent:r,init:function(){t=0,n.length=0,r.length=0},push:function(e,t,i,a,s,u){var c=o(e,t,i,a,s,u);(!0===i.transparent?r:n).push(c)},unshift:function(e,t,i,a,s,u){var c=o(e,t,i,a,s,u);(!0===i.transparent?r:n).unshift(c)},sort:function(e,t){n.length>1&&n.sort(e||ns),r.length>1&&r.sort(t||rs)}}}function os(){var e=new WeakMap;function t(n){var r=n.target;r.removeEventListener("dispose",t),e.delete(r)}return{get:function(n,r){var i,o=e.get(n);return void 0===o?(i=new is,e.set(n,new WeakMap),e.get(n).set(r,i),n.addEventListener("dispose",t)):void 0===(i=o.get(r))&&(i=new is,o.set(r,i)),i},dispose:function(){e=new WeakMap}}}function as(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new Bn,color:new ni,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Pn};break;case"SpotLight":n={position:new Bn,direction:new Bn,color:new ni,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Pn};break;case"PointLight":n={position:new Bn,color:new ni,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Pn,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":n={direction:new Bn,skyColor:new ni,groundColor:new ni};break;case"RectAreaLight":n={color:new ni,position:new Bn,halfWidth:new Bn,halfHeight:new Bn}}return e[t.id]=n,n}}}var ss=0;function us(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function cs(){for(var e=new as,t={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},n=0;n<9;n++)t.probe.push(new Bn);var r=new Bn,i=new Yn,o=new Yn;return{setup:function(n,a,s){for(var u=0,c=0,l=0,h=0;h<9;h++)t.probe[h].set(0,0,0);var p=0,f=0,d=0,m=0,v=0,g=0,y=0,b=0,x=s.matrixWorldInverse;n.sort(us),h=0;for(var w=n.length;h<w;h++){var _=n[h],T=_.color,S=_.intensity,M=_.distance,E=_.shadow&&_.shadow.map?_.shadow.map.texture:null;if(_.isAmbientLight)u+=T.r*S,c+=T.g*S,l+=T.b*S;else if(_.isLightProbe)for(var A=0;A<9;A++)t.probe[A].addScaledVector(_.sh.coefficients[A],S);else if(_.isDirectionalLight){if((O=e.get(_)).color.copy(_.color).multiplyScalar(_.intensity),O.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),O.direction.sub(r),O.direction.transformDirection(x),O.shadow=_.castShadow,_.castShadow){var P=_.shadow;O.shadowBias=P.bias,O.shadowRadius=P.radius,O.shadowMapSize=P.mapSize,t.directionalShadowMap[p]=E,t.directionalShadowMatrix[p]=_.shadow.matrix,g++}t.directional[p]=O,p++}else if(_.isSpotLight){if((O=e.get(_)).position.setFromMatrixPosition(_.matrixWorld),O.position.applyMatrix4(x),O.color.copy(T).multiplyScalar(S),O.distance=M,O.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),O.direction.sub(r),O.direction.transformDirection(x),O.coneCos=Math.cos(_.angle),O.penumbraCos=Math.cos(_.angle*(1-_.penumbra)),O.decay=_.decay,O.shadow=_.castShadow,_.castShadow){P=_.shadow;O.shadowBias=P.bias,O.shadowRadius=P.radius,O.shadowMapSize=P.mapSize,t.spotShadowMap[d]=E,t.spotShadowMatrix[d]=_.shadow.matrix,b++}t.spot[d]=O,d++}else if(_.isRectAreaLight){(O=e.get(_)).color.copy(T).multiplyScalar(S),O.position.setFromMatrixPosition(_.matrixWorld),O.position.applyMatrix4(x),o.identity(),i.copy(_.matrixWorld),i.premultiply(x),o.extractRotation(i),O.halfWidth.set(.5*_.width,0,0),O.halfHeight.set(0,.5*_.height,0),O.halfWidth.applyMatrix4(o),O.halfHeight.applyMatrix4(o),t.rectArea[m]=O,m++}else if(_.isPointLight){if((O=e.get(_)).position.setFromMatrixPosition(_.matrixWorld),O.position.applyMatrix4(x),O.color.copy(_.color).multiplyScalar(_.intensity),O.distance=_.distance,O.decay=_.decay,O.shadow=_.castShadow,_.castShadow){P=_.shadow;O.shadowBias=P.bias,O.shadowRadius=P.radius,O.shadowMapSize=P.mapSize,O.shadowCameraNear=P.camera.near,O.shadowCameraFar=P.camera.far,t.pointShadowMap[f]=E,t.pointShadowMatrix[f]=_.shadow.matrix,y++}t.point[f]=O,f++}else if(_.isHemisphereLight){var O;(O=e.get(_)).direction.setFromMatrixPosition(_.matrixWorld),O.direction.transformDirection(x),O.direction.normalize(),O.skyColor.copy(_.color).multiplyScalar(S),O.groundColor.copy(_.groundColor).multiplyScalar(S),t.hemi[v]=O,v++}}t.ambient[0]=u,t.ambient[1]=c,t.ambient[2]=l;var L=t.hash;L.directionalLength===p&&L.pointLength===f&&L.spotLength===d&&L.rectAreaLength===m&&L.hemiLength===v&&L.numDirectionalShadows===g&&L.numPointShadows===y&&L.numSpotShadows===b||(t.directional.length=p,t.spot.length=d,t.rectArea.length=m,t.point.length=f,t.hemi.length=v,t.directionalShadowMap.length=g,t.pointShadowMap.length=y,t.spotShadowMap.length=b,t.directionalShadowMatrix.length=g,t.pointShadowMatrix.length=y,t.spotShadowMatrix.length=b,L.directionalLength=p,L.pointLength=f,L.spotLength=d,L.rectAreaLength=m,L.hemiLength=v,L.numDirectionalShadows=g,L.numPointShadows=y,L.numSpotShadows=b,t.version=ss++)},state:t}}function ls(){var e=new cs,t=[],n=[];return{init:function(){t.length=0,n.length=0},state:{lightsArray:t,shadowsArray:n,lights:e},setupLights:function(r){e.setup(t,n,r)},pushLight:function(e){t.push(e)},pushShadow:function(e){n.push(e)}}}function hs(){var e=new WeakMap;function t(n){var r=n.target;r.removeEventListener("dispose",t),e.delete(r)}return{get:function(n,r){var i;return!1===e.has(n)?(i=new ls,e.set(n,new WeakMap),e.get(n).set(r,i),n.addEventListener("dispose",t)):!1===e.get(n).has(r)?(i=new ls,e.get(n).set(r,i)):i=e.get(n).get(r),i},dispose:function(){e=new WeakMap}}}function ps(e){ui.call(this),this.type="MeshDepthMaterial",this.depthPacking=Yt,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function fs(e){ui.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Bn,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}ps.prototype=Object.create(ui.prototype),ps.prototype.constructor=ps,ps.prototype.isMeshDepthMaterial=!0,ps.prototype.copy=function(e){return ui.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},fs.prototype=Object.create(ui.prototype),fs.prototype.constructor=fs,fs.prototype.isMeshDistanceMaterial=!0,fs.prototype.copy=function(e){return ui.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};var ds="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",ms="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function vs(e,t,n){var r=new xo,i=new Pn,o=new Pn,a=new Rn,s=[],u=[],c={},l={0:b,1:y,2:x},h=new co({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Pn},radius:{value:4}},vertexShader:ms,fragmentShader:ds}),p=h.clone();p.defines.HORIZONAL_PASS=1;var f=new Li;f.setAttribute("position",new hi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var d=new qi(f,h),v=this;function w(n,r){var i=t.update(d);h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,i,h,d,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,i,p,d,null)}function _(e,t,n){var r=e<<0|t<<1|n<<2,i=s[r];return void 0===i&&(i=new ps({depthPacking:qt,morphTargets:e,skinning:t}),s[r]=i),i}function T(e,t,n){var r=e<<0|t<<1|n<<2,i=u[r];return void 0===i&&(i=new fs({morphTargets:e,skinning:t}),u[r]=i),i}function S(t,n,r,i,o,a){var s=t.geometry,u=null,h=_,p=t.customDepthMaterial;if(!0===r.isPointLight&&(h=T,p=t.customDistanceMaterial),void 0===p){var f=!1;!0===n.morphTargets&&(!0===s.isBufferGeometry?f=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:!0===s.isGeometry&&(f=s.morphTargets&&s.morphTargets.length>0));var d=!1;!0===t.isSkinnedMesh&&(!0===n.skinning?d=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),u=h(f,d,!0===t.isInstancedMesh)}else u=p;if(e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){var m=u.uuid,v=n.uuid,y=c[m];void 0===y&&(y={},c[m]=y);var b=y[v];void 0===b&&(b=u.clone(),y[v]=b),u=b}return u.visible=n.visible,u.wireframe=n.wireframe,u.side=a===g?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:l[n.side],u.clipShadows=n.clipShadows,u.clippingPlanes=n.clippingPlanes,u.clipIntersection=n.clipIntersection,u.wireframeLinewidth=n.wireframeLinewidth,u.linewidth=n.linewidth,!0===r.isPointLight&&!0===u.isMeshDistanceMaterial&&(u.referencePosition.setFromMatrixPosition(r.matrixWorld),u.nearDistance=i,u.farDistance=o),u}function M(n,i,o,a,s){if(!1!==n.visible){if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===g)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);var u=t.update(n),c=n.material;if(Array.isArray(c))for(var l=u.groups,h=0,p=l.length;h<p;h++){var f=l[h],d=c[f.materialIndex];if(d&&d.visible){var m=S(n,d,a,o.near,o.far,s);e.renderBufferDirect(o,null,u,m,n,f)}}else if(c.visible){m=S(n,c,a,o.near,o.far,s);e.renderBufferDirect(o,null,u,m,n,null)}}for(var v=n.children,y=0,b=v.length;y<b;y++)M(v[y],i,o,a,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=m,this.render=function(t,s,u){if(!1!==v.enabled&&(!1!==v.autoUpdate||!1!==v.needsUpdate)&&0!==t.length){var c=e.getRenderTarget(),l=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),p=e.state;p.setBlending(E),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(var f=0,d=t.length;f<d;f++){var m=t[f],y=m.shadow;if(void 0!==y){i.copy(y.mapSize);var b=y.getFrameExtents();if(i.multiply(b),o.copy(y.mapSize),(i.x>n||i.y>n)&&(console.warn("THREE.WebGLShadowMap:",m,"has shadow exceeding max texture size, reducing"),i.x>n&&(o.x=Math.floor(n/b.x),i.x=o.x*b.x,y.mapSize.x=o.x),i.y>n&&(o.y=Math.floor(n/b.y),i.y=o.y*b.y,y.mapSize.y=o.y)),null===y.map&&!y.isPointLightShadow&&this.type===g){var x={minFilter:Ae,magFilter:Ae,format:Xe};y.map=new Dn(i.x,i.y,x),y.map.texture.name=m.name+".shadowMap",y.mapPass=new Dn(i.x,i.y,x),y.camera.updateProjectionMatrix()}if(null===y.map){x={minFilter:_e,magFilter:_e,format:Xe};y.map=new Dn(i.x,i.y,x),y.map.texture.name=m.name+".shadowMap",y.camera.updateProjectionMatrix()}e.setRenderTarget(y.map),e.clear();for(var _=y.getViewportCount(),T=0;T<_;T++){var S=y.getViewport(T);a.set(o.x*S.x,o.y*S.y,o.x*S.z,o.y*S.w),p.viewport(a),y.updateMatrices(m,T),r=y.getFrustum(),M(s,u,y.camera,m,this.type)}y.isPointLightShadow||this.type!==g||w(y,u)}else console.warn("THREE.WebGLShadowMap:",m,"has no shadow.")}v.needsUpdate=!1,e.setRenderTarget(c,l,h)}}}function gs(e,t,n){var r=n.isWebGL2;var i=new function(){var t=!1,n=new Rn,r=null,i=new Rn(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,o,a,s){!0===s&&(t*=a,r*=a,o*=a),n.set(t,r,o,a),!1===i.equals(n)&&(e.clearColor(t,r,o,a),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},o=new function(){var t=!1,n=null,r=null,i=null;return{setTest:function(e){e?be(2929):xe(2929)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case q:e.depthFunc(512);break;case Q:e.depthFunc(519);break;case Z:e.depthFunc(513);break;case K:e.depthFunc(515);break;case J:e.depthFunc(514);break;case $:e.depthFunc(518);break;case ee:e.depthFunc(516);break;case te:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},a=new function(){var t=!1,n=null,r=null,i=null,o=null,a=null,s=null,u=null,c=null;return{setTest:function(e){t||(e?be(2960):xe(2960))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,a){r===t&&i===n&&o===a||(e.stencilFunc(t,n,a),r=t,i=n,o=a)},setOp:function(t,n,r){a===t&&s===n&&u===r||(e.stencilOp(t,n,r),a=t,s=n,u=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,i=null,o=null,a=null,s=null,u=null,c=null}}},s=e.getParameter(34921),h=new Uint8Array(s),p=new Uint8Array(s),f=new Uint8Array(s),d={},m=null,v=null,g=null,y=null,w=null,_=null,T=null,S=null,M=null,ne=!1,re=null,ie=null,oe=null,ae=null,se=null,ue=e.getParameter(35661),ce=!1,le=0,he=e.getParameter(7938);-1!==he.indexOf("WebGL")?(le=parseFloat(/^WebGL\ ([0-9])/.exec(he)[1]),ce=le>=1):-1!==he.indexOf("OpenGL ES")&&(le=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(he)[1]),ce=le>=2);var pe=null,fe={},de=new Rn,me=new Rn;function ve(t,n,r){var i=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var a=0;a<r;a++)e.texImage2D(n+a,0,6408,1,1,0,6408,5121,i);return o}var ge={};function ye(n,i){(h[n]=1,0===p[n]&&(e.enableVertexAttribArray(n),p[n]=1),f[n]!==i)&&((r?e:t.get("ANGLE_instanced_arrays"))[r?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),f[n]=i)}function be(t){!0!==d[t]&&(e.enable(t),d[t]=!0)}function xe(t){!1!==d[t]&&(e.disable(t),d[t]=!1)}ge[3553]=ve(3553,3553,1),ge[34067]=ve(34067,34069,6),i.setClear(0,0,0,1),o.setClear(1),a.setClear(0),be(2929),o.setFunc(K),Me(!1),Ee(c),be(2884),Se(E);var we={[C]:32774,[R]:32778,[D]:32779};if(r)we[N]=32775,we[F]=32776;else{var _e=t.get("EXT_blend_minmax");null!==_e&&(we[N]=_e.MIN_EXT,we[F]=_e.MAX_EXT)}var Te={[j]:0,[U]:1,[B]:768,[z]:770,[Y]:776,[W]:774,[V]:772,[k]:769,[G]:771,[X]:775,[H]:773};function Se(t,n,r,i,o,a,s,u){if(t!==E){if(v||(be(3042),v=!0),t===I)o=o||n,a=a||r,s=s||i,n===y&&o===T||(e.blendEquationSeparate(we[n],we[o]),y=n,T=o),r===w&&i===_&&a===S&&s===M||(e.blendFuncSeparate(Te[r],Te[i],Te[a],Te[s]),w=r,_=i,S=a,M=s),g=t,ne=null;else if(t!==g||u!==ne){if(y===C&&T===C||(e.blendEquation(32774),y=C,T=C),u)switch(t){case A:e.blendFuncSeparate(1,771,1,771);break;case P:e.blendFunc(1,1);break;case O:e.blendFuncSeparate(0,0,769,771);break;case L:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case A:e.blendFuncSeparate(770,771,1,771);break;case P:e.blendFunc(770,1);break;case O:e.blendFunc(0,769);break;case L:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}w=null,_=null,S=null,M=null,g=t,ne=u}}else v&&(xe(3042),v=!1)}function Me(t){re!==t&&(t?e.frontFace(2304):e.frontFace(2305),re=t)}function Ee(t){t!==u?(be(2884),t!==ie&&(t===c?e.cullFace(1029):t===l?e.cullFace(1028):e.cullFace(1032))):xe(2884),ie=t}function Ae(t,n,r){t?(be(32823),ae===n&&se===r||(e.polygonOffset(n,r),ae=n,se=r)):xe(32823)}function Pe(t){void 0===t&&(t=33984+ue-1),pe!==t&&(e.activeTexture(t),pe=t)}return{buffers:{color:i,depth:o,stencil:a},initAttributes:function(){for(var e=0,t=h.length;e<t;e++)h[e]=0},enableAttribute:function(e){ye(e,0)},enableAttributeAndDivisor:ye,disableUnusedAttributes:function(){for(var t=0,n=p.length;t!==n;++t)p[t]!==h[t]&&(e.disableVertexAttribArray(t),p[t]=0)},enable:be,disable:xe,useProgram:function(t){return m!==t&&(e.useProgram(t),m=t,!0)},setBlending:Se,setMaterial:function(e,t){e.side===x?xe(2884):be(2884);var n=e.side===b;t&&(n=!n),Me(n),e.blending===A&&!1===e.transparent?Se(E):Se(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),i.setMask(e.colorWrite);var r=e.stencilWrite;a.setTest(r),r&&(a.setMask(e.stencilWriteMask),a.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),a.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Ae(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:Me,setCullFace:Ee,setLineWidth:function(t){t!==oe&&(ce&&e.lineWidth(t),oe=t)},setPolygonOffset:Ae,setScissorTest:function(e){e?be(3089):xe(3089)},activeTexture:Pe,bindTexture:function(t,n){null===pe&&Pe();var r=fe[pe];void 0===r&&(r={type:void 0,texture:void 0},fe[pe]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||ge[t]),r.type=t,r.texture=n)},unbindTexture:function(){var t=fe[pe];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===de.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),de.copy(t))},viewport:function(t){!1===me.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),me.copy(t))},reset:function(){for(var t=0;t<p.length;t++)1===p[t]&&(e.disableVertexAttribArray(t),p[t]=0);d={},pe=null,fe={},m=null,g=null,re=null,ie=null,i.reset(),o.reset(),a.reset()}}}function ys(e,t,n,r,i,o,a){var s,u=i.isWebGL2,c=i.maxTextures,l=i.maxCubemapSize,h=i.maxTextureSize,p=i.maxSamples,f=new WeakMap,d=!1;try{d="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function m(e,t){return d?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(e,t,n,r){var i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var o=t?An.floorPowerOfTwo:Math.floor,a=o(i*e.width),u=o(i*e.height);void 0===s&&(s=m(a,u));var c=n?m(a,u):s;return c.width=a,c.height=u,c.getContext("2d").drawImage(e,0,0,a,u),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+u+")."),c}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function g(e){return An.isPowerOfTwo(e.width)&&An.isPowerOfTwo(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==_e&&e.minFilter!==Ae}function b(t,n,i,o){e.generateMipmap(t),r.get(n).__maxMipLevel=Math.log(Math.max(i,o))*Math.LOG2E}function x(n,r,i){if(!1===u)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var o=r;return 6403===r&&(5126===i&&(o=33326),5131===i&&(o=33325),5121===i&&(o=33321)),6407===r&&(5126===i&&(o=34837),5131===i&&(o=34843),5121===i&&(o=32849)),6408===r&&(5126===i&&(o=34836),5131===i&&(o=34842),5121===i&&(o=32856)),33325===o||33326===o||34842===o||34836===o?t.get("EXT_color_buffer_float"):34843!==o&&34837!==o||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),o}function w(e){return e===_e||e===Te||e===Me?9728:9729}function _(t){var n=t.target;n.removeEventListener("dispose",_),function(t){var n=r.get(t);if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture),r.remove(t)}(n),n.isVideoTexture&&f.delete(n),a.memory.textures--}function T(t){var n=t.target;n.removeEventListener("dispose",T),function(t){var n=r.get(t),i=r.get(t.texture);if(!t)return;void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(var o=0;o<6;o++)e.deleteFramebuffer(n.__webglFramebuffer[o]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[o]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer);if(t.isWebGLMultiviewRenderTarget){e.deleteTexture(n.__webglColorTexture),e.deleteTexture(n.__webglDepthStencilTexture),a.memory.textures-=2;o=0;for(var s=n.__webglViewFramebuffers.length;o<s;o++)e.deleteFramebuffer(n.__webglViewFramebuffers[o])}r.remove(t.texture),r.remove(t)}(n),a.memory.textures--}var S=0;function M(e,t){var i=r.get(e);if(e.isVideoTexture&&function(e){var t=a.render.frame;f.get(e)!==t&&(f.set(e,t),e.update())}(e),e.version>0&&i.__version!==e.version){var o=e.image;if(void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==o.complete)return void C(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,i.__webglTexture)}function E(t,i){if(6===t.image.length){var a=r.get(t);if(t.version>0&&a.__version!==t.version){I(a,t),n.activeTexture(33984+i),n.bindTexture(34067,a.__webglTexture),e.pixelStorei(37440,t.flipY);for(var s=t&&(t.isCompressedTexture||t.image[0].isCompressedTexture),c=t.image[0]&&t.image[0].isDataTexture,h=[],p=0;p<6;p++)h[p]=s||c?c?t.image[p].image:t.image[p]:v(t.image[p],!1,!0,l);var f,d=h[0],m=g(d)||u,w=o.convert(t.format),_=o.convert(t.type),T=x(t.internalFormat,w,_);if(L(34067,t,m),s){for(p=0;p<6;p++){f=h[p].mipmaps;for(var S=0;S<f.length;S++){var M=f[S];t.format!==Xe&&t.format!==We?null!==w?n.compressedTexImage2D(34069+p,S,T,M.width,M.height,0,M.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+p,S,T,M.width,M.height,0,w,_,M.data)}}a.__maxMipLevel=f.length-1}else{f=t.mipmaps;for(p=0;p<6;p++)if(c){n.texImage2D(34069+p,0,T,h[p].width,h[p].height,0,w,_,h[p].data);for(S=0;S<f.length;S++){var E=(M=f[S]).image[p].image;n.texImage2D(34069+p,S+1,T,E.width,E.height,0,w,_,E.data)}}else{n.texImage2D(34069+p,0,T,w,_,h[p]);for(S=0;S<f.length;S++){M=f[S];n.texImage2D(34069+p,S+1,T,w,_,M.image[p])}}a.__maxMipLevel=f.length}y(t,m)&&b(34067,t,d.width,d.height),a.__version=t.version,t.onUpdate&&t.onUpdate(t)}else n.activeTexture(33984+i),n.bindTexture(34067,a.__webglTexture)}}function A(e,t){n.activeTexture(33984+t),n.bindTexture(34067,r.get(e).__webglTexture)}var P={[be]:10497,[xe]:33071,[we]:33648},O={[_e]:9728,[Te]:9984,[Me]:9986,[Ae]:9729,[Pe]:9985,[Le]:9987};function L(n,o,a){a?(e.texParameteri(n,10242,P[o.wrapS]),e.texParameteri(n,10243,P[o.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,P[o.wrapR]),e.texParameteri(n,10240,O[o.magFilter]),e.texParameteri(n,10241,O[o.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),o.wrapS===xe&&o.wrapT===xe||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,w(o.magFilter)),e.texParameteri(n,10241,w(o.minFilter)),o.minFilter!==_e&&o.minFilter!==Ae&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var s=t.get("EXT_texture_filter_anisotropic");if(s){if(o.type===Ue&&null===t.get("OES_texture_float_linear"))return;if(o.type===Be&&null===(u||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function I(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",_),t.__webglTexture=e.createTexture(),a.memory.textures++)}function C(t,r,i){var a=3553;r.isDataTexture2DArray&&(a=35866),r.isDataTexture3D&&(a=32879),I(t,r),n.activeTexture(33984+i),n.bindTexture(a,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment);var s=function(e){return!u&&(e.wrapS!==xe||e.wrapT!==xe||e.minFilter!==_e&&e.minFilter!==Ae)}(r)&&!1===g(r.image),c=v(r.image,s,!1,h),l=g(c)||u,p=o.convert(r.format),f=o.convert(r.type),d=x(r.internalFormat,p,f);L(a,r,l);var m,w=r.mipmaps;if(r.isDepthTexture){if(d=6402,r.type===Ue){if(!1===u)throw new Error("Float Depth Texture only supported in WebGL2.0");d=36012}else u&&(d=33189);r.format===Ze&&6402===d&&r.type!==Ne&&r.type!==je&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Ne,f=o.convert(r.type)),r.format===Ke&&(d=34041,r.type!==Ve&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Ve,f=o.convert(r.type))),n.texImage2D(3553,0,d,c.width,c.height,0,p,f,null)}else if(r.isDataTexture)if(w.length>0&&l){for(var _=0,T=w.length;_<T;_++)m=w[_],n.texImage2D(3553,_,d,m.width,m.height,0,p,f,m.data);r.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,d,c.width,c.height,0,p,f,c.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(_=0,T=w.length;_<T;_++)m=w[_],r.format!==Xe&&r.format!==We?null!==p?n.compressedTexImage2D(3553,_,d,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,_,d,m.width,m.height,0,p,f,m.data);t.__maxMipLevel=w.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,d,c.width,c.height,c.depth,0,p,f,c.data),t.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,d,c.width,c.height,c.depth,0,p,f,c.data),t.__maxMipLevel=0;else if(w.length>0&&l){for(_=0,T=w.length;_<T;_++)m=w[_],n.texImage2D(3553,_,d,p,f,m);r.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,d,p,f,c),t.__maxMipLevel=0;y(r,l)&&b(a,r,c.width,c.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function R(t,i,a,s){var u=o.convert(i.texture.format),c=o.convert(i.texture.type),l=x(i.texture.internalFormat,u,c);n.texImage2D(s,0,l,i.width,i.height,0,u,c,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,s,r.get(i.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function D(t,n,r){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){if(r){var i=F(n);e.renderbufferStorageMultisample(36161,i,33189,n.width,n.height)}else e.renderbufferStorage(36161,33189,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(r){i=F(n);e.renderbufferStorageMultisample(36161,i,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{var a=o.convert(n.texture.format),s=o.convert(n.texture.type),u=x(n.texture.internalFormat,a,s);if(r){i=F(n);e.renderbufferStorageMultisample(36161,i,u,n.width,n.height)}else e.renderbufferStorage(36161,u,n.width,n.height)}e.bindRenderbuffer(36161,null)}function N(t){var n=r.get(t),i=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),M(n.depthTexture,0);var i=r.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===Ze)e.framebufferTexture2D(36160,36096,3553,i,0);else{if(n.depthTexture.format!==Ke)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,i,0)}}(n.__webglFramebuffer,t)}else if(i){n.__webglDepthbuffer=[];for(var o=0;o<6;o++)e.bindFramebuffer(36160,n.__webglFramebuffer[o]),n.__webglDepthbuffer[o]=e.createRenderbuffer(),D(n.__webglDepthbuffer[o],t)}else e.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),D(n.__webglDepthbuffer,t);e.bindFramebuffer(36160,null)}function F(e){return u&&e.isWebGLMultisampleRenderTarget?Math.min(p,e.samples):0}var j=!1,U=!1;this.allocateTextureUnit=function(){var e=S;return e>=c&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+c),S+=1,e},this.resetTextureUnits=function(){S=0},this.setTexture2D=M,this.setTexture2DArray=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?C(i,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?C(i,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=E,this.setTextureCubeDynamic=A,this.setupRenderTarget=function(i){var s=r.get(i),c=r.get(i.texture);i.addEventListener("dispose",T),c.__webglTexture=e.createTexture(),a.memory.textures++;var l=!0===i.isWebGLCubeRenderTarget,h=!0===i.isWebGLMultisampleRenderTarget,p=!0===i.isWebGLMultiviewRenderTarget,f=g(i)||u;if(l){s.__webglFramebuffer=[];for(var d=0;d<6;d++)s.__webglFramebuffer[d]=e.createFramebuffer()}else if(s.__webglFramebuffer=e.createFramebuffer(),h)if(u){s.__webglMultisampledFramebuffer=e.createFramebuffer(),s.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,s.__webglColorRenderbuffer);var m=o.convert(i.texture.format),v=o.convert(i.texture.type),w=x(i.texture.internalFormat,m,v),_=F(i);e.renderbufferStorageMultisample(36161,_,w,i.width,i.height),e.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),i.depthBuffer&&(s.__webglDepthRenderbuffer=e.createRenderbuffer(),D(s.__webglDepthRenderbuffer,i,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");else if(p){var S=i.width,M=i.height,E=i.numViews;e.bindFramebuffer(36160,s.__webglFramebuffer);var A=t.get("OVR_multiview2");a.memory.textures+=2;var P=e.createTexture();e.bindTexture(35866,P),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,32856,S,M,E,0,6408,5121,null),A.framebufferTextureMultiviewOVR(36160,36064,P,0,0,E);var O=e.createTexture();e.bindTexture(35866,O),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,35056,S,M,E,0,34041,34042,null),A.framebufferTextureMultiviewOVR(36160,33306,O,0,0,E);var I=new Array(E);for(d=0;d<E;++d)I[d]=e.createFramebuffer(),e.bindFramebuffer(36160,I[d]),e.framebufferTextureLayer(36160,36064,P,0,d);s.__webglColorTexture=P,s.__webglDepthStencilTexture=O,s.__webglViewFramebuffers=I,e.bindFramebuffer(36160,null),e.bindTexture(35866,null)}if(l){n.bindTexture(34067,c.__webglTexture),L(34067,i.texture,f);for(d=0;d<6;d++)R(s.__webglFramebuffer[d],i,36064,34069+d);y(i.texture,f)&&b(34067,i.texture,i.width,i.height),n.bindTexture(34067,null)}else p||(n.bindTexture(3553,c.__webglTexture),L(3553,i.texture,f),R(s.__webglFramebuffer,i,36064,3553),y(i.texture,f)&&b(3553,i.texture,i.width,i.height),n.bindTexture(3553,null));i.depthBuffer&&N(i)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(y(t,g(e)||u)){var i=e.isWebGLCubeRenderTarget?34067:3553,o=r.get(t).__webglTexture;n.bindTexture(i,o),b(i,t,e.width,e.height),n.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(u){var n=r.get(t);e.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,n.__webglFramebuffer);var i=t.width,o=t.height,a=16384;t.depthBuffer&&(a|=256),t.stencilBuffer&&(a|=1024),e.blitFramebuffer(0,0,i,o,0,0,i,o,a,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===j&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),j=!0),e=e.texture),M(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===U&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),U=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?E(e,t):A(e,t)}}function bs(e,t,n){var r=n.isWebGL2;return{convert:function(e){var n;if(e===Ce)return 5121;if(e===ke)return 32819;if(e===ze)return 32820;if(e===Ge)return 33635;if(e===Re)return 5120;if(e===De)return 5122;if(e===Ne)return 5123;if(e===Fe)return 5124;if(e===je)return 5125;if(e===Ue)return 5126;if(e===Be)return r?5131:null!==(n=t.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(e===He)return 6406;if(e===We)return 6407;if(e===Xe)return 6408;if(e===Ye)return 6409;if(e===qe)return 6410;if(e===Ze)return 6402;if(e===Ke)return 34041;if(e===Je)return 6403;if(e===$e)return 36244;if(e===et)return 33319;if(e===tt)return 33320;if(e===nt)return 36248;if(e===rt)return 36249;if(e===it||e===ot||e===at||e===st){if(null===(n=t.get("WEBGL_compressed_texture_s3tc")))return null;if(e===it)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===ot)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===at)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===st)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===ut||e===ct||e===lt||e===ht){if(null===(n=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(e===ut)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===ct)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===lt)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===ht)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}return e===pt?null!==(n=t.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null:e===ft||e===dt||e===mt||e===vt||e===gt||e===yt||e===bt||e===xt||e===wt||e===_t||e===Tt||e===St||e===Mt||e===Et?null!==(n=t.get("WEBGL_compressed_texture_astc"))?e:null:e===Ve?r?34042:null!==(n=t.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function xs(e,t,n,r){Dn.call(this,e,t,r),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=n}function ws(e,t){var n,r,i,o,a,s,u,c=2,l=e.extensions,h=e.properties,p=0;function f(e){return e.isArrayCamera?e.cameras:(a[0]=e,a)}this.isAvailable=function(){if(void 0===u){var e=l.get("OVR_multiview2");if(u=null!==e&&!1===t.getContextAttributes().antialias){p=t.getParameter(e.MAX_VIEWS_OVR),n=new xs(0,0,c),s=new Pn,o=[],i=[],a=[];for(var r=0;r<p;r++)o[r]=new Yn,i[r]=new On}}return u},this.attachCamera=function(t){!1!==function(e){if(void 0===e.isArrayCamera)return!0;var t=e.cameras;if(t.length>p)return!1;for(var n=1,r=t.length;n<r;n++)if(t[0].viewport.z!==t[n].viewport.z||t[0].viewport.w!==t[n].viewport.w)return!1;return!0}(t)&&(r=e.getRenderTarget(),function(t){if(r?s.set(r.width,r.height):e.getDrawingBufferSize(s),t.isArrayCamera){var i=t.cameras[0].viewport;n.setSize(i.z,i.w),n.setNumViews(t.cameras.length)}else n.setSize(s.x,s.y),n.setNumViews(c)}(t),e.setRenderTarget(n))},this.detachCamera=function(i){n===e.getRenderTarget()&&(e.setRenderTarget(r),function(e){var r=n,i=r.numViews,o=h.get(r).__webglViewFramebuffers,a=r.width,u=r.height;if(e.isArrayCamera)for(var c=0;c<i;c++){var l=e.cameras[c].viewport,p=l.x,f=l.y,d=p+l.z,m=f+l.w;t.bindFramebuffer(36008,o[c]),t.blitFramebuffer(0,0,a,u,p,f,d,m,16384,9728)}else t.bindFramebuffer(36008,o[0]),t.blitFramebuffer(0,0,a,u,0,0,s.x,s.y,16384,9728)}(i))},this.updateCameraProjectionMatricesUniform=function(e,n){for(var r=f(e),i=0;i<r.length;i++)o[i].copy(r[i].projectionMatrix);n.setValue(t,"projectionMatrices",o)},this.updateCameraViewMatricesUniform=function(e,n){for(var r=f(e),i=0;i<r.length;i++)o[i].copy(r[i].matrixWorldInverse);n.setValue(t,"viewMatrices",o)},this.updateObjectMatricesUniforms=function(e,n,r){for(var a=f(n),s=0;s<a.length;s++)o[s].multiplyMatrices(a[s].matrixWorldInverse,e.matrixWorld),i[s].getNormalMatrix(o[s]);r.setValue(t,"modelViewMatrices",o),r.setValue(t,"normalMatrices",i)}}function _s(e){ho.call(this),this.cameras=e||[]}function Ts(){hr.call(this),this.type="Group"}function Ss(e,t){var n=this,r=null,i=null,o="local-floor",a=null,s=[],u=new Map,c=new ho;c.layers.enable(1),c.viewport=new Rn;var l=new ho;l.layers.enable(2),l.viewport=new Rn;var h=new _s([c,l]);h.layers.enable(1),h.layers.enable(2);var p=null,f=null;function d(e){var t=u.get(e.inputSource);t&&(t.targetRay&&t.targetRay.dispatchEvent({type:e.type}),t.grip&&t.grip.dispatchEvent({type:e.type}))}function m(){u.forEach((function(e,t){e.targetRay&&(e.targetRay.dispatchEvent({type:"disconnected",data:t}),e.targetRay.visible=!1),e.grip&&(e.grip.dispatchEvent({type:"disconnected",data:t}),e.grip.visible=!1)})),u.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),_.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function v(e){i=e,_.setContext(r),_.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}function g(e){for(var t=r.inputSources,n=0;n<s.length;n++)u.set(t[n],s[n]);for(n=0;n<e.removed.length;n++){var i=e.removed[n];(o=u.get(i))&&(o.targetRay&&o.targetRay.dispatchEvent({type:"disconnected",data:i}),o.grip&&o.grip.dispatchEvent({type:"disconnected",data:i}),u.delete(i))}for(n=0;n<e.added.length;n++){var o;i=e.added[n];(o=u.get(i))&&(o.targetRay&&o.targetRay.dispatchEvent({type:"connected",data:i}),o.grip&&o.grip.dispatchEvent({type:"connected",data:i}))}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){var t=s[e];return void 0===t&&(t={},s[e]=t),void 0===t.targetRay&&(t.targetRay=new Ts,t.targetRay.matrixAutoUpdate=!1,t.targetRay.visible=!1),t.targetRay},this.getControllerGrip=function(e){var t=s[e];return void 0===t&&(t={},s[e]=t),void 0===t.grip&&(t.grip=new Ts,t.grip.matrixAutoUpdate=!1,t.grip.visible=!1),t.grip},this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(e){o=e},this.getReferenceSpace=function(){return i},this.getSession=function(){return r},this.setSession=function(e){if(null!==(r=e)){r.addEventListener("select",d),r.addEventListener("selectstart",d),r.addEventListener("selectend",d),r.addEventListener("squeeze",d),r.addEventListener("squeezestart",d),r.addEventListener("squeezeend",d),r.addEventListener("end",m);var n=t.getContextAttributes(),i={antialias:n.antialias,alpha:n.alpha,depth:n.depth,stencil:n.stencil},a=new XRWebGLLayer(r,t,i);r.updateRenderState({baseLayer:a}),r.requestReferenceSpace(o).then(v),r.addEventListener("inputsourceschange",g)}};var y=new Bn,b=new Bn;function x(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}this.getCamera=function(e){h.near=l.near=c.near=e.near,h.far=l.far=c.far=e.far,p===h.near&&f===h.far||(r.updateRenderState({depthNear:h.near,depthFar:h.far}),p=h.near,f=h.far);var t=e.parent,n=h.cameras;x(h,t);for(var i=0;i<n.length;i++)x(n[i],t);e.matrixWorld.copy(h.matrixWorld);for(var o=e.children,a=(i=0,o.length);i<a;i++)o[i].updateMatrixWorld(!0);return function(e,t,n){y.setFromMatrixPosition(t.matrixWorld),b.setFromMatrixPosition(n.matrixWorld);var r=y.distanceTo(b),i=t.projectionMatrix.elements,o=n.projectionMatrix.elements,a=i[14]/(i[10]-1),s=i[14]/(i[10]+1),u=(i[9]+1)/i[5],c=(i[9]-1)/i[5],l=(i[8]-1)/i[0],h=(o[8]+1)/o[0],p=a*l,f=a*h,d=r/(-l+h),m=d*-l;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(d),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var v=a+d,g=s+d,x=p-m,w=f+(r-m),_=u*s/g*v,T=c*s/g*v;e.projectionMatrix.makePerspective(x,w,_,T,v,g)}(h,c,l),h};var w=null;var _=new _o;_.setAnimationLoop((function(t,n){if(null!==(a=n.getViewerPose(i))){var o=a.views,u=r.renderState.baseLayer;e.setFramebuffer(u.framebuffer);for(var c=0;c<o.length;c++){var l=o[c],p=u.getViewport(l),f=h.cameras[c];f.matrix.fromArray(l.transform.matrix),f.projectionMatrix.fromArray(l.projectionMatrix),f.viewport.set(p.x,p.y,p.width,p.height),0===c&&h.matrix.copy(f.matrix)}}var d=r.inputSources;for(c=0;c<s.length;c++){var m=s[c],v=d[c],g=null,y=null;v&&(m.targetRay&&null!==(g=n.getPose(v.targetRaySpace,i))&&(m.targetRay.matrix.fromArray(g.transform.matrix),m.targetRay.matrix.decompose(m.targetRay.position,m.targetRay.rotation,m.targetRay.scale)),m.grip&&v.gripSpace&&null!==(y=n.getPose(v.gripSpace,i))&&(m.grip.matrix.fromArray(y.transform.matrix),m.grip.matrix.decompose(m.grip.position,m.grip.rotation,m.grip.scale))),m.targetRay&&(m.targetRay.visible=null!==g),m.grip&&(m.grip.visible=null!==y)}w&&w(t,n)})),this.setAnimationLoop=function(e){w=e},this.dispose=function(){}}function Ms(e){var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,u=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",l=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,h=null,p=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Bt,this.physicallyCorrectLights=!1,this.toneMapping=ae,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var f,d,m,v,g,y,x,w,_,T,S,M,E,A,P,O,L,I,C=this,R=!1,D=null,N=0,F=0,j=null,U=null,B=-1,k={geometry:null,program:null,wireframe:!1},z=null,G=null,V=new Rn,H=new Rn,W=null,X=t.width,Y=t.height,q=1,Q=null,Z=null,K=new Rn(0,0,X,Y),J=new Rn(0,0,X,Y),$=!1,ee=new xo,te=new Io,ne=!1,re=!1,ie=new Yn,oe=new Bn;function se(){return null===j?q:1}try{var ue={alpha:r,depth:i,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:u,powerPreference:c,failIfMajorPerformanceCaveat:l,xrCompatible:!0};if(t.addEventListener("webglcontextlost",fe,!1),t.addEventListener("webglcontextrestored",de,!1),null===(f=n||t.getContext("webgl",ue)||t.getContext("experimental-webgl",ue)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===f.getShaderPrecisionFormat&&(f.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ce(){d=new Co(f),!1===(m=new Lo(f,d,e)).isWebGL2&&(d.get("WEBGL_depth_texture"),d.get("OES_texture_float"),d.get("OES_texture_half_float"),d.get("OES_texture_half_float_linear"),d.get("OES_standard_derivatives"),d.get("OES_element_index_uint"),d.get("ANGLE_instanced_arrays")),d.get("OES_texture_float_linear"),I=new bs(f,d,m),(v=new gs(f,d,m)).scissor(H.copy(J).multiplyScalar(q).floor()),v.viewport(V.copy(K).multiplyScalar(q).floor()),g=new No(f),y=new ts,x=new ys(f,d,v,y,m,I,g),w=new To(f,m),_=new Ro(f,w,g),T=new Uo(f,_,w,g),P=new jo(f),S=new es(C,d,m),M=new os,E=new hs,A=new Po(C,v,T,s),O=new Oo(f,d,g,m),L=new Do(f,d,g,m),g.programs=S.programs,C.capabilities=m,C.extensions=d,C.properties=y,C.renderLists=M,C.state=v,C.info=g}ce();var le=new Ss(C,f);this.xr=le;var he=new ws(C,f),pe=new vs(C,T,m.maxTextureSize);function fe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),R=!0}function de(){console.log("THREE.WebGLRenderer: Context Restored."),R=!1,ce()}function me(e){var t=e.target;t.removeEventListener("dispose",me),function(e){ve(e),y.remove(e)}(t)}function ve(e){var t=y.get(e).program;e.program=void 0,void 0!==t&&S.releaseProgram(t)}this.shadowMap=pe,this.getContext=function(){return f},this.getContextAttributes=function(){return f.getContextAttributes()},this.forceContextLoss=function(){var e=d.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=d.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return q},this.setPixelRatio=function(e){void 0!==e&&(q=e,this.setSize(X,Y,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new Pn),e.set(X,Y)},this.setSize=function(e,n,r){le.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(X=e,Y=n,t.width=Math.floor(e*q),t.height=Math.floor(n*q),!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new Pn),e.set(X*q,Y*q).floor()},this.setDrawingBufferSize=function(e,n,r){X=e,Y=n,q=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new Rn),e.copy(V)},this.getViewport=function(e){return e.copy(K)},this.setViewport=function(e,t,n,r){e.isVector4?K.set(e.x,e.y,e.z,e.w):K.set(e,t,n,r),v.viewport(V.copy(K).multiplyScalar(q).floor())},this.getScissor=function(e){return e.copy(J)},this.setScissor=function(e,t,n,r){e.isVector4?J.set(e.x,e.y,e.z,e.w):J.set(e,t,n,r),v.scissor(H.copy(J).multiplyScalar(q).floor())},this.getScissorTest=function(){return $},this.setScissorTest=function(e){v.setScissorTest($=e)},this.setOpaqueSort=function(e){Q=e},this.setTransparentSort=function(e){Z=e},this.getClearColor=function(){return A.getClearColor()},this.setClearColor=function(){A.setClearColor.apply(A,arguments)},this.getClearAlpha=function(){return A.getClearAlpha()},this.setClearAlpha=function(){A.setClearAlpha.apply(A,arguments)},this.clear=function(e,t,n){var r=0;(void 0===e||e)&&(r|=16384),(void 0===t||t)&&(r|=256),(void 0===n||n)&&(r|=1024),f.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",fe,!1),t.removeEventListener("webglcontextrestored",de,!1),M.dispose(),E.dispose(),y.dispose(),T.dispose(),le.dispose(),be.stop()},this.renderBufferImmediate=function(e,t){v.initAttributes();var n=y.get(e);e.hasPositions&&!n.position&&(n.position=f.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=f.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=f.createBuffer()),e.hasColors&&!n.color&&(n.color=f.createBuffer());var r=t.getAttributes();e.hasPositions&&(f.bindBuffer(34962,n.position),f.bufferData(34962,e.positionArray,35048),v.enableAttribute(r.position),f.vertexAttribPointer(r.position,3,5126,!1,0,0)),e.hasNormals&&(f.bindBuffer(34962,n.normal),f.bufferData(34962,e.normalArray,35048),v.enableAttribute(r.normal),f.vertexAttribPointer(r.normal,3,5126,!1,0,0)),e.hasUvs&&(f.bindBuffer(34962,n.uv),f.bufferData(34962,e.uvArray,35048),v.enableAttribute(r.uv),f.vertexAttribPointer(r.uv,2,5126,!1,0,0)),e.hasColors&&(f.bindBuffer(34962,n.color),f.bufferData(34962,e.colorArray,35048),v.enableAttribute(r.color),f.vertexAttribPointer(r.color,3,5126,!1,0,0)),v.disableUnusedAttributes(),f.drawArrays(4,0,e.count),e.count=0};var ge=new pr;this.renderBufferDirect=function(e,t,n,r,i,o){null===t&&(t=ge);var a=i.isMesh&&i.matrixWorld.determinant()<0,s=Se(e,t,r,i);v.setMaterial(r,a);var u=!1;k.geometry===n.id&&k.program===s.id&&k.wireframe===(!0===r.wireframe)||(k.geometry=n.id,k.program=s.id,k.wireframe=!0===r.wireframe,u=!0),(r.morphTargets||r.morphNormals)&&(P.update(i,n,r,s),u=!0);var c=n.index,l=n.attributes.position;if(null===c){if(void 0===l||0===l.count)return}else if(0===c.count)return;var h,p=1;!0===r.wireframe&&(c=_.getWireframeAttribute(n),p=2);var g=O;null!==c&&(h=w.get(c),(g=L).setIndex(h)),u&&(!function(e,t,n,r){if(!1===m.isWebGL2&&(e.isInstancedMesh||t.isInstancedBufferGeometry)&&null===d.get("ANGLE_instanced_arrays"))return;v.initAttributes();var i=t.attributes,o=r.getAttributes(),a=n.defaultAttributeValues;for(var s in o){var u=o[s];if(u>=0){var c=i[s];if(void 0!==c){var l=c.normalized,h=c.itemSize;if(void 0===(T=w.get(c)))continue;var p=T.buffer,g=T.type,y=T.bytesPerElement;if(c.isInterleavedBufferAttribute){var b=c.data,x=b.stride,_=c.offset;b&&b.isInstancedInterleavedBuffer?(v.enableAttributeAndDivisor(u,b.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=b.meshPerAttribute*b.count)):v.enableAttribute(u),f.bindBuffer(34962,p),f.vertexAttribPointer(u,h,g,l,x*y,_*y)}else c.isInstancedBufferAttribute?(v.enableAttributeAndDivisor(u,c.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=c.meshPerAttribute*c.count)):v.enableAttribute(u),f.bindBuffer(34962,p),f.vertexAttribPointer(u,h,g,l,0,0)}else if("instanceMatrix"===s){var T;if(void 0===(T=w.get(e.instanceMatrix)))continue;p=T.buffer,g=T.type;v.enableAttributeAndDivisor(u+0,1),v.enableAttributeAndDivisor(u+1,1),v.enableAttributeAndDivisor(u+2,1),v.enableAttributeAndDivisor(u+3,1),f.bindBuffer(34962,p),f.vertexAttribPointer(u+0,4,g,!1,64,0),f.vertexAttribPointer(u+1,4,g,!1,64,16),f.vertexAttribPointer(u+2,4,g,!1,64,32),f.vertexAttribPointer(u+3,4,g,!1,64,48)}else if(void 0!==a){var S=a[s];if(void 0!==S)switch(S.length){case 2:f.vertexAttrib2fv(u,S);break;case 3:f.vertexAttrib3fv(u,S);break;case 4:f.vertexAttrib4fv(u,S);break;default:f.vertexAttrib1fv(u,S)}}}}v.disableUnusedAttributes()}(i,n,r,s),null!==c&&f.bindBuffer(34963,h.buffer));var y=null!==c?c.count:l.count,b=n.drawRange.start*p,x=n.drawRange.count*p,T=null!==o?o.start*p:0,S=null!==o?o.count*p:1/0,M=Math.max(b,T),E=Math.min(y,b+x,T+S)-1,A=Math.max(0,E-M+1);if(0!==A){if(i.isMesh)!0===r.wireframe?(v.setLineWidth(r.wireframeLinewidth*se()),g.setMode(1)):g.setMode(4);else if(i.isLine){var I=r.linewidth;void 0===I&&(I=1),v.setLineWidth(I*se()),i.isLineSegments?g.setMode(1):i.isLineLoop?g.setMode(2):g.setMode(3)}else i.isPoints?g.setMode(0):i.isSprite&&g.setMode(4);i.isInstancedMesh?g.renderInstances(n,M,A,i.count):n.isInstancedBufferGeometry?g.renderInstances(n,M,A,n.maxInstancedCount):g.render(M,A)}},this.compile=function(e,t){(p=E.get(e,t)).init(),e.traverse((function(e){e.isLight&&(p.pushLight(e),e.castShadow&&p.pushShadow(e))})),p.setupLights(t);var n={};e.traverse((function(t){if(t.material)if(Array.isArray(t.material))for(var r=0;r<t.material.length;r++)t.material[r].uuid in n==!1&&(Te(t.material[r],e,t),n[t.material[r].uuid]=!0);else t.material.uuid in n==!1&&(Te(t.material,e,t),n[t.material.uuid]=!0)}))};var ye=null;var be=new _o;function xe(e,t,n,r){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)p.pushLight(e),e.castShadow&&p.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||ee.intersectsSprite(e)){r&&oe.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ie);var i=T.update(e);(o=e.material).visible&&h.push(e,i,o,n,oe.z,null)}}else if(e.isImmediateRenderObject)r&&oe.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ie),h.push(e,null,e.material,n,oe.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==g.render.frame&&(e.skeleton.update(),e.skeleton.frame=g.render.frame),!e.frustumCulled||ee.intersectsObject(e))){r&&oe.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ie);i=T.update(e);var o=e.material;if(Array.isArray(o))for(var a=i.groups,s=0,u=a.length;s<u;s++){var c=a[s],l=o[c.materialIndex];l&&l.visible&&h.push(e,i,l,n,oe.z,c)}else o.visible&&h.push(e,i,o,n,oe.z,null)}var f=e.children;for(s=0,u=f.length;s<u;s++)xe(f[s],t,n,r)}}function we(e,t,n,r){for(var i=0,o=e.length;i<o;i++){var a=e[i],s=a.object,u=a.geometry,c=void 0===r?a.material:r,l=a.group;if(n.isArrayCamera)if(G=n,le.enabled&&he.isAvailable())_e(s,t,n,u,c,l);else for(var h=n.cameras,f=0,d=h.length;f<d;f++){var m=h[f];s.layers.test(m.layers)&&(v.viewport(V.copy(m.viewport)),p.setupLights(m),_e(s,t,m,u,c,l))}else G=null,_e(s,t,n,u,c,l)}}function _e(e,t,n,r,i,o){if(e.onBeforeRender(C,t,n,r,i,o),p=E.get(t,G||n),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var a=Se(n,t,i,e);v.setMaterial(i),k.geometry=null,k.program=null,k.wireframe=!1,function(e,t){e.render((function(e){C.renderBufferImmediate(e,t)}))}(e,a)}else C.renderBufferDirect(n,t,r,i,e,o);e.onAfterRender(C,t,n,r,i,o),p=E.get(t,G||n)}function Te(e,t,n){var r=y.get(e),i=p.state.lights,o=p.state.shadowsArray,a=i.state.version,s=S.getParameters(e,i.state,o,t,te.numPlanes,te.numIntersection,n),u=S.getProgramCacheKey(s),c=r.program,l=!0;if(void 0===c)e.addEventListener("dispose",me);else if(c.cacheKey!==u)ve(e);else if(r.lightsStateVersion!==a)r.lightsStateVersion=a,l=!1;else{if(void 0!==s.shaderID)return;l=!1}l&&(c=S.acquireProgram(s,u),r.program=c,r.uniforms=s.uniforms,r.environment=e.isMeshStandardMaterial?t.environment:null,r.outputEncoding=C.outputEncoding,e.program=c);var h=c.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var f=0;f<C.maxMorphTargets;f++)h["morphTarget"+f]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(f=0;f<C.maxMorphNormals;f++)h["morphNormal"+f]>=0&&e.numSupportedMorphNormals++}var d=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=te.numPlanes,r.numIntersection=te.numIntersection,d.clippingPlanes=te.uniform),r.fog=t.fog,r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=a,r.needsLights&&(d.ambientLightColor.value=i.state.ambient,d.lightProbe.value=i.state.probe,d.directionalLights.value=i.state.directional,d.spotLights.value=i.state.spot,d.rectAreaLights.value=i.state.rectArea,d.pointLights.value=i.state.point,d.hemisphereLights.value=i.state.hemi,d.directionalShadowMap.value=i.state.directionalShadowMap,d.directionalShadowMatrix.value=i.state.directionalShadowMatrix,d.spotShadowMap.value=i.state.spotShadowMap,d.spotShadowMatrix.value=i.state.spotShadowMatrix,d.pointShadowMap.value=i.state.pointShadowMap,d.pointShadowMatrix.value=i.state.pointShadowMatrix);var m=r.program.getUniforms(),v=Fa.seqWithValue(m.seq,d);r.uniformsList=v}function Se(e,t,n,r){x.resetTextureUnits();var i=t.fog,o=n.isMeshStandardMaterial?t.environment:null,a=y.get(n),s=p.state.lights;if(ne&&(re||e!==z)){var u=e===z&&n.id===B;te.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,e,a,u)}n.version===a.__version?void 0===a.program?Te(n,t,r):n.fog&&a.fog!==i?Te(n,t,r):a.environment!==o?Te(n,t,r):a.needsLights&&a.lightsStateVersion!==s.state.version?Te(n,t,r):void 0===a.numClippingPlanes||a.numClippingPlanes===te.numPlanes&&a.numIntersection===te.numIntersection?a.outputEncoding!==C.outputEncoding&&Te(n,t,r):Te(n,t,r):(Te(n,t,r),a.__version=n.version);var c,l,h=!1,d=!1,g=!1,w=a.program,_=w.getUniforms(),T=a.uniforms;if(v.useProgram(w.program)&&(h=!0,d=!0,g=!0),n.id!==B&&(B=n.id,d=!0),h||z!==e){if(w.numMultiviewViews>0?he.updateCameraProjectionMatricesUniform(e,_):_.setValue(f,"projectionMatrix",e.projectionMatrix),m.logarithmicDepthBuffer&&_.setValue(f,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),z!==e&&(z=e,d=!0,g=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){var S=_.map.cameraPosition;void 0!==S&&S.setValue(f,oe.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&_.setValue(f,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.skinning)&&(w.numMultiviewViews>0?he.updateCameraViewMatricesUniform(e,_):_.setValue(f,"viewMatrix",e.matrixWorldInverse))}if(n.skinning){_.setOptional(f,r,"bindMatrix"),_.setOptional(f,r,"bindMatrixInverse");var M=r.skeleton;if(M){var E=M.bones;if(m.floatVertexTextures){if(void 0===M.boneTexture){var A=Math.sqrt(4*E.length);A=An.ceilPowerOfTwo(A),A=Math.max(A,4);var P=new Float32Array(A*A*4);P.set(M.boneMatrices);var O=new go(P,A,A,Xe,Ue);M.boneMatrices=P,M.boneTexture=O,M.boneTextureSize=A}_.setValue(f,"boneTexture",M.boneTexture,x),_.setValue(f,"boneTextureSize",M.boneTextureSize)}else _.setOptional(f,M,"boneMatrices")}}return(d||a.receiveShadow!==r.receiveShadow)&&(a.receiveShadow=r.receiveShadow,_.setValue(f,"receiveShadow",r.receiveShadow)),d&&(_.setValue(f,"toneMappingExposure",C.toneMappingExposure),_.setValue(f,"toneMappingWhitePoint",C.toneMappingWhitePoint),a.needsLights&&(l=g,(c=T).ambientLightColor.needsUpdate=l,c.lightProbe.needsUpdate=l,c.directionalLights.needsUpdate=l,c.pointLights.needsUpdate=l,c.spotLights.needsUpdate=l,c.rectAreaLights.needsUpdate=l,c.hemisphereLights.needsUpdate=l),i&&n.fog&&function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(T,i),n.isMeshBasicMaterial?Me(T,n):n.isMeshLambertMaterial?(Me(T,n),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(T,n)):n.isMeshToonMaterial?(Me(T,n),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===b&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===b&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(T,n)):n.isMeshPhongMaterial?(Me(T,n),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===b&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===b&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(T,n)):n.isMeshStandardMaterial?(Me(T,n,o),n.isMeshPhysicalMaterial?function(e,t,n){Ee(e,t,n),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===b&&e.clearcoatNormalScale.value.negate());e.transparency.value=t.transparency}(T,n,o):Ee(T,n,o)):n.isMeshMatcapMaterial?(Me(T,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===b&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===b&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(T,n)):n.isMeshDepthMaterial?(Me(T,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(T,n)):n.isMeshDistanceMaterial?(Me(T,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(T,n)):n.isMeshNormalMaterial?(Me(T,n),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===b&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===b&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(T,n)):n.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(T,n),n.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(T,n)):n.isPointsMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*q,e.scale.value=.5*Y,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(T,n):n.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(T,n):n.isShadowMaterial&&(T.color.value.copy(n.color),T.opacity.value=n.opacity),void 0!==T.ltc_1&&(T.ltc_1.value=wo.LTC_1),void 0!==T.ltc_2&&(T.ltc_2.value=wo.LTC_2),Fa.upload(f,a.uniformsList,T,x),n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Fa.upload(f,a.uniformsList,T,x),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&_.setValue(f,"center",r.center),w.numMultiviewViews>0?he.updateObjectMatricesUniforms(r,e,_):(_.setValue(f,"modelViewMatrix",r.modelViewMatrix),_.setValue(f,"normalMatrix",r.normalMatrix)),_.setValue(f,"modelMatrix",r.matrixWorld),w}function Me(e,t,n){e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap);var r,i,o=t.envMap||n;o&&(e.envMap.value=o,e.flipEnvMap.value=o.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=y.get(o).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),t.aoMap?i=t.aoMap:t.lightMap&&(i=t.lightMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uv2Transform.value.copy(i.matrix))}function Ee(e,t,n){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===b&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===b&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),(t.envMap||n)&&(e.envMapIntensity.value=t.envMapIntensity)}be.setAnimationLoop((function(e){le.isPresenting||ye&&ye(e)})),"undefined"!=typeof window&&be.setContext(window),this.setAnimationLoop=function(e){ye=e,le.setAnimationLoop(e),be.start()},this.render=function(e,t){var n,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),t&&t.isCamera){if(!R){k.geometry=null,k.program=null,k.wireframe=!1,B=-1,z=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),le.enabled&&le.isPresenting&&(t=le.getCamera(t)),(p=E.get(e,t)).init(),e.onBeforeRender(C,e,t,n||j),ie.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ee.setFromProjectionMatrix(ie),re=this.localClippingEnabled,ne=te.init(this.clippingPlanes,re,t),(h=M.get(e,t)).init(),xe(e,t,0,C.sortObjects),!0===C.sortObjects&&h.sort(Q,Z),ne&&te.beginShadows();var i=p.state.shadowsArray;pe.render(i,e,t),p.setupLights(t),ne&&te.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),le.enabled&&he.isAvailable()&&he.attachCamera(t),A.render(h,e,t,r);var o=h.opaque,a=h.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;o.length&&we(o,e,t,s),a.length&&we(a,e,t,s)}else o.length&&we(o,e,t),a.length&&we(a,e,t);e.onAfterRender(C,e,t),null!==j&&(x.updateRenderTargetMipmap(j),x.updateMultisampleRenderTarget(j)),v.buffers.depth.setTest(!0),v.buffers.depth.setMask(!0),v.buffers.color.setMask(!0),v.setPolygonOffset(!1),le.enabled&&he.isAvailable()&&he.detachCamera(t),h=null,p=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){D!==e&&null===j&&f.bindFramebuffer(36160,e),D=e},this.getActiveCubeFace=function(){return N},this.getActiveMipmapLevel=function(){return F},this.getRenderTarget=function(){return j},this.setRenderTarget=function(e,t,n){j=e,N=t,F=n,e&&void 0===y.get(e).__webglFramebuffer&&x.setupRenderTarget(e);var r=D,i=!1;if(e){var o=y.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=o[t||0],i=!0):r=e.isWebGLMultisampleRenderTarget?y.get(e).__webglMultisampledFramebuffer:o,V.copy(e.viewport),H.copy(e.scissor),W=e.scissorTest}else V.copy(K).multiplyScalar(q).floor(),H.copy(J).multiplyScalar(q).floor(),W=$;if(U!==r&&(f.bindFramebuffer(36160,r),U=r),v.viewport(V),v.scissor(H),v.setScissorTest(W),i){var a=y.get(e.texture);f.framebufferTexture2D(36160,36064,34069+(t||0),a.__webglTexture,n||0)}},this.readRenderTargetPixels=function(e,t,n,r,i,o,a){if(e&&e.isWebGLRenderTarget){var s=y.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(s=s[a]),s){var u=!1;s!==U&&(f.bindFramebuffer(36160,s),u=!0);try{var c=e.texture,l=c.format,h=c.type;if(l!==Xe&&I.convert(l)!==f.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(h===Ce||I.convert(h)===f.getParameter(35738)||h===Ue&&(m.isWebGL2||d.get("OES_texture_float")||d.get("WEBGL_color_buffer_float"))||h===Be&&(m.isWebGL2?d.get("EXT_color_buffer_float"):d.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===f.checkFramebufferStatus(36160)?t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&f.readPixels(t,n,r,i,I.convert(l),I.convert(h),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{u&&f.bindFramebuffer(36160,U)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,n){void 0===n&&(n=0);var r=Math.pow(2,-n),i=Math.floor(t.image.width*r),o=Math.floor(t.image.height*r),a=I.convert(t.format);x.setTexture2D(t,0),f.copyTexImage2D(3553,n,a,e.x,e.y,i,o,0),v.unbindTexture()},this.copyTextureToTexture=function(e,t,n,r){var i=t.image.width,o=t.image.height,a=I.convert(n.format),s=I.convert(n.type);x.setTexture2D(n,0),t.isDataTexture?f.texSubImage2D(3553,r||0,e.x,e.y,i,o,a,s,t.image.data):f.texSubImage2D(3553,r||0,e.x,e.y,a,s,t.image),v.unbindTexture()},this.initTexture=function(e){x.setTexture2D(e,0),v.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Es(e,t){this.name="",this.color=new ni(e),this.density=void 0!==t?t:25e-5}function As(e,t,n){this.name="",this.color=new ni(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3}function Ps(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=dn,this.updateRange={offset:0,count:-1},this.version=0}xs.prototype=Object.assign(Object.create(Dn.prototype),{constructor:xs,isWebGLMultiviewRenderTarget:!0,copy:function(e){return Dn.prototype.copy.call(this,e),this.numViews=e.numViews,this},setNumViews:function(e){return this.numViews!==e&&(this.numViews=e,this.dispose()),this}}),_s.prototype=Object.assign(Object.create(ho.prototype),{constructor:_s,isArrayCamera:!0}),Ts.prototype=Object.assign(Object.create(hr.prototype),{constructor:Ts,isGroup:!0}),Object.assign(Ss.prototype,Tn.prototype),Object.assign(Es.prototype,{isFogExp2:!0,clone:function(){return new Es(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(As.prototype,{isFog:!0,clone:function(){return new As(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(Ps.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Ps.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}});var Os,Ls=new Bn;function Is(e,t,n,r){this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}function Cs(e){ui.call(this),this.type="SpriteMaterial",this.color=new ni(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}Object.defineProperties(Is.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Is.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(var t=0,n=this.data.count;t<n;t++)Ls.x=this.getX(t),Ls.y=this.getY(t),Ls.z=this.getZ(t),Ls.applyMatrix4(e),this.setXYZ(t,Ls.x,Ls.y,Ls.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}}),Cs.prototype=Object.create(ui.prototype),Cs.prototype.constructor=Cs,Cs.prototype.isSpriteMaterial=!0,Cs.prototype.copy=function(e){return ui.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var Rs=new Bn,Ds=new Bn,Ns=new Bn,Fs=new Pn,js=new Pn,Us=new Yn,Bs=new Bn,ks=new Bn,zs=new Bn,Gs=new Pn,Vs=new Pn,Hs=new Pn;function Ws(e){if(hr.call(this),this.type="Sprite",void 0===Os){Os=new Li;var t=new Ps(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Os.setIndex([0,1,2,0,2,3]),Os.setAttribute("position",new Is(t,3,0,!1)),Os.setAttribute("uv",new Is(t,2,3,!1))}this.geometry=Os,this.material=void 0!==e?e:new Cs,this.center=new Pn(.5,.5)}function Xs(e,t,n,r,i,o){Fs.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(js.x=o*Fs.x-i*Fs.y,js.y=i*Fs.x+o*Fs.y):js.copy(Fs),e.copy(t),e.x+=js.x,e.y+=js.y,e.applyMatrix4(Us)}Ws.prototype=Object.assign(Object.create(hr.prototype),{constructor:Ws,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ds.setFromMatrixScale(this.matrixWorld),Us.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Ns.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ds.multiplyScalar(-Ns.z);var n,r,i=this.material.rotation;0!==i&&(r=Math.cos(i),n=Math.sin(i));var o=this.center;Xs(Bs.set(-.5,-.5,0),Ns,o,Ds,n,r),Xs(ks.set(.5,-.5,0),Ns,o,Ds,n,r),Xs(zs.set(.5,.5,0),Ns,o,Ds,n,r),Gs.set(0,0),Vs.set(1,0),Hs.set(1,1);var a=e.ray.intersectTriangle(Bs,ks,zs,!1,Rs);if(null!==a||(Xs(ks.set(-.5,.5,0),Ns,o,Ds,n,r),Vs.set(0,1),null!==(a=e.ray.intersectTriangle(Bs,zs,ks,!1,Rs)))){var s=e.ray.origin.distanceTo(Rs);s<e.near||s>e.far||t.push({distance:s,point:Rs.clone(),uv:Jr.getUV(Rs,Bs,ks,zs,Gs,Vs,Hs,new Pn),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return hr.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}});var Ys=new Bn,qs=new Bn;function Qs(){hr.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function Zs(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),qi.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Yn,this.bindMatrixInverse=new Yn}Qs.prototype=Object.assign(Object.create(hr.prototype),{constructor:Qs,isLOD:!0,copy:function(e){hr.prototype.copy.call(this,e,!1);for(var t=e.levels,n=0,r=t.length;n<r;n++){var i=t[n];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var n=this.levels,r=0;r<n.length&&!(t<n[r].distance);r++);return n.splice(r,0,{distance:t,object:e}),this.add(e),this},getObjectForDistance:function(e){var t=this.levels;if(t.length>0){for(var n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object}return null},raycast:function(e,t){if(this.levels.length>0){Ys.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(Ys);this.getObjectForDistance(n).raycast(e,t)}},update:function(e){var t=this.levels;if(t.length>1){Ys.setFromMatrixPosition(e.matrixWorld),qs.setFromMatrixPosition(this.matrixWorld);var n=Ys.distanceTo(qs);t[0].object.visible=!0;for(var r=1,i=t.length;r<i&&n>=t[r].distance;r++)t[r-1].object.visible=!1,t[r].object.visible=!0;for(;r<i;r++)t[r].object.visible=!1}},toJSON:function(e){var t=hr.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var n=this.levels,r=0,i=n.length;r<i;r++){var o=n[r];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),Zs.prototype=Object.assign(Object.create(qi.prototype),{constructor:Zs,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new Rn,t=this.geometry.attributes.skinWeight,n=0,r=t.count;n<r;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);var i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){qi.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Ks=new Yn,Js=new Yn;function $s(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new Yn)}}function eu(){hr.call(this),this.type="Bone"}Object.assign($s.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new Yn;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},pose:function(){var e,t,n;for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,i=0,o=e.length;i<o;i++){var a=e[i]?e[i].matrixWorld:Js;Ks.multiplyMatrices(a,t[i]),Ks.toArray(n,16*i)}void 0!==r&&(r.needsUpdate=!0)},clone:function(){return new $s(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,n=this.bones.length;t<n;t++){var r=this.bones[t];if(r.name===e)return r}}}),eu.prototype=Object.assign(Object.create(hr.prototype),{constructor:eu,isBone:!0});var tu=new Yn,nu=new Yn,ru=[],iu=new qi;function ou(e,t,n){qi.call(this,e,t),this.instanceMatrix=new hi(new Float32Array(16*n),16),this.count=n,this.frustumCulled=!1}function au(e){ui.call(this),this.type="LineBasicMaterial",this.color=new ni(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}ou.prototype=Object.assign(Object.create(qi.prototype),{constructor:ou,isInstancedMesh:!0,getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){var n=this.matrixWorld,r=this.count;if(iu.geometry=this.geometry,iu.material=this.material,void 0!==iu.material)for(var i=0;i<r;i++)this.getMatrixAt(i,tu),nu.multiplyMatrices(n,tu),iu.matrixWorld=nu,iu.raycast(e,ru),ru.length>0&&(ru[0].instanceId=i,ru[0].object=this,t.push(ru[0]),ru.length=0)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){}}),au.prototype=Object.create(ui.prototype),au.prototype.constructor=au,au.prototype.isLineBasicMaterial=!0,au.prototype.copy=function(e){return ui.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this};var su=new Bn,uu=new Bn,cu=new Yn,lu=new jr,hu=new Or;function pu(e,t,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),hr.call(this),this.type="Line",this.geometry=void 0!==e?e:new Li,this.material=void 0!==t?t:new au}pu.prototype=Object.assign(Object.create(hr.prototype),{constructor:pu,isLine:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[0],r=1,i=t.count;r<i;r++)su.fromBufferAttribute(t,r-1),uu.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=su.distanceTo(uu);e.setAttribute("lineDistance",new bi(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices;(n=e.lineDistances)[0]=0;for(r=1,i=o.length;r<i;r++)n[r]=n[r-1],n[r]+=o[r-1].distanceTo(o[r])}return this},raycast:function(e,t){var n=e.linePrecision,r=this.geometry,i=this.matrixWorld;if(null===r.boundingSphere&&r.computeBoundingSphere(),hu.copy(r.boundingSphere),hu.applyMatrix4(i),hu.radius+=n,!1!==e.ray.intersectsSphere(hu)){cu.getInverse(i),lu.copy(e.ray).applyMatrix4(cu);var o=n/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,s=new Bn,u=new Bn,c=new Bn,l=new Bn,h=this&&this.isLineSegments?2:1;if(r.isBufferGeometry){var p=r.index,f=r.attributes.position.array;if(null!==p)for(var d=p.array,m=0,v=d.length-1;m<v;m+=h){var g=d[m],y=d[m+1];if(s.fromArray(f,3*g),u.fromArray(f,3*y),!(lu.distanceSqToSegment(s,u,l,c)>a))l.applyMatrix4(this.matrixWorld),(w=e.ray.origin.distanceTo(l))<e.near||w>e.far||t.push({distance:w,point:c.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}else for(m=0,v=f.length/3-1;m<v;m+=h){if(s.fromArray(f,3*m),u.fromArray(f,3*m+3),!(lu.distanceSqToSegment(s,u,l,c)>a))l.applyMatrix4(this.matrixWorld),(w=e.ray.origin.distanceTo(l))<e.near||w>e.far||t.push({distance:w,point:c.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else if(r.isGeometry){var b=r.vertices,x=b.length;for(m=0;m<x-1;m+=h){var w;if(!(lu.distanceSqToSegment(b[m],b[m+1],l,c)>a))l.applyMatrix4(this.matrixWorld),(w=e.ray.origin.distanceTo(l))<e.near||w>e.far||t.push({distance:w,point:c.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var fu=new Bn,du=new Bn;function mu(e,t){pu.call(this,e,t),this.type="LineSegments"}function vu(e,t){pu.call(this,e,t),this.type="LineLoop"}function gu(e){ui.call(this),this.type="PointsMaterial",this.color=new ni(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}mu.prototype=Object.assign(Object.create(pu.prototype),{constructor:mu,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[],r=0,i=t.count;r<i;r+=2)fu.fromBufferAttribute(t,r),du.fromBufferAttribute(t,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+fu.distanceTo(du);e.setAttribute("lineDistance",new bi(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices;for(n=e.lineDistances,r=0,i=o.length;r<i;r+=2)fu.copy(o[r]),du.copy(o[r+1]),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+fu.distanceTo(du)}return this}}),vu.prototype=Object.assign(Object.create(pu.prototype),{constructor:vu,isLineLoop:!0}),gu.prototype=Object.create(ui.prototype),gu.prototype.constructor=gu,gu.prototype.isPointsMaterial=!0,gu.prototype.copy=function(e){return ui.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var yu=new Yn,bu=new jr,xu=new Or,wu=new Bn;function _u(e,t){hr.call(this),this.type="Points",this.geometry=void 0!==e?e:new Li,this.material=void 0!==t?t:new gu,this.updateMorphTargets()}function Tu(e,t,n,r,i,o,a){var s=bu.distanceSqToPoint(e);if(s<n){var u=new Bn;bu.closestPointToPoint(e,u),u.applyMatrix4(r);var c=i.ray.origin.distanceTo(u);if(c<i.near||c>i.far)return;o.push({distance:c,distanceToRay:Math.sqrt(s),point:u,index:t,face:null,object:a})}}function Su(e,t,n,r,i,o,a,s,u){Cn.call(this,e,t,n,r,i,o,a,s,u),this.format=void 0!==a?a:We,this.minFilter=void 0!==o?o:Ae,this.magFilter=void 0!==i?i:Ae,this.generateMipmaps=!1}function Mu(e,t,n,r,i,o,a,s,u,c,l,h){Cn.call(this,null,o,a,s,u,c,r,i,l,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function Eu(e,t,n,r,i,o,a,s,u){Cn.call(this,e,t,n,r,i,o,a,s,u),this.needsUpdate=!0}function Au(e,t,n,r,i,o,a,s,u,c){if((c=void 0!==c?c:Ze)!==Ze&&c!==Ke)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===Ze&&(n=Ne),void 0===n&&c===Ke&&(n=Ve),Cn.call(this,null,r,i,o,a,s,c,n,u),this.image={width:e,height:t},this.magFilter=void 0!==a?a:_e,this.minFilter=void 0!==s?s:_e,this.flipY=!1,this.generateMipmaps=!1}function Pu(e){Li.call(this),this.type="WireframeGeometry";var t,n,r,i,o,a,s,u,c,l,h=[],p=[0,0],f={},d=["a","b","c"];if(e&&e.isGeometry){var m=e.faces;for(t=0,r=m.length;t<r;t++){var v=m[t];for(n=0;n<3;n++)s=v[d[n]],u=v[d[(n+1)%3]],p[0]=Math.min(s,u),p[1]=Math.max(s,u),void 0===f[c=p[0]+","+p[1]]&&(f[c]={index1:p[0],index2:p[1]})}for(c in f)a=f[c],l=e.vertices[a.index1],h.push(l.x,l.y,l.z),l=e.vertices[a.index2],h.push(l.x,l.y,l.z)}else if(e&&e.isBufferGeometry){var g,y,b,x,w,_,T;if(l=new Bn,null!==e.index){for(g=e.attributes.position,y=e.index,0===(b=e.groups).length&&(b=[{start:0,count:y.count,materialIndex:0}]),i=0,o=b.length;i<o;++i)for(t=w=(x=b[i]).start,r=w+x.count;t<r;t+=3)for(n=0;n<3;n++)s=y.getX(t+n),u=y.getX(t+(n+1)%3),p[0]=Math.min(s,u),p[1]=Math.max(s,u),void 0===f[c=p[0]+","+p[1]]&&(f[c]={index1:p[0],index2:p[1]});for(c in f)a=f[c],l.fromBufferAttribute(g,a.index1),h.push(l.x,l.y,l.z),l.fromBufferAttribute(g,a.index2),h.push(l.x,l.y,l.z)}else for(t=0,r=(g=e.attributes.position).count/3;t<r;t++)for(n=0;n<3;n++)_=3*t+n,l.fromBufferAttribute(g,_),h.push(l.x,l.y,l.z),T=3*t+(n+1)%3,l.fromBufferAttribute(g,T),h.push(l.x,l.y,l.z)}this.setAttribute("position",new bi(h,3))}function Ou(e,t,n){to.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n},this.fromBufferGeometry(new Lu(e,t,n)),this.mergeVertices()}function Lu(e,t,n){Li.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};var r,i,o=[],a=[],s=[],u=[],c=new Bn,l=new Bn,h=new Bn,p=new Bn,f=new Bn;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var d=t+1;for(r=0;r<=n;r++){var m=r/n;for(i=0;i<=t;i++){var v=i/t;e(v,m,l),a.push(l.x,l.y,l.z),v-1e-5>=0?(e(v-1e-5,m,h),p.subVectors(l,h)):(e(v+1e-5,m,h),p.subVectors(h,l)),m-1e-5>=0?(e(v,m-1e-5,h),f.subVectors(l,h)):(e(v,m+1e-5,h),f.subVectors(h,l)),c.crossVectors(p,f).normalize(),s.push(c.x,c.y,c.z),u.push(v,m)}}for(r=0;r<n;r++)for(i=0;i<t;i++){var g=r*d+i,y=r*d+i+1,b=(r+1)*d+i+1,x=(r+1)*d+i;o.push(g,y,x),o.push(y,b,x)}this.setIndex(o),this.setAttribute("position",new bi(a,3)),this.setAttribute("normal",new bi(s,3)),this.setAttribute("uv",new bi(u,2))}function Iu(e,t,n,r){to.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r},this.fromBufferGeometry(new Cu(e,t,n,r)),this.mergeVertices()}function Cu(e,t,n,r){Li.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r},n=n||1;var i=[],o=[];function a(e,t,n,r){var i,o,a=Math.pow(2,r),u=[];for(i=0;i<=a;i++){u[i]=[];var c=e.clone().lerp(n,i/a),l=t.clone().lerp(n,i/a),h=a-i;for(o=0;o<=h;o++)u[i][o]=0===o&&i===a?c:c.clone().lerp(l,o/h)}for(i=0;i<a;i++)for(o=0;o<2*(a-i)-1;o++){var p=Math.floor(o/2);o%2==0?(s(u[i][p+1]),s(u[i+1][p]),s(u[i][p])):(s(u[i][p+1]),s(u[i+1][p+1]),s(u[i+1][p]))}}function s(e){i.push(e.x,e.y,e.z)}function u(t,n){var r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function c(e,t,n,r){r<0&&1===e.x&&(o[t]=e.x-1),0===n.x&&0===n.z&&(o[t]=r/2/Math.PI+.5)}function l(e){return Math.atan2(e.z,-e.x)}!function(e){for(var n=new Bn,r=new Bn,i=new Bn,o=0;o<t.length;o+=3)u(t[o+0],n),u(t[o+1],r),u(t[o+2],i),a(n,r,i,e)}(r=r||0),function(e){for(var t=new Bn,n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}(n),function(){for(var e=new Bn,t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];var n=l(e)/2/Math.PI+.5,r=(a=e,Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5);o.push(n,1-r)}var a;(function(){for(var e=new Bn,t=new Bn,n=new Bn,r=new Bn,a=new Pn,s=new Pn,u=new Pn,h=0,p=0;h<i.length;h+=9,p+=6){e.set(i[h+0],i[h+1],i[h+2]),t.set(i[h+3],i[h+4],i[h+5]),n.set(i[h+6],i[h+7],i[h+8]),a.set(o[p+0],o[p+1]),s.set(o[p+2],o[p+3]),u.set(o[p+4],o[p+5]),r.copy(e).add(t).add(n).divideScalar(3);var f=l(r);c(a,p+0,e,f),c(s,p+2,t,f),c(u,p+4,n,f)}})(),function(){for(var e=0;e<o.length;e+=6){var t=o[e+0],n=o[e+2],r=o[e+4],i=Math.max(t,n,r),a=Math.min(t,n,r);i>.9&&a<.1&&(t<.2&&(o[e+0]+=1),n<.2&&(o[e+2]+=1),r<.2&&(o[e+4]+=1))}}()}(),this.setAttribute("position",new bi(i,3)),this.setAttribute("normal",new bi(i.slice(),3)),this.setAttribute("uv",new bi(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}function Ru(e,t){to.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Du(e,t)),this.mergeVertices()}function Du(e,t){Cu.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Nu(e,t){to.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Fu(e,t)),this.mergeVertices()}function Fu(e,t){Cu.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function ju(e,t){to.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Uu(e,t)),this.mergeVertices()}function Uu(e,t){var n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1];Cu.call(this,r,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Bu(e,t){to.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new ku(e,t)),this.mergeVertices()}function ku(e,t){var n=(1+Math.sqrt(5))/2,r=1/n,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r];Cu.call(this,i,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function zu(e,t,n,r,i,o){to.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new Gu(e,t,n,r,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function Gu(e,t,n,r,i){Li.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i},t=t||64,n=n||1,r=r||8,i=i||!1;var o=e.computeFrenetFrames(t,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var a,s,u=new Bn,c=new Bn,l=new Pn,h=new Bn,p=[],f=[],d=[],m=[];function v(i){h=e.getPointAt(i/t,h);var a=o.normals[i],l=o.binormals[i];for(s=0;s<=r;s++){var d=s/r*Math.PI*2,m=Math.sin(d),v=-Math.cos(d);c.x=v*a.x+m*l.x,c.y=v*a.y+m*l.y,c.z=v*a.z+m*l.z,c.normalize(),f.push(c.x,c.y,c.z),u.x=h.x+n*c.x,u.y=h.y+n*c.y,u.z=h.z+n*c.z,p.push(u.x,u.y,u.z)}}!function(){for(a=0;a<t;a++)v(a);v(!1===i?t:0),function(){for(a=0;a<=t;a++)for(s=0;s<=r;s++)l.x=a/t,l.y=s/r,d.push(l.x,l.y)}(),function(){for(s=1;s<=t;s++)for(a=1;a<=r;a++){var e=(r+1)*(s-1)+(a-1),n=(r+1)*s+(a-1),i=(r+1)*s+a,o=(r+1)*(s-1)+a;m.push(e,n,o),m.push(n,i,o)}}()}(),this.setIndex(m),this.setAttribute("position",new bi(p,3)),this.setAttribute("normal",new bi(f,3)),this.setAttribute("uv",new bi(d,2))}function Vu(e,t,n,r,i,o,a){to.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Hu(e,t,n,r,i,o)),this.mergeVertices()}function Hu(e,t,n,r,i,o){Li.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:o},e=e||1,t=t||.4,n=Math.floor(n)||64,r=Math.floor(r)||8,i=i||2,o=o||3;var a,s,u=[],c=[],l=[],h=[],p=new Bn,f=new Bn,d=new Bn,m=new Bn,v=new Bn,g=new Bn,y=new Bn;for(a=0;a<=n;++a){var b=a/n*i*Math.PI*2;for(A(b,i,o,e,d),A(b+.01,i,o,e,m),g.subVectors(m,d),y.addVectors(m,d),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize(),s=0;s<=r;++s){var x=s/r*Math.PI*2,w=-t*Math.cos(x),_=t*Math.sin(x);p.x=d.x+(w*y.x+_*v.x),p.y=d.y+(w*y.y+_*v.y),p.z=d.z+(w*y.z+_*v.z),c.push(p.x,p.y,p.z),f.subVectors(p,d).normalize(),l.push(f.x,f.y,f.z),h.push(a/n),h.push(s/r)}}for(s=1;s<=n;s++)for(a=1;a<=r;a++){var T=(r+1)*(s-1)+(a-1),S=(r+1)*s+(a-1),M=(r+1)*s+a,E=(r+1)*(s-1)+a;u.push(T,S,E),u.push(S,M,E)}function A(e,t,n,r,i){var o=Math.cos(e),a=Math.sin(e),s=n/t*e,u=Math.cos(s);i.x=r*(2+u)*.5*o,i.y=r*(2+u)*a*.5,i.z=r*Math.sin(s)*.5}this.setIndex(u),this.setAttribute("position",new bi(c,3)),this.setAttribute("normal",new bi(l,3)),this.setAttribute("uv",new bi(h,2))}function Wu(e,t,n,r,i){to.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},this.fromBufferGeometry(new Xu(e,t,n,r,i)),this.mergeVertices()}function Xu(e,t,n,r,i){Li.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},e=e||1,t=t||.4,n=Math.floor(n)||8,r=Math.floor(r)||6,i=i||2*Math.PI;var o,a,s=[],u=[],c=[],l=[],h=new Bn,p=new Bn,f=new Bn;for(o=0;o<=n;o++)for(a=0;a<=r;a++){var d=a/r*i,m=o/n*Math.PI*2;p.x=(e+t*Math.cos(m))*Math.cos(d),p.y=(e+t*Math.cos(m))*Math.sin(d),p.z=t*Math.sin(m),u.push(p.x,p.y,p.z),h.x=e*Math.cos(d),h.y=e*Math.sin(d),f.subVectors(p,h).normalize(),c.push(f.x,f.y,f.z),l.push(a/r),l.push(o/n)}for(o=1;o<=n;o++)for(a=1;a<=r;a++){var v=(r+1)*o+a-1,g=(r+1)*(o-1)+a-1,y=(r+1)*(o-1)+a,b=(r+1)*o+a;s.push(v,g,b),s.push(g,y,b)}this.setIndex(s),this.setAttribute("position",new bi(u,3)),this.setAttribute("normal",new bi(c,3)),this.setAttribute("uv",new bi(l,2))}_u.prototype=Object.assign(Object.create(hr.prototype),{constructor:_u,isPoints:!0,raycast:function(e,t){var n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),xu.copy(n.boundingSphere),xu.applyMatrix4(r),xu.radius+=i,!1!==e.ray.intersectsSphere(xu)){yu.getInverse(r),bu.copy(e.ray).applyMatrix4(yu);var o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(n.isBufferGeometry){var s=n.index,u=n.attributes.position.array;if(null!==s)for(var c=s.array,l=0,h=c.length;l<h;l++){var p=c[l];wu.fromArray(u,3*p),Tu(wu,p,a,r,e,t,this)}else{l=0;for(var f=u.length/3;l<f;l++)wu.fromArray(u,3*l),Tu(wu,l,a,r,e,t,this)}}else{var d=n.vertices;for(l=0,f=d.length;l<f;l++)Tu(d[l],l,a,r,e,t,this)}}},updateMorphTargets:function(){var e,t,n,r=this.geometry;if(r.isBufferGeometry){var i=r.morphAttributes,o=Object.keys(i);if(o.length>0){var a=i[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)n=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var s=r.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Su.prototype=Object.assign(Object.create(Cn.prototype),{constructor:Su,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Mu.prototype=Object.create(Cn.prototype),Mu.prototype.constructor=Mu,Mu.prototype.isCompressedTexture=!0,Eu.prototype=Object.create(Cn.prototype),Eu.prototype.constructor=Eu,Eu.prototype.isCanvasTexture=!0,Au.prototype=Object.create(Cn.prototype),Au.prototype.constructor=Au,Au.prototype.isDepthTexture=!0,Pu.prototype=Object.create(Li.prototype),Pu.prototype.constructor=Pu,Ou.prototype=Object.create(to.prototype),Ou.prototype.constructor=Ou,Lu.prototype=Object.create(Li.prototype),Lu.prototype.constructor=Lu,Iu.prototype=Object.create(to.prototype),Iu.prototype.constructor=Iu,Cu.prototype=Object.create(Li.prototype),Cu.prototype.constructor=Cu,Ru.prototype=Object.create(to.prototype),Ru.prototype.constructor=Ru,Du.prototype=Object.create(Cu.prototype),Du.prototype.constructor=Du,Nu.prototype=Object.create(to.prototype),Nu.prototype.constructor=Nu,Fu.prototype=Object.create(Cu.prototype),Fu.prototype.constructor=Fu,ju.prototype=Object.create(to.prototype),ju.prototype.constructor=ju,Uu.prototype=Object.create(Cu.prototype),Uu.prototype.constructor=Uu,Bu.prototype=Object.create(to.prototype),Bu.prototype.constructor=Bu,ku.prototype=Object.create(Cu.prototype),ku.prototype.constructor=ku,zu.prototype=Object.create(to.prototype),zu.prototype.constructor=zu,Gu.prototype=Object.create(Li.prototype),Gu.prototype.constructor=Gu,Gu.prototype.toJSON=function(){var e=Li.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},Vu.prototype=Object.create(to.prototype),Vu.prototype.constructor=Vu,Hu.prototype=Object.create(Li.prototype),Hu.prototype.constructor=Hu,Wu.prototype=Object.create(to.prototype),Wu.prototype.constructor=Wu,Xu.prototype=Object.create(Li.prototype),Xu.prototype.constructor=Xu;var Yu=function(e,t,n){n=n||2;var r,i,o,a,s,u,c,l=t&&t.length,h=l?t[0]*n:e.length,p=qu(e,0,h,n,!0),f=[];if(!p||p.next===p.prev)return f;if(l&&(p=function(e,t,n,r){var i,o,a,s,u,c=[];for(i=0,o=t.length;i<o;i++)a=t[i]*r,s=i<o-1?t[i+1]*r:e.length,(u=qu(e,a,s,r,!1))===u.next&&(u.steiner=!0),c.push(ic(u));for(c.sort(tc),i=0;i<c.length;i++)nc(c[i],n),n=Qu(n,n.next);return n}(e,t,p,n)),e.length>80*n){r=o=e[0],i=a=e[1];for(var d=n;d<h;d+=n)(s=e[d])<r&&(r=s),(u=e[d+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);c=0!==(c=Math.max(o-r,a-i))?1/c:0}return Zu(p,f,n,r,i,c),f};function qu(e,t,n,r,i){var o,a;if(i===function(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}(e,t,n,r)>0)for(o=t;o<n;o+=r)a=pc(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=pc(o,e[o],e[o+1],a);return a&&uc(a,a.next)&&(fc(a),a=a.next),a}function Qu(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!uc(r,r.next)&&0!==sc(r.prev,r,r.next))r=r.next;else{if(fc(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function Zu(e,t,n,r,i,o,a){if(e){!a&&o&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=rc(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,s,u,c=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<c&&(s++,r=r.nextZ);t++);for(u=c;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(e,r,i,o);for(var s,u,c=e;e.prev!==e.next;)if(s=e.prev,u=e.next,o?Ju(e,r,i,o):Ku(e))t.push(s.i/n),t.push(e.i/n),t.push(u.i/n),fc(e),e=u.next,c=u.next;else if((e=u)===c){a?1===a?Zu(e=$u(e,t,n),t,n,r,i,o,2):2===a&&ec(e,t,n,r,i,o):Zu(Qu(e),t,n,r,i,o,1);break}}}function Ku(e){var t=e.prev,n=e,r=e.next;if(sc(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(oc(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&sc(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Ju(e,t,n,r){var i=e.prev,o=e,a=e.next;if(sc(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=rc(s,u,t,n,r),p=rc(c,l,t,n,r),f=e.prevZ,d=e.nextZ;f&&f.z>=h&&d&&d.z<=p;){if(f!==e.prev&&f!==e.next&&oc(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&sc(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,d!==e.prev&&d!==e.next&&oc(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&sc(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&oc(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&sc(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;d&&d.z<=p;){if(d!==e.prev&&d!==e.next&&oc(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&sc(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function $u(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!uc(i,o)&&cc(i,r,r.next,o)&&lc(i,o)&&lc(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),fc(r),fc(r.next),r=e=o),r=r.next}while(r!==e);return r}function ec(e,t,n,r,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&ac(a,s)){var u=hc(a,s);return a=Qu(a,a.next),u=Qu(u,u.next),Zu(a,t,n,r,i,o),void Zu(u,t,n,r,i,o)}s=s.next}a=a.next}while(a!==e)}function tc(e,t){return e.x-t.x}function nc(e,t){if(t=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===a)return n.prev;var u,c=n,l=n.x,h=n.y,p=1/0;r=n.next;for(;r!==c;)i>=r.x&&r.x>=l&&i!==r.x&&oc(o<h?i:a,o,l,h,o<h?a:i,o,r.x,r.y)&&((u=Math.abs(o-r.y)/(i-r.x))<p||u===p&&r.x>n.x)&&lc(r,e)&&(n=r,p=u),r=r.next;return n}(e,t)){var n=hc(t,e);Qu(n,n.next)}}function rc(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ic(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function oc(e,t,n,r,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function ac(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&cc(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&lc(e,t)&&lc(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)}function sc(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function uc(e,t){return e.x===t.x&&e.y===t.y}function cc(e,t,n,r){return!!(uc(e,n)&&uc(t,r)||uc(e,r)&&uc(n,t))||sc(e,t,n)>0!=sc(e,t,r)>0&&sc(n,r,e)>0!=sc(n,r,t)>0}function lc(e,t){return sc(e.prev,e,e.next)<0?sc(e,t,e.next)>=0&&sc(e,e.prev,t)>=0:sc(e,t,e.prev)<0||sc(e,e.next,t)<0}function hc(e,t){var n=new dc(e.i,e.x,e.y),r=new dc(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function pc(e,t,n,r){var i=new dc(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function fc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function dc(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var mc={area:function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n},isClockWise:function(e){return mc.area(e)<0},triangulateShape:function(e,t){var n=[],r=[],i=[];vc(e),gc(n,e);var o=e.length;t.forEach(vc);for(var a=0;a<t.length;a++)r.push(o),o+=t[a].length,gc(n,t[a]);var s=Yu(n,r);for(a=0;a<s.length;a+=3)i.push(s.slice(a,a+3));return i}};function vc(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function gc(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}function yc(e,t){to.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new bc(e,t)),this.mergeVertices()}function bc(e,t){Li.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var n=this,r=[],i=[],o=0,a=e.length;o<a;o++){s(e[o])}function s(e){var o=[],a=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,u=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,l=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:l-2,p=void 0!==t.bevelOffset?t.bevelOffset:0,f=void 0!==t.bevelSegments?t.bevelSegments:3,d=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:xc;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),u=t.amount);var v,g,y,b,x,w,_,T,S=!1;d&&(v=d.getSpacedPoints(s),S=!0,c=!1,g=d.computeFrenetFrames(s,!1),y=new Bn,b=new Bn,x=new Bn),c||(f=0,l=0,h=0,p=0);var M=e.extractPoints(a),E=M.shape,A=M.holes;if(!mc.isClockWise(E))for(E=E.reverse(),_=0,T=A.length;_<T;_++)w=A[_],mc.isClockWise(w)&&(A[_]=w.reverse());var P=mc.triangulateShape(E,A),O=E;for(_=0,T=A.length;_<T;_++)w=A[_],E=E.concat(w);function L(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var I,C,R,D,N,F,j=E.length,U=P.length;function B(e,t,n){var r,i,o,a=e.x-t.x,s=e.y-t.y,u=n.x-e.x,c=n.y-e.y,l=a*a+s*s,h=a*c-s*u;if(Math.abs(h)>Number.EPSILON){var p=Math.sqrt(l),f=Math.sqrt(u*u+c*c),d=t.x-s/p,m=t.y+a/p,v=((n.x-c/f-d)*c-(n.y+u/f-m)*u)/(a*c-s*u),g=(r=d+a*v-e.x)*r+(i=m+s*v-e.y)*i;if(g<=2)return new Pn(r,i);o=Math.sqrt(g/2)}else{var y=!1;a>Number.EPSILON?u>Number.EPSILON&&(y=!0):a<-Number.EPSILON?u<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(c)&&(y=!0),y?(r=-s,i=a,o=Math.sqrt(l)):(r=a,i=s,o=Math.sqrt(l/2))}return new Pn(r/o,i/o)}for(var k=[],z=0,G=O.length,V=G-1,H=z+1;z<G;z++,V++,H++)V===G&&(V=0),H===G&&(H=0),k[z]=B(O[z],O[V],O[H]);var W,X,Y=[],q=k.concat();for(_=0,T=A.length;_<T;_++){for(w=A[_],W=[],z=0,V=(G=w.length)-1,H=z+1;z<G;z++,V++,H++)V===G&&(V=0),H===G&&(H=0),W[z]=B(w[z],w[V],w[H]);Y.push(W),q=q.concat(W)}for(I=0;I<f;I++){for(R=I/f,D=l*Math.cos(R*Math.PI/2),C=h*Math.sin(R*Math.PI/2)+p,z=0,G=O.length;z<G;z++)Z((N=L(O[z],k[z],C)).x,N.y,-D);for(_=0,T=A.length;_<T;_++)for(w=A[_],W=Y[_],z=0,G=w.length;z<G;z++)Z((N=L(w[z],W[z],C)).x,N.y,-D)}for(C=h+p,z=0;z<j;z++)N=c?L(E[z],q[z],C):E[z],S?(b.copy(g.normals[0]).multiplyScalar(N.x),y.copy(g.binormals[0]).multiplyScalar(N.y),x.copy(v[0]).add(b).add(y),Z(x.x,x.y,x.z)):Z(N.x,N.y,0);for(X=1;X<=s;X++)for(z=0;z<j;z++)N=c?L(E[z],q[z],C):E[z],S?(b.copy(g.normals[X]).multiplyScalar(N.x),y.copy(g.binormals[X]).multiplyScalar(N.y),x.copy(v[X]).add(b).add(y),Z(x.x,x.y,x.z)):Z(N.x,N.y,u/s*X);for(I=f-1;I>=0;I--){for(R=I/f,D=l*Math.cos(R*Math.PI/2),C=h*Math.sin(R*Math.PI/2)+p,z=0,G=O.length;z<G;z++)Z((N=L(O[z],k[z],C)).x,N.y,u+D);for(_=0,T=A.length;_<T;_++)for(w=A[_],W=Y[_],z=0,G=w.length;z<G;z++)N=L(w[z],W[z],C),S?Z(N.x,N.y+v[s-1].y,v[s-1].x+D):Z(N.x,N.y,u+D)}function Q(e,t){var n,r;for(z=e.length;--z>=0;){n=z,(r=z-1)<0&&(r=e.length-1);var i=0,o=s+2*f;for(i=0;i<o;i++){var a=j*i,u=j*(i+1);J(t+n+a,t+r+a,t+r+u,t+n+u)}}}function Z(e,t,n){o.push(e),o.push(t),o.push(n)}function K(e,t,i){$(e),$(t),$(i);var o=r.length/3,a=m.generateTopUV(n,r,o-3,o-2,o-1);ee(a[0]),ee(a[1]),ee(a[2])}function J(e,t,i,o){$(e),$(t),$(o),$(t),$(i),$(o);var a=r.length/3,s=m.generateSideWallUV(n,r,a-6,a-3,a-2,a-1);ee(s[0]),ee(s[1]),ee(s[3]),ee(s[1]),ee(s[2]),ee(s[3])}function $(e){r.push(o[3*e+0]),r.push(o[3*e+1]),r.push(o[3*e+2])}function ee(e){i.push(e.x),i.push(e.y)}!function(){var e=r.length/3;if(c){var t=0,i=j*t;for(z=0;z<U;z++)K((F=P[z])[2]+i,F[1]+i,F[0]+i);for(i=j*(t=s+2*f),z=0;z<U;z++)K((F=P[z])[0]+i,F[1]+i,F[2]+i)}else{for(z=0;z<U;z++)K((F=P[z])[2],F[1],F[0]);for(z=0;z<U;z++)K((F=P[z])[0]+j*s,F[1]+j*s,F[2]+j*s)}n.addGroup(e,r.length/3-e,0)}(),function(){var e=r.length/3,t=0;for(Q(O,t),t+=O.length,_=0,T=A.length;_<T;_++)Q(w=A[_],t),t+=w.length;n.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new bi(r,3)),this.setAttribute("uv",new bi(i,2)),this.computeVertexNormals()}yc.prototype=Object.create(to.prototype),yc.prototype.constructor=yc,yc.prototype.toJSON=function(){var e=to.prototype.toJSON.call(this);return wc(this.parameters.shapes,this.parameters.options,e)},bc.prototype=Object.create(Li.prototype),bc.prototype.constructor=bc,bc.prototype.toJSON=function(){var e=Li.prototype.toJSON.call(this);return wc(this.parameters.shapes,this.parameters.options,e)};var xc={generateTopUV:function(e,t,n,r,i){var o=t[3*n],a=t[3*n+1],s=t[3*r],u=t[3*r+1],c=t[3*i],l=t[3*i+1];return[new Pn(o,a),new Pn(s,u),new Pn(c,l)]},generateSideWallUV:function(e,t,n,r,i,o){var a=t[3*n],s=t[3*n+1],u=t[3*n+2],c=t[3*r],l=t[3*r+1],h=t[3*r+2],p=t[3*i],f=t[3*i+1],d=t[3*i+2],m=t[3*o],v=t[3*o+1],g=t[3*o+2];return Math.abs(s-l)<.01?[new Pn(a,1-u),new Pn(c,1-h),new Pn(p,1-d),new Pn(m,1-g)]:[new Pn(s,1-u),new Pn(l,1-h),new Pn(f,1-d),new Pn(v,1-g)]}};function wc(e,t,n){if(n.shapes=[],Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var o=e[r];n.shapes.push(o.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}function _c(e,t){to.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Tc(e,t)),this.mergeVertices()}function Tc(e,t){var n=(t=t||{}).font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new to;var r=n.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),bc.call(this,r,t),this.type="TextBufferGeometry"}function Sc(e,t,n,r,i,o,a){to.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new Mc(e,t,n,r,i,o,a)),this.mergeVertices()}function Mc(e,t,n,r,i,o,a){Li.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},e=e||1,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;var s,u,c=Math.min(o+a,Math.PI),l=0,h=[],p=new Bn,f=new Bn,d=[],m=[],v=[],g=[];for(u=0;u<=n;u++){var y=[],b=u/n,x=0;for(0==u&&0==o?x=.5/t:u==n&&c==Math.PI&&(x=-.5/t),s=0;s<=t;s++){var w=s/t;p.x=-e*Math.cos(r+w*i)*Math.sin(o+b*a),p.y=e*Math.cos(o+b*a),p.z=e*Math.sin(r+w*i)*Math.sin(o+b*a),m.push(p.x,p.y,p.z),f.copy(p).normalize(),v.push(f.x,f.y,f.z),g.push(w+x,1-b),y.push(l++)}h.push(y)}for(u=0;u<n;u++)for(s=0;s<t;s++){var _=h[u][s+1],T=h[u][s],S=h[u+1][s],M=h[u+1][s+1];(0!==u||o>0)&&d.push(_,T,M),(u!==n-1||c<Math.PI)&&d.push(T,S,M)}this.setIndex(d),this.setAttribute("position",new bi(m,3)),this.setAttribute("normal",new bi(v,3)),this.setAttribute("uv",new bi(g,2))}function Ec(e,t,n,r,i,o){to.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new Ac(e,t,n,r,i,o)),this.mergeVertices()}function Ac(e,t,n,r,i,o){Li.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},e=e||.5,t=t||1,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,n=void 0!==n?Math.max(3,n):8;var a,s,u,c=[],l=[],h=[],p=[],f=e,d=(t-e)/(r=void 0!==r?Math.max(1,r):1),m=new Bn,v=new Pn;for(s=0;s<=r;s++){for(u=0;u<=n;u++)a=i+u/n*o,m.x=f*Math.cos(a),m.y=f*Math.sin(a),l.push(m.x,m.y,m.z),h.push(0,0,1),v.x=(m.x/t+1)/2,v.y=(m.y/t+1)/2,p.push(v.x,v.y);f+=d}for(s=0;s<r;s++){var g=s*(n+1);for(u=0;u<n;u++){var y=a=u+g,b=a+n+1,x=a+n+2,w=a+1;c.push(y,b,w),c.push(b,x,w)}}this.setIndex(c),this.setAttribute("position",new bi(l,3)),this.setAttribute("normal",new bi(h,3)),this.setAttribute("uv",new bi(p,2))}function Pc(e,t,n,r){to.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},this.fromBufferGeometry(new Oc(e,t,n,r)),this.mergeVertices()}function Oc(e,t,n,r){Li.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t)||12,n=n||0,r=r||2*Math.PI,r=An.clamp(r,0,2*Math.PI);var i,o,a,s=[],u=[],c=[],l=1/t,h=new Bn,p=new Pn;for(o=0;o<=t;o++){var f=n+o*l*r,d=Math.sin(f),m=Math.cos(f);for(a=0;a<=e.length-1;a++)h.x=e[a].x*d,h.y=e[a].y,h.z=e[a].x*m,u.push(h.x,h.y,h.z),p.x=o/t,p.y=a/(e.length-1),c.push(p.x,p.y)}for(o=0;o<t;o++)for(a=0;a<e.length-1;a++){var v=i=a+o*e.length,g=i+e.length,y=i+e.length+1,b=i+1;s.push(v,g,b),s.push(g,y,b)}if(this.setIndex(s),this.setAttribute("position",new bi(u,3)),this.setAttribute("uv",new bi(c,2)),this.computeVertexNormals(),r===2*Math.PI){var x=this.attributes.normal.array,w=new Bn,_=new Bn,T=new Bn;for(i=t*e.length*3,o=0,a=0;o<e.length;o++,a+=3)w.x=x[a+0],w.y=x[a+1],w.z=x[a+2],_.x=x[i+a+0],_.y=x[i+a+1],_.z=x[i+a+2],T.addVectors(w,_).normalize(),x[a+0]=x[i+a+0]=T.x,x[a+1]=x[i+a+1]=T.y,x[a+2]=x[i+a+2]=T.z}}function Lc(e,t){to.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Ic(e,t)),this.mergeVertices()}function Ic(e,t){Li.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var n=[],r=[],i=[],o=[],a=0,s=0;if(!1===Array.isArray(e))c(e);else for(var u=0;u<e.length;u++)c(e[u]),this.addGroup(a,s,u),a+=s,s=0;function c(e){var a,u,c,l=r.length/3,h=e.extractPoints(t),p=h.shape,f=h.holes;for(!1===mc.isClockWise(p)&&(p=p.reverse()),a=0,u=f.length;a<u;a++)c=f[a],!0===mc.isClockWise(c)&&(f[a]=c.reverse());var d=mc.triangulateShape(p,f);for(a=0,u=f.length;a<u;a++)c=f[a],p=p.concat(c);for(a=0,u=p.length;a<u;a++){var m=p[a];r.push(m.x,m.y,0),i.push(0,0,1),o.push(m.x,m.y)}for(a=0,u=d.length;a<u;a++){var v=d[a],g=v[0]+l,y=v[1]+l,b=v[2]+l;n.push(g,y,b),s+=3}}this.setIndex(n),this.setAttribute("position",new bi(r,3)),this.setAttribute("normal",new bi(i,3)),this.setAttribute("uv",new bi(o,2))}function Cc(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++){var i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}function Rc(e,t){Li.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var n,r,i,o,a=[],s=Math.cos(An.DEG2RAD*t),u=[0,0],c={},l=["a","b","c"];e.isBufferGeometry?(o=new to).fromBufferGeometry(e):o=e.clone(),o.mergeVertices(),o.computeFaceNormals();for(var h=o.vertices,p=o.faces,f=0,d=p.length;f<d;f++)for(var m=p[f],v=0;v<3;v++)n=m[l[v]],r=m[l[(v+1)%3]],u[0]=Math.min(n,r),u[1]=Math.max(n,r),void 0===c[i=u[0]+","+u[1]]?c[i]={index1:u[0],index2:u[1],face1:f,face2:void 0}:c[i].face2=f;for(i in c){var g=c[i];if(void 0===g.face2||p[g.face1].normal.dot(p[g.face2].normal)<=s){var y=h[g.index1];a.push(y.x,y.y,y.z),y=h[g.index2],a.push(y.x,y.y,y.z)}}this.setAttribute("position",new bi(a,3))}function Dc(e,t,n,r,i,o,a,s){to.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new Nc(e,t,n,r,i,o,a,s)),this.mergeVertices()}function Nc(e,t,n,r,i,o,a,s){Li.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s};var u=this;e=void 0!==e?e:1,t=void 0!==t?t:1,n=n||1,r=Math.floor(r)||8,i=Math.floor(i)||1,o=void 0!==o&&o,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var c=[],l=[],h=[],p=[],f=0,d=[],m=n/2,v=0;function g(n){var i,o,d,g=new Pn,y=new Bn,b=0,x=!0===n?e:t,w=!0===n?1:-1;for(o=f,i=1;i<=r;i++)l.push(0,m*w,0),h.push(0,w,0),p.push(.5,.5),f++;for(d=f,i=0;i<=r;i++){var _=i/r*s+a,T=Math.cos(_),S=Math.sin(_);y.x=x*S,y.y=m*w,y.z=x*T,l.push(y.x,y.y,y.z),h.push(0,w,0),g.x=.5*T+.5,g.y=.5*S*w+.5,p.push(g.x,g.y),f++}for(i=0;i<r;i++){var M=o+i,E=d+i;!0===n?c.push(E,E+1,M):c.push(E+1,E,M),b+=3}u.addGroup(v,b,!0===n?1:2),v+=b}!function(){var o,g,y=new Bn,b=new Bn,x=0,w=(t-e)/n;for(g=0;g<=i;g++){var _=[],T=g/i,S=T*(t-e)+e;for(o=0;o<=r;o++){var M=o/r,E=M*s+a,A=Math.sin(E),P=Math.cos(E);b.x=S*A,b.y=-T*n+m,b.z=S*P,l.push(b.x,b.y,b.z),y.set(A,w,P).normalize(),h.push(y.x,y.y,y.z),p.push(M,1-T),_.push(f++)}d.push(_)}for(o=0;o<r;o++)for(g=0;g<i;g++){var O=d[g][o],L=d[g+1][o],I=d[g+1][o+1],C=d[g][o+1];c.push(O,L,C),c.push(L,I,C),x+=6}u.addGroup(v,x,0),v+=x}(),!1===o&&(e>0&&g(!0),t>0&&g(!1)),this.setIndex(c),this.setAttribute("position",new bi(l,3)),this.setAttribute("normal",new bi(h,3)),this.setAttribute("uv",new bi(p,2))}function Fc(e,t,n,r,i,o,a){Dc.call(this,0,e,t,n,r,i,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:a}}function jc(e,t,n,r,i,o,a){Nc.call(this,0,e,t,n,r,i,o,a),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:a}}function Uc(e,t,n,r){to.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},this.fromBufferGeometry(new Bc(e,t,n,r)),this.mergeVertices()}function Bc(e,t,n,r){Li.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},e=e||1,t=void 0!==t?Math.max(3,t):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var i,o,a=[],s=[],u=[],c=[],l=new Bn,h=new Pn;for(s.push(0,0,0),u.push(0,0,1),c.push(.5,.5),o=0,i=3;o<=t;o++,i+=3){var p=n+o/t*r;l.x=e*Math.cos(p),l.y=e*Math.sin(p),s.push(l.x,l.y,l.z),u.push(0,0,1),h.x=(s[i]/e+1)/2,h.y=(s[i+1]/e+1)/2,c.push(h.x,h.y)}for(i=1;i<=t;i++)a.push(i,i+1,0);this.setIndex(a),this.setAttribute("position",new bi(s,3)),this.setAttribute("normal",new bi(u,3)),this.setAttribute("uv",new bi(c,2))}_c.prototype=Object.create(to.prototype),_c.prototype.constructor=_c,Tc.prototype=Object.create(bc.prototype),Tc.prototype.constructor=Tc,Sc.prototype=Object.create(to.prototype),Sc.prototype.constructor=Sc,Mc.prototype=Object.create(Li.prototype),Mc.prototype.constructor=Mc,Ec.prototype=Object.create(to.prototype),Ec.prototype.constructor=Ec,Ac.prototype=Object.create(Li.prototype),Ac.prototype.constructor=Ac,Pc.prototype=Object.create(to.prototype),Pc.prototype.constructor=Pc,Oc.prototype=Object.create(Li.prototype),Oc.prototype.constructor=Oc,Lc.prototype=Object.create(to.prototype),Lc.prototype.constructor=Lc,Lc.prototype.toJSON=function(){var e=to.prototype.toJSON.call(this);return Cc(this.parameters.shapes,e)},Ic.prototype=Object.create(Li.prototype),Ic.prototype.constructor=Ic,Ic.prototype.toJSON=function(){var e=Li.prototype.toJSON.call(this);return Cc(this.parameters.shapes,e)},Rc.prototype=Object.create(Li.prototype),Rc.prototype.constructor=Rc,Dc.prototype=Object.create(to.prototype),Dc.prototype.constructor=Dc,Nc.prototype=Object.create(Li.prototype),Nc.prototype.constructor=Nc,Fc.prototype=Object.create(Dc.prototype),Fc.prototype.constructor=Fc,jc.prototype=Object.create(Nc.prototype),jc.prototype.constructor=jc,Uc.prototype=Object.create(to.prototype),Uc.prototype.constructor=Uc,Bc.prototype=Object.create(Li.prototype),Bc.prototype.constructor=Bc;var kc=Object.freeze({__proto__:null,WireframeGeometry:Pu,ParametricGeometry:Ou,ParametricBufferGeometry:Lu,TetrahedronGeometry:Ru,TetrahedronBufferGeometry:Du,OctahedronGeometry:Nu,OctahedronBufferGeometry:Fu,IcosahedronGeometry:ju,IcosahedronBufferGeometry:Uu,DodecahedronGeometry:Bu,DodecahedronBufferGeometry:ku,PolyhedronGeometry:Iu,PolyhedronBufferGeometry:Cu,TubeGeometry:zu,TubeBufferGeometry:Gu,TorusKnotGeometry:Vu,TorusKnotBufferGeometry:Hu,TorusGeometry:Wu,TorusBufferGeometry:Xu,TextGeometry:_c,TextBufferGeometry:Tc,SphereGeometry:Sc,SphereBufferGeometry:Mc,RingGeometry:Ec,RingBufferGeometry:Ac,PlaneGeometry:So,PlaneBufferGeometry:Mo,LatheGeometry:Pc,LatheBufferGeometry:Oc,ShapeGeometry:Lc,ShapeBufferGeometry:Ic,ExtrudeGeometry:yc,ExtrudeBufferGeometry:bc,EdgesGeometry:Rc,ConeGeometry:Fc,ConeBufferGeometry:jc,CylinderGeometry:Dc,CylinderBufferGeometry:Nc,CircleGeometry:Uc,CircleBufferGeometry:Bc,BoxGeometry:no,BoxBufferGeometry:ro});function zc(e){ui.call(this),this.type="ShadowMaterial",this.color=new ni(0),this.transparent=!0,this.setValues(e)}function Gc(e){co.call(this,e),this.type="RawShaderMaterial"}function Vc(e){ui.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ni(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ni(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qt,this.normalScale=new Pn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Hc(e){Vc.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new Pn(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(e)}function Wc(e){ui.call(this),this.type="MeshPhongMaterial",this.color=new ni(16777215),this.specular=new ni(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ni(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qt,this.normalScale=new Pn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ne,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Xc(e){ui.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ni(16777215),this.specular=new ni(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ni(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qt,this.normalScale=new Pn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Yc(e){ui.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qt,this.normalScale=new Pn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function qc(e){ui.call(this),this.type="MeshLambertMaterial",this.color=new ni(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ni(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ne,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Qc(e){ui.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ni(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qt,this.normalScale=new Pn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Zc(e){au.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}zc.prototype=Object.create(ui.prototype),zc.prototype.constructor=zc,zc.prototype.isShadowMaterial=!0,zc.prototype.copy=function(e){return ui.prototype.copy.call(this,e),this.color.copy(e.color),this},Gc.prototype=Object.create(co.prototype),Gc.prototype.constructor=Gc,Gc.prototype.isRawShaderMaterial=!0,Vc.prototype=Object.create(ui.prototype),Vc.prototype.constructor=Vc,Vc.prototype.isMeshStandardMaterial=!0,Vc.prototype.copy=function(e){return ui.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Hc.prototype=Object.create(Vc.prototype),Hc.prototype.constructor=Hc,Hc.prototype.isMeshPhysicalMaterial=!0,Hc.prototype.copy=function(e){return Vc.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearcoat=e.clearcoat,this.clearcoatRoughness=e.clearcoatRoughness,e.sheen?this.sheen=(this.sheen||new ni).copy(e.sheen):this.sheen=null,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.transparency=e.transparency,this},Wc.prototype=Object.create(ui.prototype),Wc.prototype.constructor=Wc,Wc.prototype.isMeshPhongMaterial=!0,Wc.prototype.copy=function(e){return ui.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Xc.prototype=Object.create(ui.prototype),Xc.prototype.constructor=Xc,Xc.prototype.isMeshToonMaterial=!0,Xc.prototype.copy=function(e){return ui.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Yc.prototype=Object.create(ui.prototype),Yc.prototype.constructor=Yc,Yc.prototype.isMeshNormalMaterial=!0,Yc.prototype.copy=function(e){return ui.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},qc.prototype=Object.create(ui.prototype),qc.prototype.constructor=qc,qc.prototype.isMeshLambertMaterial=!0,qc.prototype.copy=function(e){return ui.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Qc.prototype=Object.create(ui.prototype),Qc.prototype.constructor=Qc,Qc.prototype.isMeshMatcapMaterial=!0,Qc.prototype.copy=function(e){return ui.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Zc.prototype=Object.create(au.prototype),Zc.prototype.constructor=Zc,Zc.prototype.isLineDashedMaterial=!0,Zc.prototype.copy=function(e){return au.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Kc=Object.freeze({__proto__:null,ShadowMaterial:zc,SpriteMaterial:Cs,RawShaderMaterial:Gc,ShaderMaterial:co,PointsMaterial:gu,MeshPhysicalMaterial:Hc,MeshStandardMaterial:Vc,MeshPhongMaterial:Wc,MeshToonMaterial:Xc,MeshNormalMaterial:Yc,MeshLambertMaterial:qc,MeshDepthMaterial:ps,MeshDistanceMaterial:fs,MeshBasicMaterial:ci,MeshMatcapMaterial:Qc,LineDashedMaterial:Zc,LineBasicMaterial:au,Material:ui}),Jc={arraySlice:function(e,t,n){return Jc.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),r=0;r!==t;++r)n[r]=r;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){for(var r=e.length,i=new e.constructor(r),o=0,a=0;a!==r;++o)for(var s=n[o]*t,u=0;u!==t;++u)i[a++]=e[s+u];return i},flattenJSON:function(e,t,n,r){for(var i=1,o=e[0];void 0!==o&&void 0===o[r];)o=e[i++];if(void 0!==o){var a=o[r];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[r])&&(t.push(o.time),n.push.apply(n,a)),o=e[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[r])&&(t.push(o.time),a.toArray(n,n.length)),o=e[i++]}while(void 0!==o);else do{void 0!==(a=o[r])&&(t.push(o.time),n.push(a)),o=e[i++]}while(void 0!==o)}},subclip:function(e,t,n,r,i){i=i||30;var o=e.clone();o.name=t;for(var a=[],s=0;s<o.tracks.length;++s){for(var u=o.tracks[s],c=u.getValueSize(),l=[],h=[],p=0;p<u.times.length;++p){var f=u.times[p]*i;if(!(f<n||f>=r)){l.push(u.times[p]);for(var d=0;d<c;++d)h.push(u.values[p*c+d])}}0!==l.length&&(u.times=Jc.convertArray(l,u.times.constructor),u.values=Jc.convertArray(h,u.values.constructor),a.push(u))}o.tracks=a;var m=1/0;for(s=0;s<o.tracks.length;++s)m>o.tracks[s].times[0]&&(m=o.tracks[s].times[0]);for(s=0;s<o.tracks.length;++s)o.tracks[s].shift(-1*m);return o.resetDuration(),o}};function $c(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function el(e,t,n,r){$c.call(this,e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function tl(e,t,n,r){$c.call(this,e,t,n,r)}function nl(e,t,n,r){$c.call(this,e,t,n,r)}function rl(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Jc.convertArray(t,this.TimeBufferType),this.values=Jc.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function il(e,t,n){rl.call(this,e,t,n)}function ol(e,t,n,r){rl.call(this,e,t,n,r)}function al(e,t,n,r){rl.call(this,e,t,n,r)}function sl(e,t,n,r){$c.call(this,e,t,n,r)}function ul(e,t,n,r){rl.call(this,e,t,n,r)}function cl(e,t,n,r){rl.call(this,e,t,n,r)}function ll(e,t,n,r){rl.call(this,e,t,n,r)}function hl(e,t,n){this.name=e,this.tracks=n,this.duration=void 0!==t?t:-1,this.uuid=An.generateUUID(),this.duration<0&&this.resetDuration()}function pl(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return al;case"vector":case"vector2":case"vector3":case"vector4":return ll;case"color":return ol;case"quaternion":return ul;case"bool":case"boolean":return il;case"string":return cl}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],r=[];Jc.flattenJSON(e.keys,n,r,"value"),e.times=n,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign($c.prototype,{evaluate:function(e){var t=this.parameterPositions,n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{var o;n:{r:if(!(e<r)){for(var a=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===a)break;if(i=r,e<(r=t[++n]))break t}o=t.length;break n}if(e>=i)break e;var s=t[1];e<s&&(n=2,i=s);for(a=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===a)break;if(r=i,e>=(i=t[--n-1]))break t}o=n,n=0}for(;n<o;){var u=n+o>>>1;e<t[u]?o=u:n=u+1}if(r=t[n],void 0===(i=t[n-1]))return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r,o=0;o!==r;++o)t[o]=n[i+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign($c.prototype,{beforeStart_:$c.prototype.copySampleValue_,afterEnd_:$c.prototype.copySampleValue_}),el.prototype=Object.assign(Object.create($c.prototype),{constructor:el,DefaultSettings_:{endingStart:Rt,endingEnd:Rt},intervalChanged_:function(e,t,n){var r=this.parameterPositions,i=e-2,o=e+1,a=r[i],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case Dt:i=e,a=2*t-n;break;case Nt:a=t+r[i=r.length-2]-r[i+1];break;default:i=e,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case Dt:o=e,s=2*n-t;break;case Nt:o=1,s=n+r[1]-r[0];break;default:o=e-1,s=t}var u=.5*(n-t),c=this.valueSize;this._weightPrev=u/(t-a),this._weightNext=u/(s-n),this._offsetPrev=i*c,this._offsetNext=o*c},interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,u=s-a,c=this._offsetPrev,l=this._offsetNext,h=this._weightPrev,p=this._weightNext,f=(n-t)/(r-t),d=f*f,m=d*f,v=-h*m+2*h*d-h*f,g=(1+h)*m+(-1.5-2*h)*d+(-.5+h)*f+1,y=(-1-p)*m+(1.5+p)*d+.5*f,b=p*m-p*d,x=0;x!==a;++x)i[x]=v*o[c+x]+g*o[u+x]+y*o[s+x]+b*o[l+x];return i}}),tl.prototype=Object.assign(Object.create($c.prototype),{constructor:tl,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,u=s-a,c=(n-t)/(r-t),l=1-c,h=0;h!==a;++h)i[h]=o[u+h]*l+o[s+h]*c;return i}}),nl.prototype=Object.assign(Object.create($c.prototype),{constructor:nl,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(rl,{toJSON:function(e){var t,n=e.constructor;if(void 0!==n.toJSON)t=n.toJSON(e);else{t={name:e.name,times:Jc.convertArray(e.times,Array),values:Jc.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}}),Object.assign(rl.prototype,{constructor:rl,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:It,InterpolantFactoryMethodDiscrete:function(e){return new nl(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new tl(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new el(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case Lt:t=this.InterpolantFactoryMethodDiscrete;break;case It:t=this.InterpolantFactoryMethodLinear;break;case Ct:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Lt;case this.InterpolantFactoryMethodLinear:return It;case this.InterpolantFactoryMethodSmooth:return Ct}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]*=e;return this},trim:function(e,t){for(var n=this.times,r=n.length,i=0,o=r-1;i!==r&&n[i]<e;)++i;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==i||o!==r){i>=o&&(i=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=Jc.arraySlice(n,i,o),this.values=Jc.arraySlice(this.values,i*a,o*a)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var o=null,a=0;a!==i;a++){var s=n[a];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,s),e=!1;break}if(null!==o&&o>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,s,o),e=!1;break}o=s}if(void 0!==r&&Jc.isTypedArray(r)){a=0;for(var u=r.length;a!==u;++a){var c=r[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}}return e},optimize:function(){for(var e=Jc.arraySlice(this.times),t=Jc.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===Ct,i=1,o=e.length-1,a=1;a<o;++a){var s=!1,u=e[a];if(u!==e[a+1]&&(1!==a||u!==u[0]))if(r)s=!0;else for(var c=a*n,l=c-n,h=c+n,p=0;p!==n;++p){var f=t[c+p];if(f!==t[l+p]||f!==t[h+p]){s=!0;break}}if(s){if(a!==i){e[i]=e[a];var d=a*n,m=i*n;for(p=0;p!==n;++p)t[m+p]=t[d+p]}++i}}if(o>0){e[i]=e[o];for(d=o*n,m=i*n,p=0;p!==n;++p)t[m+p]=t[d+p];++i}return i!==e.length?(this.times=Jc.arraySlice(e,0,i),this.values=Jc.arraySlice(t,0,i*n)):(this.times=e,this.values=t),this},clone:function(){var e=Jc.arraySlice(this.times,0),t=Jc.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}),il.prototype=Object.assign(Object.create(rl.prototype),{constructor:il,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Lt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ol.prototype=Object.assign(Object.create(rl.prototype),{constructor:ol,ValueTypeName:"color"}),al.prototype=Object.assign(Object.create(rl.prototype),{constructor:al,ValueTypeName:"number"}),sl.prototype=Object.assign(Object.create($c.prototype),{constructor:sl,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,u=(n-t)/(r-t),c=s+a;s!==c;s+=4)Fn.slerpFlat(i,0,o,s-a,o,s,u);return i}}),ul.prototype=Object.assign(Object.create(rl.prototype),{constructor:ul,ValueTypeName:"quaternion",DefaultInterpolation:It,InterpolantFactoryMethodLinear:function(e){return new sl(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),cl.prototype=Object.assign(Object.create(rl.prototype),{constructor:cl,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Lt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ll.prototype=Object.assign(Object.create(rl.prototype),{constructor:ll,ValueTypeName:"vector"}),Object.assign(hl,{parse:function(e){for(var t=[],n=e.tracks,r=1/(e.fps||1),i=0,o=n.length;i!==o;++i)t.push(pl(n[i]).scale(r));return new hl(e.name,e.duration,t)},toJSON:function(e){for(var t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},i=0,o=n.length;i!==o;++i)t.push(rl.toJSON(n[i]));return r},CreateFromMorphTargetSequence:function(e,t,n,r){for(var i=t.length,o=[],a=0;a<i;a++){var s=[],u=[];s.push((a+i-1)%i,a,(a+1)%i),u.push(0,1,0);var c=Jc.getKeyframeOrder(s);s=Jc.sortedArray(s,1,c),u=Jc.sortedArray(u,1,c),r||0!==s[0]||(s.push(i),u.push(u[0])),o.push(new al(".morphTargetInfluences["+t[a].name+"]",s,u).scale(1/n))}return new hl(e,-1,o)},findByName:function(e,t){var n=e;if(!Array.isArray(e)){var r=e;n=r.geometry&&r.geometry.animations||r.animations}for(var i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,o=0,a=e.length;o<a;o++){var s=e[o],u=s.name.match(i);if(u&&u.length>1){var c=r[h=u[1]];c||(r[h]=c=[]),c.push(s)}}var l=[];for(var h in r)l.push(hl.CreateFromMorphTargetSequence(h,r[h],t,n));return l},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,r,i){if(0!==n.length){var o=[],a=[];Jc.flattenJSON(n,o,a,r),0!==o.length&&i.push(new e(t,o,a))}},r=[],i=e.name||"default",o=e.length||-1,a=e.fps||30,s=e.hierarchy||[],u=0;u<s.length;u++){var c=s[u].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var l={},h=0;h<c.length;h++)if(c[h].morphTargets)for(var p=0;p<c[h].morphTargets.length;p++)l[c[h].morphTargets[p]]=-1;for(var f in l){var d=[],m=[];for(p=0;p!==c[h].morphTargets.length;++p){var v=c[h];d.push(v.time),m.push(v.morphTarget===f?1:0)}r.push(new al(".morphTargetInfluence["+f+"]",d,m))}o=l.length*(a||1)}else{var g=".bones["+t[u].name+"]";n(ll,g+".position",c,"pos",r),n(ul,g+".quaternion",c,"rot",r),n(ll,g+".scale",c,"scl",r)}}return 0===r.length?null:new hl(i,o,r)}}),Object.assign(hl.prototype,{resetDuration:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new hl(this.name,this.duration,e)}});var fl={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function dl(e,t,n){var r=this,i=!1,o=0,a=0,s=void 0,u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===i&&void 0!==r.onStart&&r.onStart(e,o,a),i=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,a),o===a&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return u.push(e,t),this},this.removeHandler=function(e){var t=u.indexOf(e);return-1!==t&&u.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=u.length;t<n;t+=2){var r=u[t],i=u[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return i}return null}}var ml=new dl;function vl(e){this.manager=void 0!==e?e:ml,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(vl.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this}});var gl={};function yl(e){vl.call(this,e)}function bl(e){vl.call(this,e)}function xl(e){vl.call(this,e)}function wl(e){vl.call(this,e)}function _l(e){vl.call(this,e)}function Tl(e){vl.call(this,e)}function Sl(e){vl.call(this,e)}function Ml(){this.type="Curve",this.arcLengthDivisions=200}function El(e,t,n,r,i,o,a,s){Ml.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function Al(e,t,n,r,i,o){El.call(this,e,t,n,n,r,i,o),this.type="ArcCurve"}function Pl(){var e=0,t=0,n=0,r=0;function i(i,o,a,s){e=i,t=a,n=-3*i+3*o-2*a-s,r=2*i-2*o+a+s}return{initCatmullRom:function(e,t,n,r,o){i(t,n,o*(n-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,o,a,s){var u=(t-e)/o-(n-e)/(o+a)+(n-t)/a,c=(n-t)/a-(r-t)/(a+s)+(r-n)/s;i(t,n,u*=a,c*=a)},calc:function(i){var o=i*i;return e+t*i+n*o+r*(o*i)}}}yl.prototype=Object.assign(Object.create(vl.prototype),{constructor:yl,load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=fl.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;if(void 0===gl[e]){var a=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],u=!!a[2],c=a[3];c=decodeURIComponent(c),u&&(c=atob(c));try{var l,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var p=new Uint8Array(c.length),f=0;f<c.length;f++)p[f]=c.charCodeAt(f);l="blob"===h?new Blob([p.buffer],{type:s}):p.buffer;break;case"document":var d=new DOMParser;l=d.parseFromString(c,s);break;case"json":l=JSON.parse(c);break;default:l=c}setTimeout((function(){t&&t(l),i.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}),0)}}else{gl[e]=[],gl[e].push({onLoad:t,onProgress:n,onError:r});var m=new XMLHttpRequest;for(var v in m.open("GET",e,!0),m.addEventListener("load",(function(t){var n=this.response,r=gl[e];if(delete gl[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),fl.add(e,n);for(var o=0,a=r.length;o<a;o++){(s=r[o]).onLoad&&s.onLoad(n)}i.manager.itemEnd(e)}else{for(o=0,a=r.length;o<a;o++){var s;(s=r[o]).onError&&s.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}}),!1),m.addEventListener("progress",(function(t){for(var n=gl[e],r=0,i=n.length;r<i;r++){var o=n[r];o.onProgress&&o.onProgress(t)}}),!1),m.addEventListener("error",(function(t){var n=gl[e];delete gl[e];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),m.addEventListener("abort",(function(t){var n=gl[e];delete gl[e];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return i.manager.itemStart(e),m}gl[e].push({onLoad:t,onProgress:n,onError:r})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),bl.prototype=Object.assign(Object.create(vl.prototype),{constructor:bl,load:function(e,t,n,r){var i=this,o=new yl(i.manager);o.setPath(i.path),o.load(e,(function(e){t(i.parse(JSON.parse(e)))}),n,r)},parse:function(e){for(var t=[],n=0;n<e.length;n++){var r=hl.parse(e[n]);t.push(r)}return t}}),xl.prototype=Object.assign(Object.create(vl.prototype),{constructor:xl,load:function(e,t,n,r){var i=this,o=[],a=new Mu;a.image=o;var s=new yl(this.manager);function u(u){s.load(e[u],(function(e){var n=i.parse(e,!0);o[u]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(c+=1)&&(1===n.mipmapCount&&(a.minFilter=Ae),a.format=n.format,a.needsUpdate=!0,t&&t(a))}),n,r)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var c=0,l=0,h=e.length;l<h;++l)u(l);else s.load(e,(function(e){var n=i.parse(e,!0);if(n.isCubemap)for(var r=n.mipmaps.length/n.mipmapCount,s=0;s<r;s++){o[s]={mipmaps:[]};for(var u=0;u<n.mipmapCount;u++)o[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+u]),o[s].format=n.format,o[s].width=n.width,o[s].height=n.height}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=Ae),a.format=n.format,a.needsUpdate=!0,t&&t(a)}),n,r);return a}}),wl.prototype=Object.assign(Object.create(vl.prototype),{constructor:wl,load:function(e,t,n,r){var i=this,o=new go,a=new yl(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(e,(function(e){var n=i.parse(e);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:xe,o.wrapT=void 0!==n.wrapT?n.wrapT:xe,o.magFilter=void 0!==n.magFilter?n.magFilter:Ae,o.minFilter=void 0!==n.minFilter?n.minFilter:Ae,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=Le),1===n.mipmapCount&&(o.minFilter=Ae),o.needsUpdate=!0,t&&t(o,n))}),n,r),o}}),_l.prototype=Object.assign(Object.create(vl.prototype),{constructor:_l,load:function(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=fl.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",u,!1),fl.add(e,this),t&&t(this),i.manager.itemEnd(e)}function u(t){a.removeEventListener("load",s,!1),a.removeEventListener("error",u,!1),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}return a.addEventListener("load",s,!1),a.addEventListener("error",u,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(e),a.src=e,a}}),Tl.prototype=Object.assign(Object.create(vl.prototype),{constructor:Tl,load:function(e,t,n,r){var i=new Bo,o=new _l(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(n){o.load(e[n],(function(e){i.images[n]=e,6===++a&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(var u=0;u<e.length;++u)s(u);return i}}),Sl.prototype=Object.assign(Object.create(vl.prototype),{constructor:Sl,load:function(e,t,n,r){var i=new Cn,o=new _l(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(n){i.image=n;var r=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=r?We:Xe,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i}}),Object.assign(Ml.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n,r=[],i=this.getPoint(0),o=0;for(r.push(0),n=1;n<=e;n++)o+=(t=this.getPoint(n/e)).distanceTo(i),r.push(o),i=t;return this.cacheArcLengths=r,r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var n,r=this.getLengths(),i=0,o=r.length;n=t||e*r[o-1];for(var a,s=0,u=o-1;s<=u;)if((a=r[i=Math.floor(s+(u-s)/2)]-n)<0)s=i+1;else{if(!(a>0)){u=i;break}u=i-1}if(r[i=u]===n)return i/(o-1);var c=r[i];return(i+(n-c)/(r[i+1]-c))/(o-1)},getTangent:function(e){var t=e-1e-4,n=e+1e-4;t<0&&(t=0),n>1&&(n=1);var r=this.getPoint(t);return this.getPoint(n).clone().sub(r).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var n,r,i,o=new Bn,a=[],s=[],u=[],c=new Bn,l=new Yn;for(n=0;n<=e;n++)r=n/e,a[n]=this.getTangentAt(r),a[n].normalize();s[0]=new Bn,u[0]=new Bn;var h=Number.MAX_VALUE,p=Math.abs(a[0].x),f=Math.abs(a[0].y),d=Math.abs(a[0].z);for(p<=h&&(h=p,o.set(1,0,0)),f<=h&&(h=f,o.set(0,1,0)),d<=h&&o.set(0,0,1),c.crossVectors(a[0],o).normalize(),s[0].crossVectors(a[0],c),u[0].crossVectors(a[0],s[0]),n=1;n<=e;n++)s[n]=s[n-1].clone(),u[n]=u[n-1].clone(),c.crossVectors(a[n-1],a[n]),c.length()>Number.EPSILON&&(c.normalize(),i=Math.acos(An.clamp(a[n-1].dot(a[n]),-1,1)),s[n].applyMatrix4(l.makeRotationAxis(c,i))),u[n].crossVectors(a[n],s[n]);if(!0===t)for(i=Math.acos(An.clamp(s[0].dot(s[e]),-1,1)),i/=e,a[0].dot(c.crossVectors(s[0],s[e]))>0&&(i=-i),n=1;n<=e;n++)s[n].applyMatrix4(l.makeRotationAxis(a[n],i*n)),u[n].crossVectors(a[n],s[n]);return{tangents:a,normals:s,binormals:u}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),El.prototype=Object.create(Ml.prototype),El.prototype.constructor=El,El.prototype.isEllipseCurve=!0,El.prototype.getPoint=function(e,t){for(var n=t||new Pn,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);var a=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(a),u=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var c=Math.cos(this.aRotation),l=Math.sin(this.aRotation),h=s-this.aX,p=u-this.aY;s=h*c-p*l+this.aX,u=h*l+p*c+this.aY}return n.set(s,u)},El.prototype.copy=function(e){return Ml.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},El.prototype.toJSON=function(){var e=Ml.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},El.prototype.fromJSON=function(e){return Ml.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Al.prototype=Object.create(El.prototype),Al.prototype.constructor=Al,Al.prototype.isArcCurve=!0;var Ol=new Bn,Ll=new Pl,Il=new Pl,Cl=new Pl;function Rl(e,t,n,r){Ml.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=n||"centripetal",this.tension=r||.5}function Dl(e,t,n,r,i){var o=.5*(r-t),a=.5*(i-n),s=e*e;return(2*n-2*r+o+a)*(e*s)+(-3*n+3*r-2*o-a)*s+o*e+n}function Nl(e,t,n,r){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function Fl(e,t,n,r,i){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}function jl(e,t,n,r){Ml.call(this),this.type="CubicBezierCurve",this.v0=e||new Pn,this.v1=t||new Pn,this.v2=n||new Pn,this.v3=r||new Pn}function Ul(e,t,n,r){Ml.call(this),this.type="CubicBezierCurve3",this.v0=e||new Bn,this.v1=t||new Bn,this.v2=n||new Bn,this.v3=r||new Bn}function Bl(e,t){Ml.call(this),this.type="LineCurve",this.v1=e||new Pn,this.v2=t||new Pn}function kl(e,t){Ml.call(this),this.type="LineCurve3",this.v1=e||new Bn,this.v2=t||new Bn}function zl(e,t,n){Ml.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Pn,this.v1=t||new Pn,this.v2=n||new Pn}function Gl(e,t,n){Ml.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new Bn,this.v1=t||new Bn,this.v2=n||new Bn}function Vl(e){Ml.call(this),this.type="SplineCurve",this.points=e||[]}Rl.prototype=Object.create(Ml.prototype),Rl.prototype.constructor=Rl,Rl.prototype.isCatmullRomCurve3=!0,Rl.prototype.getPoint=function(e,t){var n,r,i,o,a=t||new Bn,s=this.points,u=s.length,c=(u-(this.closed?0:1))*e,l=Math.floor(c),h=c-l;if(this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/u)+1)*u:0===h&&l===u-1&&(l=u-2,h=1),this.closed||l>0?n=s[(l-1)%u]:(Ol.subVectors(s[0],s[1]).add(s[0]),n=Ol),r=s[l%u],i=s[(l+1)%u],this.closed||l+2<u?o=s[(l+2)%u]:(Ol.subVectors(s[u-1],s[u-2]).add(s[u-1]),o=Ol),"centripetal"===this.curveType||"chordal"===this.curveType){var p="chordal"===this.curveType?.5:.25,f=Math.pow(n.distanceToSquared(r),p),d=Math.pow(r.distanceToSquared(i),p),m=Math.pow(i.distanceToSquared(o),p);d<1e-4&&(d=1),f<1e-4&&(f=d),m<1e-4&&(m=d),Ll.initNonuniformCatmullRom(n.x,r.x,i.x,o.x,f,d,m),Il.initNonuniformCatmullRom(n.y,r.y,i.y,o.y,f,d,m),Cl.initNonuniformCatmullRom(n.z,r.z,i.z,o.z,f,d,m)}else"catmullrom"===this.curveType&&(Ll.initCatmullRom(n.x,r.x,i.x,o.x,this.tension),Il.initCatmullRom(n.y,r.y,i.y,o.y,this.tension),Cl.initCatmullRom(n.z,r.z,i.z,o.z,this.tension));return a.set(Ll.calc(h),Il.calc(h),Cl.calc(h)),a},Rl.prototype.copy=function(e){Ml.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Rl.prototype.toJSON=function(){var e=Ml.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Rl.prototype.fromJSON=function(e){Ml.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new Bn).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},jl.prototype=Object.create(Ml.prototype),jl.prototype.constructor=jl,jl.prototype.isCubicBezierCurve=!0,jl.prototype.getPoint=function(e,t){var n=t||new Pn,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(Fl(e,r.x,i.x,o.x,a.x),Fl(e,r.y,i.y,o.y,a.y)),n},jl.prototype.copy=function(e){return Ml.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},jl.prototype.toJSON=function(){var e=Ml.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},jl.prototype.fromJSON=function(e){return Ml.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Ul.prototype=Object.create(Ml.prototype),Ul.prototype.constructor=Ul,Ul.prototype.isCubicBezierCurve3=!0,Ul.prototype.getPoint=function(e,t){var n=t||new Bn,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(Fl(e,r.x,i.x,o.x,a.x),Fl(e,r.y,i.y,o.y,a.y),Fl(e,r.z,i.z,o.z,a.z)),n},Ul.prototype.copy=function(e){return Ml.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Ul.prototype.toJSON=function(){var e=Ml.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Ul.prototype.fromJSON=function(e){return Ml.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Bl.prototype=Object.create(Ml.prototype),Bl.prototype.constructor=Bl,Bl.prototype.isLineCurve=!0,Bl.prototype.getPoint=function(e,t){var n=t||new Pn;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Bl.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Bl.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Bl.prototype.copy=function(e){return Ml.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Bl.prototype.toJSON=function(){var e=Ml.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Bl.prototype.fromJSON=function(e){return Ml.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},kl.prototype=Object.create(Ml.prototype),kl.prototype.constructor=kl,kl.prototype.isLineCurve3=!0,kl.prototype.getPoint=function(e,t){var n=t||new Bn;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},kl.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},kl.prototype.copy=function(e){return Ml.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},kl.prototype.toJSON=function(){var e=Ml.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},kl.prototype.fromJSON=function(e){return Ml.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},zl.prototype=Object.create(Ml.prototype),zl.prototype.constructor=zl,zl.prototype.isQuadraticBezierCurve=!0,zl.prototype.getPoint=function(e,t){var n=t||new Pn,r=this.v0,i=this.v1,o=this.v2;return n.set(Nl(e,r.x,i.x,o.x),Nl(e,r.y,i.y,o.y)),n},zl.prototype.copy=function(e){return Ml.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},zl.prototype.toJSON=function(){var e=Ml.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},zl.prototype.fromJSON=function(e){return Ml.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Gl.prototype=Object.create(Ml.prototype),Gl.prototype.constructor=Gl,Gl.prototype.isQuadraticBezierCurve3=!0,Gl.prototype.getPoint=function(e,t){var n=t||new Bn,r=this.v0,i=this.v1,o=this.v2;return n.set(Nl(e,r.x,i.x,o.x),Nl(e,r.y,i.y,o.y),Nl(e,r.z,i.z,o.z)),n},Gl.prototype.copy=function(e){return Ml.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Gl.prototype.toJSON=function(){var e=Ml.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Gl.prototype.fromJSON=function(e){return Ml.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Vl.prototype=Object.create(Ml.prototype),Vl.prototype.constructor=Vl,Vl.prototype.isSplineCurve=!0,Vl.prototype.getPoint=function(e,t){var n=t||new Pn,r=this.points,i=(r.length-1)*e,o=Math.floor(i),a=i-o,s=r[0===o?o:o-1],u=r[o],c=r[o>r.length-2?r.length-1:o+1],l=r[o>r.length-3?r.length-1:o+2];return n.set(Dl(a,s.x,u.x,c.x,l.x),Dl(a,s.y,u.y,c.y,l.y)),n},Vl.prototype.copy=function(e){Ml.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this},Vl.prototype.toJSON=function(){var e=Ml.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e},Vl.prototype.fromJSON=function(e){Ml.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new Pn).fromArray(r))}return this};var Hl=Object.freeze({__proto__:null,ArcCurve:Al,CatmullRomCurve3:Rl,CubicBezierCurve:jl,CubicBezierCurve3:Ul,EllipseCurve:El,LineCurve:Bl,LineCurve3:kl,QuadraticBezierCurve:zl,QuadraticBezierCurve3:Gl,SplineCurve:Vl});function Wl(){Ml.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Xl(e){Wl.call(this),this.type="Path",this.currentPoint=new Pn,e&&this.setFromPoints(e)}function Yl(e){Xl.call(this,e),this.uuid=An.generateUUID(),this.type="Shape",this.holes=[]}function ql(e,t){hr.call(this),this.type="Light",this.color=new ni(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function Ql(e,t,n){ql.call(this,e,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(hr.DefaultUp),this.updateMatrix(),this.groundColor=new ni(t)}function Zl(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Pn(512,512),this.map=null,this.mapPass=null,this.matrix=new Yn,this._frustum=new xo,this._frameExtents=new Pn(1,1),this._viewportCount=1,this._viewports=[new Rn(0,0,1,1)]}function Kl(){Zl.call(this,new ho(50,1,.5,500))}function Jl(e,t,n,r,i,o){ql.call(this,e,t),this.type="SpotLight",this.position.copy(hr.DefaultUp),this.updateMatrix(),this.target=new hr,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new Kl}function $l(){Zl.call(this,new ho(90,1,.5,500)),this._frameExtents=new Pn(4,2),this._viewportCount=6,this._viewports=[new Rn(2,1,1,1),new Rn(0,1,1,1),new Rn(3,1,1,1),new Rn(1,1,1,1),new Rn(3,0,1,1),new Rn(1,0,1,1)],this._cubeDirections=[new Bn(1,0,0),new Bn(-1,0,0),new Bn(0,0,1),new Bn(0,0,-1),new Bn(0,1,0),new Bn(0,-1,0)],this._cubeUps=[new Bn(0,1,0),new Bn(0,1,0),new Bn(0,1,0),new Bn(0,1,0),new Bn(0,0,1),new Bn(0,0,-1)]}function eh(e,t,n,r){ql.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new $l}function th(e,t,n,r,i,o){lo.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==n?n:1,this.bottom=void 0!==r?r:-1,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function nh(){Zl.call(this,new th(-5,5,5,-5,.5,500))}function rh(e,t){ql.call(this,e,t),this.type="DirectionalLight",this.position.copy(hr.DefaultUp),this.updateMatrix(),this.target=new hr,this.shadow=new nh}function ih(e,t){ql.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function oh(e,t,n,r){ql.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}function ah(e){vl.call(this,e),this.textures={}}Wl.prototype=Object.assign(Object.create(Ml.prototype),{constructor:Wl,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Bl(t,e))},getPoint:function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),r=0;r<n.length;){if(n[r]>=t){var i=n[r]-t,o=this.curves[r],a=o.getLength(),s=0===a?0:1-i/a;return o.getPointAt(s)}r++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,n=[],r=0,i=this.curves;r<i.length;r++)for(var o=i[r],a=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a),u=0;u<s.length;u++){var c=s[u];t&&t.equals(c)||(n.push(c),t=c)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(e){Ml.prototype.copy.call(this,e),this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Ml.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,n=this.curves.length;t<n;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e},fromJSON:function(e){Ml.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push((new Hl[r.type]).fromJSON(r))}return this}}),Xl.prototype=Object.assign(Object.create(Wl.prototype),{constructor:Xl,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var n=new Bl(this.currentPoint.clone(),new Pn(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,n,r){var i=new zl(this.currentPoint.clone(),new Pn(e,t),new Pn(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this},bezierCurveTo:function(e,t,n,r,i,o){var a=new jl(this.currentPoint.clone(),new Pn(e,t),new Pn(n,r),new Pn(i,o));return this.curves.push(a),this.currentPoint.set(i,o),this},splineThru:function(e){var t=new Vl([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,n,r,i,o){var a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+a,t+s,n,r,i,o),this},absarc:function(e,t,n,r,i,o){return this.absellipse(e,t,n,n,r,i,o),this},ellipse:function(e,t,n,r,i,o,a,s){var u=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+u,t+c,n,r,i,o,a,s),this},absellipse:function(e,t,n,r,i,o,a,s){var u=new El(e,t,n,r,i,o,a,s);if(this.curves.length>0){var c=u.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(u);var l=u.getPoint(1);return this.currentPoint.copy(l),this},copy:function(e){return Wl.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=Wl.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return Wl.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Yl.prototype=Object.assign(Object.create(Xl.prototype),{constructor:Yl,getPointsHoles:function(e){for(var t=[],n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Xl.prototype.copy.call(this,e),this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push(r.clone())}return this},toJSON:function(){var e=Xl.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,n=this.holes.length;t<n;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e},fromJSON:function(e){Xl.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push((new Xl).fromJSON(r))}return this}}),ql.prototype=Object.assign(Object.create(hr.prototype),{constructor:ql,isLight:!0,copy:function(e){return hr.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=hr.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),Ql.prototype=Object.assign(Object.create(ql.prototype),{constructor:Ql,isHemisphereLight:!0,copy:function(e){return ql.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(Zl.prototype,{_projScreenMatrix:new Yn,_lightPositionWorld:new Bn,_lookTarget:new Bn,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,n=this.matrix,r=this._projScreenMatrix,i=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(e.matrixWorld),t.position.copy(o),i.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(i),t.updateMatrixWorld(),r.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Kl.prototype=Object.assign(Object.create(Zl.prototype),{constructor:Kl,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,n=2*An.RAD2DEG*e.angle,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),Zl.prototype.updateMatrices.call(this,e)}}),Jl.prototype=Object.assign(Object.create(ql.prototype),{constructor:Jl,isSpotLight:!0,copy:function(e){return ql.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),$l.prototype=Object.assign(Object.create(Zl.prototype),{constructor:$l,isPointLightShadow:!0,updateMatrices:function(e,t){void 0===t&&(t=0);var n=this.camera,r=this.matrix,i=this._lightPositionWorld,o=this._lookTarget,a=this._projScreenMatrix;i.setFromMatrixPosition(e.matrixWorld),n.position.copy(i),o.copy(n.position),o.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(o),n.updateMatrixWorld(),r.makeTranslation(-i.x,-i.y,-i.z),a.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(a)}}),eh.prototype=Object.assign(Object.create(ql.prototype),{constructor:eh,isPointLight:!0,copy:function(e){return ql.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),th.prototype=Object.assign(Object.create(lo.prototype),{constructor:th,isOrthographicCamera:!0,copy:function(e,t){return lo.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-e,o=n+e,a=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var u=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o=(i+=u*this.view.offsetX)+u*this.view.width,s=(a-=c*this.view.offsetY)-c*this.view.height}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=hr.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),nh.prototype=Object.assign(Object.create(Zl.prototype),{constructor:nh,isDirectionalLightShadow:!0,updateMatrices:function(e){Zl.prototype.updateMatrices.call(this,e)}}),rh.prototype=Object.assign(Object.create(ql.prototype),{constructor:rh,isDirectionalLight:!0,copy:function(e){return ql.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),ih.prototype=Object.assign(Object.create(ql.prototype),{constructor:ih,isAmbientLight:!0}),oh.prototype=Object.assign(Object.create(ql.prototype),{constructor:oh,isRectAreaLight:!0,copy:function(e){return ql.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=ql.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),ah.prototype=Object.assign(Object.create(vl.prototype),{constructor:ah,load:function(e,t,n,r){var i=this,o=new yl(i.manager);o.setPath(i.path),o.load(e,(function(e){t(i.parse(JSON.parse(e)))}),n,r)},parse:function(e){var t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var r=new Kc[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=(new ni).setHex(e.sheen)),void 0!==e.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.vertexColors&&(r.vertexColors=e.vertexColors),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(r.morphNormals=e.morphNormals),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.uniforms)for(var i in e.uniforms){var o=e.uniforms[i];switch(r.uniforms[i]={},o.type){case"t":r.uniforms[i].value=n(o.value);break;case"c":r.uniforms[i].value=(new ni).setHex(o.value);break;case"v2":r.uniforms[i].value=(new Pn).fromArray(o.value);break;case"v3":r.uniforms[i].value=(new Bn).fromArray(o.value);break;case"v4":r.uniforms[i].value=(new Rn).fromArray(o.value);break;case"m3":r.uniforms[i].value=(new On).fromArray(o.value);case"m4":r.uniforms[i].value=(new Yn).fromArray(o.value);break;default:r.uniforms[i].value=o.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var a in e.extensions)r.extensions[a]=e.extensions[a];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap),r.transparent=!0),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),r.normalScale=(new Pn).fromArray(s)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Pn).fromArray(e.clearcoatNormalScale)),r},setTextures:function(e){return this.textures=e,this}});var sh={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function uh(){Li.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function ch(e,t,n,r){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),hi.call(this,e,t,n),this.meshPerAttribute=r||1}function lh(e){vl.call(this,e)}uh.prototype=Object.assign(Object.create(Li.prototype),{constructor:uh,isInstancedBufferGeometry:!0,copy:function(e){return Li.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=Li.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),ch.prototype=Object.assign(Object.create(hi.prototype),{constructor:ch,isInstancedBufferAttribute:!0,copy:function(e){return hi.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=hi.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),lh.prototype=Object.assign(Object.create(vl.prototype),{constructor:lh,load:function(e,t,n,r){var i=this,o=new yl(i.manager);o.setPath(i.path),o.load(e,(function(e){t(i.parse(JSON.parse(e)))}),n,r)},parse:function(e){var t=e.isInstancedBufferGeometry?new uh:new Li,n=e.data.index;if(void 0!==n){var r=new hh[n.type](n.array);t.setIndex(new hi(r,1))}var i=e.data.attributes;for(var o in i){var a=i[o],s=(r=new hh[a.type](a.array),new(a.isInstancedBufferAttribute?ch:hi)(r,a.itemSize,a.normalized));void 0!==a.name&&(s.name=a.name),t.setAttribute(o,s)}var u=e.data.morphAttributes;if(u)for(var o in u){for(var c=u[o],l=[],h=0,p=c.length;h<p;h++){a=c[h],s=new hi(r=new hh[a.type](a.array),a.itemSize,a.normalized);void 0!==a.name&&(s.name=a.name),l.push(s)}t.morphAttributes[o]=l}e.data.morphTargetsRelative&&(t.morphTargetsRelative=!0);var f=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==f){h=0;for(var d=f.length;h!==d;++h){var m=f[h];t.addGroup(m.start,m.count,m.materialIndex)}}var v=e.data.boundingSphere;if(void 0!==v){var g=new Bn;void 0!==v.center&&g.fromArray(v.center),t.boundingSphere=new Or(g,v.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t}});var hh={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function ph(e){vl.call(this,e)}ph.prototype=Object.assign(Object.create(vl.prototype),{constructor:ph,load:function(e,t,n,r){var i=this,o=""===this.path?sh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;var a=new yl(i.manager);a.setPath(this.path),a.load(e,(function(n){var o=null;try{o=JSON.parse(n)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?i.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e)}),n,r)},parse:function(e,t){var n=this.parseShape(e.shapes),r=this.parseGeometries(e.geometries,n),i=this.parseImages(e.images,(function(){void 0!==t&&t(s)})),o=this.parseTextures(e.textures,i),a=this.parseMaterials(e.materials,o),s=this.parseObject(e.object,r,a);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var n=0,r=e.length;n<r;n++){var i=(new Yl).fromJSON(e[n]);t[i.uuid]=i}return t},parseGeometries:function(e,t){var n={};if(void 0!==e)for(var r=new lh,i=0,o=e.length;i<o;i++){var a,s=e[i];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new kc[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new kc[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new kc[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new kc[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new kc[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new kc[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new kc[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new kc[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new kc[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new kc[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":a=new kc[s.type]((new Hl[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":a=new kc[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new kc[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var u=[],c=0,l=s.shapes.length;c<l;c++){var h=t[s.shapes[c]];u.push(h)}a=new kc[s.type](u,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(u=[],c=0,l=s.shapes.length;c<l;c++){h=t[s.shapes[c]];u.push(h)}var p=s.options.extrudePath;void 0!==p&&(s.options.extrudePath=(new Hl[p.type]).fromJSON(p)),a=new kc[s.type](u,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(s);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE)a=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry;else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),!0===a.isBufferGeometry&&void 0!==s.userData&&(a.userData=s.userData),n[s.uuid]=a}return n},parseMaterials:function(e,t){var n={},r={};if(void 0!==e){var i=new ah;i.setTextures(t);for(var o=0,a=e.length;o<a;o++){var s=e[o];if("MultiMaterial"===s.type){for(var u=[],c=0;c<s.materials.length;c++){var l=s.materials[c];void 0===n[l.uuid]&&(n[l.uuid]=i.parse(l)),u.push(n[l.uuid])}r[s.uuid]=u}else void 0===n[s.uuid]&&(n[s.uuid]=i.parse(s)),r[s.uuid]=n[s.uuid]}}return r},parseAnimations:function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],i=hl.parse(r);void 0!==r.uuid&&(i.uuid=r.uuid),t.push(i)}return t},parseImages:function(e,t){var n=this,r={};function i(e){return n.manager.itemStart(e),o.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}if(void 0!==e&&e.length>0){var o=new _l(new dl(t));o.setCrossOrigin(this.crossOrigin);for(var a=0,s=e.length;a<s;a++){var u=e[a],c=u.url;if(Array.isArray(c)){r[u.uuid]=[];for(var l=0,h=c.length;l<h;l++){var p=c[l],f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(p)?p:n.resourcePath+p;r[u.uuid].push(i(f))}}else{f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u.url)?u.url:n.resourcePath+u.url;r[u.uuid]=i(f)}}}return r},parseTextures:function(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(void 0!==e)for(var i=0,o=e.length;i<o;i++){var a,s=e[i];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(a=Array.isArray(t[s.image])?new Bo(t[s.image]):new Cn(t[s.image])).needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=n(s.mapping,dh)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=n(s.wrap[0],mh),a.wrapT=n(s.wrap[1],mh)),void 0!==s.format&&(a.format=s.format),void 0!==s.type&&(a.type=s.type),void 0!==s.encoding&&(a.encoding=s.encoding),void 0!==s.minFilter&&(a.minFilter=n(s.minFilter,vh)),void 0!==s.magFilter&&(a.magFilter=n(s.magFilter,vh)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(a.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(a.unpackAlignment=s.unpackAlignment),r[s.uuid]=a}return r},parseObject:function(e,t,n){var r;function i(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function o(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],r=0,i=e.length;r<i;r++){var o=e[r];void 0===n[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),t.push(n[o])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}switch(e.type){case"Scene":r=new pr,void 0!==e.background&&Number.isInteger(e.background)&&(r.background=new ni(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?r.fog=new As(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(r.fog=new Es(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new ho(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(r.focus=e.focus),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.filmGauge&&(r.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(r.filmOffset=e.filmOffset),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new th(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new ih(e.color,e.intensity);break;case"DirectionalLight":r=new rh(e.color,e.intensity);break;case"PointLight":r=new eh(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new oh(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new Jl(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new Ql(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=i(e.geometry),s=o(e.material);r=a.bones&&a.bones.length>0?new Zs(a,s):new qi(a,s);break;case"InstancedMesh":a=i(e.geometry),s=o(e.material);var u=e.count,c=e.instanceMatrix;(r=new ou(a,s,u)).instanceMatrix=new hi(new Float32Array(c.array),16);break;case"LOD":r=new Qs;break;case"Line":r=new pu(i(e.geometry),o(e.material),e.mode);break;case"LineLoop":r=new vu(i(e.geometry),o(e.material));break;case"LineSegments":r=new mu(i(e.geometry),o(e.material));break;case"PointCloud":case"Points":r=new _u(i(e.geometry),o(e.material));break;case"Sprite":r=new Ws(o(e.material));break;case"Group":r=new Ts;break;default:r=new hr}if(r.uuid=e.uuid,void 0!==e.name&&(r.name=e.name),void 0!==e.matrix?(r.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==e.position&&r.position.fromArray(e.position),void 0!==e.rotation&&r.rotation.fromArray(e.rotation),void 0!==e.quaternion&&r.quaternion.fromArray(e.quaternion),void 0!==e.scale&&r.scale.fromArray(e.scale)),void 0!==e.castShadow&&(r.castShadow=e.castShadow),void 0!==e.receiveShadow&&(r.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(r.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(r.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&r.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(r.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.frustumCulled&&(r.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(r.renderOrder=e.renderOrder),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.layers&&(r.layers.mask=e.layers),void 0!==e.children)for(var l=e.children,h=0;h<l.length;h++)r.add(this.parseObject(l[h],t,n));if("LOD"===e.type){void 0!==e.autoUpdate&&(r.autoUpdate=e.autoUpdate);for(var p=e.levels,f=0;f<p.length;f++){var d=p[f],m=r.getObjectByProperty("uuid",d.object);void 0!==m&&r.addLevel(m,d.distance)}}return r}});var fh,dh={UVMapping:he,CubeReflectionMapping:pe,CubeRefractionMapping:fe,EquirectangularReflectionMapping:de,EquirectangularRefractionMapping:me,SphericalReflectionMapping:ve,CubeUVReflectionMapping:ge,CubeUVRefractionMapping:ye},mh={RepeatWrapping:be,ClampToEdgeWrapping:xe,MirroredRepeatWrapping:we},vh={NearestFilter:_e,NearestMipmapNearestFilter:Te,NearestMipmapLinearFilter:Me,LinearFilter:Ae,LinearMipmapNearestFilter:Pe,LinearMipmapLinearFilter:Le};function gh(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),vl.call(this,e),this.options=void 0}function yh(){this.type="ShapePath",this.color=new ni,this.subPaths=[],this.currentPath=null}function bh(e){this.type="Font",this.data=e}function xh(e,t,n,r,i){var o=i.glyphs[e]||i.glyphs["?"];if(o){var a,s,u,c,l,h,p,f,d=new yh;if(o.o)for(var m=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),v=0,g=m.length;v<g;){switch(m[v++]){case"m":a=m[v++]*t+n,s=m[v++]*t+r,d.moveTo(a,s);break;case"l":a=m[v++]*t+n,s=m[v++]*t+r,d.lineTo(a,s);break;case"q":u=m[v++]*t+n,c=m[v++]*t+r,l=m[v++]*t+n,h=m[v++]*t+r,d.quadraticCurveTo(l,h,u,c);break;case"b":u=m[v++]*t+n,c=m[v++]*t+r,l=m[v++]*t+n,h=m[v++]*t+r,p=m[v++]*t+n,f=m[v++]*t+r,d.bezierCurveTo(l,h,p,f,u,c)}}return{offsetX:o.ha*t,path:d}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".")}function wh(e){vl.call(this,e)}gh.prototype=Object.assign(Object.create(vl.prototype),{constructor:gh,setOptions:function(e){return this.options=e,this},load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=fl.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;fetch(e).then((function(e){return e.blob()})).then((function(e){return void 0===i.options?createImageBitmap(e):createImageBitmap(e,i.options)})).then((function(n){fl.add(e,n),t&&t(n),i.manager.itemEnd(e)})).catch((function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}}),Object.assign(yh.prototype,{moveTo:function(e,t){return this.currentPath=new Xl,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this},bezierCurveTo:function(e,t,n,r,i,o){return this.currentPath.bezierCurveTo(e,t,n,r,i,o),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function n(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n],o=new Yl;o.curves=i.curves,t.push(o)}return t}function r(e,t){for(var n=t.length,r=!1,i=n-1,o=0;o<n;i=o++){var a=t[i],s=t[o],u=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(a=t[o],u=-u,s=t[i],c=-c),e.y<a.y||e.y>s.y)continue;if(e.y===a.y){if(e.x===a.x)return!0}else{var l=c*(e.x-a.x)-u*(e.y-a.y);if(0===l)return!0;if(l<0)continue;r=!r}}else{if(e.y!==a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return r}var i=mc.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return n(o);var a,s,u,c=[];if(1===o.length)return s=o[0],(u=new Yl).curves=s.curves,c.push(u),c;var l=!i(o[0].getPoints());l=e?!l:l;var h,p,f=[],d=[],m=[],v=0;d[v]=void 0,m[v]=[];for(var g=0,y=o.length;g<y;g++)a=i(h=(s=o[g]).getPoints()),(a=e?!a:a)?(!l&&d[v]&&v++,d[v]={s:new Yl,p:h},d[v].s.curves=s.curves,l&&v++,m[v]=[]):m[v].push({h:s,p:h[0]});if(!d[0])return n(o);if(d.length>1){for(var b=!1,x=[],w=0,_=d.length;w<_;w++)f[w]=[];for(w=0,_=d.length;w<_;w++)for(var T=m[w],S=0;S<T.length;S++){for(var M=T[S],E=!0,A=0;A<d.length;A++)r(M.p,d[A].p)&&(w!==A&&x.push({froms:w,tos:A,hole:S}),E?(E=!1,f[A].push(M)):b=!0);E&&f[w].push(M)}x.length>0&&(b||(m=f))}g=0;for(var P=d.length;g<P;g++){u=d[g].s,c.push(u);for(var O=0,L=(p=m[g]).length;O<L;O++)u.holes.push(p[O].h)}return c}}),Object.assign(bh.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var n=[],r=function(e,t,n){for(var r=Array.from?Array.from(e):String(e).split(""),i=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,a=[],s=0,u=0,c=0;c<r.length;c++){var l=r[c];if("\n"===l)s=0,u-=o;else{var h=xh(l,i,s,u,n);s+=h.offsetX,a.push(h.path)}}return a}(e,t,this.data),i=0,o=r.length;i<o;i++)Array.prototype.push.apply(n,r[i].toShapes());return n}}),wh.prototype=Object.assign(Object.create(vl.prototype),{constructor:wh,load:function(e,t,n,r){var i=this,o=new yl(this.manager);o.setPath(this.path),o.load(e,(function(e){var n;try{n=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}var r=i.parse(n);t&&t(r)}),n,r)},parse:function(e){return new bh(e)}});var _h={getContext:function(){return void 0===fh&&(fh=new(window.AudioContext||window.webkitAudioContext)),fh},setContext:function(e){fh=e}};function Th(e){vl.call(this,e)}function Sh(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new Bn)}function Mh(e,t){ql.call(this,void 0,t),this.sh=void 0!==e?e:new Sh}function Eh(e,t,n){Mh.call(this,void 0,n);var r=(new ni).set(e),i=(new ni).set(t),o=new Bn(r.r,r.g,r.b),a=new Bn(i.r,i.g,i.b),s=Math.sqrt(Math.PI),u=s*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(u)}function Ah(e,t){Mh.call(this,void 0,t);var n=(new ni).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}Th.prototype=Object.assign(Object.create(vl.prototype),{constructor:Th,load:function(e,t,n,r){var i=new yl(this.manager);i.setResponseType("arraybuffer"),i.setPath(this.path),i.load(e,(function(e){var n=e.slice(0);_h.getContext().decodeAudioData(n,(function(e){t(e)}))}),n,r)}}),Object.assign(Sh.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScale(o[1],.488603*r),t.addScale(o[2],.488603*i),t.addScale(o[3],.488603*n),t.addScale(o[4],n*r*1.092548),t.addScale(o[5],r*i*1.092548),t.addScale(o[6],.315392*(3*i*i-1)),t.addScale(o[7],n*i*1.092548),t.addScale(o[8],.546274*(n*n-r*r)),t},getIrradianceAt:function(e,t){var n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScale(o[1],1.023328*r),t.addScale(o[2],1.023328*i),t.addScale(o[3],1.023328*n),t.addScale(o[4],.858086*n*r),t.addScale(o[5],.858086*r*i),t.addScale(o[6],.743125*i*i-.247708),t.addScale(o[7],.858086*n*i),t.addScale(o[8],.429043*(n*n-r*r)),t},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(e,t){void 0===t&&(t=0);for(var n=this.coefficients,r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);for(var n=this.coefficients,r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}}),Object.assign(Sh,{getBasisAt:function(e,t){var n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}),Mh.prototype=Object.assign(Object.create(ql.prototype),{constructor:Mh,isLightProbe:!0,copy:function(e){return ql.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){return ql.prototype.toJSON.call(this,e)}}),Eh.prototype=Object.assign(Object.create(Mh.prototype),{constructor:Eh,isHemisphereLightProbe:!0,copy:function(e){return Mh.prototype.copy.call(this,e),this},toJSON:function(e){return Mh.prototype.toJSON.call(this,e)}}),Ah.prototype=Object.assign(Object.create(Mh.prototype),{constructor:Ah,isAmbientLightProbe:!0,copy:function(e){return Mh.prototype.copy.call(this,e),this},toJSON:function(e){return Mh.prototype.toJSON.call(this,e)}});var Ph=new Yn,Oh=new Yn;function Lh(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ho,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ho,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Ih(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(Lh.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var n,r,i=e.projectionMatrix.clone(),o=t.eyeSep/2,a=o*t.near/t.focus,s=t.near*Math.tan(An.DEG2RAD*t.fov*.5)/t.zoom;Oh.elements[12]=-o,Ph.elements[12]=o,n=-s*t.aspect+a,r=s*t.aspect+a,i.elements[0]=2*t.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameraL.projectionMatrix.copy(i),n=-s*t.aspect-a,r=s*t.aspect-a,i.elements[0]=2*t.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Oh),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Ph)}}),Object.assign(Ih.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var Ch=new Bn,Rh=new Fn,Dh=new Bn,Nh=new Bn;function Fh(){hr.call(this),this.type="AudioListener",this.context=_h.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Ih}function jh(e){hr.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}Fh.prototype=Object.assign(Object.create(hr.prototype),{constructor:Fh,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){hr.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Ch,Rh,Dh),Nh.set(0,0,-1).applyQuaternion(Rh),t.positionX){var r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Ch.x,r),t.positionY.linearRampToValueAtTime(Ch.y,r),t.positionZ.linearRampToValueAtTime(Ch.z,r),t.forwardX.linearRampToValueAtTime(Nh.x,r),t.forwardY.linearRampToValueAtTime(Nh.y,r),t.forwardZ.linearRampToValueAtTime(Nh.z,r),t.upX.linearRampToValueAtTime(n.x,r),t.upY.linearRampToValueAtTime(n.y,r),t.upZ.linearRampToValueAtTime(n.z,r)}else t.setPosition(Ch.x,Ch.y,Ch.z),t.setOrientation(Nh.x,Nh.y,Nh.z,n.x,n.y,n.z)}}),jh.prototype=Object.assign(Object.create(hr.prototype),{constructor:jh,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(e){if(void 0===e&&(e=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._pausedAt=(this.context.currentTime-this._startedAt)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(e){return this.loopStart=e,this},setLoopEnd:function(e){return this.loopEnd=e,this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});var Uh=new Bn,Bh=new Fn,kh=new Bn,zh=new Bn;function Gh(e){jh.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function Vh(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function Hh(e,t,n){this.binding=e,this.valueSize=n;var r,i=Float64Array;switch(t){case"quaternion":r=this._slerp;break;case"string":case"bool":i=Array,r=this._select;break;default:r=this._lerp}this.buffer=new i(4*n),this._mixBufferRegion=r,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Gh.prototype=Object.assign(Object.create(jh.prototype),{constructor:Gh,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(e){if(hr.prototype.updateMatrixWorld.call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(Uh,Bh,kh),zh.set(0,0,1).applyQuaternion(Bh);var t=this.panner;if(t.positionX){var n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Uh.x,n),t.positionY.linearRampToValueAtTime(Uh.y,n),t.positionZ.linearRampToValueAtTime(Uh.z,n),t.orientationX.linearRampToValueAtTime(zh.x,n),t.orientationY.linearRampToValueAtTime(zh.y,n),t.orientationZ.linearRampToValueAtTime(zh.z,n)}else t.setPosition(Uh.x,Uh.y,Uh.z),t.setOrientation(zh.x,zh.y,zh.z)}}}),Object.assign(Vh.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}),Object.assign(Hh.prototype,{accumulate:function(e,t){var n=this.buffer,r=this.valueSize,i=e*r+r,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==r;++a)n[i+a]=n[a];o=t}else{var s=t/(o+=t);this._mixBufferRegion(n,i,0,s,r)}this.cumulativeWeight=o},apply:function(e){var t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,i<1){var a=3*t;this._mixBufferRegion(n,r,a,1-i,t)}for(var s=t,u=t+t;s!==u;++s)if(n[s]!==n[s+t]){o.setValue(n,r);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,n=this.valueSize,r=3*n;e.getValue(t,r);for(var i=n,o=r;i!==o;++i)t[i]=t[r+i%n];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,n,r,i){if(r>=.5)for(var o=0;o!==i;++o)e[t+o]=e[n+o]},_slerp:function(e,t,n,r){Fn.slerpFlat(e,t,e,t,e,n,r)},_lerp:function(e,t,n,r,i){for(var o=1-r,a=0;a!==i;++a){var s=t+a;e[s]=e[s]*o+e[n+a]*r}}});var Wh=new RegExp("[\\[\\]\\.:\\/]","g"),Xh="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Yh=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),qh=/(WCOD+)?/.source.replace("WCOD",Xh),Qh=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Zh=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Kh=new RegExp("^"+Yh+qh+Qh+Zh+"$"),Jh=["material","materials","bones"];function $h(e,t,n){var r=n||ep.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function ep(e,t,n){this.path=t,this.parsedPath=n||ep.parseTrackName(t),this.node=ep.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function tp(){this.uuid=An.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}function np(e,t,n){this._mixer=e,this._clip=t,this._localRoot=n||null;for(var r=t.tracks,i=r.length,o=new Array(i),a={endingStart:Rt,endingEnd:Rt},s=0;s!==i;++s){var u=r[s].createInterpolant(null);o[s]=u,u.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Pt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function rp(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function ip(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function op(e,t,n){Ps.call(this,e,t),this.meshPerAttribute=n||1}function ap(e,t,n,r){this.ray=new jr(e,t),this.near=n||0,this.far=r||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function sp(e,t){return e.distance-t.distance}function up(e,t,n,r){if(!1!==e.visible&&(e.raycast(t,n),!0===r))for(var i=e.children,o=0,a=i.length;o<a;o++)up(i[o],t,n,!0)}function cp(e,t,n){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==n?n:0,this}function lp(e,t,n){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==n?n:0,this}Object.assign($h.prototype,{getValue:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)},setValue:function(e,t){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(ep,{Composite:$h,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new ep.Composite(e,t,n):new ep(e,t,n)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(Wh,"")},parseTrackName:function(e){var t=Kh.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var i=n.nodeName.substring(r+1);-1!==Jh.indexOf(i)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n},findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var r=function(e){for(var n=0;n<e.length;n++){var i=e[n];if(i.name===t||i.uuid===t)return i;var o=r(i.children);if(o)return o}return null},i=r(e.children);if(i)return i}return null}}),Object.assign(ep.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)e[t++]=n[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++]},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,n=t.objectName,r=t.propertyName,i=t.propertyIndex;if(e||(e=ep.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(n){var o=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var a=0;a<e.length;a++)if(e[a].name===o){o=a;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==o){if(void 0===e[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var s=e[r];if(void 0!==s){var u=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?u=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(u=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(e.geometry.morphAttributes.position[a].name===i){i=a;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(e.geometry.morphTargets[a].name===i){i=a;break}}}c=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(c=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][u]}else{var l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+r+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(ep.prototype,{_getValue_unbound:ep.prototype.getValue,_setValue_unbound:ep.prototype.setValue}),Object.assign(tp.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,u=void 0,c=0,l=arguments.length;c!==l;++c){var h=arguments[c],p=h.uuid,f=r[p];if(void 0===f){f=t++,r[p]=f,e.push(h);for(var d=0,m=s;d!==m;++d)a[d].push(new ep(h,i[d],o[d]))}else if(f<n){u=e[f];var v=--n,g=e[v];r[g.uuid]=f,e[f]=g,r[p]=v,e[v]=h;for(d=0,m=s;d!==m;++d){var y=a[d],b=y[v],x=y[f];y[f]=b,void 0===x&&(x=new ep(h,i[d],o[d])),y[v]=x}}else e[f]!==u&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,i=r.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],u=s.uuid,c=n[u];if(void 0!==c&&c>=t){var l=t++,h=e[l];n[h.uuid]=c,e[c]=h,n[u]=l,e[l]=s;for(var p=0,f=i;p!==f;++p){var d=r[p],m=d[l],v=d[c];d[c]=m,d[l]=v}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._bindings,o=i.length,a=0,s=arguments.length;a!==s;++a){var u=arguments[a],c=u.uuid,l=r[c];if(void 0!==l)if(delete r[c],l<n){var h=--n,p=e[h],f=e[y=--t];r[p.uuid]=l,e[l]=p,r[f.uuid]=h,e[h]=f,e.pop();for(var d=0,m=o;d!==m;++d){var v=(b=i[d])[h],g=b[y];b[l]=v,b[h]=g,b.pop()}}else{var y;r[(f=e[y=--t]).uuid]=l,e[l]=f,e.pop();for(d=0,m=o;d!==m;++d){var b;(b=i[d])[l]=b[y],b.pop()}}}this.nCachedObjects_=n},subscribe_:function(e,t){var n=this._bindingsIndicesByPath,r=n[e],i=this._bindings;if(void 0!==r)return i[r];var o=this._paths,a=this._parsedPaths,s=this._objects,u=s.length,c=this.nCachedObjects_,l=new Array(u);r=i.length,n[e]=r,o.push(e),a.push(t),i.push(l);for(var h=c,p=s.length;h!==p;++h){var f=s[h];l[h]=new ep(f,e,t)}return l},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var r=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];t[e[a]]=n,o[n]=s,o.pop(),i[n]=i[a],i.pop(),r[n]=r[a],r.pop()}}}),Object.assign(np.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var r=this._clip.duration,i=e._clip.duration,o=i/r,a=r/i;e.warp(1,o,t),this.warp(a,1,t)}return this},crossFadeTo:function(e,t,n){return e.crossFadeFrom(this,t,n)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,n){var r=this._mixer,i=r.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,u=o.sampleValues;return s[0]=i,s[1]=i+n,u[0]=e/a,u[1]=t/a,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,n,r){if(this.enabled){var i=this._startTime;if(null!==i){var o=(e-i)*n;if(o<0||0===n)return;this._startTime=null,t=n*o}t*=this._updateTimeScale(e);var a=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var u=this._interpolants,c=this._propertyBindings,l=0,h=u.length;l!==h;++l)u[l].evaluate(a),c[l].accumulate(r,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,n=this._clip.duration,r=this.loop,i=this._loopCount,o=r===Ot;if(0===e)return-1===i?t:o&&1==(1&i)?n-t:t;if(r===At){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=n)t=n;else{if(!(t<0)){this.time=t;break e}t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=n||t<0){var a=Math.floor(t/n);t-=n*a,i+=Math.abs(a);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?n:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var u=e<0;this._setEndings(u,!u,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=t;if(o&&1==(1&i))return n-t}return t},_setEndings:function(e,t,n){var r=this._interpolantSettings;n?(r.endingStart=Dt,r.endingEnd=Dt):(r.endingStart=e?this.zeroSlopeAtStart?Dt:Rt:Nt,r.endingEnd=t?this.zeroSlopeAtEnd?Dt:Rt:Nt)},_scheduleFading:function(e,t,n){var r=this._mixer,i=r.time,o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=t,a[1]=i+e,s[1]=n,this}}),rp.prototype=Object.assign(Object.create(Tn.prototype),{constructor:rp,_bindAction:function(e,t){var n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,o=e._propertyBindings,a=e._interpolants,s=n.uuid,u=this._bindingsByRootAndName,c=u[s];void 0===c&&(c={},u[s]=c);for(var l=0;l!==i;++l){var h=r[l],p=h.name,f=c[p];if(void 0!==f)o[l]=f;else{if(void 0!==(f=o[l])){null===f._cacheIndex&&(++f.referenceCount,this._addInactiveBinding(f,s,p));continue}var d=t&&t._propertyBindings[l].binding.parsedPath;++(f=new Hh(ep.create(n,p,d),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(f,s,p),o[l]=f}a[l].resultBuffer=f.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}for(var i=e._propertyBindings,o=0,a=i.length;o!==a;++o){var s=i[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){var r=this._actions,i=this._actionsByClip,o=i[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{var a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e},_removeInactiveAction:function(e){var t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;var i=e._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,u=s[s.length-1],c=e._byClipCacheIndex;u._byClipCacheIndex=c,s[c]=u,s.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(e){var t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackAction:function(e){var t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_addInactiveBinding:function(e,t,n){var r=this._bindingsByRootAndName,i=r[t],o=this._bindings;void 0===i&&(i={},r[t]=i),i[n]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,a=o[r],s=t[t.length-1],u=e._cacheIndex;s._cacheIndex=u,t[u]=s,t.pop(),delete a[i],0===Object.keys(a).length&&delete o[r]},_lendBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new tl(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=n),n},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var n=t||this._root,r=n.uuid,i="string"==typeof e?hl.findByName(n,e):e,o=null!==i?i.uuid:e,a=this._actionsByClip[o],s=null;if(void 0!==a){var u=a.actionByRoot[r];if(void 0!==u)return u;s=a.knownActions[0],null===i&&(i=s._clip)}if(null===i)return null;var c=new np(this,i,t);return this._bindAction(c,s),this._addInactiveAction(c,o,r),c},existingAction:function(e,t){var n=t||this._root,r=n.uuid,i="string"==typeof e?hl.findByName(n,e):e,o=i?i.uuid:e,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[r]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,n=this._bindings,r=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==t;++i)e[i].reset();for(i=0;i!==r;++i)n[i].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1,a=0;a!==n;++a){t[a]._update(r,e,i,o)}var s=this._bindings,u=this._nActiveBindings;for(a=0;a!==u;++a)s[a].apply(o);return this},setTime:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){for(var o=i.knownActions,a=0,s=o.length;a!==s;++a){var u=o[a];this._deactivateAction(u);var c=u._cacheIndex,l=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,l._cacheIndex=c,t[c]=l,t.pop(),this._removeInactiveBindingsForAction(u)}delete r[n]}},uncacheRoot:function(e){var t=e.uuid,n=this._actionsByClip;for(var r in n){var i=n[r].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}),ip.prototype.clone=function(){return new ip(void 0===this.value.clone?this.value:this.value.clone())},op.prototype=Object.assign(Object.create(Ps.prototype),{constructor:op,isInstancedInterleavedBuffer:!0,copy:function(e){return Ps.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(ap.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,n){var r=n||[];return up(e,this,r,t),r.sort(sp),r},intersectObjects:function(e,t,n){var r=n||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var i=0,o=e.length;i<o;i++)up(e[i],this,r,t);return r.sort(sp),r}}),Object.assign(cp.prototype,{set:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(An.clamp(t/this.radius,-1,1))),this}}),Object.assign(lp.prototype,{set:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}});var hp=new Pn;function pp(e,t){this.min=void 0!==e?e:new Pn(1/0,1/0),this.max=void 0!==t?t:new Pn(-1/0,-1/0)}Object.assign(pp.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var n=hp.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Pn),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Pn),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Pn),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Pn),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return hp.copy(e).clamp(this.min,this.max).sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var fp=new Bn,dp=new Bn;function mp(e,t){this.start=void 0!==e?e:new Bn,this.end=void 0!==t?t:new Bn}function vp(e){hr.call(this),this.material=e,this.render=function(){}}Object.assign(mp.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Bn),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Bn),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new Bn),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){fp.subVectors(e,this.start),dp.subVectors(this.end,this.start);var n=dp.dot(dp),r=dp.dot(fp)/n;return t&&(r=An.clamp(r,0,1)),r},closestPointToPoint:function(e,t,n){var r=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new Bn),this.delta(n).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),vp.prototype=Object.create(hr.prototype),vp.prototype.constructor=vp,vp.prototype.isImmediateRenderObject=!0;var gp=new Bn;function yp(e,t){hr.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var n=new Li,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,o=1;i<32;i++,o++){var a=i/32*Math.PI*2,s=o/32*Math.PI*2;r.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new bi(r,3));var u=new au({fog:!1});this.cone=new mu(n,u),this.add(this.cone),this.update()}yp.prototype=Object.create(hr.prototype),yp.prototype.constructor=yp,yp.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},yp.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),gp.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(gp),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var bp=new Bn,xp=new Yn,wp=new Yn;function _p(e){for(var t=function e(t){var n=[];t&&t.isBone&&n.push(t);for(var r=0;r<t.children.length;r++)n.push.apply(n,e(t.children[r]));return n}(e),n=new Li,r=[],i=[],o=new ni(0,0,1),a=new ni(0,1,0),s=0;s<t.length;s++){var u=t[s];u.parent&&u.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}n.setAttribute("position",new bi(r,3)),n.setAttribute("color",new bi(i,3));var c=new au({vertexColors:M,depthTest:!1,depthWrite:!1,transparent:!0});mu.call(this,n,c),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function Tp(e,t,n){this.light=e,this.light.updateMatrixWorld(),this.color=n;var r=new Mc(t,4,2),i=new ci({wireframe:!0,fog:!1});qi.call(this,r,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}_p.prototype=Object.create(mu.prototype),_p.prototype.constructor=_p,_p.prototype.updateMatrixWorld=function(e){var t=this.bones,n=this.geometry,r=n.getAttribute("position");wp.getInverse(this.root.matrixWorld);for(var i=0,o=0;i<t.length;i++){var a=t[i];a.parent&&a.parent.isBone&&(xp.multiplyMatrices(wp,a.matrixWorld),bp.setFromMatrixPosition(xp),r.setXYZ(o,bp.x,bp.y,bp.z),xp.multiplyMatrices(wp,a.parent.matrixWorld),bp.setFromMatrixPosition(xp),r.setXYZ(o+1,bp.x,bp.y,bp.z),o+=2)}n.getAttribute("position").needsUpdate=!0,hr.prototype.updateMatrixWorld.call(this,e)},Tp.prototype=Object.create(qi.prototype),Tp.prototype.constructor=Tp,Tp.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Tp.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var Sp=new Bn,Mp=new ni,Ep=new ni;function Ap(e,t,n){hr.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;var r=new Fu(t);r.rotateY(.5*Math.PI),this.material=new ci({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=M);var i=r.getAttribute("position"),o=new Float32Array(3*i.count);r.setAttribute("color",new hi(o,3)),this.add(new qi(r,this.material)),this.update()}function Pp(e,t,n,r){e=e||10,t=t||10,n=new ni(void 0!==n?n:4473924),r=new ni(void 0!==r?r:8947848);for(var i=t/2,o=e/t,a=e/2,s=[],u=[],c=0,l=0,h=-a;c<=t;c++,h+=o){s.push(-a,0,h,a,0,h),s.push(h,0,-a,h,0,a);var p=c===i?n:r;p.toArray(u,l),l+=3,p.toArray(u,l),l+=3,p.toArray(u,l),l+=3,p.toArray(u,l),l+=3}var f=new Li;f.setAttribute("position",new bi(s,3)),f.setAttribute("color",new bi(u,3));var d=new au({vertexColors:M});mu.call(this,f,d)}function Op(e,t,n,r,i,o){e=e||10,t=t||16,n=n||8,r=r||64,i=new ni(void 0!==i?i:4473924),o=new ni(void 0!==o?o:8947848);var a,s,u,c,l,h,p,f=[],d=[];for(c=0;c<=t;c++)u=c/t*(2*Math.PI),a=Math.sin(u)*e,s=Math.cos(u)*e,f.push(0,0,0),f.push(a,0,s),p=1&c?i:o,d.push(p.r,p.g,p.b),d.push(p.r,p.g,p.b);for(c=0;c<=n;c++)for(p=1&c?i:o,h=e-e/n*c,l=0;l<r;l++)u=l/r*(2*Math.PI),a=Math.sin(u)*h,s=Math.cos(u)*h,f.push(a,0,s),d.push(p.r,p.g,p.b),u=(l+1)/r*(2*Math.PI),a=Math.sin(u)*h,s=Math.cos(u)*h,f.push(a,0,s),d.push(p.r,p.g,p.b);var m=new Li;m.setAttribute("position",new bi(f,3)),m.setAttribute("color",new bi(d,3));var v=new au({vertexColors:M});mu.call(this,m,v)}Ap.prototype=Object.create(hr.prototype),Ap.prototype.constructor=Ap,Ap.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Ap.prototype.update=function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");Mp.copy(this.light.color),Ep.copy(this.light.groundColor);for(var n=0,r=t.count;n<r;n++){var i=n<r/2?Mp:Ep;t.setXYZ(n,i.r,i.g,i.b)}t.needsUpdate=!0}e.lookAt(Sp.setFromMatrixPosition(this.light.matrixWorld).negate())},Pp.prototype=Object.assign(Object.create(mu.prototype),{constructor:Pp,copy:function(e){return mu.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),Op.prototype=Object.create(mu.prototype),Op.prototype.constructor=Op;var Lp=new Bn,Ip=new Bn,Cp=new Bn;function Rp(e,t,n){hr.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);var r=new Li;r.setAttribute("position",new bi([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var i=new au({fog:!1});this.lightPlane=new pu(r,i),this.add(this.lightPlane),(r=new Li).setAttribute("position",new bi([0,0,0,0,0,1],3)),this.targetLine=new pu(r,i),this.add(this.targetLine),this.update()}Rp.prototype=Object.create(hr.prototype),Rp.prototype.constructor=Rp,Rp.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Rp.prototype.update=function(){Lp.setFromMatrixPosition(this.light.matrixWorld),Ip.setFromMatrixPosition(this.light.target.matrixWorld),Cp.subVectors(Ip,Lp),this.lightPlane.lookAt(Ip),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Ip),this.targetLine.scale.z=Cp.length()};var Dp=new Bn,Np=new lo;function Fp(e){var t=new Li,n=new au({color:16777215,vertexColors:S}),r=[],i=[],o={},a=new ni(16755200),s=new ni(16711680),u=new ni(43775),c=new ni(16777215),l=new ni(3355443);function h(e,t,n){p(e,n),p(t,n)}function p(e,t){r.push(0,0,0),i.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(r.length/3-1)}h("n1","n2",a),h("n2","n4",a),h("n4","n3",a),h("n3","n1",a),h("f1","f2",a),h("f2","f4",a),h("f4","f3",a),h("f3","f1",a),h("n1","f1",a),h("n2","f2",a),h("n3","f3",a),h("n4","f4",a),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",u),h("u2","u3",u),h("u3","u1",u),h("c","t",c),h("p","c",l),h("cn1","cn2",l),h("cn3","cn4",l),h("cf1","cf2",l),h("cf3","cf4",l),t.setAttribute("position",new bi(r,3)),t.setAttribute("color",new bi(i,3)),mu.call(this,t,n),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function jp(e,t,n,r,i,o,a){Dp.set(i,o,a).unproject(r);var s=t[e];if(void 0!==s)for(var u=n.getAttribute("position"),c=0,l=s.length;c<l;c++)u.setXYZ(s[c],Dp.x,Dp.y,Dp.z)}Fp.prototype=Object.create(mu.prototype),Fp.prototype.constructor=Fp,Fp.prototype.update=function(){var e=this.geometry,t=this.pointMap;Np.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),jp("c",t,e,Np,0,0,-1),jp("t",t,e,Np,0,0,1),jp("n1",t,e,Np,-1,-1,-1),jp("n2",t,e,Np,1,-1,-1),jp("n3",t,e,Np,-1,1,-1),jp("n4",t,e,Np,1,1,-1),jp("f1",t,e,Np,-1,-1,1),jp("f2",t,e,Np,1,-1,1),jp("f3",t,e,Np,-1,1,1),jp("f4",t,e,Np,1,1,1),jp("u1",t,e,Np,.7,1.1,-1),jp("u2",t,e,Np,-.7,1.1,-1),jp("u3",t,e,Np,0,2,-1),jp("cf1",t,e,Np,-1,0,1),jp("cf2",t,e,Np,1,0,1),jp("cf3",t,e,Np,0,-1,1),jp("cf4",t,e,Np,0,1,1),jp("cn1",t,e,Np,-1,0,-1),jp("cn2",t,e,Np,1,0,-1),jp("cn3",t,e,Np,0,-1,-1),jp("cn4",t,e,Np,0,1,-1),e.getAttribute("position").needsUpdate=!0};var Up=new Er;function Bp(e,t){this.object=e,void 0===t&&(t=16776960);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new Li;i.setIndex(new hi(n,1)),i.setAttribute("position",new hi(r,3)),mu.call(this,i,new au({color:t})),this.matrixAutoUpdate=!1,this.update()}function kp(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Li;r.setIndex(new hi(n,1)),r.setAttribute("position",new bi([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),mu.call(this,r,new au({color:t})),this.geometry.computeBoundingSphere()}function zp(e,t,n){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var r=void 0!==n?n:16776960,i=new Li;i.setAttribute("position",new bi([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),pu.call(this,i,new au({color:r}));var o=new Li;o.setAttribute("position",new bi([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new qi(o,new ci({color:r,opacity:.2,transparent:!0,depthWrite:!1})))}Bp.prototype=Object.create(mu.prototype),Bp.prototype.constructor=Bp,Bp.prototype.update=function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Up.setFromObject(this.object),!Up.isEmpty()){var t=Up.min,n=Up.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=t.x,i[4]=n.y,i[5]=n.z,i[6]=t.x,i[7]=t.y,i[8]=n.z,i[9]=n.x,i[10]=t.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=t.z,i[15]=t.x,i[16]=n.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=n.x,i[22]=t.y,i[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}},Bp.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Bp.prototype.copy=function(e){return mu.prototype.copy.call(this,e),this.object=e.object,this},Bp.prototype.clone=function(){return(new this.constructor).copy(this)},kp.prototype=Object.create(mu.prototype),kp.prototype.constructor=kp,kp.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),hr.prototype.updateMatrixWorld.call(this,e))},zp.prototype=Object.create(pu.prototype),zp.prototype.constructor=zp,zp.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?b:y,this.lookAt(this.plane.normal),hr.prototype.updateMatrixWorld.call(this,e)};var Gp,Vp,Hp=new Bn;function Wp(e,t,n,r,i,o){hr.call(this),void 0===e&&(e=new Bn(0,0,1)),void 0===t&&(t=new Bn(0,0,0)),void 0===n&&(n=1),void 0===r&&(r=16776960),void 0===i&&(i=.2*n),void 0===o&&(o=.2*i),void 0===Gp&&((Gp=new Li).setAttribute("position",new bi([0,0,0,0,1,0],3)),(Vp=new Nc(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new pu(Gp,new au({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new qi(Vp,new ci({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,o)}function Xp(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new Li;n.setAttribute("position",new bi(t,3)),n.setAttribute("color",new bi([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var r=new au({vertexColors:M});mu.call(this,n,r)}Wp.prototype=Object.create(hr.prototype),Wp.prototype.constructor=Wp,Wp.prototype.setDirection=function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Hp.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Hp,t)}},Wp.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},Wp.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},Wp.prototype.copy=function(e){return hr.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},Wp.prototype.clone=function(){return(new this.constructor).copy(this)},Xp.prototype=Object.create(mu.prototype),Xp.prototype.constructor=Xp;var Yp,qp,Qp,Zp,Kp=4,Jp=8,$p=Math.pow(2,Jp),ef=[.125,.215,.35,.446,.526,.582],tf=Jp-Kp+1+ef.length,nf=20,rf={[Bt]:0,[kt]:1,[Gt]:2,[Ht]:3,[Wt]:4,[Xt]:5,[zt]:6},of=new th,af=(Yp=nf,qp=new Float32Array(Yp),Qp=new Bn(0,1,0),(Zp=new Gc({defines:{n:Yp},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:qp},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:Qp},inputEncoding:{value:rf[Bt]},outputEncoding:{value:rf[Bt]}},vertexShader:Of(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform int samples;\nuniform float weights[n];\nuniform bool latitudinal;\nuniform float dTheta;\nuniform float mipInt;\nuniform vec3 poleAxis;\n\n${Lf()}\n\n#define ENVMAP_TYPE_CUBE_UV\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tfor (int i = 0; i < n; i++) {\n\t\tif (i >= samples)\n\t\t\tbreak;\n\t\tfor (int dir = -1; dir < 2; dir += 2) {\n\t\t\tif (i == 0 && dir == 1)\n\t\t\t\tcontinue;\n\t\t\tvec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);\n\t\t\tif (all(equal(axis, vec3(0.0))))\n\t\t\t\taxis = cross(vec3(0.0, 1.0, 0.0), vOutputDirection);\n\t\t\taxis = normalize(axis);\n\t\t\tfloat theta = dTheta * float(dir * i);\n\t\t\tfloat cosTheta = cos(theta);\n\t\t\t// Rodrigues' axis-angle rotation\n\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross(axis, vOutputDirection) * sin(theta)\n\t\t\t\t\t+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);\n\t\t\tgl_FragColor.rgb +=\n\t\t\t\t\tweights[i] * bilinearCubeUV(envMap, sampleDirection, mipInt);\n\t\t}\n\t}\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:E,depthTest:!1,depthWrite:!1})).type="SphericalGaussianBlur",Zp),sf=null,uf=null,{_lodPlanes:cf,_sizeLods:lf,_sigmas:hf}=function(){for(var e=[],t=[],n=[],r=Jp,i=0;i<tf;i++){var o=Math.pow(2,r);t.push(o);var a=1/o;i>Jp-Kp?a=ef[i-Jp+Kp-1]:0==i&&(a=0),n.push(a);for(var s=1/(o-1),u=-s/2,c=1+s/2,l=[u,u,c,u,c,c,u,u,c,c,u,c],h=new Float32Array(108),p=new Float32Array(72),f=new Float32Array(36),d=0;d<6;d++){var m=d%3*2/3-1,v=d>2?0:-1,g=[m,v,0,m+2/3,v,0,m+2/3,v+1,0,m,v,0,m+2/3,v+1,0,m,v+1,0];h.set(g,18*d),p.set(l,12*d);var y=[d,d,d,d,d,d];f.set(y,6*d)}var b=new Li;b.setAttribute("position",new hi(h,3)),b.setAttribute("uv",new hi(p,2)),b.setAttribute("faceIndex",new hi(f,1)),e.push(b),r>Kp&&r--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}(),pf=null,ff=null,df=null,mf=(1+Math.sqrt(5))/2,vf=1/mf,gf=[new Bn(1,1,1),new Bn(-1,1,1),new Bn(1,1,-1),new Bn(-1,1,-1),new Bn(0,mf,vf),new Bn(0,mf,-vf),new Bn(vf,0,mf),new Bn(-vf,0,mf),new Bn(mf,vf,0),new Bn(-mf,vf,0)];function yf(e){ff=e,wf(af)}function bf(e){var t={magFilter:_e,minFilter:_e,generateMipmaps:!1,type:e?e.type:Ce,format:e?e.format:Qe,encoding:e?e.encoding:Gt,depthBuffer:!1,stencilBuffer:!1},n=_f(t);return n.depthBuffer=!e,pf=_f(t),n}function xf(e){pf.dispose(),ff.setRenderTarget(df),e.scissorTest=!1,e.setSize(e.width,e.height)}function wf(e){var t=new pr;t.add(new qi(cf[0],e)),ff.compile(t,of)}function _f(e){var t=new Dn(3*$p,3*$p,e);return t.texture.mapping=ge,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function Tf(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function Sf(e){var t=ff.autoClear;ff.autoClear=!1;for(var n=1;n<tf;n++){Mf(e,n-1,n,Math.sqrt(hf[n]*hf[n]-hf[n-1]*hf[n-1]),gf[(n-1)%gf.length])}ff.autoClear=t}function Mf(e,t,n,r,i){Ef(e,pf,t,n,r,"latitudinal",i),Ef(pf,e,n,n,r,"longitudinal",i)}function Ef(e,t,n,r,i,o,a){"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");var s=new pr;s.add(new qi(cf[r],af));var u=af.uniforms,c=lf[n]-1,l=isFinite(i)?Math.PI/(2*c):2*Math.PI/(2*nf-1),h=i/l,p=isFinite(i)?1+Math.floor(3*h):nf;p>nf&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${p} samples when the maximum is set to ${nf}`);for(var f=[],d=0,m=0;m<nf;++m){var v=m/h,g=Math.exp(-v*v/2);f.push(g),0==m?d+=g:m<p&&(d+=2*g)}for(m=0;m<f.length;m++)f[m]=f[m]/d;u.envMap.value=e.texture,u.samples.value=p,u.weights.value=f,u.latitudinal.value="latitudinal"===o,a&&(u.poleAxis.value=a),u.dTheta.value=l,u.mipInt.value=Jp-n,u.inputEncoding.value=rf[e.texture.encoding],u.outputEncoding.value=rf[e.texture.encoding];var y=lf[r];Tf(t,v=3*Math.max(0,$p-2*y),(0===r?0:2*$p)+2*y*(r>Jp-Kp?r-Jp+Kp:0),3*y,2*y),ff.setRenderTarget(t),ff.render(s,of)}function Af(){var e=new Gc({uniforms:{envMap:{value:null},texelSize:{value:new Pn(1,1)},inputEncoding:{value:rf[Bt]},outputEncoding:{value:rf[Bt]}},vertexShader:Of(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform vec2 texelSize;\n\n${Lf()}\n\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tvec3 outputDirection = normalize(vOutputDirection);\n\tvec2 uv;\n\tuv.y = asin(clamp(outputDirection.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;\n\tuv.x = atan(outputDirection.z, outputDirection.x) * RECIPROCAL_PI2 + 0.5;\n\tvec2 f = fract(uv / texelSize - 0.5);\n\tuv -= f * texelSize;\n\tvec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x += texelSize.x;\n\tvec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.y += texelSize.y;\n\tvec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x -= texelSize.x;\n\tvec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tvec3 tm = mix(tl, tr, f.x);\n\tvec3 bm = mix(bl, br, f.x);\n\tgl_FragColor.rgb = mix(tm, bm, f.y);\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:E,depthTest:!1,depthWrite:!1});return e.type="EquirectangularToCubeUV",e}function Pf(){var e=new Gc({uniforms:{envMap:{value:null},inputEncoding:{value:rf[Bt]},outputEncoding:{value:rf[Bt]}},vertexShader:Of(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform samplerCube envMap;\n\n${Lf()}\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:E,depthTest:!1,depthWrite:!1});return e.type="CubemapToCubeUV",e}function Of(){return"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.x *= -1.0;\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.y *= -1.0;\n\t} else if (face == 5.0) {\n\t\tdirection.xz *= -1.0;\n\t}\n\treturn direction;\n}\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t"}function Lf(){return"\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t"}function If(e,t,n,r,i,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new ai(e,t,n,i,o,a)}yf.prototype={constructor:yf,fromScene:function(e,t=0,n=.1,r=100){df=ff.getRenderTarget();var i=bf();return function(e,t,n,r){var i=new ho(90,1,t,n),o=[1,1,1,1,-1,1],a=[1,1,-1,-1,-1,1],s=ff.outputEncoding,u=ff.toneMapping,c=ff.toneMappingExposure,l=ff.getClearColor(),h=ff.getClearAlpha();ff.toneMapping=ae,ff.toneMappingExposure=1,ff.outputEncoding=Bt,e.scale.z*=-1;var p=e.background;if(p&&p.isColor){p.convertSRGBToLinear();var f=Math.max(p.r,p.g,p.b),d=Math.min(Math.max(Math.ceil(Math.log2(f)),-128),127);p=p.multiplyScalar(Math.pow(2,-d));var m=(d+128)/255;ff.setClearColor(p,m),e.background=null}for(var v=0;v<6;v++){var g=v%3;0==g?(i.up.set(0,o[v],0),i.lookAt(a[v],0,0)):1==g?(i.up.set(0,0,o[v]),i.lookAt(0,a[v],0)):(i.up.set(0,o[v],0),i.lookAt(0,0,a[v])),Tf(r,g*$p,v>2?$p:0,$p,$p),ff.setRenderTarget(r),ff.render(e,i)}ff.toneMapping=u,ff.toneMappingExposure=c,ff.outputEncoding=s,ff.setClearColor(l,h),e.scale.z*=-1}(e,n,r,i),t>0&&Mf(i,0,0,t),Sf(i),xf(i),i},fromEquirectangular:function(e){return e.magFilter=_e,e.minFilter=_e,e.generateMipmaps=!1,this.fromCubemap(e)},fromCubemap:function(e){df=ff.getRenderTarget();var t=bf(e);return function(e,t){var n=new pr;e.isCubeTexture?null==uf&&(uf=Pf()):null==sf&&(sf=Af());var r=e.isCubeTexture?uf:sf;n.add(new qi(cf[0],r));var i=r.uniforms;i.envMap.value=e,e.isCubeTexture||i.texelSize.value.set(1/e.image.width,1/e.image.height);i.inputEncoding.value=rf[e.encoding],i.outputEncoding.value=rf[e.encoding],Tf(t,0,0,3*$p,2*$p),ff.setRenderTarget(t),ff.render(n,of)}(e,t),Sf(t),xf(t),t},compileCubemapShader:function(){null==uf&&wf(uf=Pf())},compileEquirectangularShader:function(){null==sf&&wf(sf=Af())},dispose:function(){af.dispose(),null!=uf&&uf.dispose(),null!=sf&&sf.dispose();for(var e=0;e<cf.length;e++)cf[e].dispose()}};var Cf=0,Rf=1;function Df(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function Nf(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function Ff(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new _u(e,t)}function jf(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Ws(e)}function Uf(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new _u(e,t)}function Bf(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new gu(e)}function kf(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new gu(e)}function zf(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new gu(e)}function Gf(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Bn(e,t,n)}function Vf(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new hi(e,t).setUsage(mn)}function Hf(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new pi(e,t)}function Wf(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new fi(e,t)}function Xf(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new di(e,t)}function Yf(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new mi(e,t)}function qf(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new vi(e,t)}function Qf(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new gi(e,t)}function Zf(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new yi(e,t)}function Kf(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new bi(e,t)}function Jf(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new xi(e,t)}function $f(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Rl.call(this,e),this.type="catmullrom",this.closed=!0}function ed(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Rl.call(this,e),this.type="catmullrom"}function td(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Rl.call(this,e),this.type="catmullrom"}function nd(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Xp(e)}function rd(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Bp(e,t)}function id(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new mu(new Rc(e.geometry),new au({color:void 0!==t?t:16777215}))}function od(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new mu(new Pu(e.geometry),new au({color:void 0!==t?t:16777215}))}function ad(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new yl(e)}function sd(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new wl(e)}function ud(e,t,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new vo(e,n)}Ml.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Ml.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(Wl.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new to,n=0,r=e.length;n<r;n++){var i=e[n];t.vertices.push(new Bn(i.x,i.y,i.z||0))}return t}}),Object.assign(Xl.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),$f.prototype=Object.create(Rl.prototype),ed.prototype=Object.create(Rl.prototype),td.prototype=Object.create(Rl.prototype),Object.assign(td.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Pp.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},_p.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(vl.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),sh.extractUrlBase(e)}}),vl.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(ph.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(pp.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Er.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),xo.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},mp.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(An,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),An.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),An.ceilPowerOfTwo(e)}}),Object.assign(On.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Yn.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Bn).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,i,o)}}),zr.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Fn.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(jr.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Jr.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Jr,{barycoordFromPoint:function(e,t,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Jr.getBarycoord(e,t,n,r,i)},normal:function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Jr.getNormal(e,t,n,r)}}),Object.assign(Yl.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new yc(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Lc(this,e)}}),Object.assign(Pn.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Bn.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Rn.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(to.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.assign(hr.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(hr.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(qi.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(qi.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Ft},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Qs.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty($s.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Zs.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Ml.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),ho.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(ql.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(hi.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===mn},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(mn)}}}),Object.assign(hi.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?mn:dn),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Li.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new hi(arguments[1],arguments[2])))},addDrawCall:function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(Li.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Ps.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===mn},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(Ps.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?mn:dn),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(bc.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(ip.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(ui.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new ni}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===w}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(Wc.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(co.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(Ms.prototype,{clearTarget:function(e,t,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Ms.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?kt:Bt}}}),Object.defineProperties(vs.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Dn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(jh.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new Th).load(e,(function(e){t.setBuffer(e)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),Vh.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},mo.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var cd={merge:function(e,t,n){var r;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,n)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};function ld(){console.error("THREE.CanvasRenderer has been removed")}function hd(){console.error("THREE.JSONLoader has been removed.")}Ln.crossOrigin=void 0,Ln.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new Sl;i.setCrossOrigin(this.crossOrigin);var o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},Ln.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new Tl;i.setCrossOrigin(this.crossOrigin);var o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},Ln.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Ln.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var pd={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};function fd(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:o}}));var dd,md,vd=function(){uh.call(this),this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new bi([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new bi([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))};vd.prototype=Object.assign(Object.create(uh.prototype),{constructor:vd,isLineSegmentsGeometry:!0,applyMatrix4:function(e){var t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),n.applyMatrix4(e),t.data.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(e){var t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));var n=new op(t,6,1);return this.setAttribute("instanceStart",new Is(n,3,0)),this.setAttribute("instanceEnd",new Is(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(e){var t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));var n=new op(t,6,1);return this.setAttribute("instanceColorStart",new Is(n,3,0)),this.setAttribute("instanceColorEnd",new Is(n,3,3)),this},fromWireframeGeometry:function(e){return this.setPositions(e.attributes.position.array),this},fromEdgesGeometry:function(e){return this.setPositions(e.attributes.position.array),this},fromMesh:function(e){return this.fromWireframeGeometry(new Pu(e.geometry)),this},fromLineSegements:function(e){var t=e.geometry;return t.isGeometry?this.setPositions(t.vertices):t.isBufferGeometry&&this.setPositions(t.position.array),this},computeBoundingBox:(md=new Er,function(){null===this.boundingBox&&(this.boundingBox=new Er);var e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),md.setFromBufferAttribute(t),this.boundingBox.union(md))}),computeBoundingSphere:(dd=new Bn,function(){null===this.boundingSphere&&(this.boundingSphere=new Or),null===this.boundingBox&&this.computeBoundingBox();var e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){var n=this.boundingSphere.center;this.boundingBox.getCenter(n);for(var r=0,i=0,o=e.count;i<o;i++)dd.fromBufferAttribute(e,i),r=Math.max(r,n.distanceToSquared(dd)),dd.fromBufferAttribute(t,i),r=Math.max(r,n.distanceToSquared(dd));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}),toJSON:function(){},applyMatrix:function(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}),wo.line={linewidth:{value:1},resolution:{value:new Pn(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},Ao.line={uniforms:ao.merge([wo.common,wo.fog,wo.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\tfloat a = vUv.x;\n\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t}\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};var gd=function(e){co.call(this,{type:"LineMaterial",uniforms:ao.clone(Ao.line.uniforms),vertexShader:Ao.line.vertexShader,fragmentShader:Ao.line.fragmentShader,clipping:!0}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}}}),this.setValues(e)};(gd.prototype=Object.create(co.prototype)).constructor=gd,gd.prototype.isLineMaterial=!0;var yd,bd,xd=function(e,t){qi.call(this),this.type="LineSegments2",this.geometry=void 0!==e?e:new vd,this.material=void 0!==t?t:new gd({color:16777215*Math.random()})};xd.prototype=Object.assign(Object.create(qi.prototype),{constructor:xd,isLineSegments2:!0,computeLineDistances:(yd=new Bn,bd=new Bn,function(){for(var e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,r=new Float32Array(2*t.data.count),i=0,o=0,a=t.data.count;i<a;i++,o+=2)yd.fromBufferAttribute(t,i),bd.fromBufferAttribute(n,i),r[o]=0===o?0:r[o-1],r[o+1]=r[o]+yd.distanceTo(bd);var s=new op(r,2,1);return e.setAttribute("instanceDistanceStart",new Is(s,1,0)),e.setAttribute("instanceDistanceEnd",new Is(s,1,1)),this}),raycast:function(){var e=new Rn,t=new Rn,n=new Rn,r=new Bn,i=new Yn,o=new mp,a=new Bn;return function(s,u){null===s.camera&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');var c=s.ray,l=s.camera,h=l.projectionMatrix,p=this.geometry,f=this.material,d=f.resolution,m=f.linewidth,v=p.attributes.instanceStart,g=p.attributes.instanceEnd;c.at(1,n),n.w=1,n.applyMatrix4(l.matrixWorldInverse),n.applyMatrix4(h),n.multiplyScalar(1/n.w),n.x*=d.x/2,n.y*=d.y/2,n.z=0,r.copy(n);var y=this.matrixWorld;i.multiplyMatrices(l.matrixWorldInverse,y);for(var b=0,x=v.count;b<x;b++){e.fromBufferAttribute(v,b),t.fromBufferAttribute(g,b),e.w=1,t.w=1,e.applyMatrix4(i),t.applyMatrix4(i),e.applyMatrix4(h),t.applyMatrix4(h),e.multiplyScalar(1/e.w),t.multiplyScalar(1/t.w);var w=e.z<-1&&t.z<-1,_=e.z>1&&t.z>1;if(!w&&!_){e.x*=d.x/2,e.y*=d.y/2,t.x*=d.x/2,t.y*=d.y/2,o.start.copy(e),o.start.z=0,o.end.copy(t),o.end.z=0;var T=o.closestPointToPointParameter(r,!0);o.at(T,a);var S=An.lerp(e.z,t.z,T),M=S>=-1&&S<=1,E=r.distanceTo(a)<.5*m;if(M&&E){o.start.fromBufferAttribute(v,b),o.end.fromBufferAttribute(g,b),o.start.applyMatrix4(y),o.end.applyMatrix4(y);var A=new Bn,P=new Bn;c.distanceSqToSegment(o.start,o.end,P,A),u.push({point:P,pointOnLine:A,distance:c.origin.distanceTo(P),object:this,face:null,faceIndex:b,uv:null,uv2:null})}}}}}()});var wd=function(){vd.call(this),this.type="LineGeometry"};wd.prototype=Object.assign(Object.create(vd.prototype),{constructor:wd,isLineGeometry:!0,setPositions:function(e){for(var t=e.length-3,n=new Float32Array(2*t),r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return vd.prototype.setPositions.call(this,n),this},setColors:function(e){for(var t=e.length-3,n=new Float32Array(2*t),r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return vd.prototype.setColors.call(this,n),this},fromLine:function(e){var t=e.geometry;return t.isGeometry?this.setPositions(t.vertices):t.isBufferGeometry&&this.setPositions(t.position.array),this},copy:function(){return this}});var _d=function(e,t){xd.call(this),this.type="Line2",this.geometry=void 0!==e?e:new wd,this.material=void 0!==t?t:new gd({color:16777215*Math.random()})};_d.prototype=Object.assign(Object.create(xd.prototype),{constructor:_d,isLine2:!0});var Td=function(e,t){void 0===t&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),hr.call(this),this.visible=!1,this.domElement=t;var n=new Sd;this.add(n);var r=new Md;this.add(r);var i=this;B("camera",e),B("object",void 0),B("enabled",!0),B("axis",null),B("mode","translate"),B("translationSnap",null),B("rotationSnap",null),B("scaleSnap",null),B("space","world"),B("size",1),B("dragging",!1),B("showX",!0),B("showY",!0),B("showZ",!0);var o={type:"change"},a={type:"mouseDown"},s={type:"mouseUp",mode:i.mode},u={type:"objectChange"},c=new ap,l=new Bn,h=new Bn,p=new Fn,f={X:new Bn(1,0,0),Y:new Bn(0,1,0),Z:new Bn(0,0,1)},d=new Bn,m=new Bn,v=new Bn,g=new Bn,y=new Bn,b=new Bn,x=0,w=new Bn,_=new Fn,T=new Bn,S=new Bn,M=new Fn,E=new Fn,A=new Bn,P=new Bn,O=new Fn,L=new Bn,I=new Bn,C=new Fn,R=new Fn,D=new Bn,N=new Bn,F=new Bn,j=new Fn,U=new Bn;function B(e,t){var a=t;Object.defineProperty(i,e,{get:function(){return void 0!==a?a:t},set:function(t){a!==t&&(a=t,r[e]=t,n[e]=t,i.dispatchEvent({type:e+"-changed",value:t}),i.dispatchEvent(o))}}),i[e]=t,r[e]=t,n[e]=t}function k(e){if(document.pointerLockElement)return{x:0,y:0,button:e.button};var n=e.changedTouches?e.changedTouches[0]:e,r=t.getBoundingClientRect();return{x:(n.clientX-r.left)/r.width*2-1,y:-(n.clientY-r.top)/r.height*2+1,button:e.button}}function z(e){i.enabled&&i.pointerHover(k(e))}function G(e){i.enabled&&(document.addEventListener("mousemove",V,!1),i.pointerHover(k(e)),i.pointerDown(k(e)))}function V(e){i.enabled&&i.pointerMove(k(e))}function H(e){i.enabled&&(document.removeEventListener("mousemove",V,!1),i.pointerUp(k(e)))}B("worldPosition",I),B("worldPositionStart",P),B("worldQuaternion",C),B("worldQuaternionStart",O),B("cameraPosition",w),B("cameraQuaternion",_),B("pointStart",d),B("pointEnd",m),B("rotationAxis",g),B("rotationAngle",x),B("eye",N),t.addEventListener("mousedown",G,!1),t.addEventListener("touchstart",G,!1),t.addEventListener("mousemove",z,!1),t.addEventListener("touchmove",z,!1),t.addEventListener("touchmove",V,!1),document.addEventListener("mouseup",H,!1),t.addEventListener("touchend",H,!1),t.addEventListener("touchcancel",H,!1),t.addEventListener("touchleave",H,!1),this.dispose=function(){t.removeEventListener("mousedown",G),t.removeEventListener("touchstart",G),t.removeEventListener("mousemove",z),document.removeEventListener("mousemove",V),t.removeEventListener("touchmove",z),t.removeEventListener("touchmove",V),document.removeEventListener("mouseup",H),t.removeEventListener("touchend",H),t.removeEventListener("touchcancel",H),t.removeEventListener("touchleave",H),this.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))},this.attach=function(e){return this.object=e,this.visible=!0,this},this.detach=function(){return this.object=void 0,this.visible=!1,this.axis=null,this},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),this.object.parent.matrixWorld.decompose(S,M,A),this.object.matrixWorld.decompose(I,C,D),E.copy(M).inverse(),R.copy(C).inverse()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(w,_,T),N.copy(w).sub(I).normalize(),hr.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){c.setFromCamera(e,this.camera);var t=c.intersectObjects(n.picker[this.mode].children,!0)[0]||!1;this.axis=t?t.object.name:null}},this.pointerDown=function(e){if(!(void 0===this.object||!0===this.dragging||void 0!==e.button&&0!==e.button||0!==e.button&&void 0!==e.button||null===this.axis)){c.setFromCamera(e,this.camera);var t=c.intersectObjects([r],!0)[0]||!1;if(t){var n=this.space;if("scale"===this.mode?n="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(n="world"),"local"===n&&"rotate"===this.mode){var i=this.rotationSnap;"X"===this.axis&&i&&(this.object.rotation.x=Math.round(this.object.rotation.x/i)*i),"Y"===this.axis&&i&&(this.object.rotation.y=Math.round(this.object.rotation.y/i)*i),"Z"===this.axis&&i&&(this.object.rotation.z=Math.round(this.object.rotation.z/i)*i)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),F.copy(this.object.position),j.copy(this.object.quaternion),U.copy(this.object.scale),this.object.matrixWorld.decompose(P,O,L),d.copy(t.point).sub(P)}this.dragging=!0,a.mode=this.mode,this.dispatchEvent(a)}},this.pointerMove=function(e){var t=this.axis,n=this.mode,i=this.object,a=this.space;if("scale"===n?a="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(a="world"),void 0!==i&&null!==t&&!1!==this.dragging&&(void 0===e.button||0===e.button)){c.setFromCamera(e,this.camera);var s=c.intersectObjects([r],!0)[0]||!1;if(!1!==s){if(m.copy(s.point).sub(P),"translate"===n)v.copy(m).sub(d),"local"===a&&"XYZ"!==t&&v.applyQuaternion(R),-1===t.indexOf("X")&&(v.x=0),-1===t.indexOf("Y")&&(v.y=0),-1===t.indexOf("Z")&&(v.z=0),"local"===a&&"XYZ"!==t?v.applyQuaternion(j).divide(A):v.applyQuaternion(E).divide(A),i.position.copy(v).add(F),this.translationSnap&&("local"===a&&(i.position.applyQuaternion(p.copy(j).inverse()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(j)),"world"===a&&(i.parent&&i.position.add(l.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(l.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){var w=m.length()/d.length();m.dot(d)<0&&(w*=-1),h.set(w,w,w)}else l.copy(d),h.copy(m),l.applyQuaternion(R),h.applyQuaternion(R),h.divide(l),-1===t.search("X")&&(h.x=1),-1===t.search("Y")&&(h.y=1),-1===t.search("Z")&&(h.z=1);i.scale.copy(U).multiply(h),this.scaleSnap&&(-1!==t.search("X")&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===n){v.copy(m).sub(d);var _=20/I.distanceTo(l.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(g.copy(N),x=m.angleTo(d),y.copy(d).normalize(),b.copy(m).normalize(),x*=b.cross(y).dot(N)<0?1:-1):"XYZE"===t?(g.copy(v).cross(N).normalize(),x=v.dot(l.copy(g).cross(this.eye))*_):"X"!==t&&"Y"!==t&&"Z"!==t||(g.copy(f[t]),l.copy(f[t]),"local"===a&&l.applyQuaternion(C),x=v.dot(l.cross(N).normalize())*_),this.rotationSnap&&(x=Math.round(x/this.rotationSnap)*this.rotationSnap),this.rotationAngle=x,"local"===a&&"E"!==t&&"XYZE"!==t?(i.quaternion.copy(j),i.quaternion.multiply(p.setFromAxisAngle(g,x)).normalize()):(g.applyQuaternion(E),i.quaternion.copy(p.setFromAxisAngle(g,x)),i.quaternion.multiply(j).normalize())}this.dispatchEvent(o),this.dispatchEvent(u)}}},this.pointerUp=function(e){void 0!==e.button&&0!==e.button||(this.dragging&&null!==this.axis&&(s.mode=this.mode,this.dispatchEvent(s)),this.dragging=!1,void 0===e.button&&(this.axis=null))},this.getMode=function(){return i.mode},this.setMode=function(e){i.mode=e},this.setTranslationSnap=function(e){i.translationSnap=e},this.setRotationSnap=function(e){i.rotationSnap=e},this.setScaleSnap=function(e){i.scaleSnap=e},this.setSize=function(e){i.size=e},this.setSpace=function(e){i.space=e},this.update=function(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}};Td.prototype=Object.assign(Object.create(hr.prototype),{constructor:Td,isTransformControls:!0});var Sd=function(){hr.call(this),this.type="TransformControlsGizmo";var e=new ci({depthTest:!1,depthWrite:!1,transparent:!0,side:x,fog:!1}),t=new au({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),n=e.clone();n.opacity=.15;var r=e.clone();r.opacity=.33;var i=e.clone();i.color.set(16711680);var o=e.clone();o.color.set(65280);var a=e.clone();a.color.set(255);var s=e.clone();s.opacity=.25;var u=s.clone();u.color.set(16776960);var c=s.clone();c.color.set(65535);var l=s.clone();l.color.set(16711935),e.clone().color.set(16776960);var h=t.clone();h.color.set(16711680);var p=t.clone();p.color.set(65280);var f=t.clone();f.color.set(255);var d=t.clone();d.color.set(65535);var m=t.clone();m.color.set(16711935);var v=t.clone();v.color.set(16776960);var g=t.clone();g.color.set(7895160);var y=v.clone();y.opacity=.25;var b=new Nc(0,.05,.2,12,1,!1),w=new ro(.125,.125,.125),_=new Li;_.setAttribute("position",new bi([0,0,0,1,0,0],3));var T,S=function(e,t){for(var n=new Li,r=[],i=0;i<=64*t;++i)r.push(0,Math.cos(i/32*Math.PI)*e,Math.sin(i/32*Math.PI)*e);return n.setAttribute("position",new bi(r,3)),n},M={X:[[new qi(b,i),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new qi(b,i),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new pu(_,h)]],Y:[[new qi(b,o),[0,1,0],null,null,"fwd"],[new qi(b,o),[0,1,0],[Math.PI,0,0],null,"bwd"],[new pu(_,p),null,[0,0,Math.PI/2]]],Z:[[new qi(b,a),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new qi(b,a),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new pu(_,f),null,[0,-Math.PI/2,0]]],XYZ:[[new qi(new Fu(.1,0),s.clone()),[0,0,0],[0,0,0]]],XY:[[new qi(new Mo(.295,.295),u.clone()),[.15,.15,0]],[new pu(_,v),[.18,.3,0],null,[.125,1,1]],[new pu(_,v),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new qi(new Mo(.295,.295),c.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new pu(_,d),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new pu(_,d),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new qi(new Mo(.295,.295),l.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new pu(_,m),[.18,0,.3],null,[.125,1,1]],[new pu(_,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},E={X:[[new qi(new Nc(.2,0,1,4,1,!1),n),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new qi(new Nc(.2,0,1,4,1,!1),n),[0,.6,0]]],Z:[[new qi(new Nc(.2,0,1,4,1,!1),n),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new qi(new Fu(.2,0),n)]],XY:[[new qi(new Mo(.4,.4),n),[.2,.2,0]]],YZ:[[new qi(new Mo(.4,.4),n),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new qi(new Mo(.4,.4),n),[.2,0,.2],[-Math.PI/2,0,0]]]},A={START:[[new qi(new Fu(.01,2),r),null,null,null,"helper"]],END:[[new qi(new Fu(.01,2),r),null,null,null,"helper"]],DELTA:[[new pu((T=new Li,T.setAttribute("position",new bi([0,0,0,1,1,1],3)),T),r),null,null,null,"helper"]],X:[[new pu(_,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new pu(_,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new pu(_,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},P={X:[[new pu(S(1,.5),h)],[new qi(new Fu(.04,0),i),[0,0,.99],null,[1,3,1]]],Y:[[new pu(S(1,.5),p),null,[0,0,-Math.PI/2]],[new qi(new Fu(.04,0),o),[0,0,.99],null,[3,1,1]]],Z:[[new pu(S(1,.5),f),null,[0,Math.PI/2,0]],[new qi(new Fu(.04,0),a),[.99,0,0],null,[1,3,1]]],E:[[new pu(S(1.25,1),y),null,[0,Math.PI/2,0]],[new qi(new Nc(.03,0,.15,4,1,!1),y),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new qi(new Nc(.03,0,.15,4,1,!1),y),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new qi(new Nc(.03,0,.15,4,1,!1),y),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new qi(new Nc(.03,0,.15,4,1,!1),y),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new pu(S(1,1),g),null,[0,Math.PI/2,0]]]},O={AXIS:[[new pu(_,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},L={X:[[new qi(new Xu(1,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new qi(new Xu(1,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new qi(new Xu(1,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new qi(new Xu(1.25,.1,2,24),n)]],XYZE:[[new qi(new Mc(.7,10,8),n)]]},I={X:[[new qi(w,i),[.8,0,0],[0,0,-Math.PI/2]],[new pu(_,h),null,null,[.8,1,1]]],Y:[[new qi(w,o),[0,.8,0]],[new pu(_,p),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new qi(w,a),[0,0,.8],[Math.PI/2,0,0]],[new pu(_,f),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new qi(w,u),[.85,.85,0],null,[2,2,.2]],[new pu(_,v),[.855,.98,0],null,[.125,1,1]],[new pu(_,v),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new qi(w,c),[0,.85,.85],null,[.2,2,2]],[new pu(_,d),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new pu(_,d),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new qi(w,l),[.85,0,.85],null,[2,.2,2]],[new pu(_,m),[.855,0,.98],null,[.125,1,1]],[new pu(_,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new qi(new ro(.125,.125,.125),s.clone()),[1.1,0,0]]],XYZY:[[new qi(new ro(.125,.125,.125),s.clone()),[0,1.1,0]]],XYZZ:[[new qi(new ro(.125,.125,.125),s.clone()),[0,0,1.1]]]},C={X:[[new qi(new Nc(.2,0,.8,4,1,!1),n),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new qi(new Nc(.2,0,.8,4,1,!1),n),[0,.5,0]]],Z:[[new qi(new Nc(.2,0,.8,4,1,!1),n),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new qi(w,n),[.85,.85,0],null,[3,3,.2]]],YZ:[[new qi(w,n),[0,.85,.85],null,[.2,3,3]]],XZ:[[new qi(w,n),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new qi(new ro(.2,.2,.2),n),[1.1,0,0]]],XYZY:[[new qi(new ro(.2,.2,.2),n),[0,1.1,0]]],XYZZ:[[new qi(new ro(.2,.2,.2),n),[0,0,1.1]]]},R={X:[[new pu(_,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new pu(_,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new pu(_,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},D=function(e){var t=new hr;for(var n in e)for(var r=e[n].length;r--;){var i=e[n][r][0].clone(),o=e[n][r][1],a=e[n][r][2],s=e[n][r][3],u=e[n][r][4];i.name=n,i.tag=u,o&&i.position.set(o[0],o[1],o[2]),a&&i.rotation.set(a[0],a[1],a[2]),s&&i.scale.set(s[0],s[1],s[2]),i.updateMatrix();var c=i.geometry.clone();c.applyMatrix4(i.matrix),i.geometry=c,i.renderOrder=1/0,i.position.set(0,0,0),i.rotation.set(0,0,0),i.scale.set(1,1,1),t.add(i)}return t},N=new Bn(0,0,0),F=new Zn,j=new Bn(0,1,0),U=new Bn(0,0,0),B=new Yn,k=new Fn,z=new Fn,G=new Fn,V=new Bn(1,0,0),H=new Bn(0,1,0),W=new Bn(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=D(M)),this.add(this.gizmo.rotate=D(P)),this.add(this.gizmo.scale=D(I)),this.add(this.picker.translate=D(E)),this.add(this.picker.rotate=D(L)),this.add(this.picker.scale=D(C)),this.add(this.helper.translate=D(A)),this.add(this.helper.rotate=D(O)),this.add(this.helper.scale=D(R)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var e=this.space;"scale"===this.mode&&(e="local");var t="local"===e?this.worldQuaternion:G;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var n=[];n=(n=(n=n.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var r=0;r<n.length;r++){var i=n[r];i.visible=!0,i.rotation.set(0,0,0),i.position.copy(this.worldPosition);var o=this.worldPosition.distanceTo(this.cameraPosition);if(i.scale.set(1,1,1).multiplyScalar(o*this.size/7),"helper"!==i.tag){if(i.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){"X"!==i.name&&"XYZX"!==i.name||Math.abs(j.copy(V).applyQuaternion(t).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"Y"!==i.name&&"XYZY"!==i.name||Math.abs(j.copy(H).applyQuaternion(t).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"Z"!==i.name&&"XYZZ"!==i.name||Math.abs(j.copy(W).applyQuaternion(t).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"XY"===i.name&&Math.abs(j.copy(W).applyQuaternion(t).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"YZ"===i.name&&Math.abs(j.copy(V).applyQuaternion(t).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"XZ"===i.name&&Math.abs(j.copy(H).applyQuaternion(t).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),-1!==i.name.search("X")&&(j.copy(V).applyQuaternion(t).dot(this.eye)<0?"fwd"===i.tag?i.visible=!1:i.scale.x*=-1:"bwd"===i.tag&&(i.visible=!1)),-1!==i.name.search("Y")&&(j.copy(H).applyQuaternion(t).dot(this.eye)<0?"fwd"===i.tag?i.visible=!1:i.scale.y*=-1:"bwd"===i.tag&&(i.visible=!1)),-1!==i.name.search("Z")&&(j.copy(W).applyQuaternion(t).dot(this.eye)<0?"fwd"===i.tag?i.visible=!1:i.scale.z*=-1:"bwd"===i.tag&&(i.visible=!1))}else"rotate"===this.mode&&(z.copy(t),j.copy(this.eye).applyQuaternion(k.copy(t).inverse()),-1!==i.name.search("E")&&i.quaternion.setFromRotationMatrix(B.lookAt(this.eye,U,H)),"X"===i.name&&(k.setFromAxisAngle(V,Math.atan2(-j.y,j.z)),k.multiplyQuaternions(z,k),i.quaternion.copy(k)),"Y"===i.name&&(k.setFromAxisAngle(H,Math.atan2(j.x,j.z)),k.multiplyQuaternions(z,k),i.quaternion.copy(k)),"Z"===i.name&&(k.setFromAxisAngle(W,Math.atan2(j.y,j.x)),k.multiplyQuaternions(z,k),i.quaternion.copy(k)));i.visible=i.visible&&(-1===i.name.indexOf("X")||this.showX),i.visible=i.visible&&(-1===i.name.indexOf("Y")||this.showY),i.visible=i.visible&&(-1===i.name.indexOf("Z")||this.showZ),i.visible=i.visible&&(-1===i.name.indexOf("E")||this.showX&&this.showY&&this.showZ),i.material._opacity=i.material._opacity||i.material.opacity,i.material._color=i.material._color||i.material.color.clone(),i.material.color.copy(i.material._color),i.material.opacity=i.material._opacity,this.enabled?this.axis&&(i.name===this.axis?(i.material.opacity=1,i.material.color.lerp(new ni(1,1,1),.5)):this.axis.split("").some((function(e){return i.name===e}))?(i.material.opacity=1,i.material.color.lerp(new ni(1,1,1),.5)):(i.material.opacity*=.25,i.material.color.lerp(new ni(1,1,1),.5))):(i.material.opacity*=.5,i.material.color.lerp(new ni(1,1,1),.5))}else i.visible=!1,"AXIS"===i.name?(i.position.copy(this.worldPositionStart),i.visible=!!this.axis,"X"===this.axis&&(k.setFromEuler(F.set(0,0,0)),i.quaternion.copy(t).multiply(k),Math.abs(j.copy(V).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"Y"===this.axis&&(k.setFromEuler(F.set(0,0,Math.PI/2)),i.quaternion.copy(t).multiply(k),Math.abs(j.copy(H).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"Z"===this.axis&&(k.setFromEuler(F.set(0,Math.PI/2,0)),i.quaternion.copy(t).multiply(k),Math.abs(j.copy(W).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"XYZE"===this.axis&&(k.setFromEuler(F.set(0,Math.PI/2,0)),j.copy(this.rotationAxis),i.quaternion.setFromRotationMatrix(B.lookAt(U,j,H)),i.quaternion.multiply(k),i.visible=this.dragging),"E"===this.axis&&(i.visible=!1)):"START"===i.name?(i.position.copy(this.worldPositionStart),i.visible=this.dragging):"END"===i.name?(i.position.copy(this.worldPosition),i.visible=this.dragging):"DELTA"===i.name?(i.position.copy(this.worldPositionStart),i.quaternion.copy(this.worldQuaternionStart),N.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),N.applyQuaternion(this.worldQuaternionStart.clone().inverse()),i.scale.copy(N),i.visible=this.dragging):(i.quaternion.copy(t),this.dragging?i.position.copy(this.worldPositionStart):i.position.copy(this.worldPosition),this.axis&&(i.visible=-1!==this.axis.search(i.name)))}hr.prototype.updateMatrixWorld.call(this)}};Sd.prototype=Object.assign(Object.create(hr.prototype),{constructor:Sd,isTransformControlsGizmo:!0});var Md=function(){qi.call(this,new Mo(1e5,1e5,2,2),new ci({visible:!1,wireframe:!0,side:x,transparent:!0,opacity:.1})),this.type="TransformControlsPlane";var e=new Bn(1,0,0),t=new Bn(0,1,0),n=new Bn(0,0,1),r=new Bn,i=new Bn,o=new Bn,a=new Yn,s=new Fn;this.updateMatrixWorld=function(){var u=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(u="local"),e.set(1,0,0).applyQuaternion("local"===u?this.worldQuaternion:s),t.set(0,1,0).applyQuaternion("local"===u?this.worldQuaternion:s),n.set(0,0,1).applyQuaternion("local"===u?this.worldQuaternion:s),o.copy(t),this.mode){case"translate":case"scale":switch(this.axis){case"X":o.copy(this.eye).cross(e),i.copy(e).cross(o);break;case"Y":o.copy(this.eye).cross(t),i.copy(t).cross(o);break;case"Z":o.copy(this.eye).cross(n),i.copy(n).cross(o);break;case"XY":i.copy(n);break;case"YZ":i.copy(e);break;case"XZ":o.copy(n),i.copy(t);break;case"XYZ":case"E":i.set(0,0,0)}break;case"rotate":default:i.set(0,0,0)}0===i.length()?this.quaternion.copy(this.cameraQuaternion):(a.lookAt(r.set(0,0,0),i,o),this.quaternion.setFromRotationMatrix(a)),hr.prototype.updateMatrixWorld.call(this)}};Md.prototype=Object.assign(Object.create(qi.prototype),{constructor:Md,isTransformControlsPlane:!0});var Ed=function(e,t){void 0===t&&(console.warn('THREE.PointerLockControls: The second parameter "domElement" is now mandatory.'),t=document.body),this.domElement=t,this.isLocked=!1;var n,r=this,i={type:"change"},o={type:"lock"},a={type:"unlock"},s=new Zn(0,0,0,"YXZ"),u=Math.PI/2,c=new Bn;function l(t){if(!1!==r.isLocked){var n=t.movementX||t.mozMovementX||t.webkitMovementX||0,o=t.movementY||t.mozMovementY||t.webkitMovementY||0;s.setFromQuaternion(e.quaternion),s.y-=.002*n,s.x-=.002*o,s.x=Math.max(-u,Math.min(u,s.x)),e.quaternion.setFromEuler(s),r.dispatchEvent(i)}}function h(){document.pointerLockElement===r.domElement?(r.dispatchEvent(o),r.isLocked=!0):(r.dispatchEvent(a),r.isLocked=!1)}function p(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}this.connect=function(){document.addEventListener("mousemove",l,!1),document.addEventListener("pointerlockchange",h,!1),document.addEventListener("pointerlockerror",p,!1)},this.disconnect=function(){document.removeEventListener("mousemove",l,!1),document.removeEventListener("pointerlockchange",h,!1),document.removeEventListener("pointerlockerror",p,!1)},this.dispose=function(){this.disconnect()},this.getObject=function(){return e},this.getDirection=(n=new Bn(0,0,-1),function(t){return t.copy(n).applyQuaternion(e.quaternion)}),this.moveForward=function(t){c.setFromMatrixColumn(e.matrix,0),c.crossVectors(e.up,c),e.position.addScaledVector(c,t)},this.moveRight=function(t){c.setFromMatrixColumn(e.matrix,0),e.position.addScaledVector(c,t)},this.lock=function(){this.domElement.requestPointerLock()},this.unlock=function(){document.exitPointerLock()},this.connect()};(Ed.prototype=Object.create(Tn.prototype)).constructor=Ed;var Ad={uniforms:{tDiffuse:{value:null},resolution:{value:new Pn(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immediates.","    // Immediates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")},Pd=function(e){hr.call(this),this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.addEventListener("removed",(function(){this.traverse((function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)}))}))};Pd.prototype=Object.create(hr.prototype),Pd.prototype.constructor=Pd;var Od=function(e){Pd.call(this,e)};Od.prototype=Object.create(Pd.prototype),Od.prototype.constructor=Od;var Ld=function(e){hr.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",(function(){this.traverse((function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)}))}))};(Ld.prototype=Object.create(hr.prototype)).constructor=Ld;var Id,Cd,Rd;function Dd(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(Dd.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),Dd.FullScreenQuad=(Id=new th(-1,1,1,-1,0,1),Cd=new Mo(2,2),Rd=function(e){this._mesh=new qi(Cd,e)},Object.defineProperty(Rd.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(Rd.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,Id)}}),Rd);var Nd=function(e,t){Dd.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof co?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=ao.clone(e.uniforms),this.material=new co({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Dd.FullScreenQuad(this.material)};Nd.prototype=Object.assign(Object.create(Dd.prototype),{constructor:Nd,render:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}});var Fd=function(e,t,n,r,i){Dd.call(this),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};Fd.prototype=Object.assign(Object.create(Dd.prototype),{constructor:Fd,render:function(e,t,n){var r,i,o=e.autoClear;e.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(r=e.getClearColor().getHex(),i=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(r,i),this.scene.overrideMaterial=null,e.autoClear=o}});var jd={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")},Ud=function(e,t,n,r){this.renderScene=t,this.renderCamera=n,this.selectedObjects=void 0!==r?r:[],this.visibleEdgeColor=new ni(1,1,1),this.hiddenEdgeColor=new ni(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,Dd.call(this),this.resolution=void 0!==e?new Pn(e.x,e.y):new Pn(256,256);var i={minFilter:Ae,magFilter:Ae,format:Xe},o=Math.round(this.resolution.x/this.downSampleRatio),a=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new ci({color:16777215}),this.maskBufferMaterial.side=x,this.renderTargetMaskBuffer=new Dn(this.resolution.x,this.resolution.y,i),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new ps,this.depthMaterial.side=x,this.depthMaterial.depthPacking=qt,this.depthMaterial.blending=E,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=x,this.prepareMaskMaterial.fragmentShader=function(e,t){var n=t.isPerspectiveCamera?"perspective":"orthographic";return e.replace(/DEPTH_TO_VIEW_Z/g,n+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new Dn(this.resolution.x,this.resolution.y,i),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new Dn(o,a,i),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new Dn(o,a,i),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new Dn(Math.round(o/2),Math.round(a/2),i),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new Dn(o,a,i),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new Dn(Math.round(o/2),Math.round(a/2),i),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value.set(o,a),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(o/2),Math.round(a/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),void 0===jd&&console.error("OutlinePass relies on CopyShader");var s=jd;this.copyUniforms=ao.clone(s.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new co({uniforms:this.copyUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,blending:E,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new ni,this.oldClearAlpha=1,this.fsQuad=new Dd.FullScreenQuad(null),this.tempPulseColor1=new ni,this.tempPulseColor2=new ni,this.textureMatrix=new Yn};Ud.prototype=Object.assign(Object.create(Dd.prototype),{constructor:Ud,dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(e,t){this.renderTargetMaskBuffer.setSize(e,t);var n=Math.round(e/this.downSampleRatio),r=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(n,r),this.renderTargetBlurBuffer1.setSize(n,r),this.renderTargetEdgeBuffer1.setSize(n,r),this.separableBlurMaterial1.uniforms.texSize.value.set(n,r),n=Math.round(n/2),r=Math.round(r/2),this.renderTargetBlurBuffer2.setSize(n,r),this.renderTargetEdgeBuffer2.setSize(n,r),this.separableBlurMaterial2.uniforms.texSize.value.set(n,r)},changeVisibilityOfSelectedObjects:function(e){function t(t){t.isMesh&&(e?(t.visible=t.userData.oldVisible,delete t.userData.oldVisible):(t.userData.oldVisible=t.visible,t.visible=e))}for(var n=0;n<this.selectedObjects.length;n++){this.selectedObjects[n].traverse(t)}},changeVisibilityOfNonSelectedObjects:function(e){var t=[];function n(e){e.isMesh&&t.push(e)}for(var r=0;r<this.selectedObjects.length;r++){this.selectedObjects[r].traverse(n)}this.renderScene.traverse((function(n){if(n.isMesh||n.isLine||n.isSprite){for(var r=!1,i=0;i<t.length;i++){if(t[i].id===n.id){r=!0;break}}if(!r){var o=n.visible;e&&!n.bVisible||(n.visible=e),n.bVisible=o}}}))},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},render:function(e,t,n,r,i){if(this.selectedObjects.length>0){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;e.autoClear=!1,i&&e.state.buffers.stencil.setTest(!1),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);var a=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this.renderScene.background=a,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){var s=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(s),this.tempPulseColor2.multiplyScalar(s)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Ud.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Ud.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=Ud.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=Ud.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,i&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(n),this.fsQuad.render(e),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=o}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=n.texture,e.setRenderTarget(null),this.fsQuad.render(e))},getPrepareMaskMaterial:function(){return new co({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new Pn(.5,.5)},textureMatrix:{value:null}},vertexShader:["#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","varying vec4 projTexCoord;","varying vec4 vPosition;","uniform mat4 textureMatrix;","void main() {","\t#include <skinbase_vertex>","\t#include <begin_vertex>","\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\tvPosition = mvPosition;","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tprojTexCoord = textureMatrix * worldPosition;","}"].join("\n"),fragmentShader:["#include <packing>","varying vec4 vPosition;","varying vec4 projTexCoord;","uniform sampler2D depthTexture;","uniform vec2 cameraNearFar;","void main() {","\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));","\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );","\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;","\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new co({uniforms:{maskTexture:{value:null},texSize:{value:new Pn(.5,.5)},visibleEdgeColor:{value:new Bn(1,1,1)},hiddenEdgeColor:{value:new Bn(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(e){return new co({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new Pn(.5,.5)},direction:{value:new Pn(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\t\t\t\t}"})},getOverlayMaterial:function(){return new co({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:P,depthTest:!1,depthWrite:!1,transparent:!0})}}),Ud.BlurDirectionX=new Pn(1,0),Ud.BlurDirectionY=new Pn(0,1);var Bd={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new ni(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec3 luma = vec3( 0.299, 0.587, 0.114 );","\tfloat v = dot( texel.xyz, luma );","\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","\tgl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")},kd=function(e,t,n,r){Dd.call(this),this.strength=void 0!==t?t:1,this.radius=n,this.threshold=r,this.resolution=void 0!==e?new Pn(e.x,e.y):new Pn(256,256),this.clearColor=new ni(0,0,0);var i={minFilter:Ae,magFilter:Ae,format:Xe};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new Dn(o,a,i),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var s=0;s<this.nMips;s++){var u=new Dn(o,a,i);u.texture.name="UnrealBloomPass.h"+s,u.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(u);var c=new Dn(o,a,i);c.texture.name="UnrealBloomPass.v"+s,c.texture.generateMipmaps=!1,this.renderTargetsVertical.push(c),o=Math.round(o/2),a=Math.round(a/2)}void 0===Bd&&console.error("UnrealBloomPass relies on LuminosityHighPassShader");var l=Bd;this.highPassUniforms=ao.clone(l.uniforms),this.highPassUniforms.luminosityThreshold.value=r,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new co({uniforms:this.highPassUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var h=[3,5,7,9,11];for(o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2),s=0;s<this.nMips;s++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(h[s])),this.separableBlurMaterials[s].uniforms.texSize.value=new Pn(o,a),o=Math.round(o/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new Bn(1,1,1),new Bn(1,1,1),new Bn(1,1,1),new Bn(1,1,1),new Bn(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===jd&&console.error("UnrealBloomPass relies on CopyShader");var p=jd;this.copyUniforms=ao.clone(p.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new co({uniforms:this.copyUniforms,vertexShader:p.vertexShader,fragmentShader:p.fragmentShader,blending:P,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new ni,this.oldClearAlpha=1,this.basic=new ci,this.fsQuad=new Dd.FullScreenQuad(null)};kd.prototype=Object.assign(Object.create(Dd.prototype),{constructor:kd,dispose:function(){for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()},setSize:function(e,t){var n=Math.round(e/2),r=Math.round(t/2);this.renderTargetBright.setSize(n,r);for(var i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(n,r),this.renderTargetsVertical[i].setSize(n,r),this.separableBlurMaterials[i].uniforms.texSize.value=new Pn(n,r),n=Math.round(n/2),r=Math.round(r/2)},render:function(e,t,n,r,i){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),i&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=n.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=n.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);for(var a=this.renderTargetBright,s=0;s<this.nMips;s++)this.fsQuad.material=this.separableBlurMaterials[s],this.separableBlurMaterials[s].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[s].uniforms.direction.value=kd.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[s]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurMaterials[s].uniforms.direction.value=kd.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[s]),e.clear(),this.fsQuad.render(e),a=this.renderTargetsVertical[s];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,i&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(n),this.fsQuad.render(e)),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=o},getSeperableBlurMaterial:function(e){return new co({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new Pn(.5,.5)},direction:{value:new Pn(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(e){return new co({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),kd.BlurDirectionX=new Pn(1,0),kd.BlurDirectionY=new Pn(0,1);var zd=function(e,t){Dd.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1};zd.prototype=Object.assign(Object.create(Dd.prototype),{constructor:zd,render:function(e,t,n){var r,i,o=e.getContext(),a=e.state;a.buffers.color.setMask(!1),a.buffers.depth.setMask(!1),a.buffers.color.setLocked(!0),a.buffers.depth.setLocked(!0),this.inverse?(r=0,i=1):(r=1,i=0),a.buffers.stencil.setTest(!0),a.buffers.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),a.buffers.stencil.setFunc(o.ALWAYS,r,4294967295),a.buffers.stencil.setClear(i),a.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),a.buffers.color.setLocked(!1),a.buffers.depth.setLocked(!1),a.buffers.stencil.setLocked(!1),a.buffers.stencil.setFunc(o.EQUAL,1,4294967295),a.buffers.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),a.buffers.stencil.setLocked(!0)}});var Gd=function(){Dd.call(this),this.needsSwap=!1};Gd.prototype=Object.create(Dd.prototype),Object.assign(Gd.prototype,{render:function(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}});var Vd=function(e,t){if(this.renderer=e,void 0===t){var n={minFilter:Ae,magFilter:Ae,format:Xe,stencilBuffer:!1},r=e.getSize(new Pn);this._pixelRatio=e.getPixelRatio(),this._width=r.width,this._height=r.height,(t=new Dn(this._width*this._pixelRatio,this._height*this._pixelRatio,n)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===jd&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===Nd&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new Nd(jd),this.clock=new Ih};Object.assign(Vd.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(e,t){this.passes.splice(t,0,e)},isLastEnabledPass:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0},render:function(e){void 0===e&&(e=this.clock.getDelta());var t,n,r=this.renderer.getRenderTarget(),i=!1,o=this.passes.length;for(n=0;n<o;n++)if(!1!==(t=this.passes[n]).enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),t.needsSwap){if(i){var a=this.renderer.getContext(),s=this.renderer.state.buffers.stencil;s.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),s.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==zd&&(t instanceof zd?i=!0:t instanceof Gd&&(i=!1))}this.renderer.setRenderTarget(r)},reset:function(e){if(void 0===e){var t=this.renderer.getSize(new Pn);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this._width=e,this._height=t;var n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(var i=0;i<this.passes.length;i++)this.passes[i].setSize(n,r)},setPixelRatio:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}});var Hd=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(Hd.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),Hd.FullScreenQuad=function(){var e=new th(-1,1,1,-1,0,1),t=new Mo(2,2),n=function(e){this._mesh=new qi(t,e)};return Object.defineProperty(n.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(n.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(t){t.render(this._mesh,e)}}),n}();var Wd={defines:{NUM_SAMPLES:7,NUM_RINGS:4,NORMAL_TEXTURE:0,DIFFUSE_TEXTURE:0,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},tDiffuse:{value:null},tNormal:{value:null},size:{value:new Pn(512,512)},cameraNear:{value:1},cameraFar:{value:100},cameraProjectionMatrix:{value:new Yn},cameraInverseProjectionMatrix:{value:new Yn},scale:{value:1},intensity:{value:.1},bias:{value:.5},minResolution:{value:0},kernelRadius:{value:100},randomSeed:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","#if DIFFUSE_TEXTURE == 1","uniform sampler2D tDiffuse;","#endif","uniform sampler2D tDepth;","#if NORMAL_TEXTURE == 1","uniform sampler2D tNormal;","#endif","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float scale;","uniform float intensity;","uniform float bias;","uniform float kernelRadius;","uniform float minResolution;","uniform vec2 size;","uniform float randomSeed;","// RGBA depth","#include <packing>","vec4 getDefaultColor( const in vec2 screenPosition ) {","\t#if DIFFUSE_TEXTURE == 1","\treturn texture2D( tDiffuse, vUv );","\t#else","\treturn vec4( 1.0 );","\t#endif","}","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","\tclipPosition *= clipW; // unprojection.","\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {","\t#if NORMAL_TEXTURE == 1","\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","\t#else","\treturn normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );","\t#endif","}","float scaleDividedByCameraFar;","float minResolutionMultipliedByCameraFar;","float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {","\tvec3 viewDelta = sampleViewPosition - centerViewPosition;","\tfloat viewDistance = length( viewDelta );","\tfloat scaledScreenDistance = scaleDividedByCameraFar * viewDistance;","\treturn max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );","}","// moving costly divides into consts","const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );","const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );","float getAmbientOcclusion( const in vec3 centerViewPosition ) {","\t// precompute some variables require in getOcclusion.","\tscaleDividedByCameraFar = scale / cameraFar;","\tminResolutionMultipliedByCameraFar = minResolution * cameraFar;","\tvec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );","\t// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/","\tfloat angle = rand( vUv + randomSeed ) * PI2;","\tvec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;","\tvec2 radiusStep = radius;","\tfloat occlusionSum = 0.0;","\tfloat weightSum = 0.0;","\tfor( int i = 0; i < NUM_SAMPLES; i ++ ) {","\t\tvec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;","\t\tradius += radiusStep;","\t\tangle += ANGLE_STEP;","\t\tfloat sampleDepth = getDepth( sampleUv );","\t\tif( sampleDepth >= ( 1.0 - EPSILON ) ) {","\t\t\tcontinue;","\t\t}","\t\tfloat sampleViewZ = getViewZ( sampleDepth );","\t\tvec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );","\t\tocclusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );","\t\tweightSum += 1.0;","\t}","\tif( weightSum == 0.0 ) discard;","\treturn occlusionSum * ( intensity / weightSum );","}","void main() {","\tfloat centerDepth = getDepth( vUv );","\tif( centerDepth >= ( 1.0 - EPSILON ) ) {","\t\tdiscard;","\t}","\tfloat centerViewZ = getViewZ( centerDepth );","\tvec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );","\tfloat ambientOcclusion = getAmbientOcclusion( viewPosition );","\tgl_FragColor = getDefaultColor( vUv );","\tgl_FragColor.xyz *=  1.0 - ambientOcclusion;","}"].join("\n")},Xd={defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{value:null},size:{value:new Pn(512,512)},sampleUvOffsets:{value:[new Pn(0,0)]},sampleWeights:{value:[1]},tDepth:{value:null},cameraNear:{value:10},cameraFar:{value:1e3},depthCutoff:{value:10}},vertexShader:["#include <common>","uniform vec2 size;","varying vec2 vUv;","varying vec2 vInvSize;","void main() {","\tvUv = uv;","\tvInvSize = 1.0 / size;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","#include <packing>","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","uniform float depthCutoff;","uniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];","uniform float sampleWeights[ KERNEL_RADIUS + 1 ];","varying vec2 vUv;","varying vec2 vInvSize;","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","void main() {","\tfloat depth = getDepth( vUv );","\tif( depth >= ( 1.0 - EPSILON ) ) {","\t\tdiscard;","\t}","\tfloat centerViewZ = -getViewZ( depth );","\tbool rBreak = false, lBreak = false;","\tfloat weightSum = sampleWeights[0];","\tvec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;","\tfor( int i = 1; i <= KERNEL_RADIUS; i ++ ) {","\t\tfloat sampleWeight = sampleWeights[i];","\t\tvec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;","\t\tvec2 sampleUv = vUv + sampleUvOffset;","\t\tfloat viewZ = -getViewZ( getDepth( sampleUv ) );","\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;","\t\tif( ! rBreak ) {","\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","\t\t\tweightSum += sampleWeight;","\t\t}","\t\tsampleUv = vUv - sampleUvOffset;","\t\tviewZ = -getViewZ( getDepth( sampleUv ) );","\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;","\t\tif( ! lBreak ) {","\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","\t\t\tweightSum += sampleWeight;","\t\t}","\t}","\tgl_FragColor = diffuseSum / weightSum;","}"].join("\n")},Yd={createSampleWeights:function(e,t){for(var n=function(e,t){return Math.exp(-e*e/(t*t*2))/(Math.sqrt(2*Math.PI)*t)},r=[],i=0;i<=e;i++)r.push(n(i,t));return r},createSampleOffsets:function(e,t){for(var n=[],r=0;r<=e;r++)n.push(t.clone().multiplyScalar(r));return n},configure:function(e,t,n,r){e.defines.KERNEL_RADIUS=t,e.uniforms.sampleUvOffsets.value=Yd.createSampleOffsets(t,r),e.uniforms.sampleWeights.value=Yd.createSampleWeights(t,n),e.needsUpdate=!0}},qd={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","#include <packing>","void main() {","\tfloat depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );","\tgl_FragColor = vec4( vec3( depth ), opacity );","}"].join("\n")},Qd=function(e,t,n,r,i){(Dd.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.supportsDepthTextureExtension=void 0!==n&&n,this.supportsNormalTexture=void 0!==r&&r,this.originalClearColor=new ni,this.oldClearColor=new ni,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=void 0!==i?new Pn(i.x,i.y):new Pn(256,256),this.saoRenderTarget=new Dn(this.resolution.x,this.resolution.y,{minFilter:Ae,magFilter:Ae,format:Xe}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone(),this.beautyRenderTarget=this.saoRenderTarget.clone(),this.normalRenderTarget=new Dn(this.resolution.x,this.resolution.y,{minFilter:_e,magFilter:_e,format:Xe}),this.depthRenderTarget=this.normalRenderTarget.clone(),this.supportsDepthTextureExtension)&&((n=new Au).type=Ne,n.minFilter=_e,n.maxFilter=_e,this.beautyRenderTarget.depthTexture=n,this.beautyRenderTarget.depthBuffer=!0);this.depthMaterial=new ps,this.depthMaterial.depthPacking=qt,this.depthMaterial.blending=E,this.normalMaterial=new Yc,this.normalMaterial.blending=E,void 0===Wd&&console.error("THREE.SAOPass relies on SAOShader"),this.saoMaterial=new co({defines:Object.assign({},Wd.defines),fragmentShader:Wd.fragmentShader,vertexShader:Wd.vertexShader,uniforms:ao.clone(Wd.uniforms)}),this.saoMaterial.extensions.derivatives=!0,this.saoMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.saoMaterial.defines.NORMAL_TEXTURE=this.supportsNormalTexture?1:0,this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?n:this.depthRenderTarget.texture,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=E,void 0===Xd&&console.error("THREE.SAOPass relies on DepthLimitedBlurShader"),this.vBlurMaterial=new co({uniforms:ao.clone(Xd.uniforms),defines:Object.assign({},Xd.defines),vertexShader:Xd.vertexShader,fragmentShader:Xd.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?n:this.depthRenderTarget.texture,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=E,this.hBlurMaterial=new co({uniforms:ao.clone(Xd.uniforms),defines:Object.assign({},Xd.defines),vertexShader:Xd.vertexShader,fragmentShader:Xd.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?n:this.depthRenderTarget.texture,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=E,void 0===jd&&console.error("THREE.SAOPass relies on CopyShader"),this.materialCopy=new co({uniforms:ao.clone(jd.uniforms),vertexShader:jd.vertexShader,fragmentShader:jd.fragmentShader,blending:E}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=I,this.materialCopy.blendSrc=W,this.materialCopy.blendDst=j,this.materialCopy.blendEquation=C,this.materialCopy.blendSrcAlpha=V,this.materialCopy.blendDstAlpha=j,this.materialCopy.blendEquationAlpha=C,void 0===qd&&console.error("THREE.SAOPass relies on UnpackDepthRGBAShader"),this.depthCopy=new co({uniforms:ao.clone(qd.uniforms),vertexShader:qd.vertexShader,fragmentShader:qd.fragmentShader,blending:E}),this.fsQuad=new Dd.FullScreenQuad(null)};Qd.OUTPUT={Beauty:1,Default:0,SAO:2,Depth:3,Normal:4},Qd.prototype=Object.assign(Object.create(Dd.prototype),{constructor:Qd,render:function(e,t,n){if(this.renderToScreen&&(this.materialCopy.blending=E,this.materialCopy.uniforms.tDiffuse.value=n.texture,this.materialCopy.needsUpdate=!0,this.renderPass(e,this.materialCopy,null)),1!==this.params.output){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var r=e.autoClear;e.autoClear=!1,e.setRenderTarget(this.depthRenderTarget),e.clear(),this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;var i=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=i,this.hBlurMaterial.uniforms.depthCutoff.value=i,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),this.prevStdDev===this.params.saoBlurStdDev&&this.prevNumSamples===this.params.saoBlurRadius||(Yd.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new Pn(0,1)),Yd.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new Pn(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),e.setClearColor(0),e.setRenderTarget(this.beautyRenderTarget),e.clear(),e.render(this.scene,this.camera),this.supportsDepthTextureExtension||this.renderOverride(e,this.depthMaterial,this.depthRenderTarget,0,1),this.supportsNormalTexture&&this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(e,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(e,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(e,this.hBlurMaterial,this.saoRenderTarget,16777215,1));var o=this.materialCopy;3===this.params.output?this.supportsDepthTextureExtension?(this.materialCopy.uniforms.tDiffuse.value=this.beautyRenderTarget.depthTexture,this.materialCopy.needsUpdate=!0):(this.depthCopy.uniforms.tDiffuse.value=this.depthRenderTarget.texture,this.depthCopy.needsUpdate=!0,o=this.depthCopy):4===this.params.output?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),0===this.params.output?o.blending=I:o.blending=E,this.renderPass(e,o,this.renderToScreen?null:n),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=r}},renderPass:function(e,t,n,r,i){this.originalClearColor.copy(e.getClearColor());var o=e.getClearAlpha(),a=e.autoClear;e.setRenderTarget(n),e.autoClear=!1,null!=r&&(e.setClearColor(r),e.setClearAlpha(i||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=a,e.setClearColor(this.originalClearColor),e.setClearAlpha(o)},renderOverride:function(e,t,n,r,i){this.originalClearColor.copy(e.getClearColor());var o=e.getClearAlpha(),a=e.autoClear;e.setRenderTarget(n),e.autoClear=!1,r=t.clearColor||r,i=t.clearAlpha||i,null!=r&&(e.setClearColor(r),e.setClearAlpha(i||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=a,e.setClearColor(this.originalClearColor),e.setClearAlpha(o)},setSize:function(e,t){this.beautyRenderTarget.setSize(e,t),this.saoRenderTarget.setSize(e,t),this.blurIntermediateRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.depthRenderTarget.setSize(e,t),this.saoMaterial.uniforms.size.value.set(e,t),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(e,t),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(e,t),this.hBlurMaterial.needsUpdate=!0}});var Zd=function(e,t,n,r){Dd.call(this),this.scene=e,this.camera=t,this.sampleLevel=4,this.unbiased=!0,this.clearColor=void 0!==n?n:0,this.clearAlpha=void 0!==r?r:0,void 0===jd&&console.error("SSAARenderPass relies on CopyShader");var i=jd;this.copyUniforms=ao.clone(i.uniforms),this.copyMaterial=new co({uniforms:this.copyUniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:P,depthTest:!1,depthWrite:!1}),this.fsQuad=new Dd.FullScreenQuad(this.copyMaterial)};Zd.prototype=Object.assign(Object.create(Dd.prototype),{constructor:Zd,dispose:function(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null)},setSize:function(e,t){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(e,t)},render:function(e,t,n){this.sampleRenderTarget||(this.sampleRenderTarget=new Dn(n.width,n.height,{minFilter:Ae,magFilter:Ae,format:Xe}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");var r=Zd.JitterVectors[Math.max(0,Math.min(this.sampleLevel,5))],i=e.autoClear;e.autoClear=!1;var o=e.getClearColor().getHex(),a=e.getClearAlpha(),s=1/r.length;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;for(var u=n.width,c=n.height,l=0;l<r.length;l++){var h=r[l];this.camera.setViewOffset&&this.camera.setViewOffset(u,c,.0625*h[0],.0625*h[1],u,c);var p=s;if(this.unbiased)p+=1/32*((l+.5)/r.length-.5);this.copyUniforms.opacity.value=p,e.setClearColor(this.clearColor,this.clearAlpha),e.setRenderTarget(this.sampleRenderTarget),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(this.renderToScreen?null:t),0===l&&(e.setClearColor(0,0),e.clear()),this.fsQuad.render(e)}this.camera.clearViewOffset&&this.camera.clearViewOffset(),e.autoClear=i,e.setClearColor(o,a)}}),Zd.JitterVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];var Kd=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,n=/^usemtl /,r=/^usemap /;function i(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var r={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"==typeof n.clone){var r=n.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){var n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){var r=this.vertices,i=this.object.geometry.vertices;i.push(r[e+0],r[e+1],r[e+2]),i.push(r[t+0],r[t+1],r[t+2]),i.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){var r=this.normals,i=this.object.geometry.normals;i.push(r[e+0],r[e+1],r[e+2]),i.push(r[t+0],r[t+1],r[t+2]),i.push(r[n+0],r[n+1],r[n+2])},addColor:function(e,t,n){var r=this.colors,i=this.object.geometry.colors;i.push(r[e+0],r[e+1],r[e+2]),i.push(r[t+0],r[t+1],r[t+2]),i.push(r[n+0],r[n+1],r[n+2])},addUV:function(e,t,n){var r=this.uvs,i=this.object.geometry.uvs;i.push(r[e+0],r[e+1]),i.push(r[t+0],r[t+1]),i.push(r[n+0],r[n+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,r,i,o,a,s,u){var c=this.vertices.length,l=this.parseVertexIndex(e,c),h=this.parseVertexIndex(t,c),p=this.parseVertexIndex(n,c);if(this.addVertex(l,h,p),this.colors.length>0&&this.addColor(l,h,p),void 0!==r&&""!==r){var f=this.uvs.length;l=this.parseUVIndex(r,f),h=this.parseUVIndex(i,f),p=this.parseUVIndex(o,f),this.addUV(l,h,p)}if(void 0!==a&&""!==a){var d=this.normals.length;l=this.parseNormalIndex(a,d),h=a===s?l:this.parseNormalIndex(s,d),p=a===u?l:this.parseNormalIndex(u,d),this.addNormal(l,h,p)}},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,n=0,r=e.length;n<r;n++)this.addVertexPoint(this.parseVertexIndex(e[n],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var n=this.vertices.length,r=this.uvs.length,i=0,o=e.length;i<o;i++)this.addVertexLine(this.parseVertexIndex(e[i],n));var a=0;for(o=t.length;a<o;a++)this.addUVLine(this.parseUVIndex(t[a],r))}};return e.startObject("",!1),e}function o(e){vl.call(this,e),this.materials=null}return o.prototype=Object.assign(Object.create(vl.prototype),{constructor:o,load:function(e,t,n,r){var i=this,o=new yl(i.manager);o.setPath(this.path),o.load(e,(function(e){t(i.parse(e))}),n,r)},setMaterials:function(e){return this.materials=e,this},parse:function(o){var a=new i;-1!==o.indexOf("\r\n")&&(o=o.replace(/\r\n/g,"\n")),-1!==o.indexOf("\\\n")&&(o=o.replace(/\\\n/g,""));for(var s=o.split("\n"),u="",c="",l=[],h="function"==typeof"".trimLeft,p=0,f=s.length;p<f;p++)if(u=s[p],0!==(u=h?u.trimLeft():u.trim()).length&&"#"!==(c=u.charAt(0)))if("v"===c){var d=u.split(/\s+/);switch(d[0]){case"v":a.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])),d.length>=7&&a.colors.push(parseFloat(d[4]),parseFloat(d[5]),parseFloat(d[6]));break;case"vn":a.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":a.uvs.push(parseFloat(d[1]),parseFloat(d[2]))}}else if("f"===c){for(var m=u.substr(1).trim().split(/\s+/),v=[],g=0,y=m.length;g<y;g++){var b=m[g];if(b.length>0){var x=b.split("/");v.push(x)}}var w=v[0];for(g=1,y=v.length-1;g<y;g++){var _=v[g],S=v[g+1];a.addFace(w[0],_[0],S[0],w[1],_[1],S[1],w[2],_[2],S[2])}}else if("l"===c){var E=u.substring(1).trim().split(" "),A=[],P=[];if(-1===u.indexOf("/"))A=E;else for(var O=0,L=E.length;O<L;O++){var I=E[O].split("/");""!==I[0]&&A.push(I[0]),""!==I[1]&&P.push(I[1])}a.addLineGeometry(A,P)}else if("p"===c){var C=u.substr(1).trim().split(" ");a.addPointGeometry(C)}else if(null!==(l=e.exec(u))){var R=(" "+l[0].substr(1).trim()).substr(1);a.startObject(R)}else if(n.test(u))a.object.startMaterial(u.substring(7).trim(),a.materialLibraries);else if(t.test(u))a.materialLibraries.push(u.substring(7).trim());else if(r.test(u))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===c){if((l=u.split(" ")).length>1){var D=l[1].trim().toLowerCase();a.object.smooth="0"!==D&&"off"!==D}else a.object.smooth=!0;(q=a.object.currentMaterial())&&(q.smooth=a.object.smooth)}else{if("\0"===u)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+u+'"')}a.finalize();var N=new Ts;N.materialLibraries=[].concat(a.materialLibraries);for(p=0,f=a.objects.length;p<f;p++){var F=a.objects[p],j=F.geometry,U=F.materials,B="Line"===j.type,k="Points"===j.type,z=!1;if(0!==j.vertices.length){var G=new Li;G.setAttribute("position",new bi(j.vertices,3)),j.normals.length>0?G.setAttribute("normal",new bi(j.normals,3)):G.computeVertexNormals(),j.colors.length>0&&(z=!0,G.setAttribute("color",new bi(j.colors,3))),j.uvs.length>0&&G.setAttribute("uv",new bi(j.uvs,2));for(var V,H=[],W=0,X=U.length;W<X;W++){var Y=(K=U[W]).name+"_"+K.smooth+"_"+z,q=a.materials[Y];if(null!==this.materials)if(q=this.materials.create(K.name),!B||!q||q instanceof au){if(k&&q&&!(q instanceof gu)){var Q=new gu({size:10,sizeAttenuation:!1});ui.prototype.copy.call(Q,q),Q.color.copy(q.color),Q.map=q.map,q=Q}}else{var Z=new au;ui.prototype.copy.call(Z,q),Z.color.copy(q.color),q=Z}void 0===q&&((q=B?new au:k?new gu({size:1,sizeAttenuation:!1}):new Wc).name=K.name,q.flatShading=!K.smooth,q.vertexColors=z?M:T,a.materials[Y]=q),H.push(q)}if(H.length>1){for(W=0,X=U.length;W<X;W++){var K=U[W];G.addGroup(K.groupStart,K.groupCount,W)}V=B?new mu(G,H):k?new _u(G,H):new qi(G,H)}else V=B?new mu(G,H[0]):k?new _u(G,H[0]):new qi(G,H[0]);V.name=F.name,N.add(V)}}return N}}),o}(),Jd={},$d=void 0,em=Jd;
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */function tm(e,t){var n,r=e.split("."),i=em;!(r[0]in i)&&i.execScript&&i.execScript("var "+r[0]);for(;r.length&&(n=r.shift());)r.length||t===$d?i=i[n]?i[n]:i[n]={}:i[n]=t}var nm="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function rm(e){var t,n,r,i,o,a,s,u,c,l,h=e.length,p=0,f=Number.POSITIVE_INFINITY;for(u=0;u<h;++u)e[u]>p&&(p=e[u]),e[u]<f&&(f=e[u]);for(t=1<<p,n=new(nm?Uint32Array:Array)(t),r=1,i=0,o=2;r<=p;){for(u=0;u<h;++u)if(e[u]===r){for(a=0,s=i,c=0;c<r;++c)a=a<<1|1&s,s>>=1;for(l=r<<16|u,c=a;c<t;c+=o)n[c]=l;++i}++r,i<<=1,o<<=1}return[n,p,f]}function im(e,t){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=nm?new Uint8Array(e):e,this.m=!1,this.i=am,this.r=!1,!t&&(t={})||(t.index&&(this.a=t.index),t.bufferSize&&(this.h=t.bufferSize),t.bufferType&&(this.i=t.bufferType),t.resize&&(this.r=t.resize)),this.i){case om:this.b=32768,this.c=new(nm?Uint8Array:Array)(32768+this.h+258);break;case am:this.b=0,this.c=new(nm?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var om=0,am=1,sm={t:om,s:am};im.prototype.k=function(){for(;!this.m;){var e=Em(this,3);switch(1&e&&(this.m=!0),e>>>=1){case 0:var t=this.input,n=this.a,r=this.c,i=this.b,o=t.length,a=$d,s=r.length,u=$d;if(this.d=this.f=0,n+1>=o)throw Error("invalid uncompressed block header: LEN");if(a=t[n++]|t[n++]<<8,n+1>=o)throw Error("invalid uncompressed block header: NLEN");if(a===~(t[n++]|t[n++]<<8))throw Error("invalid uncompressed block header: length verify");if(n+a>t.length)throw Error("input buffer is broken");switch(this.i){case om:for(;i+a>r.length;){if(a-=u=s-i,nm)r.set(t.subarray(n,n+u),i),i+=u,n+=u;else for(;u--;)r[i++]=t[n++];this.b=i,r=this.e(),i=this.b}break;case am:for(;i+a>r.length;)r=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(nm)r.set(t.subarray(n,n+a),i),i+=a,n+=a;else for(;a--;)r[i++]=t[n++];this.a=n,this.b=i,this.c=r;break;case 1:this.j(Tm,Mm);break;case 2:var c,l,h,p,f=Em(this,5)+257,d=Em(this,5)+1,m=Em(this,4)+4,v=new(nm?Uint8Array:Array)(hm.length),g=$d,y=$d,b=$d,x=$d,w=$d;for(w=0;w<m;++w)v[hm[w]]=Em(this,3);if(!nm)for(w=m,m=v.length;w<m;++w)v[hm[w]]=0;for(c=rm(v),g=new(nm?Uint8Array:Array)(f+d),w=0,p=f+d;w<p;)switch(y=Am(this,c),y){case 16:for(x=3+Em(this,2);x--;)g[w++]=b;break;case 17:for(x=3+Em(this,3);x--;)g[w++]=0;b=0;break;case 18:for(x=11+Em(this,7);x--;)g[w++]=0;b=0;break;default:b=g[w++]=y}l=rm(nm?g.subarray(0,f):g.slice(0,f)),h=rm(nm?g.subarray(f):g.slice(f)),this.j(l,h);break;default:throw Error("unknown BTYPE: "+e)}}return this.n()};var um,cm,lm=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],hm=nm?new Uint16Array(lm):lm,pm=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],fm=nm?new Uint16Array(pm):pm,dm=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],mm=nm?new Uint8Array(dm):dm,vm=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],gm=nm?new Uint16Array(vm):vm,ym=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],bm=nm?new Uint8Array(ym):ym,xm=new(nm?Uint8Array:Array)(288);for(um=0,cm=xm.length;um<cm;++um)xm[um]=143>=um?8:255>=um?9:279>=um?7:8;var wm,_m,Tm=rm(xm),Sm=new(nm?Uint8Array:Array)(30);for(wm=0,_m=Sm.length;wm<_m;++wm)Sm[wm]=5;var Mm=rm(Sm);function Em(e,t){for(var n,r=e.f,i=e.d,o=e.input,a=e.a,s=o.length;i<t;){if(a>=s)throw Error("input buffer is broken");r|=o[a++]<<i,i+=8}return n=r&(1<<t)-1,e.f=r>>>t,e.d=i-t,e.a=a,n}function Am(e,t){for(var n,r,i=e.f,o=e.d,a=e.input,s=e.a,u=a.length,c=t[0],l=t[1];o<l&&!(s>=u);)i|=a[s++]<<o,o+=8;if((r=(n=c[i&(1<<l)-1])>>>16)>o)throw Error("invalid code length: "+r);return e.f=i>>r,e.d=o-r,e.a=s,65535&n}function Pm(e,t){var n,r;switch(this.input=e,this.a=0,!t&&(t={})||(t.index&&(this.a=t.index),t.verify&&(this.A=t.verify)),n=e[this.a++],r=e[this.a++],15&n){case Om:this.method=Om;break;default:throw Error("unsupported compression method")}if(0!=((n<<8)+r)%31)throw Error("invalid fcheck flag:"+((n<<8)+r)%31);if(32&r)throw Error("fdict flag is not supported");this.q=new im(e,{index:this.a,bufferSize:t.bufferSize,bufferType:t.bufferType,resize:t.resize})}im.prototype.j=function(e,t){var n=this.c,r=this.b;this.o=e;for(var i,o,a,s,u=n.length-258;256!==(i=Am(this,e));)if(256>i)r>=u&&(this.b=r,n=this.e(),r=this.b),n[r++]=i;else for(s=fm[o=i-257],0<mm[o]&&(s+=Em(this,mm[o])),i=Am(this,t),a=gm[i],0<bm[i]&&(a+=Em(this,bm[i])),r>=u&&(this.b=r,n=this.e(),r=this.b);s--;)n[r]=n[r++-a];for(;8<=this.d;)this.d-=8,this.a--;this.b=r},im.prototype.w=function(e,t){var n=this.c,r=this.b;this.o=e;for(var i,o,a,s,u=n.length;256!==(i=Am(this,e));)if(256>i)r>=u&&(u=(n=this.e()).length),n[r++]=i;else for(s=fm[o=i-257],0<mm[o]&&(s+=Em(this,mm[o])),i=Am(this,t),a=gm[i],0<bm[i]&&(a+=Em(this,bm[i])),r+s>u&&(u=(n=this.e()).length);s--;)n[r]=n[r++-a];for(;8<=this.d;)this.d-=8,this.a--;this.b=r},im.prototype.e=function(){var e,t,n=new(nm?Uint8Array:Array)(this.b-32768),r=this.b-32768,i=this.c;if(nm)n.set(i.subarray(32768,n.length));else for(e=0,t=n.length;e<t;++e)n[e]=i[e+32768];if(this.g.push(n),this.l+=n.length,nm)i.set(i.subarray(r,r+32768));else for(e=0;32768>e;++e)i[e]=i[r+e];return this.b=32768,i},im.prototype.z=function(e){var t,n,r,i=this.input.length/this.a+1|0,o=this.input,a=this.c;return e&&("number"==typeof e.p&&(i=e.p),"number"==typeof e.u&&(i+=e.u)),2>i?n=(r=(o.length-this.a)/this.o[2]/2*258|0)<a.length?a.length+r:a.length<<1:n=a.length*i,nm?(t=new Uint8Array(n)).set(a):t=a,this.c=t},im.prototype.n=function(){var e,t,n,r,i,o=0,a=this.c,s=this.g,u=new(nm?Uint8Array:Array)(this.l+(this.b-32768));if(0===s.length)return nm?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(t=0,n=s.length;t<n;++t)for(r=0,i=(e=s[t]).length;r<i;++r)u[o++]=e[r];for(t=32768,n=this.b;t<n;++t)u[o++]=a[t];return this.g=[],this.buffer=u},im.prototype.v=function(){var e,t=this.b;return nm?this.r?(e=new Uint8Array(t)).set(this.c.subarray(0,t)):e=this.c.subarray(0,t):(this.c.length>t&&(this.c.length=t),e=this.c),this.buffer=e},Pm.prototype.k=function(){var e,t,n=this.input;if(e=this.q.k(),this.a=this.q.a,this.A){t=(n[this.a++]<<24|n[this.a++]<<16|n[this.a++]<<8|n[this.a++])>>>0;var r=e;if("string"==typeof r){var i,o,a=r.split("");for(i=0,o=a.length;i<o;i++)a[i]=(255&a[i].charCodeAt(0))>>>0;r=a}for(var s,u=1,c=0,l=r.length,h=0;0<l;){l-=s=1024<l?1024:l;do{c+=u+=r[h++]}while(--s);u%=65521,c%=65521}if(t!==(c<<16|u)>>>0)throw Error("invalid adler-32 checksum")}return e};var Om=8;tm("Zlib.Inflate",Pm),tm("Zlib.Inflate.prototype.decompress",Pm.prototype.k);var Lm,Im,Cm,Rm,Dm={ADAPTIVE:sm.s,BLOCK:sm.t};if(Object.keys)Lm=Object.keys(Dm);else for(Im in Lm=[],Cm=0,Dm)Lm[Cm++]=Im;for(Cm=0,Rm=Lm.length;Cm<Rm;++Cm)tm("Zlib.Inflate.BufferType."+(Im=Lm[Cm]),Dm[Im]);var Nm=Jd.Zlib,Fm={findSpan:function(e,t,n){var r=n.length-e-1;if(t>=n[r])return r-1;if(t<=n[e])return e;for(var i=e,o=r,a=Math.floor((i+o)/2);t<n[a]||t>=n[a+1];)t<n[a]?o=a:i=a,a=Math.floor((i+o)/2);return a},calcBasisFunctions:function(e,t,n,r){var i=[],o=[],a=[];i[0]=1;for(var s=1;s<=n;++s){o[s]=t-r[e+1-s],a[s]=r[e+s]-t;for(var u=0,c=0;c<s;++c){var l=a[c+1],h=o[s-c],p=i[c]/(l+h);i[c]=u+l*p,u=h*p}i[s]=u}return i},calcBSplinePoint:function(e,t,n,r){for(var i=this.findSpan(e,r,t),o=this.calcBasisFunctions(i,r,e,t),a=new Rn(0,0,0,0),s=0;s<=e;++s){var u=n[i-e+s],c=o[s],l=u.w*c;a.x+=u.x*l,a.y+=u.y*l,a.z+=u.z*l,a.w+=u.w*c}return a},calcBasisFunctionDerivatives:function(e,t,n,r,i){for(var o=[],a=0;a<=n;++a)o[a]=0;var s=[];for(a=0;a<=r;++a)s[a]=o.slice(0);var u=[];for(a=0;a<=n;++a)u[a]=o.slice(0);u[0][0]=1;for(var c=o.slice(0),l=o.slice(0),h=1;h<=n;++h){c[h]=t-i[e+1-h],l[h]=i[e+h]-t;for(var p=0,f=0;f<h;++f){var d=l[f+1],m=c[h-f];u[h][f]=d+m;var v=u[f][h-1]/u[h][f];u[f][h]=p+d*v,p=m*v}u[h][h]=p}for(h=0;h<=n;++h)s[0][h]=u[h][n];for(f=0;f<=n;++f){var g=0,y=1,b=[];for(a=0;a<=n;++a)b[a]=o.slice(0);b[0][0]=1;for(var x=1;x<=r;++x){var w=0,_=f-x,T=n-x;f>=x&&(b[y][0]=b[g][0]/u[T+1][_],w=b[y][0]*u[_][T]);var S=f-1<=T?x-1:n-f;for(h=_>=-1?1:-_;h<=S;++h)b[y][h]=(b[g][h]-b[g][h-1])/u[T+1][_+h],w+=b[y][h]*u[_+h][T];f<=T&&(b[y][x]=-b[g][x-1]/u[T+1][f],w+=b[y][x]*u[f][T]),s[x][f]=w;h=g;g=y,y=h}}for(f=n,x=1;x<=r;++x){for(h=0;h<=n;++h)s[x][h]*=f;f*=n-x}return s},calcBSplineDerivatives:function(e,t,n,r,i){for(var o=i<e?i:e,a=[],s=this.findSpan(e,r,t),u=this.calcBasisFunctionDerivatives(s,r,e,o,t),c=[],l=0;l<n.length;++l){var h=(f=n[l].clone()).w;f.x*=h,f.y*=h,f.z*=h,c[l]=f}for(var p=0;p<=o;++p){for(var f=c[s-e].clone().multiplyScalar(u[p][0]),d=1;d<=e;++d)f.add(c[s-e+d].clone().multiplyScalar(u[p][d]));a[p]=f}for(p=o+1;p<=i+1;++p)a[p]=new Rn(0,0,0);return a},calcKoverI:function(e,t){for(var n=1,r=2;r<=e;++r)n*=r;var i=1;for(r=2;r<=t;++r)i*=r;for(r=2;r<=e-t;++r)i*=r;return n/i},calcRationalCurveDerivatives:function(e){for(var t=e.length,n=[],r=[],i=0;i<t;++i){var o=e[i];n[i]=new Bn(o.x,o.y,o.z),r[i]=o.w}for(var a=[],s=0;s<t;++s){var u=n[s].clone();for(i=1;i<=s;++i)u.sub(a[s-i].clone().multiplyScalar(this.calcKoverI(s,i)*r[i]));a[s]=u.divideScalar(r[0])}return a},calcNURBSDerivatives:function(e,t,n,r,i){var o=this.calcBSplineDerivatives(e,t,n,r,i);return this.calcRationalCurveDerivatives(o)},calcSurfacePoint:function(e,t,n,r,i,o,a,s){for(var u=this.findSpan(e,o,n),c=this.findSpan(t,a,r),l=this.calcBasisFunctions(u,o,e,n),h=this.calcBasisFunctions(c,a,t,r),p=[],f=0;f<=t;++f){p[f]=new Rn(0,0,0,0);for(var d=0;d<=e;++d){var m=i[u-e+d][c-t+f].clone(),v=m.w;m.x*=v,m.y*=v,m.z*=v,p[f].add(m.multiplyScalar(l[d]))}}var g=new Rn(0,0,0,0);for(f=0;f<=t;++f)g.add(p[f].multiplyScalar(h[f]));g.divideScalar(g.w),s.set(g.x,g.y,g.z)}},jm=function(e,t,n,r,i){Ml.call(this),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=i||this.knots.length-1;for(var o=0;o<n.length;++o){var a=n[o];this.controlPoints[o]=new Rn(a.x,a.y,a.z,a.w)}};(jm.prototype=Object.create(Ml.prototype)).constructor=jm,jm.prototype.getPoint=function(e){var t=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),n=Fm.calcBSplinePoint(this.degree,this.knots,this.controlPoints,t);return 1!=n.w&&n.divideScalar(n.w),new Bn(n.x,n.y,n.z)},jm.prototype.getTangent=function(e){var t=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),n=Fm.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,t,1)[1].clone();return n.normalize(),n};var Um=function(){var e,t,n;function r(e){vl.call(this,e)}function i(e,t){this.textureLoader=e,this.manager=t}function o(){}function a(){}function s(){}function u(){}function c(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function l(){}function h(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function p(e){return e/46186158e3}r.prototype=Object.assign(Object.create(vl.prototype),{constructor:r,load:function(e,t,n,r){var i=this,o=""===i.path?sh.extractUrlBase(e):i.path,a=new yl(this.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,(function(n){try{t(i.parse(n,o))}catch(t){setTimeout((function(){r&&r(t),i.manager.itemError(e)}),0)}}),n,r)},parse:function(t,n){if(a="Kaydara FBX Binary  \0",(o=t).byteLength>=a.length&&a===x(o,0,a.length))e=(new u).parse(t);else{var r=x(t);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],n=0;for(var r=0;r<t.length;++r){if((o=void 0,o=e[(i=1)-1],e=e.slice(n+i),n++,o)===t[r])return!1}var i,o;return!0}(r))throw new Error("THREE.FBXLoader: Unknown format.");if(h(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+h(r));e=(new s).parse(r)}var o,a;return new i(new Sl(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin),this.manager).parse(e)}}),i.prototype={constructor:i,parse:function(){t=this.parseConnections();var e=this.parseImages(),r=this.parseTextures(e),i=this.parseMaterials(r),a=this.parseDeformers(),s=(new o).parse(a);return this.parseScene(a,s,i),n},parseConnections:function(){var t=new Map;"Connections"in e&&e.Connections.connections.forEach((function(e){var n=e[0],r=e[1],i=e[2];t.has(n)||t.set(n,{parents:[],children:[]});var o={ID:r,relationship:i};t.get(n).parents.push(o),t.has(r)||t.set(r,{parents:[],children:[]});var a={ID:n,relationship:i};t.get(r).children.push(a)}));return t},parseImages:function(){var t={},n={};if("Video"in e.Objects){var r=e.Objects.Video;for(var i in r){var o=r[i];if(t[c=parseInt(i)]=o.RelativeFilename||o.Filename,"Content"in o){var a=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,s="string"==typeof o.Content&&""!==o.Content;if(a||s){var u=this.parseImage(r[i]);n[o.RelativeFilename||o.Filename]=u}}}}for(var c in t){var l=t[c];void 0!==n[l]?t[c]=n[l]:t[c]=t[c].split("\\").pop()}return t},parseImage:function(e){var t,n=e.Content,r=e.RelativeFilename||e.Filename,i=r.slice(r.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",r),t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof n)return"data:"+t+";base64,"+n;var o=new Uint8Array(n);return window.URL.createObjectURL(new Blob([o],{type:t}))},parseTextures:function(t){var n=new Map;if("Texture"in e.Objects){var r=e.Objects.Texture;for(var i in r){var o=this.parseTexture(r[i],t);n.set(parseInt(i),o)}}return n},parseTexture:function(e,t){var n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;var r=e.WrapModeU,i=e.WrapModeV,o=void 0!==r?r.value:0,a=void 0!==i?i.value:0;if(n.wrapS=0===o?be:xe,n.wrapT=0===a?be:xe,"Scaling"in e){var s=e.Scaling.value;n.repeat.x=s[0],n.repeat.y=s[1]}return n},loadTexture:function(e,n){var r,i,o=this.textureLoader.path,a=t.get(e.id).children;void 0!==a&&a.length>0&&void 0!==n[a[0].ID]&&(0!==(r=n[a[0].ID]).indexOf("blob:")&&0!==r.indexOf("data:")||this.textureLoader.setPath(void 0));var s=e.FileName.slice(-3).toLowerCase();if("tga"===s){var u=this.manager.getHandler(".tga");null===u?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),i=new Cn):i=u.load(r)}else"psd"===s?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),i=new Cn):i=this.textureLoader.load(r);return this.textureLoader.setPath(o),i},parseMaterials:function(t){var n=new Map;if("Material"in e.Objects){var r=e.Objects.Material;for(var i in r){var o=this.parseMaterial(r[i],t);null!==o&&n.set(parseInt(i),o)}}return n},parseMaterial:function(e,n){var r=e.id,i=e.attrName,o=e.ShadingModel;if("object"==typeof o&&(o=o.value),!t.has(r))return null;var a,s=this.parseParameters(e,n,r);switch(o.toLowerCase()){case"phong":a=new Wc;break;case"lambert":a=new qc;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),a=new Wc}return a.setValues(s),a.name=i,a},parseParameters:function(e,n,r){var i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=(new ni).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(i.color=(new ni).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=(new ni).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(i.emissive=(new ni).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=(new ni).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=(new ni).fromArray(e.SpecularColor.value));var o=this;return t.get(r).children.forEach((function(e){var t=e.relationship;switch(t){case"Bump":i.bumpMap=o.getTexture(n,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=o.getTexture(n,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=o.getTexture(n,e.ID),i.map.encoding=kt;break;case"DisplacementColor":i.displacementMap=o.getTexture(n,e.ID);break;case"EmissiveColor":i.emissiveMap=o.getTexture(n,e.ID),i.emissiveMap.encoding=kt;break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=o.getTexture(n,e.ID);break;case"ReflectionColor":i.envMap=o.getTexture(n,e.ID),i.envMap.mapping=de,i.envMap.encoding=kt;break;case"SpecularColor":i.specularMap=o.getTexture(n,e.ID),i.specularMap.encoding=kt;break;case"TransparentColor":i.alphaMap=o.getTexture(n,e.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",t)}})),i},getTexture:function(n,r){return"LayeredTexture"in e.Objects&&r in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),r=t.get(r).children[0].ID),n.get(r)},parseDeformers:function(){var n={},r={};if("Deformer"in e.Objects){var i=e.Objects.Deformer;for(var o in i){var a=i[o],s=t.get(parseInt(o));if("Skin"===a.attrType){var u=this.parseSkeleton(s,i);u.ID=o,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),u.geometryID=s.parents[0].ID,n[o]=u}else if("BlendShape"===a.attrType){var c={id:o};c.rawTargets=this.parseMorphTargets(s,i),c.id=o,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),r[o]=c}}}return{skeletons:n,morphTargets:r}},parseSkeleton:function(e,t){var n=[];return e.children.forEach((function(e){var r=t[e.ID];if("Cluster"===r.attrType){var i={ID:e.ID,indices:[],weights:[],transformLink:(new Yn).fromArray(r.TransformLink.a)};"Indexes"in r&&(i.indices=r.Indexes.a,i.weights=r.Weights.a),n.push(i)}})),{rawBones:n,bones:[]}},parseMorphTargets:function(e,n){for(var r=[],i=0;i<e.children.length;i++){var o=e.children[i],a=n[o.ID],s={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if("BlendShapeChannel"!==a.attrType)return;s.geoID=t.get(parseInt(o.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,r.push(s)}return r},parseScene:function(r,i,o){n=new Ts;var s=this.parseModels(r.skeletons,i,o),u=e.Objects.Model,c=this;s.forEach((function(e){var r=u[e.ID];c.setLookAtProperties(e,r),t.get(e.ID).parents.forEach((function(t){var n=s.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&n.add(e)})),this.bindSkeleton(r.skeletons,i,s),this.createAmbientLight(),this.setupMorphMaterials(),n.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrixWorld=e.parent.matrix);var t=g(e.userData.transformData);e.applyMatrix4(t)}}));var l=(new a).parse();1===n.children.length&&n.children[0].isGroup&&(n.children[0].animations=l,n=n.children[0]),n.animations=l},parseModels:function(n,r,i){var o=new Map,a=e.Objects.Model;for(var s in a){var u=parseInt(s),c=a[s],l=t.get(u),h=this.buildSkeleton(l,n,u,c.attrName);if(!h){switch(c.attrType){case"Camera":h=this.createCamera(l);break;case"Light":h=this.createLight(l);break;case"Mesh":h=this.createMesh(l,r,i);break;case"NurbsCurve":h=this.createCurve(l,r);break;case"LimbNode":case"Root":h=new eu;break;case"Null":default:h=new Ts}h.name=c.attrName?ep.sanitizeNodeName(c.attrName):"",h.ID=u}this.getTransformData(h,c),o.set(u,h)}return o},buildSkeleton:function(e,t,n,r){var i=null;return e.parents.forEach((function(e){for(var o in t){var a=t[o];a.rawBones.forEach((function(t,o){if(t.ID===e.ID){var s=i;(i=new eu).matrixWorld.copy(t.transformLink),i.name=r?ep.sanitizeNodeName(r):"",i.ID=n,a.bones[o]=i,null!==s&&i.add(s)}}))}})),i},createCamera:function(t){var n,r;if(t.children.forEach((function(t){var n=e.Objects.NodeAttribute[t.ID];void 0!==n&&(r=n)})),void 0===r)n=new hr;else{var i=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(i=1);var o=1;void 0!==r.NearPlane&&(o=r.NearPlane.value/1e3);var a=1e3;void 0!==r.FarPlane&&(a=r.FarPlane.value/1e3);var s=window.innerWidth,u=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(s=r.AspectWidth.value,u=r.AspectHeight.value);var c=s/u,l=45;void 0!==r.FieldOfView&&(l=r.FieldOfView.value);var h=r.FocalLength?r.FocalLength.value:null;switch(i){case 0:n=new ho(l,c,o,a),null!==h&&n.setFocalLength(h);break;case 1:n=new th(-s/2,s/2,u/2,-u/2,o,a);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),n=new hr}}return n},createLight:function(t){var n,r;if(t.children.forEach((function(t){var n=e.Objects.NodeAttribute[t.ID];void 0!==n&&(r=n)})),void 0===r)n=new hr;else{var i;i=void 0===r.LightType?0:r.LightType.value;var o=16777215;void 0!==r.Color&&(o=(new ni).fromArray(r.Color.value));var a=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(a=0);var s=0;void 0!==r.FarAttenuationEnd&&(s=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value);switch(i){case 0:n=new eh(o,a,s,1);break;case 1:n=new rh(o,a);break;case 2:var u=Math.PI/3;void 0!==r.InnerAngle&&(u=An.degToRad(r.InnerAngle.value));var c=0;void 0!==r.OuterAngle&&(c=An.degToRad(r.OuterAngle.value),c=Math.max(c,1)),n=new Jl(o,a,s,u,c,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),n=new eh(o,a)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(n.castShadow=!0)}return n},createMesh:function(e,t,n){var r,i=null,o=null,a=[];return e.children.forEach((function(e){t.has(e.ID)&&(i=t.get(e.ID)),n.has(e.ID)&&a.push(n.get(e.ID))})),a.length>1?o=a:a.length>0?o=a[0]:(o=new Wc({color:13421772}),a.push(o)),"color"in i.attributes&&a.forEach((function(e){e.vertexColors=M})),i.FBX_Deformer?(a.forEach((function(e){e.skinning=!0})),(r=new Zs(i,o)).normalizeSkinWeights()):r=new qi(i,o),r},createCurve:function(e,t){return new pu(e.children.reduce((function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e}),null),new au({color:3342591,linewidth:1}))},getTransformData:function(e,t){var n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?y(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n},setLookAtProperties:function(r,i){"LookAtProperty"in i&&t.get(r.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){var i=e.Objects.Model[t.ID];if("Lcl_Translation"in i){var o=i.Lcl_Translation.value;void 0!==r.target?(r.target.position.fromArray(o),n.add(r.target)):r.lookAt((new Bn).fromArray(o))}}}))},bindSkeleton:function(e,n,r){var i=this.parsePoseNodes();for(var o in e){var a=e[o];t.get(parseInt(a.ID)).parents.forEach((function(e){if(n.has(e.ID)){var o=e.ID;t.get(o).parents.forEach((function(e){r.has(e.ID)&&r.get(e.ID).bind(new $s(a.bones),i[e.ID])}))}}))}},parsePoseNodes:function(){var t={};if("Pose"in e.Objects){var n=e.Objects.Pose;for(var r in n)if("BindPose"===n[r].attrType){var i=n[r].PoseNode;Array.isArray(i)?i.forEach((function(e){t[e.Node]=(new Yn).fromArray(e.Matrix.a)})):t[i.Node]=(new Yn).fromArray(i.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var t=e.GlobalSettings.AmbientColor.value,r=t[0],i=t[1],o=t[2];if(0!==r||0!==i||0!==o){var a=new ni(r,i,o);n.add(new ih(a,1))}}},setupMorphMaterials:function(){var e=this;n.traverse((function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach((function(n,r){e.setupMorphMaterial(t,n,r)})):e.setupMorphMaterial(t,t.material))}))},setupMorphMaterial:function(e,t,r){var i=e.uuid,o=t.uuid,a=!1;if(n.traverse((function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(t){t.uuid===o&&e.uuid!==i&&(a=!0)})):e.material.uuid===o&&e.uuid!==i&&(a=!0))})),!0===a){var s=t.clone();s.morphTargets=!0,void 0===r?e.material=s:e.material[r]=s}else t.morphTargets=!0}},o.prototype={constructor:o,parse:function(n){var r=new Map;if("Geometry"in e.Objects){var i=e.Objects.Geometry;for(var o in i){var a=t.get(parseInt(o)),s=this.parseGeometry(a,i[o],n);r.set(parseInt(o),s)}}return r},parseGeometry:function(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(t,n,r){var i=r.skeletons,o=[],a=t.parents.map((function(t){return e.Objects.Model[t.ID]}));if(0!==a.length){var s=t.children.reduce((function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e}),null);t.children.forEach((function(e){void 0!==r.morphTargets[e.ID]&&o.push(r.morphTargets[e.ID])}));var u=a[0],c={};"RotationOrder"in u&&(c.eulerOrder=y(u.RotationOrder.value)),"InheritType"in u&&(c.inheritType=parseInt(u.InheritType.value)),"GeometricTranslation"in u&&(c.translation=u.GeometricTranslation.value),"GeometricRotation"in u&&(c.rotation=u.GeometricRotation.value),"GeometricScaling"in u&&(c.scale=u.GeometricScaling.value);var l=g(c);return this.genGeometry(n,s,o,l)}},genGeometry:function(e,t,n,r){var i=new Li;e.attrName&&(i.name=e.attrName);var o=this.parseGeoNode(e,t),a=this.genBuffers(o),s=new bi(a.vertex,3);if(s.applyMatrix4(r),i.setAttribute("position",s),a.colors.length>0&&i.setAttribute("color",new bi(a.colors,3)),t&&(i.setAttribute("skinIndex",new vi(a.weightsIndices,4)),i.setAttribute("skinWeight",new bi(a.vertexWeights,4)),i.FBX_Deformer=t),a.normal.length>0){var u=(new On).getNormalMatrix(r),c=new bi(a.normal,3);c.applyNormalMatrix(u),i.setAttribute("normal",c)}if(a.uvs.forEach((function(e,t){var n="uv"+(t+1).toString();0===t&&(n="uv"),i.setAttribute(n,new bi(a.uvs[t],2))})),o.material&&"AllSame"!==o.material.mappingType){var l=a.materialIndex[0],h=0;if(a.materialIndex.forEach((function(e,t){e!==l&&(i.addGroup(h,t-h,l),l=e,h=t)})),i.groups.length>0){var p=i.groups[i.groups.length-1],f=p.start+p.count;f!==a.materialIndex.length&&i.addGroup(f,a.materialIndex.length-f,l)}0===i.groups.length&&i.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(i,e,n,r),i},parseGeoNode:function(e,t){var n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];for(var r=0;e.LayerElementUV[r];)n.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(r,i){void 0===n.weightTable[r]&&(n.weightTable[r]=[]),n.weightTable[r].push({id:t,weight:e.weights[i]})}))}))),n},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},n=0,r=0,i=!1,o=[],a=[],s=[],u=[],c=[],l=[],h=this;return e.vertexIndices.forEach((function(p,f){var m=!1;p<0&&(p^=-1,m=!0);var v=[],g=[];if(o.push(3*p,3*p+1,3*p+2),e.color){var y=d(f,n,p,e.color);s.push(y[0],y[1],y[2])}if(e.skeleton){if(void 0!==e.weightTable[p]&&e.weightTable[p].forEach((function(e){g.push(e.weight),v.push(e.id)})),g.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);var b=[0,0,0,0],x=[0,0,0,0];g.forEach((function(e,t){var n=e,r=v[t];x.forEach((function(e,t,i){if(n>e){i[t]=n,n=e;var o=b[t];b[t]=r,r=o}}))})),v=b,g=x}for(;g.length<4;)g.push(0),v.push(0);for(var w=0;w<4;++w)c.push(g[w]),l.push(v[w])}if(e.normal){y=d(f,n,p,e.normal);a.push(y[0],y[1],y[2])}if(e.material&&"AllSame"!==e.material.mappingType)var _=d(f,n,p,e.material)[0];e.uv&&e.uv.forEach((function(e,t){var r=d(f,n,p,e);void 0===u[t]&&(u[t]=[]),u[t].push(r[0]),u[t].push(r[1])})),r++,m&&(h.genFace(t,e,o,_,a,s,u,c,l,r),n++,r=0,o=[],a=[],s=[],u=[],c=[],l=[])})),t},genFace:function(e,t,n,r,i,o,a,s,u,c){for(var l=2;l<c;l++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(l-1)]]),e.vertex.push(t.vertexPositions[n[3*(l-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(l-1)+2]]),e.vertex.push(t.vertexPositions[n[3*l]]),e.vertex.push(t.vertexPositions[n[3*l+1]]),e.vertex.push(t.vertexPositions[n[3*l+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(l-1)]),e.vertexWeights.push(s[4*(l-1)+1]),e.vertexWeights.push(s[4*(l-1)+2]),e.vertexWeights.push(s[4*(l-1)+3]),e.vertexWeights.push(s[4*l]),e.vertexWeights.push(s[4*l+1]),e.vertexWeights.push(s[4*l+2]),e.vertexWeights.push(s[4*l+3]),e.weightsIndices.push(u[0]),e.weightsIndices.push(u[1]),e.weightsIndices.push(u[2]),e.weightsIndices.push(u[3]),e.weightsIndices.push(u[4*(l-1)]),e.weightsIndices.push(u[4*(l-1)+1]),e.weightsIndices.push(u[4*(l-1)+2]),e.weightsIndices.push(u[4*(l-1)+3]),e.weightsIndices.push(u[4*l]),e.weightsIndices.push(u[4*l+1]),e.weightsIndices.push(u[4*l+2]),e.weightsIndices.push(u[4*l+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[3*(l-1)]),e.colors.push(o[3*(l-1)+1]),e.colors.push(o[3*(l-1)+2]),e.colors.push(o[3*l]),e.colors.push(o[3*l+1]),e.colors.push(o[3*l+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[3*(l-1)]),e.normal.push(i[3*(l-1)+1]),e.normal.push(i[3*(l-1)+2]),e.normal.push(i[3*l]),e.normal.push(i[3*l+1]),e.normal.push(i[3*l+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(a[n][0]),e.uvs[n].push(a[n][1]),e.uvs[n].push(a[n][2*(l-1)]),e.uvs[n].push(a[n][2*(l-1)+1]),e.uvs[n].push(a[n][2*l]),e.uvs[n].push(a[n][2*l+1])}))},addMorphTargets:function(t,n,r,i){if(0!==r.length){t.morphTargetsRelative=!0,t.morphAttributes.position=[];var o=this;r.forEach((function(r){r.rawTargets.forEach((function(r){var a=e.Objects.Geometry[r.geoID];void 0!==a&&o.genMorphGeometry(t,n,a,i,r.name)}))}))}},genMorphGeometry:function(e,t,n,r,i){for(var o=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],a=void 0!==n.Vertices?n.Vertices.a:[],s=void 0!==n.Indexes?n.Indexes.a:[],u=3*e.attributes.position.count,c=new Float32Array(u),l=0;l<s.length;l++){var h=3*s[l];c[h]=a[3*l],c[h+1]=a[3*l+1],c[h+2]=a[3*l+2]}var p={vertexIndices:o,vertexPositions:c},f=new bi(this.genBuffers(p).vertex,3);f.name=i||n.attrName,f.applyMatrix4(r),e.morphAttributes.position.push(f)},parseNormals:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a,i=[];return"IndexToDirect"===n&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:i,mappingType:t,referenceType:n}},parseUVs:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a,i=[];return"IndexToDirect"===n&&(i=e.UVIndex.a),{dataSize:2,buffer:r,indices:i,mappingType:t,referenceType:n}},parseVertexColors:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a,i=[];return"IndexToDirect"===n&&(i=e.ColorIndex.a),{dataSize:4,buffer:r,indices:i,mappingType:t,referenceType:n}},parseMaterialIndices:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};for(var r=e.Materials.a,i=[],o=0;o<r.length;++o)i.push(o);return{dataSize:1,buffer:r,indices:i,mappingType:t,referenceType:n}},parseNurbsGeometry:function(e){if(void 0===jm)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new Li;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Li;for(var n,r,i=t-1,o=e.KnotVector.a,a=[],s=e.Points.a,u=0,c=s.length;u<c;u+=4)a.push((new Rn).fromArray(s,u));if("Closed"===e.Form)a.push(a[0]);else if("Periodic"===e.Form){n=i,r=o.length-1-n;for(u=0;u<i;++u)a.push(a[u])}var l=new jm(i,o,a,n,r).getPoints(7*a.length),h=new Float32Array(3*l.length);l.forEach((function(e,t){e.toArray(h,3*t)}));var p=new Li;return p.setAttribute("position",new hi(h,3)),p}},a.prototype={constructor:a,parse:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var n in t){var r=t[n],i=this.addClip(r);e.push(i)}return e},parseClips:function(){if(void 0!==e.Objects.AnimationCurve){var t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);var n=this.parseAnimationLayers(t);return this.parseAnimStacks(n)}},parseAnimationCurveNodes:function(){var t=e.Objects.AnimationCurveNode,n=new Map;for(var r in t){var i=t[r];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){var o={id:i.id,attr:i.attrName,curves:{}};n.set(o.id,o)}}return n},parseAnimationCurves:function(n){var r=e.Objects.AnimationCurve;for(var i in r){var o={id:r[i].id,times:r[i].KeyTime.a.map(p),values:r[i].KeyValueFloat.a},a=t.get(o.id);if(void 0!==a){var s=a.parents[0].ID,u=a.parents[0].relationship;u.match(/X/)?n.get(s).curves.x=o:u.match(/Y/)?n.get(s).curves.y=o:u.match(/Z/)?n.get(s).curves.z=o:u.match(/d|DeformPercent/)&&n.has(s)&&(n.get(s).curves.morph=o)}}},parseAnimationLayers:function(r){var i=e.Objects.AnimationLayer,o=new Map;for(var a in i){var s=[],u=t.get(parseInt(a));if(void 0!==u)u.children.forEach((function(i,o){if(r.has(i.ID)){var a=r.get(i.ID);if(void 0!==a.curves.x||void 0!==a.curves.y||void 0!==a.curves.z){if(void 0===s[o])if(void 0!==(f=t.get(i.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID)){var u={modelName:(c=e.Objects.Model[f.toString()]).attrName?ep.sanitizeNodeName(c.attrName):"",ID:c.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};n.traverse((function(e){e.ID===c.id&&(u.transform=e.matrix,e.userData.transformData&&(u.eulerOrder=e.userData.transformData.eulerOrder))})),u.transform||(u.transform=new Yn),"PreRotation"in c&&(u.preRotation=c.PreRotation.value),"PostRotation"in c&&(u.postRotation=c.PostRotation.value),s[o]=u}s[o]&&(s[o][a.attr]=a)}else if(void 0!==a.curves.morph){if(void 0===s[o]){var c,l=t.get(i.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,h=t.get(l).parents[0].ID,p=t.get(h).parents[0].ID,f=t.get(p).parents[0].ID;u={modelName:(c=e.Objects.Model[f]).attrName?ep.sanitizeNodeName(c.attrName):"",morphName:e.Objects.Deformer[l].attrName};s[o]=u}s[o][a.attr]=a}}})),o.set(parseInt(a),s)}return o},parseAnimStacks:function(n){var r=e.Objects.AnimationStack,i={};for(var o in r){var a=t.get(parseInt(o)).children;a.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=n.get(a[0].ID);i[o]={name:r[o].attrName,layer:s}}return i},addClip:function(e){var t=[],n=this;return e.layer.forEach((function(e){t=t.concat(n.generateTracks(e))})),new hl(e.name,-1,t)},generateTracks:function(e){var t=[],n=new Bn,r=new Fn,i=new Bn;if(e.transform&&e.transform.decompose(n,r,i),n=n.toArray(),r=(new Zn).setFromQuaternion(r,e.eulerOrder).toArray(),i=i.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var o=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==o&&t.push(o)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var a=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);void 0!==a&&t.push(a)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var s=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");void 0!==s&&t.push(s)}if(void 0!==e.DeformPercent){var u=this.generateMorphTrack(e);void 0!==u&&t.push(u)}return t},generateVectorTrack:function(e,t,n,r){var i=this.getTimesForAllAxes(t);return new ll(e+"."+r,i,this.getKeyframeTrackValues(i,t,n))},generateRotationTrack:function(e,t,n,r,i,o){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(An.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(An.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(An.degToRad));var a=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(a,t,n);void 0!==r&&((r=r.map(An.degToRad)).push(o),r=(new Zn).fromArray(r),r=(new Fn).setFromEuler(r)),void 0!==i&&((i=i.map(An.degToRad)).push(o),i=(new Zn).fromArray(i),i=(new Fn).setFromEuler(i).inverse());for(var u=new Fn,c=new Zn,l=[],h=0;h<s.length;h+=3)c.set(s[h],s[h+1],s[h+2],o),u.setFromEuler(c),void 0!==r&&u.premultiply(r),void 0!==i&&u.multiply(i),u.toArray(l,h/3*4);return new ul(e+".quaternion",a,l)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,r=t.values.map((function(e){return e/100})),i=n.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new al(e.modelName+".morphTargetInfluences["+i+"]",t.times,r)},getTimesForAllAxes:function(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})).filter((function(e,t,n){return n.indexOf(e)==t}))},getKeyframeTrackValues:function(e,t,n){var r=n,i=[],o=-1,a=-1,s=-1;return e.forEach((function(e){if(t.x&&(o=t.x.times.indexOf(e)),t.y&&(a=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==o){var n=t.x.values[o];i.push(n),r[0]=n}else i.push(r[0]);if(-1!==a){var u=t.y.values[a];i.push(u),r[1]=u}else i.push(r[1]);if(-1!==s){var c=t.z.values[s];i.push(c),r[2]=c}else i.push(r[2])})),i},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var n=e.values[t-1],r=e.values[t]-n,i=Math.abs(r);if(i>=180){for(var o=i/180,a=r/o,s=n+a,u=e.times[t-1],c=(e.times[t]-u)/o,l=u+c,h=[],p=[];l<e.times[t];)h.push(l),l+=c,p.push(s),s+=a;e.times=w(e.times,t,h),e.values=w(e.values,t,p)}}}},s.prototype={constructor:s,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new l,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,r){var i=e.match(/^[\s\t]*;/),o=e.match(/^[\s\t]*$/);if(!i&&!o){var a=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=e.match("^\\t{"+(t.currentIndent-1)+"}}");a?t.parseNodeBegin(e,a):s?t.parseNodeProperty(e,s,n[++r]):u?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}})),this.allNodes},parseNodeBegin:function(e,t){var n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:n},o=this.parseNodeAttr(r),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,i):n in a?("PoseNode"===n?a.PoseNode.push(i):void 0!==a[n].id&&(a[n]={},a[n][a[n].id]=a[n]),""!==o.id&&(a[n][o.id]=i)):"number"==typeof o.id?(a[n]={},a[n][o.id]=i):"Properties70"!==n&&(a[n]="PoseNode"===n?[i]:i),"number"==typeof o.id&&(i.id=o.id),""!==o.name&&(i.attrName=o.name),""!==o.type&&(i.attrType=o.type),this.pushStack(i)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}},parseNodeProperty:function(e,t,n){var r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===i&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());var o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===r){var a=i.split(",").slice(1),s=parseInt(a[0]),u=parseInt(a[1]),c=i.split(",").slice(3);r="connections",function(e,t){for(var n=0,r=e.length,i=t.length;n<i;n++,r++)e[r]=t[n]}(i=[s,u],c=c.map((function(e){return e.trim().replace(/^"/,"")}))),void 0===o[r]&&(o[r]=[])}"Node"===r&&(o.id=i),r in o&&Array.isArray(o[r])?o[r].push(i):"a"!==r?o[r]=i:o.a=i,this.setCurrentProp(o,r),"a"===r&&","!==i.slice(-1)&&(o.a=b(i))}else this.parseNodeSpecialProperty(e,r,i)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=b(t.a))},parseNodeSpecialProperty:function(e,t,n){var r=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=r[0],o=r[1],a=r[2],s=r[3],u=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":u=parseFloat(u);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":u=b(u)}this.getPrevNode()[i]={type:o,type2:a,flag:s,value:u},this.setCurrentProp(this.getPrevNode(),i)}},u.prototype={constructor:u,parse:function(e){var t=new c(e);t.skip(23);var n=t.getUint32();console.log("THREE.FBXLoader: FBX binary version: "+n);for(var r=new l;!this.endOfContent(t);){var i=this.parseNode(t,n);null!==i&&r.add(i.name,i)}return r},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var n={},r=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32(),o=(t>=7500?e.getUint64():e.getUint32(),e.getUint8()),a=e.getString(o);if(0===r)return null;for(var s=[],u=0;u<i;u++)s.push(this.parseProperty(e));var c=s.length>0?s[0]:"",l=s.length>1?s[1]:"",h=s.length>2?s[2]:"";for(n.singleProperty=1===i&&e.getOffset()===r;r>e.getOffset();){var p=this.parseNode(e,t);null!==p&&this.parseSubNode(a,n,p)}return n.propertyList=s,"number"==typeof c&&(n.id=c),""!==l&&(n.attrName=l),""!==h&&(n.attrType=h),""!==a&&(n.name=a),n},parseSubNode:function(e,t,n){if(!0===n.singleProperty){var r=n.propertyList[0];Array.isArray(r)?(t[n.name]=n,n.a=r):t[n.name]=r}else if("Connections"===e&&"C"===n.name){var i=[];n.propertyList.forEach((function(e,t){0!==t&&i.push(e)})),void 0===t.connections&&(t.connections=[]),t.connections.push(i)}else if("Properties70"===n.name){Object.keys(n).forEach((function(e){t[e]=n[e]}))}else if("Properties70"===e&&"P"===n.name){var o,a=n.propertyList[0],s=n.propertyList[1],u=n.propertyList[2],c=n.propertyList[3];0===a.indexOf("Lcl ")&&(a=a.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),o="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[a]={type:s,type2:u,flag:c,value:o}}else void 0===t[n.name]?"number"==typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var n=e.getUint32();return e.getArrayBuffer(n);case"S":n=e.getUint32();return e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var r=e.getUint32(),i=e.getUint32(),o=e.getUint32();if(0===i)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}void 0===Nm&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var a=new c(new Nm.Inflate(new Uint8Array(e.getArrayBuffer(o))).decompress().buffer);switch(t){case"b":case"c":return a.getBooleanArray(r);case"d":return a.getFloat64Array(r);case"f":return a.getFloat32Array(r);case"i":return a.getInt32Array(r);case"l":return a.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},c.prototype={constructor:c,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],n=0;n<e;n++)t[n]=this.getUint8();var r=t.indexOf(0);return r>=0&&(t=t.slice(0,r)),sh.decodeText(new Uint8Array(t))}},l.prototype={constructor:l,add:function(e,t){this[e]=t}};var f=[];function d(e,t,n,r){var i;switch(r.mappingType){case"ByPolygonVertex":i=e;break;case"ByPolygon":i=t;break;case"ByVertice":i=n;break;case"AllSame":i=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(i=r.indices[i]);var o=i*r.dataSize,a=o+r.dataSize;return function(e,t,n,r){for(var i=n,o=0;i<r;i++,o++)e[o]=t[i];return e}(f,r.buffer,o,a)}var m=new Zn,v=new Bn;function g(e){var t,n=new Yn,r=new Yn,i=new Yn,o=new Yn,a=new Yn,s=new Yn,u=new Yn,c=new Yn,l=new Yn,h=new Yn,p=new Yn,f=e.inheritType?e.inheritType:0;(e.translation&&n.setPosition(v.fromArray(e.translation)),e.preRotation)&&((t=e.preRotation.map(An.degToRad)).push(e.eulerOrder),r.makeRotationFromEuler(m.fromArray(t)));e.rotation&&((t=e.rotation.map(An.degToRad)).push(e.eulerOrder),i.makeRotationFromEuler(m.fromArray(t)));e.postRotation&&((t=e.postRotation.map(An.degToRad)).push(e.eulerOrder),o.makeRotationFromEuler(m.fromArray(t)));e.scale&&a.scale(v.fromArray(e.scale)),e.scalingOffset&&u.setPosition(v.fromArray(e.scalingOffset)),e.scalingPivot&&s.setPosition(v.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(v.fromArray(e.rotationOffset)),e.rotationPivot&&l.setPosition(v.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h=e.parentMatrixWorld);var d=r.multiply(i).multiply(o),g=new Yn;h.extractRotation(g);var y,b,x,w,_=new Yn;if(_.copyPosition(h),x=_.getInverse(_).multiply(h),b=g.getInverse(g).multiply(x),y=a,0===f)w=g.multiply(d).multiply(b).multiply(y);else if(1===f)w=g.multiply(b).multiply(d).multiply(y);else{var T=(new Yn).copy(a),S=b.multiply(T.getInverse(T));w=g.multiply(d).multiply(S).multiply(y)}var M=n.multiply(c).multiply(l).multiply(r).multiply(i).multiply(o).multiply(l.getInverse(l)).multiply(u).multiply(s).multiply(a).multiply(s.getInverse(s)),E=(new Yn).copyPosition(M),A=h.multiply(E);return p.copyPosition(A),M=p.multiply(w)}function y(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function b(e){return e.split(",").map((function(e){return parseFloat(e)}))}function x(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),sh.decodeText(new Uint8Array(e,t,n))}function w(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}return r}(),Bm=function(){function e(e){vl.call(this,e),this.dracoLoader=null,this.ddsLoader=null}function t(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(vl.prototype),{constructor:e,load:function(e,t,n,r){var i,o=this;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:sh.extractUrlBase(e),o.manager.itemStart(e);var a=function(t){r?r(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},s=new yl(o.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),"use-credentials"===o.crossOrigin&&s.setWithCredentials(!0),s.load(e,(function(n){try{o.parse(n,i,(function(n){t(n),o.manager.itemEnd(e)}),a)}catch(e){a(e)}}),n,a)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},parse:function(e,t,s,u){var p,m={};if("string"==typeof e)p=e;else if(sh.decodeText(new Uint8Array(e,0,4))===a){try{m[n.KHR_BINARY_GLTF]=new c(e)}catch(e){return void(u&&u(e))}p=m[n.KHR_BINARY_GLTF].content}else p=sh.decodeText(new Uint8Array(e));var v=JSON.parse(p);if(void 0===v.asset||v.asset.version[0]<2)u&&u(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{if(v.extensionsUsed)for(var g=0;g<v.extensionsUsed.length;++g){var y=v.extensionsUsed[g],b=v.extensionsRequired||[];switch(y){case n.KHR_LIGHTS_PUNCTUAL:m[y]=new i(v);break;case n.KHR_MATERIALS_UNLIT:m[y]=new o;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:m[y]=new f;break;case n.KHR_DRACO_MESH_COMPRESSION:m[y]=new l(v,this.dracoLoader);break;case n.MSFT_TEXTURE_DDS:m[y]=new r(this.ddsLoader);break;case n.KHR_TEXTURE_TRANSFORM:m[y]=new h;break;case n.KHR_MESH_QUANTIZATION:m[y]=new d;break;default:b.indexOf(y)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+y+'".')}}new G(v,m,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(s,u)}}});var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function r(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=n.MSFT_TEXTURE_DDS,this.ddsLoader=e}function i(e){this.name=n.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[n.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function o(){this.name=n.KHR_MATERIALS_UNLIT}i.prototype.loadLight=function(e){var t,n=this.lightDefs[e],r=new ni(16777215);void 0!==n.color&&r.fromArray(n.color);var i=void 0!==n.range?n.range:0;switch(n.type){case"directional":(t=new rh(r)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new eh(r)).distance=i;break;case"spot":(t=new Jl(r)).distance=i,n.spot=n.spot||{},n.spot.innerConeAngle=void 0!==n.spot.innerConeAngle?n.spot.innerConeAngle:0,n.spot.outerConeAngle=void 0!==n.spot.outerConeAngle?n.spot.outerConeAngle:Math.PI/4,t.angle=n.spot.outerConeAngle,t.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+n.type+'".')}return t.position.set(0,0,0),t.decay=2,void 0!==n.intensity&&(t.intensity=n.intensity),t.name=n.name||"light_"+e,Promise.resolve(t)},o.prototype.getMaterialType=function(){return ci},o.prototype.extendParams=function(e,t,n){var r=[];e.color=new ni(1,1,1),e.opacity=1;var i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var o=i.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==i.baseColorTexture&&r.push(n.assignTexture(e,"map",i.baseColorTexture))}return Promise.all(r)};var a="glTF",s=12,u={JSON:1313821514,BIN:5130562};function c(e){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,s);if(this.header={magic:sh.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==a)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var r=new DataView(e,s),i=0;i<r.byteLength;){var o=r.getUint32(i,!0);i+=4;var c=r.getUint32(i,!0);if(i+=4,c===u.JSON){var l=new Uint8Array(e,s+i,o);this.content=sh.decodeText(l)}else if(c===u.BIN){var h=s+i;this.body=e.slice(h,h+o)}i+=o}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function l(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function h(){this.name=n.KHR_TEXTURE_TRANSFORM}function p(e){Vc.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),a={specular:{value:(new ni).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(e){for(var s in a)e.uniforms[s]=a[s];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),e.fragmentShader=e.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_pars_fragment>",t),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_pars_fragment>",n),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_fragment>",r),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_fragment>",i),e.fragmentShader=e.fragmentShader.replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(e){a.specular.value=e}},specularMap:{get:function(){return a.specularMap.value},set:function(e){a.specularMap.value=e}},glossiness:{get:function(){return a.glossiness.value},set:function(e){a.glossiness.value=e}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(e){a.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function f(){return{name:n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return p},extendParams:function(e,t,n){var r=t.extensions[this.name];e.color=new ni(1,1,1),e.opacity=1;var i=[];if(Array.isArray(r.diffuseFactor)){var o=r.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(void 0!==r.diffuseTexture&&i.push(n.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new ni(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new ni(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var a=r.specularGlossinessTexture;i.push(n.assignTexture(e,"glossinessMap",a)),i.push(n.assignTexture(e,"specularMap",a))}return Promise.all(i)},createMaterial:function(e){var t=new p(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=Qt,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function d(){this.name=n.KHR_MESH_QUANTIZATION}function m(e,t,n,r){$c.call(this,e,t,n,r)}l.prototype.decodePrimitive=function(e,t){var n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},s={},u={};for(var c in o){var l=L[c]||c.toLowerCase();a[l]=o[c]}for(c in e.attributes){l=L[c]||c.toLowerCase();if(void 0!==o[c]){var h=n.accessors[e.attributes[c]],p=E[h.componentType];u[l]=p,s[l]=!0===h.normalized}}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(var n in e.attributes){var r=e.attributes[n],i=s[n];void 0!==i&&(r.normalized=i)}t(e)}),a,u)}))}))},h.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},p.prototype=Object.create(Vc.prototype),p.prototype.constructor=p,p.prototype.copy=function(e){return Vc.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},m.prototype=Object.create($c.prototype),m.prototype.constructor=m,m.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r,o=0;o!==r;o++)t[o]=n[i+o];return t},m.prototype.beforeStart_=m.prototype.copySampleValue_,m.prototype.afterEnd_=m.prototype.copySampleValue_,m.prototype.interpolate_=function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,u=3*a,c=r-t,l=(n-t)/c,h=l*l,p=h*l,f=e*u,d=f-u,m=-2*p+3*h,v=p-h,g=1-m,y=v-h+l,b=0;b!==a;b++){var x=o[d+b+a],w=o[d+b+s]*c,_=o[f+b+a],T=o[f+b]*c;i[b]=g*x+y*w+m*_+v*T}return i};var v=0,g=1,b=2,w=3,_=4,T=5,S=6,E={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},A={9728:_e,9729:Ae,9984:Te,9985:Pe,9986:Me,9987:Le},P={33071:xe,33648:we,10497:be},O={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},L={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},I={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},C={CUBICSPLINE:void 0,LINEAR:It,STEP:Lt},R="OPAQUE",D="MASK",N="BLEND",F={"image/png":Xe,"image/jpeg":We};function j(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e)}function U(e,t,n){for(var r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function B(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function k(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(n=0,r=i.length;n<r;n++)e.morphTargetDictionary[i[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function z(e){for(var t="",n=Object.keys(e).sort(),r=0,i=n.length;r<i;r++)t+=n[r]+":"+e[n[r]]+";";return t}function G(e,n,r){this.json=e||{},this.extensions=n||{},this.options=r||{},this.cache=new t,this.primitiveCache={},this.textureLoader=new Sl(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new yl(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function V(e,t,n){var r=t.attributes,i=[];function o(t,r){return n.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(var a in r){var s=L[a]||a.toLowerCase();s in e.attributes||i.push(o(r[a],s))}if(void 0!==t.indices&&!e.index){var u=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));i.push(u)}return B(e,t),function(e,t,n){var r=t.attributes,i=new Er;if(void 0!==r.POSITION){var o=(p=n.json.accessors[r.POSITION]).min,a=p.max;if(void 0!==o&&void 0!==a){i.set(new Bn(o[0],o[1],o[2]),new Bn(a[0],a[1],a[2]));var s=t.targets;if(void 0!==s)for(var u=new Bn,c=0,l=s.length;c<l;c++){var h=s[c];if(void 0!==h.POSITION){var p;o=(p=n.json.accessors[h.POSITION]).min,a=p.max;void 0!==o&&void 0!==a?(u.setX(Math.max(Math.abs(o[0]),Math.abs(a[0]))),u.setY(Math.max(Math.abs(o[1]),Math.abs(a[1]))),u.setZ(Math.max(Math.abs(o[2]),Math.abs(a[2]))),i.expandByVector(u)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}e.boundingBox=i;var f=new Or;i.getCenter(f.center),f.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=f}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,n),Promise.all(i).then((function(){return void 0!==t.targets?function(e,t,n){for(var r=!1,i=!1,o=0,a=t.length;o<a;o++){if(void 0!==(c=t[o]).POSITION&&(r=!0),void 0!==c.NORMAL&&(i=!0),r&&i)break}if(!r&&!i)return Promise.resolve(e);var s=[],u=[];for(o=0,a=t.length;o<a;o++){var c=t[o];if(r){var l=void 0!==c.POSITION?n.getDependency("accessor",c.POSITION):e.attributes.position;s.push(l)}if(i){l=void 0!==c.NORMAL?n.getDependency("accessor",c.NORMAL):e.attributes.normal;u.push(l)}}return Promise.all([Promise.all(s),Promise.all(u)]).then((function(t){var n=t[0],o=t[1];return r&&(e.morphAttributes.position=n),i&&(e.morphAttributes.normal=o),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function H(e,t){var n=e.getIndex();if(null===n){var r=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var o=0;o<i.count;o++)r.push(o);e.setIndex(r),n=e.getIndex()}var a=n.count-2,s=[];if(t===Ut)for(o=1;o<=a;o++)s.push(n.getX(0)),s.push(n.getX(o)),s.push(n.getX(o+1));else for(o=0;o<a;o++)o%2==0?(s.push(n.getX(o)),s.push(n.getX(o+1)),s.push(n.getX(o+2))):(s.push(n.getX(o+2)),s.push(n.getX(o+1)),s.push(n.getX(o)));s.length/3!==a&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var u=e.clone();return u.setIndex(s),u}return G.prototype.parse=function(e,t){var n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(t){var o={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};U(i,o,r),B(o,r),e(o)})).catch(t)},G.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],r={},i={},o=0,a=t.length;o<a;o++)for(var s=t[o].joints,u=0,c=s.length;u<c;u++)e[s[u]].isBone=!0;for(var l=0,h=e.length;l<h;l++){var p=e[l];void 0!==p.mesh&&(void 0===r[p.mesh]&&(r[p.mesh]=i[p.mesh]=0),r[p.mesh]++,void 0!==p.skin&&(n[p.mesh].isSkinnedMesh=!0))}this.json.meshReferences=r,this.json.meshUses=i},G.prototype.getDependency=function(e,t){var r=e+":"+t,i=this.cache.get(r);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this.loadMesh(t);break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this.loadBufferView(t);break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this.loadMaterial(t);break;case"texture":i=this.loadTexture(t);break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;case"light":i=this.extensions[n.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,i)}return i},G.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t},G.prototype.loadBuffer=function(e){var t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);var i=this.options;return new Promise((function(e,n){r.load(j(t.uri,i.path),e,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},G.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)}))},G.prototype.loadAccessor=function(e){var t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var i=[];return void 0!==r.bufferView?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),void 0!==r.sparse&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then((function(e){var i,o=e[0],a=O[r.type],s=E[r.componentType],u=s.BYTES_PER_ELEMENT,c=u*a,l=r.byteOffset||0,h=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,p=!0===r.normalized;if(h&&h!==c){var f=Math.floor(l/h),d="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+f+":"+r.count,m=t.cache.get(d);m||(m=new Ps(new s(o,f*h,r.count*h/u),h/u),t.cache.add(d,m)),i=new Is(m,a,l%h/u,p)}else i=new hi(null===o?new s(r.count*a):new s(o,l,r.count*a),a,p);if(void 0!==r.sparse){var v=O.SCALAR,g=E[r.sparse.indices.componentType],y=r.sparse.indices.byteOffset||0,b=r.sparse.values.byteOffset||0,x=new g(e[1],y,r.sparse.count*v),w=new s(e[2],b,r.sparse.count*a);null!==o&&(i=new hi(i.array.slice(),i.itemSize,i.normalized));for(var _=0,T=x.length;_<T;_++){var S=x[_];if(i.setX(S,w[_*a]),a>=2&&i.setY(S,w[_*a+1]),a>=3&&i.setZ(S,w[_*a+2]),a>=4&&i.setW(S,w[_*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return i}))},G.prototype.loadTexture=function(e){var t,r=this,i=this.json,o=this.options,a=this.textureLoader,s=window.URL||window.webkitURL,u=i.textures[e],c=u.extensions||{},l=(t=c[n.MSFT_TEXTURE_DDS]?i.images[c[n.MSFT_TEXTURE_DDS].source]:i.images[u.source]).uri,h=!1;return void 0!==t.bufferView&&(l=r.getDependency("bufferView",t.bufferView).then((function(e){h=!0;var n=new Blob([e],{type:t.mimeType});return l=s.createObjectURL(n)}))),Promise.resolve(l).then((function(e){var t=o.manager.getHandler(e);return t||(t=c[n.MSFT_TEXTURE_DDS]?r.extensions[n.MSFT_TEXTURE_DDS].ddsLoader:a),new Promise((function(n,r){t.load(j(e,o.path),n,void 0,r)}))})).then((function(e){!0===h&&s.revokeObjectURL(l),e.flipY=!1,void 0!==u.name&&(e.name=u.name),t.mimeType in F&&(e.format=F[t.mimeType]);var n=(i.samplers||{})[u.sampler]||{};return e.magFilter=A[n.magFilter]||Ae,e.minFilter=A[n.minFilter]||Le,e.wrapS=P[n.wrapS]||be,e.wrapT=P[n.wrapT]||be,e}))},G.prototype.assignTexture=function(e,t,r){var i=this;return this.getDependency("texture",r.index).then((function(o){if(!o.isCompressedTexture)switch(t){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":o.format=We}if(void 0===r.texCoord||0==r.texCoord||"aoMap"===t&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+t+" not yet supported."),i.extensions[n.KHR_TEXTURE_TRANSFORM]){var a=void 0!==r.extensions?r.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;a&&(o=i.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(o,a))}e[t]=o}))},G.prototype.assignFinalMaterial=function(e){var t=e.geometry,n=e.material,r=(this.extensions,void 0!==t.attributes.tangent),i=void 0!==t.attributes.color,o=void 0===t.attributes.normal,a=!0===e.isSkinnedMesh,s=Object.keys(t.morphAttributes).length>0,u=s&&void 0!==t.morphAttributes.normal;if(e.isPoints){var c="PointsMaterial:"+n.uuid,l=this.cache.get(c);l||(l=new gu,ui.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,l.sizeAttenuation=!1,this.cache.add(c,l)),n=l}else if(e.isLine){c="LineBasicMaterial:"+n.uuid;var h=this.cache.get(c);h||(h=new au,ui.prototype.copy.call(h,n),h.color.copy(n.color),this.cache.add(c,h)),n=h}if(r||i||o||a||s){c="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),a&&(c+="skinning:"),r&&(c+="vertex-tangents:"),i&&(c+="vertex-colors:"),o&&(c+="flat-shading:"),s&&(c+="morph-targets:"),u&&(c+="morph-normals:");var p=this.cache.get(c);p||(p=n.clone(),a&&(p.skinning=!0),r&&(p.vertexTangents=!0),i&&(p.vertexColors=M),o&&(p.flatShading=!0),s&&(p.morphTargets=!0),u&&(p.morphNormals=!0),this.cache.add(c,p)),n=p}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",new hi(t.attributes.uv.array,2)),n.normalScale&&!r&&(n.normalScale.y=-n.normalScale.y),e.material=n},G.prototype.loadMaterial=function(e){var t,r=this.json,i=this.extensions,o=r.materials[e],a={},s=o.extensions||{},u=[];if(s[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var c=i[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=c.getMaterialType(),u.push(c.extendParams(a,o,this))}else if(s[n.KHR_MATERIALS_UNLIT]){var l=i[n.KHR_MATERIALS_UNLIT];t=l.getMaterialType(),u.push(l.extendParams(a,o,this))}else{t=Vc;var h=o.pbrMetallicRoughness||{};if(a.color=new ni(1,1,1),a.opacity=1,Array.isArray(h.baseColorFactor)){var f=h.baseColorFactor;a.color.fromArray(f),a.opacity=f[3]}void 0!==h.baseColorTexture&&u.push(this.assignTexture(a,"map",h.baseColorTexture)),a.metalness=void 0!==h.metallicFactor?h.metallicFactor:1,a.roughness=void 0!==h.roughnessFactor?h.roughnessFactor:1,void 0!==h.metallicRoughnessTexture&&(u.push(this.assignTexture(a,"metalnessMap",h.metallicRoughnessTexture)),u.push(this.assignTexture(a,"roughnessMap",h.metallicRoughnessTexture)))}!0===o.doubleSided&&(a.side=x);var d=o.alphaMode||R;return d===N?a.transparent=!0:(a.transparent=!1,d===D&&(a.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&t!==ci&&(u.push(this.assignTexture(a,"normalMap",o.normalTexture)),a.normalScale=new Pn(1,1),void 0!==o.normalTexture.scale&&a.normalScale.set(o.normalTexture.scale,o.normalTexture.scale)),void 0!==o.occlusionTexture&&t!==ci&&(u.push(this.assignTexture(a,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(a.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&t!==ci&&(a.emissive=(new ni).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&t!==ci&&u.push(this.assignTexture(a,"emissiveMap",o.emissiveTexture)),Promise.all(u).then((function(){var e;return e=t===p?i[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new t(a),void 0!==o.name&&(e.name=o.name),e.map&&(e.map.encoding=kt),e.emissiveMap&&(e.emissiveMap.encoding=kt),B(e,o),o.extensions&&U(i,e,o),e}))},G.prototype.loadGeometries=function(e){var t=this,r=this.extensions,i=this.primitiveCache;function o(e){return r[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return V(n,e,t)}))}for(var a,s,u=[],c=0,l=e.length;c<l;c++){var h,p=e[c],f=(s=void 0,(s=(a=p).extensions&&a.extensions[n.KHR_DRACO_MESH_COMPRESSION])?"draco:"+s.bufferView+":"+s.indices+":"+z(s.attributes):a.indices+":"+z(a.attributes)+":"+a.mode),d=i[f];if(d)u.push(d.promise);else h=p.extensions&&p.extensions[n.KHR_DRACO_MESH_COMPRESSION]?o(p):V(new Li,p,t),i[f]={primitive:p,promise:h},u.push(h)}return Promise.all(u)},G.prototype.loadMesh=function(e){for(var t,n=this,r=this.json.meshes[e],i=r.primitives,o=[],a=0,s=i.length;a<s;a++){var u=void 0===i[a].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new Vc({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:y})),t.DefaultMaterial):this.getDependency("material",i[a].material);o.push(u)}return o.push(n.loadGeometries(i)),Promise.all(o).then((function(t){for(var o=t.slice(0,t.length-1),a=t[t.length-1],s=[],u=0,c=a.length;u<c;u++){var l,h=a[u],p=i[u],f=o[u];if(p.mode===_||p.mode===T||p.mode===S||void 0===p.mode)!0!==(l=!0===r.isSkinnedMesh?new Zs(h,f):new qi(h,f)).isSkinnedMesh||l.geometry.attributes.skinWeight.normalized||l.normalizeSkinWeights(),p.mode===T?l.geometry=H(l.geometry,jt):p.mode===S&&(l.geometry=H(l.geometry,Ut));else if(p.mode===g)l=new mu(h,f);else if(p.mode===w)l=new pu(h,f);else if(p.mode===b)l=new vu(h,f);else{if(p.mode!==v)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);l=new _u(h,f)}Object.keys(l.geometry.morphAttributes).length>0&&k(l,r),l.name=r.name||"mesh_"+e,a.length>1&&(l.name+="_"+u),B(l,r),n.assignFinalMaterial(l),s.push(l)}if(1===s.length)return s[0];var d=new Ts;for(u=0,c=s.length;u<c;u++)d.add(s[u]);return d}))},G.prototype.loadCamera=function(e){var t,n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new ho(An.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new th(r.xmag/-2,r.xmag/2,r.ymag/2,r.ymag/-2,r.znear,r.zfar)),void 0!==n.name&&(t.name=n.name),B(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},G.prototype.loadSkin=function(e){var t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))},G.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],n=[],r=[],i=[],o=[],a=[],s=0,u=t.channels.length;s<u;s++){var c=t.channels[s],l=t.samplers[c.sampler],h=c.target,p=void 0!==h.node?h.node:h.id,f=void 0!==t.parameters?t.parameters[l.input]:l.input,d=void 0!==t.parameters?t.parameters[l.output]:l.output;n.push(this.getDependency("node",p)),r.push(this.getDependency("accessor",f)),i.push(this.getDependency("accessor",d)),o.push(l),a.push(h)}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(i),Promise.all(o),Promise.all(a)]).then((function(n){for(var r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],u=[],c=0,l=r.length;c<l;c++){var h=r[c],p=i[c],f=o[c],d=a[c],v=s[c];if(void 0!==h){var g;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,I[v.path]){case I.weights:g=al;break;case I.rotation:g=ul;break;case I.position:case I.scale:default:g=ll}var y=h.name?h.name:h.uuid,b=void 0!==d.interpolation?C[d.interpolation]:It,x=[];I[v.path]===I.weights?h.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&x.push(e.name?e.name:e.uuid)})):x.push(y);var w=f.array;if(f.normalized){var _;if(w.constructor===Int8Array)_=1/127;else if(w.constructor===Uint8Array)_=1/255;else if(w.constructor==Int16Array)_=1/32767;else{if(w.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");_=1/65535}for(var T=new Float32Array(w.length),S=0,M=w.length;S<M;S++)T[S]=w[S]*_;w=T}for(S=0,M=x.length;S<M;S++){var E=new g(x[S]+"."+I[v.path],p.array,w,b);"CUBICSPLINE"===d.interpolation&&(E.createInterpolant=function(e){return new m(this.times,this.values,this.getValueSize()/3,e)},E.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),u.push(E)}}}return new hl(void 0!==t.name?t.name:"animation_"+e,void 0,u)}))},G.prototype.loadNode=function(e){var t,r=this.json,i=this.extensions,o=this,a=r.meshReferences,s=r.meshUses,u=r.nodes[e];return(t=[],void 0!==u.mesh&&t.push(o.getDependency("mesh",u.mesh).then((function(e){var t;if(a[u.mesh]>1){var n=s[u.mesh]++;(t=e.clone()).name+="_instance_"+n}else t=e;return void 0!==u.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,n=u.weights.length;t<n;t++)e.morphTargetInfluences[t]=u.weights[t]})),t}))),void 0!==u.camera&&t.push(o.getDependency("camera",u.camera)),u.extensions&&u.extensions[n.KHR_LIGHTS_PUNCTUAL]&&void 0!==u.extensions[n.KHR_LIGHTS_PUNCTUAL].light&&t.push(o.getDependency("light",u.extensions[n.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(t)).then((function(e){var t;if((t=!0===u.isBone?new eu:e.length>1?new Ts:1===e.length?e[0]:new hr)!==e[0])for(var n=0,r=e.length;n<r;n++)t.add(e[n]);if(void 0!==u.name&&(t.userData.name=u.name,t.name=ep.sanitizeNodeName(u.name)),B(t,u),u.extensions&&U(i,t,u),void 0!==u.matrix){var o=new Yn;o.fromArray(u.matrix),t.applyMatrix4(o)}else void 0!==u.translation&&t.position.fromArray(u.translation),void 0!==u.rotation&&t.quaternion.fromArray(u.rotation),void 0!==u.scale&&t.scale.fromArray(u.scale);return t}))},G.prototype.loadScene=function(){function e(t,n,r,i){var o=r.nodes[t];return i.getDependency("node",t).then((function(e){return void 0===o.skin?e:i.getDependency("skin",o.skin).then((function(e){for(var n=[],r=0,o=(t=e).joints.length;r<o;r++)n.push(i.getDependency("node",t.joints[r]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(e.isMesh){for(var r=[],i=[],o=0,a=n.length;o<a;o++){var s=n[o];if(s){r.push(s);var u=new Yn;void 0!==t.inverseBindMatrices&&u.fromArray(t.inverseBindMatrices.array,16*o),i.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}e.bind(new $s(r,i),e.matrixWorld)}})),e}));var t})).then((function(t){n.add(t);var a=[];if(o.children)for(var s=o.children,u=0,c=s.length;u<c;u++){var l=s[u];a.push(e(l,t,r,i))}return Promise.all(a)}))}return function(t){var n=this.json,r=this.extensions,i=this.json.scenes[t],o=new pr;void 0!==i.name&&(o.name=i.name),B(o,i),i.extensions&&U(r,o,i);for(var a=i.nodes||[],s=[],u=0,c=a.length;u<c;u++)s.push(e(a[u],o,n,this));return Promise.all(s).then((function(){return o}))}}(),e}(),km=function(e){this.subdivisions=void 0===e?1:e};km.prototype.modify=function(e){(e=e.isBufferGeometry?(new to).fromBufferGeometry(e):e.clone()).mergeVertices();for(var t=this.subdivisions;t-- >0;)this.smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e},function(){var e=["a","b","c"];function t(e,t,n){return n[Math.min(e,t)+"_"+Math.max(e,t)]}function n(e,t,n,r,i,o){var a,s=Math.min(e,t),u=Math.max(e,t),c=s+"_"+u;c in r?a=r[c]:(a={a:n[s],b:n[u],newEdge:null,faces:[]},r[c]=a);a.faces.push(i),o[e].edges.push(a),o[t].edges.push(a)}function r(e,t,n,r,i){e.push(new ai(t,n,r,void 0,void 0,i))}function i(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function o(e,t,n,r){e.push([t.clone(),n.clone(),r.clone()])}km.prototype.smooth=function(a){var s,u,c,l,h,p,f,d,m,v,g,y,b,x=new Bn,w=[];s=a.vertices,u=a.faces;var _,T,S,M,E,A,P,O,L,I,C,R,D,N,F=void 0!==(c=a.faceVertexUvs)[0]&&c[0].length>0;if(F)for(var j=0;j<c.length;j++)w.push([]);for(f in function(e,t,r,i){var o,a,s;for(o=0,a=e.length;o<a;o++)r[o]={edges:[]};for(o=0,a=t.length;o<a;o++)n((s=t[o]).a,s.b,e,i,s,r),n(s.b,s.c,e,i,s,r),n(s.c,s.a,e,i,s,r)}(s,u,v=new Array(s.length),g={}),y=[],g){for(T=g[f],S=new Bn,E=3/8,A=1/8,2!=(P=T.faces.length)&&(E=.5,A=0),S.addVectors(T.a,T.b).multiplyScalar(E),x.set(0,0,0),j=0;j<P;j++){for(M=T.faces[j],m=0;m<3&&((_=s[M[e[m]]])===T.a||_===T.b);m++);x.add(_)}x.multiplyScalar(A),S.add(x),T.newEdge=y.length,y.push(S)}for(b=[],f=0,d=s.length;f<d;f++){for(D=s[f],3==(p=(R=v[f].edges).length)?O=3/16:p>3&&(O=3/(8*p)),L=1-p*O,I=O,p<=2&&2==p&&(L=.75,I=1/8),N=D.clone().multiplyScalar(L),x.set(0,0,0),j=0;j<p;j++)_=(C=R[j]).a!==D?C.a:C.b,x.add(_);x.multiplyScalar(I),N.add(x),b.push(N)}l=b.concat(y);var U,B,k,z,G,V,H,W=b.length;h=[];var X=new Pn,Y=new Pn,q=new Pn;for(f=0,d=u.length;f<d;f++)if(r(h,U=t((M=u[f]).a,M.b,g).newEdge+W,B=t(M.b,M.c,g).newEdge+W,k=t(M.c,M.a,g).newEdge+W,M.materialIndex),r(h,M.a,U,k,M.materialIndex),r(h,M.b,B,U,M.materialIndex),r(h,M.c,k,B,M.materialIndex),F)for(j=0;j<c.length;j++)G=(z=c[j][f])[0],V=z[1],H=z[2],X.set(i(G.x,V.x),i(G.y,V.y)),Y.set(i(V.x,H.x),i(V.y,H.y)),q.set(i(G.x,H.x),i(G.y,H.y)),o(w[j],X,Y,q),o(w[j],G,X,q),o(w[j],V,Y,X),o(w[j],H,q,Y);a.vertices=l,a.faces=h,F&&(a.faceVertexUvs=w)}}();var zm=function(){};!function(){var e=new Bn,t=new Bn;function n(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}function r(e,t){var n,r,i,o=t.position.distanceTo(e.position),a=0,s=[],u=e.faces.length;for(n=0;n<u;n++)(r=e.faces[n]).hasVertex(t)&&s.push(r);for(n=0;n<u;n++){var c=1;r=e.faces[n];for(var l=0;l<s.length;l++){i=s[l];var h=r.normal.dot(i.normal);c=Math.min(c,(1.001-h)/2)}a=Math.max(a,c)}return s.length<2&&(a=1),o*a+0}function i(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(var t=0;t<e.neighbors.length;t++){var n=r(e,e.neighbors[t]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[t],e.collapseCost=n,e.minCost=n,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=n,n<e.minCost&&(e.collapseNeighbor=e.neighbors[t],e.minCost=n)}e.collapseCost=e.totalCost/e.costCount}function o(e,t){for(console.assert(0===e.faces.length);e.neighbors.length;){n(e.neighbors.pop().neighbors,e)}n(t,e)}function a(e,t){n(t,e),e.v1&&n(e.v1.faces,e),e.v2&&n(e.v2.faces,e),e.v3&&n(e.v3.faces,e);for(var r,i,o=[e.v1,e.v2,e.v3],a=0;a<3;a++)i=o[(a+1)%3],(r=o[a])&&i&&(r.removeIfNonNeighbor(i),i.removeIfNonNeighbor(r))}function s(e,t,n,r){if(r){var s,u=[];for(s=0;s<n.neighbors.length;s++)u.push(n.neighbors[s]);for(s=n.faces.length-1;s>=0;s--)n.faces[s].hasVertex(r)&&a(n.faces[s],t);for(s=n.faces.length-1;s>=0;s--)n.faces[s].replaceVertex(n,r);for(o(n,e),s=0;s<u.length;s++)i(u[s])}else o(n,e)}function u(e){for(var t=e[0],n=0;n<e.length;n++)e[n].collapseCost<t.collapseCost&&(t=e[n]);return t}function c(e,t,n,r,i,o){this.a=r,this.b=i,this.c=o,this.v1=e,this.v2=t,this.v3=n,this.normal=new Bn,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(n),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(n),n.faces.push(this),n.addUniqueNeighbor(e),n.addUniqueNeighbor(t)}function l(e,t){this.position=e,this.id=t,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}c.prototype.computeNormal=function(){var n=this.v1.position,r=this.v2.position,i=this.v3.position;e.subVectors(i,r),t.subVectors(n,r),e.cross(t).normalize(),this.normal.copy(e)},c.prototype.hasVertex=function(e){return e===this.v1||e===this.v2||e===this.v3},c.prototype.replaceVertex=function(e,t){e===this.v1?this.v1=t:e===this.v2?this.v2=t:e===this.v3&&(this.v3=t),n(e.faces,this),t.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},l.prototype.addUniqueNeighbor=function(e){var t,n;t=this.neighbors,n=e,-1===t.indexOf(n)&&t.push(n)},l.prototype.removeIfNonNeighbor=function(e){var t=this.neighbors,n=this.faces,r=t.indexOf(e);if(-1!==r){for(var i=0;i<n.length;i++)if(n[i].hasVertex(e))return;t.splice(r,1)}},zm.prototype.modify=function(e,t){e.isBufferGeometry&&(e=(new to).fromBufferGeometry(e)),e.mergeVertices();var n,r,o,a=e.vertices,h=e.faces,p=[],f=[];for(n=0,r=a.length;n<r;n++){var d=new l(a[n],n);p.push(d)}for(n=0,r=h.length;n<r;n++){var m=(T=h[n]).a,v=T.b,g=T.c,y=new c(p[m],p[v],p[g],m,v,g);f.push(y)}for(n=0,r=p.length;n<r;n++)i(p[n]);for(var b=t;b--;){if(!(o=u(p))){console.log("THREE.SimplifyModifier: No next vertex");break}s(p,f,o,o.collapseNeighbor)}var x=new Li,w=[],_=[];for(n=0;n<p.length;n++){d=p[n].position;w.push(d.x,d.y,d.z)}for(n=0;n<f.length;n++){var T=f[n];m=p.indexOf(T.v1),v=p.indexOf(T.v2),g=p.indexOf(T.v3);_.push(m,v,g)}return x.setAttribute("position",new bi(w,3)),x.setIndex(_),x}}();var Gm={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Vm={};Vm[_e]=Gm.NEAREST,Vm[Te]=Gm.NEAREST_MIPMAP_NEAREST,Vm[Me]=Gm.NEAREST_MIPMAP_LINEAR,Vm[Ae]=Gm.LINEAR,Vm[Pe]=Gm.LINEAR_MIPMAP_NEAREST,Vm[Le]=Gm.LINEAR_MIPMAP_LINEAR,Vm[xe]=Gm.CLAMP_TO_EDGE,Vm[be]=Gm.REPEAT,Vm[we]=Gm.MIRRORED_REPEAT;var Hm={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},Wm=function(){};Wm.prototype={constructor:Wm,parse:function(e,t,n){var r={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,maxTextureSize:1/0,animations:[],forceIndices:!1,forcePowerOfTwoTextures:!1,includeCustomExtensions:!1};(n=Object.assign({},r,n)).animations.length>0&&(n.trs=!0);var i,o={asset:{version:"2.0",generator:"GLTFExporter"}},a=0,s=[],u=[],c=new Map,l=[],h={},p={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},f=new Map,d=0;function m(e){return f.has(e)||f.set(e,d++),f.get(e)}function v(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}function g(e){return 4*Math.ceil(e/4)}function y(e,t){t=t||0;var n=g(e.byteLength);if(n!==e.byteLength){var r=new Uint8Array(n);if(r.set(new Uint8Array(e)),0!==t)for(var i=e.byteLength;i<n;i++)r[i]=t;return r.buffer}return e}function b(e,t){if(0!==Object.keys(e.userData).length)try{var r=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&r.gltfExtensions){for(var i in void 0===t.extensions&&(t.extensions={}),r.gltfExtensions)t.extensions[i]=r.gltfExtensions[i],h[i]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}function w(e,t){var n=!1,r={};0===t.offset.x&&0===t.offset.y||(r.offset=t.offset.toArray(),n=!0),0!==t.rotation&&(r.rotation=t.rotation,n=!0),1===t.repeat.x&&1===t.repeat.y||(r.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,h.KHR_texture_transform=!0)}function _(e){return o.buffers||(o.buffers=[{byteLength:0}]),s.push(e),0}function T(e,t,r,i){var s;if(e.array.constructor===Float32Array)s=Gm.FLOAT;else if(e.array.constructor===Uint32Array)s=Gm.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)s=Gm.UNSIGNED_SHORT;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");s=Gm.UNSIGNED_BYTE}if(void 0===r&&(r=0),void 0===i&&(i=e.count),n.truncateDrawRange&&void 0!==t&&null===t.index){var u=r+i,c=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;r=Math.max(r,t.drawRange.start),(i=Math.min(u,c)-r)<0&&(i=0)}if(0===i)return null;var l,h=function(e,t,n){for(var r={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)},i=t;i<t+n;i++)for(var o=0;o<e.itemSize;o++){var a=e.array[i*e.itemSize+o];r.min[o]=Math.min(r.min[o],a),r.max[o]=Math.max(r.max[o],a)}return r}(e,r,i);void 0!==t&&(l=e===t.index?Gm.ELEMENT_ARRAY_BUFFER:Gm.ARRAY_BUFFER);var p=function(e,t,n,r,i){var s;o.bufferViews||(o.bufferViews=[]),s=t===Gm.UNSIGNED_BYTE?1:t===Gm.UNSIGNED_SHORT?2:4;for(var u=g(r*e.itemSize*s),c=new DataView(new ArrayBuffer(u)),l=0,h=n;h<n+r;h++)for(var p=0;p<e.itemSize;p++){var f=e.array[h*e.itemSize+p];t===Gm.FLOAT?c.setFloat32(l,f,!0):t===Gm.UNSIGNED_INT?c.setUint32(l,f,!0):t===Gm.UNSIGNED_SHORT?c.setUint16(l,f,!0):t===Gm.UNSIGNED_BYTE&&c.setUint8(l,f),l+=s}var d={buffer:_(c.buffer),byteOffset:a,byteLength:u};return void 0!==i&&(d.target=i),i===Gm.ARRAY_BUFFER&&(d.byteStride=e.itemSize*s),a+=u,o.bufferViews.push(d),{id:o.bufferViews.length-1,byteLength:0}}(e,s,r,i,l),f={bufferView:p.id,byteOffset:p.byteOffset,componentType:s,count:i,max:h.max,min:h.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return o.accessors||(o.accessors=[]),o.accessors.push(f),o.accessors.length-1}function S(e,t,r){p.images.has(e)||p.images.set(e,{});var s=p.images.get(e),c=t===Xe?"image/png":"image/jpeg",l=c+":flipY/"+r.toString();if(void 0!==s[l])return s[l];o.images||(o.images=[]);var h={mimeType:c};if(n.embedImages){var f=i=i||document.createElement("canvas");f.width=Math.min(e.width,n.maxTextureSize),f.height=Math.min(e.height,n.maxTextureSize),n.forcePowerOfTwoTextures&&!function(e){return An.isPowerOfTwo(e.width)&&An.isPowerOfTwo(e.height)}(f)&&(console.warn("GLTFExporter: Resized non-power-of-two image.",e),f.width=An.floorPowerOfTwo(f.width),f.height=An.floorPowerOfTwo(f.height));var d=f.getContext("2d");!0===r&&(d.translate(0,f.height),d.scale(1,-1)),d.drawImage(e,0,0,f.width,f.height),!0===n.binary?u.push(new Promise((function(e){f.toBlob((function(t){(function(e){return o.bufferViews||(o.bufferViews=[]),new Promise((function(t){var n=new window.FileReader;n.readAsArrayBuffer(e),n.onloadend=function(){var e=y(n.result),r={buffer:_(e),byteOffset:a,byteLength:e.byteLength};a+=e.byteLength,o.bufferViews.push(r),t(o.bufferViews.length-1)}}))})(t).then((function(t){h.bufferView=t,e()}))}),c)}))):h.uri=f.toDataURL(c)}else h.uri=e.src;o.images.push(h);var m=o.images.length-1;return s[l]=m,m}function M(e){o.samplers||(o.samplers=[]);var t={magFilter:Vm[e.magFilter],minFilter:Vm[e.minFilter],wrapS:Vm[e.wrapS],wrapT:Vm[e.wrapT]};return o.samplers.push(t),o.samplers.length-1}function E(e){if(p.textures.has(e))return p.textures.get(e);o.textures||(o.textures=[]);var t={sampler:M(e),source:S(e.image,e.format,e.flipY)};e.name&&(t.name=e.name),o.textures.push(t);var n=o.textures.length-1;return p.textures.set(e,n),n}function A(e){if(p.materials.has(e))return p.materials.get(e);if(o.materials||(o.materials=[]),e.isShaderMaterial&&!e.isGLTFSpecularGlossinessMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;var t={pbrMetallicRoughness:{}};e.isMeshBasicMaterial?(t.extensions={KHR_materials_unlit:{}},h.KHR_materials_unlit=!0):e.isGLTFSpecularGlossinessMaterial?(t.extensions={KHR_materials_pbrSpecularGlossiness:{}},h.KHR_materials_pbrSpecularGlossiness=!0):e.isMeshStandardMaterial||console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var n=e.color.toArray().concat([e.opacity]);if(v(n,[1,1,1,1])||(t.pbrMetallicRoughness.baseColorFactor=n),e.isMeshStandardMaterial?(t.pbrMetallicRoughness.metallicFactor=e.metalness,t.pbrMetallicRoughness.roughnessFactor=e.roughness):e.isMeshBasicMaterial?(t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9):(t.pbrMetallicRoughness.metallicFactor=.5,t.pbrMetallicRoughness.roughnessFactor=.5),e.isGLTFSpecularGlossinessMaterial){t.pbrMetallicRoughness.baseColorFactor&&(t.extensions.KHR_materials_pbrSpecularGlossiness.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);var r=[1,1,1];e.specular.toArray(r,0),t.extensions.KHR_materials_pbrSpecularGlossiness.specularFactor=r,t.extensions.KHR_materials_pbrSpecularGlossiness.glossinessFactor=e.glossiness}if(e.metalnessMap||e.roughnessMap)if(e.metalnessMap===e.roughnessMap){var i={index:E(e.metalnessMap)};w(i,e.metalnessMap),t.pbrMetallicRoughness.metallicRoughnessTexture=i}else console.warn("THREE.GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.");if(e.map){var a={index:E(e.map)};w(a,e.map),e.isGLTFSpecularGlossinessMaterial&&(t.extensions.KHR_materials_pbrSpecularGlossiness.diffuseTexture=a),t.pbrMetallicRoughness.baseColorTexture=a}if(e.isGLTFSpecularGlossinessMaterial&&e.specularMap){var s={index:E(e.specularMap)};w(s,e.specularMap),t.extensions.KHR_materials_pbrSpecularGlossiness.specularGlossinessTexture=s}if(e.emissive){var u=e.emissive.clone().multiplyScalar(e.emissiveIntensity).toArray();if(v(u,[0,0,0])||(t.emissiveFactor=u),e.emissiveMap){var c={index:E(e.emissiveMap)};w(c,e.emissiveMap),t.emissiveTexture=c}}if(e.normalMap){var l={index:E(e.normalMap)};e.normalScale&&-1!==e.normalScale.x&&(e.normalScale.x!==e.normalScale.y&&console.warn("THREE.GLTFExporter: Normal scale components are different, ignoring Y and exporting X."),l.scale=e.normalScale.x),w(l,e.normalMap),t.normalTexture=l}if(e.aoMap){var f={index:E(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(f.strength=e.aoMapIntensity),w(f,e.aoMap),t.occlusionTexture=f}e.transparent?t.alphaMode="BLEND":e.alphaTest>0&&(t.alphaMode="MASK",t.alphaCutoff=e.alphaTest),e.side===x&&(t.doubleSided=!0),""!==e.name&&(t.name=e.name),b(e,t),o.materials.push(t);var d=o.materials.length-1;return p.materials.set(e,d),d}function P(e){var t=e.geometry.uuid+":"+e.material.uuid;if(p.meshes.has(t))return p.meshes.get(t);var r,i=e.geometry;if(e.isLineSegments)r=Gm.LINES;else if(e.isLineLoop)r=Gm.LINE_LOOP;else if(e.isLine)r=Gm.LINE_STRIP;else if(e.isPoints)r=Gm.POINTS;else{if(!i.isBufferGeometry){console.warn("GLTFExporter: Exporting THREE.Geometry will increase file size. Use BufferGeometry instead.");var a=new Li;a.fromGeometry(i),i=a}r=e.material.wireframe?Gm.LINES:Gm.TRIANGLES}var s={},u={},c=[],l=[],h={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},f=i.getAttribute("normal");void 0===f||function(e){if(p.attributesNormalized.has(e))return!1;for(var t=new Bn,n=0,r=e.count;n<r;n++)if(Math.abs(t.fromArray(e.array,3*n).length()-1)>5e-4)return!1;return!0}(f)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),i.setAttribute("normal",function(e){if(p.attributesNormalized.has(e))return p.attributesNormalized.get(e);for(var t=e.clone(),n=new Bn,r=0,i=t.count;r<i;r++)n.fromArray(t.array,3*r),0===n.x&&0===n.y&&0===n.z?n.setX(1):n.normalize(),n.toArray(t.array,3*r);return p.attributesNormalized.set(e,t),t}(f)));var d=null;for(var v in i.attributes)if("morph"!==v.substr(0,5)){var g=i.attributes[v];v=h[v]||v.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(v)||(v="_"+v),p.attributes.has(m(g)))u[v]=p.attributes.get(m(g));else{d=null;var y=g.array;"JOINTS_0"!==v||y instanceof Uint16Array||y instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),d=new hi(new Uint16Array(y),g.itemSize,g.normalized));var x=T(d||g,i);null!==x&&(u[v]=x,p.attributes.set(m(g),x))}}if(void 0!==f&&i.setAttribute("normal",f),0===Object.keys(u).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){var w=[],_=[],S={};if(void 0!==e.morphTargetDictionary)for(var M in e.morphTargetDictionary)S[e.morphTargetDictionary[M]]=M;for(var E=0;E<e.morphTargetInfluences.length;++E){var P={},O=!1;for(var v in i.morphAttributes)if("position"===v||"normal"===v){g=i.morphAttributes[v][E];var L=v.toUpperCase(),I=i.attributes[v];if(p.attributes.has(m(g)))P[L]=p.attributes.get(m(g));else{var C=g.clone();if(!i.morphTargetsRelative)for(var R=0,D=g.count;R<D;R++)C.setXYZ(R,g.getX(R)-I.getX(R),g.getY(R)-I.getY(R),g.getZ(R)-I.getZ(R));P[L]=T(C,i),p.attributes.set(m(I),P[L])}}else O||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),O=!0);l.push(P),w.push(e.morphTargetInfluences[E]),void 0!==e.morphTargetDictionary&&_.push(S[E])}s.weights=w,_.length>0&&(s.extras={},s.extras.targetNames=_)}var N=n.forceIndices,F=Array.isArray(e.material);if(F&&0===i.groups.length)return null;!N&&null===i.index&&F&&(console.warn("THREE.GLTFExporter: Creating index for non-indexed multi-material mesh."),N=!0);var j=!1;if(null===i.index&&N){for(var U=[],B=(E=0,i.attributes.position.count);E<B;E++)U[E]=E;i.setIndex(U),j=!0}var k=F?e.material:[e.material],z=F?i.groups:[{materialIndex:0,start:void 0,count:void 0}];for(E=0,B=z.length;E<B;E++){var G={mode:r,attributes:u};if(b(i,G),l.length>0&&(G.targets=l),null!==i.index){t=m(i.index);void 0===z[E].start&&void 0===z[E].count||(t+=":"+z[E].start+":"+z[E].count),p.attributes.has(t)?G.indices=p.attributes.get(t):(G.indices=T(i.index,i,z[E].start,z[E].count),p.attributes.set(t,G.indices)),null===G.indices&&delete G.indices}var V=A(k[z[E].materialIndex]);null!==V&&(G.material=V),c.push(G)}j&&i.setIndex(null),s.primitives=c,o.meshes||(o.meshes=[]),o.meshes.push(s);var H=o.meshes.length-1;return p.meshes.set(t,H),H}function O(e,t){o.animations||(o.animations=[]);for(var n=(e=Wm.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,r=[],i=[],a=0;a<n.length;++a){var s=n[a],u=ep.parseTrackName(s.name),l=ep.findNode(t,u.nodeName),h=Hm[u.propertyName];if("bones"===u.objectName&&(l=!0===l.isSkinnedMesh?l.skeleton.getBoneByName(u.objectIndex):void 0),!l||!h)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',s.name),null;var p,f=s.values.length/s.times.length;h===Hm.morphTargetInfluences&&(f/=l.morphTargetInfluences.length),!0===s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(p="CUBICSPLINE",f/=3):p=s.getInterpolation()===Lt?"STEP":"LINEAR",i.push({input:T(new hi(s.times,1)),output:T(new hi(s.values,f)),interpolation:p}),r.push({sampler:i.length-1,target:{node:c.get(l),path:h}})}return o.animations.push({name:e.name||"clip_"+o.animations.length,samplers:i,channels:r}),o.animations.length-1}function L(e){var t=o.nodes[c.get(e)],n=e.skeleton;if(void 0===n)return null;var r=e.skeleton.bones[0];if(void 0===r)return null;for(var i=[],a=new Float32Array(16*n.bones.length),s=0;s<n.bones.length;++s)i.push(c.get(n.bones[s])),n.boneInverses[s].toArray(a,16*s);return void 0===o.skins&&(o.skins=[]),o.skins.push({inverseBindMatrices:T(new hi(a,16)),joints:i,skeleton:c.get(r)}),t.skin=o.skins.length-1}function I(e){var t={};e.name&&(t.name=e.name),t.color=e.color.toArray(),t.intensity=e.intensity,e.isDirectionalLight?t.type="directional":e.isPointLight?(t.type="point",e.distance>0&&(t.range=e.distance)):e.isSpotLight&&(t.type="spot",e.distance>0&&(t.range=e.distance),t.spot={},t.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,t.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1.");var n=o.extensions.KHR_lights_punctual.lights;return n.push(t),n.length-1}function C(e){o.nodes||(o.nodes=[]);var t={};if(n.trs){var r=e.quaternion.toArray(),i=e.position.toArray(),a=e.scale.toArray();v(r,[0,0,0,1])||(t.rotation=r),v(i,[0,0,0])||(t.translation=i),v(a,[1,1,1])||(t.scale=a)}else e.matrixAutoUpdate&&e.updateMatrix(),v(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])||(t.matrix=e.matrix.elements);if(""!==e.name&&(t.name=String(e.name)),b(e,t),e.isMesh||e.isLine||e.isPoints){var s=P(e);null!==s&&(t.mesh=s)}else if(e.isCamera)t.camera=function(e){o.cameras||(o.cameras=[]);var t=e.isOrthographicCamera,n={type:t?"orthographic":"perspective"};return t?n.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:n.perspective={aspectRatio:e.aspect,yfov:An.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(n.name=e.type),o.cameras.push(n),o.cameras.length-1}(e);else if(e.isDirectionalLight||e.isPointLight||e.isSpotLight)h.KHR_lights_punctual||(o.extensions=o.extensions||{},o.extensions.KHR_lights_punctual={lights:[]},h.KHR_lights_punctual=!0),t.extensions=t.extensions||{},t.extensions.KHR_lights_punctual={light:I(e)};else if(e.isLight)return console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e),null;if(e.isSkinnedMesh&&l.push(e),e.children.length>0){for(var u=[],p=0,f=e.children.length;p<f;p++){var d=e.children[p];if(d.visible||!1===n.onlyVisible){var m=C(d);null!==m&&u.push(m)}}u.length>0&&(t.children=u)}o.nodes.push(t);var g=o.nodes.length-1;return c.set(e,g),g}function R(e){o.scenes||(o.scenes=[],o.scene=0);var t={nodes:[]};""!==e.name&&(t.name=e.name),e.userData&&Object.keys(e.userData).length>0&&(t.extras=b(e)),o.scenes.push(t);for(var r=[],i=0,a=e.children.length;i<a;i++){var s=e.children[i];if(s.visible||!1===n.onlyVisible){var u=C(s);null!==u&&r.push(u)}}r.length>0&&(t.nodes=r),b(e,t)}!function(e){e=e instanceof Array?e:[e];for(var t=[],r=0;r<e.length;r++)e[r]instanceof pr?R(e[r]):t.push(e[r]);for(t.length>0&&function(e){var t=new pr;t.name="AuxScene";for(var n=0;n<e.length;n++)t.children.push(e[n]);R(t)}(t),r=0;r<l.length;++r)L(l[r]);for(r=0;r<n.animations.length;++r)O(n.animations[r],e[0])}(e),Promise.all(u).then((function(){var e=new Blob(s,{type:"application/octet-stream"}),r=Object.keys(h);if(r.length>0&&(o.extensionsUsed=r),o.buffers&&o.buffers.length>0){o.buffers[0].byteLength=e.size;var i=new window.FileReader;if(!0===n.binary){i.readAsArrayBuffer(e),i.onloadend=function(){var e=y(i.result),n=new DataView(new ArrayBuffer(8));n.setUint32(0,e.byteLength,!0),n.setUint32(4,5130562,!0);var r=y(function(e){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(e).buffer;for(var t=new Uint8Array(new ArrayBuffer(e.length)),n=0,r=e.length;n<r;n++){var i=e.charCodeAt(n);t[n]=i>255?32:i}return t.buffer}(JSON.stringify(o)),32),a=new DataView(new ArrayBuffer(8));a.setUint32(0,r.byteLength,!0),a.setUint32(4,1313821514,!0);var s=new ArrayBuffer(12),u=new DataView(s);u.setUint32(0,1179937895,!0),u.setUint32(4,2,!0);var c=12+a.byteLength+r.byteLength+n.byteLength+e.byteLength;u.setUint32(8,c,!0);var l=new Blob([s,a,r,n,e],{type:"application/octet-stream"}),h=new window.FileReader;h.readAsArrayBuffer(l),h.onloadend=function(){t(h.result)}}}else i.readAsDataURL(e),i.onloadend=function(){var e=i.result;o.buffers[0].uri=e,t(o)}}else t(o)}))}},Wm.Utils={insertKeyframe:function(e,t){var n,r=e.getValueSize(),i=new e.TimeBufferType(e.times.length+1),o=new e.ValueBufferType(e.values.length+r),a=e.createInterpolant(new e.ValueBufferType(r));if(0===e.times.length){i[0]=t;for(var s=0;s<r;s++)o[s]=0;n=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<.001)return 0;i[0]=t,i.set(e.times,1),o.set(a.evaluate(t),0),o.set(e.values,r),n=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<.001)return e.times.length-1;i[i.length-1]=t,i.set(e.times,0),o.set(e.values,0),o.set(a.evaluate(t),e.values.length),n=i.length-1}else for(s=0;s<e.times.length;s++){if(Math.abs(e.times[s]-t)<.001)return s;if(e.times[s]<t&&e.times[s+1]>t){i.set(e.times.slice(0,s+1),0),i[s+1]=t,i.set(e.times.slice(s+1),s+2),o.set(e.values.slice(0,(s+1)*r),0),o.set(a.evaluate(t),(s+1)*r),o.set(e.values.slice((s+1)*r),(s+2)*r),n=s+1;break}}return e.times=i,e.values=o,n},mergeMorphTargetTracks:function(e,t){for(var n=[],r={},i=e.tracks,o=0;o<i.length;++o){var a=i[o],s=ep.parseTrackName(a.name),u=ep.findNode(t,s.nodeName);if("morphTargetInfluences"===s.propertyName&&void 0!==s.propertyIndex){if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(a=a.clone()).setInterpolation(It)}var c,l=u.morphTargetInfluences.length,h=u.morphTargetDictionary[s.propertyIndex];if(void 0===h)throw new Error("THREE.GLTFExporter: Morph target name not found: "+s.propertyIndex);if(void 0!==r[u.uuid]){var p=a.createInterpolant(new a.ValueBufferType(1));c=r[u.uuid];for(m=0;m<c.times.length;m++)c.values[m*l+h]=p.evaluate(c.times[m]);for(m=0;m<a.times.length;m++){var f=this.insertKeyframe(c,a.times[m]);c.values[f*l+h]=a.values[m]}}else{for(var d=new((c=a.clone()).ValueBufferType)(l*c.times.length),m=0;m<c.times.length;m++)d[m*l+h]=c.values[m];c.name=".morphTargetInfluences",c.values=d,r[u.uuid]=c,n.push(c)}}else n.push(a)}return e.tracks=n,e}};var Xm={TransformControls:Td,PointerLockControls:Ed,FirstPersonControls:function(e,t){void 0===t&&(console.warn('THREE.FirstPersonControls: The second parameter "domElement" is now mandatory.'),t=document),this.object=e,this.domElement=t,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.viewHalfX=0,this.viewHalfY=0;var n,r=0,i=0,o=new Bn,a=new cp,s=new Bn;function u(e){e.preventDefault()}this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.lookAt=function(e,t,n){return e.isVector3?s.copy(e):s.set(e,t,n),this.object.lookAt(s),m(this),this},this.update=(n=new Bn,function(e){if(!1!==this.enabled){if(this.heightSpeed){var t=An.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(t*this.heightCoef)}else this.autoSpeedFactor=0;var o=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(o+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(o),this.moveLeft&&this.object.translateX(-o),this.moveRight&&this.object.translateX(o),this.moveUp&&this.object.translateY(o),this.moveDown&&this.object.translateY(-o);var a=e*this.lookSpeed;this.activeLook||(a=0);var s=1;this.constrainVertical&&(s=Math.PI/(this.verticalMax-this.verticalMin)),i-=this.mouseX*a,this.lookVertical&&(r-=this.mouseY*a*s),r=Math.max(-85,Math.min(85,r));var u=An.degToRad(90-r),c=An.degToRad(i);this.constrainVertical&&(u=An.mapLinear(u,0,Math.PI,this.verticalMin,this.verticalMax));var l=this.object.position;n.setFromSphericalCoords(1,u,c).add(l),this.object.lookAt(n)}}),this.dispose=function(){this.domElement.removeEventListener("contextmenu",u,!1),this.domElement.removeEventListener("mousedown",l,!1),this.domElement.removeEventListener("mousemove",c,!1),this.domElement.removeEventListener("mouseup",h,!1),window.removeEventListener("keydown",p,!1),window.removeEventListener("keyup",f,!1)};var c=d(this,this.onMouseMove),l=d(this,this.onMouseDown),h=d(this,this.onMouseUp),p=d(this,this.onKeyDown),f=d(this,this.onKeyUp);function d(e,t){return function(){t.apply(e,arguments)}}function m(e){var t=e.object.quaternion;o.set(0,0,-1).applyQuaternion(t),a.setFromVector3(o),r=90-An.radToDeg(a.phi),i=An.radToDeg(a.theta)}this.domElement.addEventListener("contextmenu",u,!1),this.domElement.addEventListener("mousemove",c,!1),this.domElement.addEventListener("mousedown",l,!1),this.domElement.addEventListener("mouseup",h,!1),window.addEventListener("keydown",p,!1),window.addEventListener("keyup",f,!1),this.handleResize(),m(this)},FXAAShader:Ad,CSS2DRenderer:function(){var e,t,n,r,i=this,o=new Bn,a=new Yn,s=new Yn,u={objects:new WeakMap},c=document.createElement("div");c.style.overflow="hidden",this.domElement=c,this.getSize=function(){return{width:e,height:t}},this.setSize=function(i,o){n=(e=i)/2,r=(t=o)/2,c.style.width=i+"px",c.style.height=o+"px"};var l,h,p=function(e,t,a){if(e instanceof Ld){e.onBeforeRender(i,t,a),o.setFromMatrixPosition(e.matrixWorld),o.applyMatrix4(s);var l=e.element,h="translate(-50%,-50%) translate("+(o.x*n+n)+"px,"+(-o.y*r+r)+"px)";l.style.WebkitTransform=h,l.style.MozTransform=h,l.style.oTransform=h,l.style.transform=h,l.style.display=e.visible&&o.z>=-1&&o.z<=1?"":"none";var d={distanceToCameraSquared:f(a,e)};u.objects.set(e,d),l.parentNode!==c&&c.appendChild(l),e.onAfterRender(i,t,a)}for(var m=0,v=e.children.length;m<v;m++)p(e.children[m],t,a)},f=(l=new Bn,h=new Bn,function(e,t){return l.setFromMatrixPosition(e.matrixWorld),h.setFromMatrixPosition(t.matrixWorld),l.distanceToSquared(h)}),d=function(e){for(var t=function(e){var t=[];return e.traverse((function(e){e instanceof Ld&&t.push(e)})),t}(e).sort((function(e,t){return u.objects.get(e).distanceToCameraSquared-u.objects.get(t).distanceToCameraSquared})),n=t.length,r=0,i=t.length;r<i;r++)t[r].element.style.zIndex=n-r};this.render=function(e,t){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),a.copy(t.matrixWorldInverse),s.multiplyMatrices(t.projectionMatrix,a),p(e,e,t),d(e)}},CSS3DRenderer:function(){var e,t,n,r,i=this,o=new Yn,a={camera:{fov:0,style:""},objects:new WeakMap},s=document.createElement("div");s.style.overflow="hidden",this.domElement=s;var u=document.createElement("div");u.style.WebkitTransformStyle="preserve-3d",u.style.transformStyle="preserve-3d",u.style.pointerEvents="none",s.appendChild(u);var c=/Trident/i.test(navigator.userAgent);function l(e){return Math.abs(e)<1e-10?0:e}function h(e){var t=e.elements;return"matrix3d("+l(t[0])+","+l(-t[1])+","+l(t[2])+","+l(t[3])+","+l(t[4])+","+l(-t[5])+","+l(t[6])+","+l(t[7])+","+l(t[8])+","+l(-t[9])+","+l(t[10])+","+l(t[11])+","+l(t[12])+","+l(-t[13])+","+l(t[14])+","+l(t[15])+")"}function p(e,t){var i=e.elements,o="matrix3d("+l(i[0])+","+l(i[1])+","+l(i[2])+","+l(i[3])+","+l(-i[4])+","+l(-i[5])+","+l(-i[6])+","+l(-i[7])+","+l(i[8])+","+l(i[9])+","+l(i[10])+","+l(i[11])+","+l(i[12])+","+l(i[13])+","+l(i[14])+","+l(i[15])+")";return c?"translate(-50%,-50%)translate("+n+"px,"+r+"px)"+t+o:"translate(-50%,-50%)"+o}this.getSize=function(){return{width:e,height:t}},this.setSize=function(i,o){n=(e=i)/2,r=(t=o)/2,s.style.width=i+"px",s.style.height=o+"px",u.style.width=i+"px",u.style.height=o+"px"};var f,d,m=(f=new Bn,d=new Bn,function(e,t){return f.setFromMatrixPosition(e.matrixWorld),d.setFromMatrixPosition(t.matrixWorld),f.distanceToSquared(d)});function v(e){for(var t=function(e){var t=[];return e.traverse((function(e){e instanceof Pd&&t.push(e)})),t}(e).sort((function(e,t){return a.objects.get(e).distanceToCameraSquared-a.objects.get(t).distanceToCameraSquared})),n=t.length,r=0,i=t.length;r<i;r++)t[r].element.style.zIndex=n-r}this.render=function(e,t){var f=t.projectionMatrix.elements[5]*r;if(a.camera.fov!==f&&(t.isPerspectiveCamera?(s.style.WebkitPerspective=f+"px",s.style.perspective=f+"px"):(s.style.WebkitPerspective="",s.style.perspective=""),a.camera.fov=f),!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),t.isOrthographicCamera)var d=-(t.right+t.left)/2,g=(t.top+t.bottom)/2;var y=t.isOrthographicCamera?"scale("+f+")translate("+l(d)+"px,"+l(g)+"px)"+h(t.matrixWorldInverse):"translateZ("+f+"px)"+h(t.matrixWorldInverse),b=y+"translate("+n+"px,"+r+"px)";a.camera.style===b||c||(u.style.WebkitTransform=b,u.style.transform=b,a.camera.style=b),function e(t,n,r,s){if(t instanceof Pd){var l;t.onBeforeRender(i,n,r),t instanceof Od?(o.copy(r.matrixWorldInverse),o.transpose(),o.copyPosition(t.matrixWorld),o.scale(t.scale),o.elements[3]=0,o.elements[7]=0,o.elements[11]=0,o.elements[15]=1,l=p(o,s)):l=p(t.matrixWorld,s);var h=t.element,f=a.objects.get(t);if(void 0===f||f.style!==l){h.style.WebkitTransform=l,h.style.transform=l;var d={style:l};c&&(d.distanceToCameraSquared=m(r,t)),a.objects.set(t,d)}h.parentNode!==u&&u.appendChild(h),t.onAfterRender(i,n,r)}for(var v=0,g=t.children.length;v<g;v++)e(t.children[v],n,r,s)}(e,e,t,y),c&&v(e)}},EffectComposer:Vd,ShaderPass:Nd,RenderPass:Fd,OutlinePass:Ud,SAOPass:Qd,UnrealBloomPass:kd,SSAARenderPass:Zd,OBJLoader:Kd,FBXLoader:Um,GLTFLoader:Bm,SubdivisionModifier:km,CSS3DObject:Pd,CSS2DObject:Ld,LineMaterial:gd,LineGeometry:wd,Line2:_d,GLTFExporter:Wm,SimplifyModifier:zm},Ym=Object.assign(r,Xm),qm=n(59),Qm=n(381).Signal,Zm={windowResize:new Qm,sceneChanged:new Qm,backgroundChanged:new Qm,beforeRender:new Qm,afterRender:new Qm,sceneRendered:new Qm,lodRendered:new Qm,tweenUpdate:new Qm,hover:new Qm,click:new Qm,dblClick:new Qm,rightClick:new Qm,mouseDown:new Qm,mouseMove:new Qm,mouseUp:new Qm,mouseWheel:new Qm,modelHover:new Qm,modelClick:new Qm,modelDblClick:new Qm,modelRightClick:new Qm,poiHover:new Qm,poiClick:new Qm,poiDblClick:new Qm,poiRightClick:new Qm,selectPosition:new Qm,modelAdded:new Qm,poiAdded:new Qm,sceneAdded:new Qm,otherAdded:new Qm,objectAdded:new Qm,objectRemoved:new Qm,objectChanged:new Qm,geometryChanged:new Qm,materialAdded:new Qm,materialChanged:new Qm,materialRemoved:new Qm,cameraChange:new Qm,outlineChange:new Qm};function Km(e){return Object.prototype.toString.call(e).split("[object ")[1].split("]")[0].toLowerCase()}var Jm=16;var $m={sleep:function(e){return new Promise((function(t){setTimeout((function(){t()}),e)}))},typeOf:Km},ev=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return new Promise((function(o,a){e||a("animation method missing param source"),t||a("animation method missing param target");var s=null;if(e.isVector3||e.isEuler){var u=e.x,c=e.y,l=e.z;s=JSON.parse(JSON.stringify({x:u,y:c,z:l}))}else s=JSON.parse(JSON.stringify(e));var h=n.duration,p=void 0===h?1e3:h,f=n.delay,d=void 0===f?0:f,m=n.repeat,v=void 0!==m&&m,g=new qm.a.Tween(e).to(t,p).easing(qm.a.Easing.Linear.None).delay(d).onUpdate((function(e){return r&&r(e)})).onComplete((function(){g.stop(),o({source:s,target:t})}));if(v)switch(Km(v)){case"boolean":g.repeat(1/0);break;case"number":g.repeat(v);break;default:a("animation method 'option.repeat' type error")}g.start(),i&&i(g)}))},tv=new Ym.Box3(new Ym.Vector3(0,0,0),new Ym.Vector3(0,0,0));function nv(e){return tv.setFromObject(e)}function rv(e){return tv.setFromObject(e)}var iv={getBoundingBox:rv,getBoundingBoxOfMesh:function(e){e.isMesh||console.error('In getBoundingBoxOfMesh: parameter "mesh" type error! ');var t=tv.clone();return e.geometry&&(e.geometry.boundingBox?t.union(e.geometry.boundingBox):t.union(e.geometry.computeBoundingBox())),t}};function ov(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function av(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var sv=null,uv=new Ym.Scene;uv.name="Scene";var cv=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),sv=t,this.mainScene=uv.clone(),this.selectedObjects={edge:[],opacity:[],emissive:[]},this.intersectsList={meshOfModelList:[],poiIconList:[],otherObjList:[],getAll:function(){return[].concat(ov(this.meshOfModelList),ov(this.poiIconList),ov(this.otherObjList))}}}var t,n,r;return t=e,(n=[{key:"importObject",value:function(){return console.warn('In ssp: The "importObject" method has been discarded. Please use "addObject"!'),this.addObject.apply(this,arguments)}},{key:"addObject",value:function(e,t){t?t.add(e):this.mainScene.add(e),this._triggerObjectAdded(e),sv.objectAdded.dispatch(e)}},{key:"removeObject",value:function(e){var t=this;e.traverse&&e.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&(e.material.map&&e.material.map.dispose(),e.material.dispose()),e.element&&e.element.remove();var n=t.intersectsList,r=n.meshOfModelList,i=n.poiIconList,o=n.otherObjList,a=r.findIndex((function(t){return t.uuid===e.uuid})),s=i.findIndex((function(t){return t.uuid===e.uuid})),u=o.findIndex((function(t){return t.uuid===e.uuid}));a>-1&&t.intersectsList.meshOfModelList.splice(a,1),s>-1&&t.intersectsList.poiIconList.splice(s,1),u>-1&&t.intersectsList.otherObjList.splice(u,1)}))}},{key:"closeFog",value:function(){this.mainScene.fog=null,sv.sceneChanged.dispatch()}},{key:"openFog",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.color,n=void 0===t?13426943:t,r=e.near,i=void 0===r?500:r,o=e.far,a=void 0===o?5e4:o;this.mainScene.fog=new Ym.Fog(n,i,a),sv.sceneChanged.dispatch()}},{key:"enable2DMode",value:function(e,t){var n=["Sbm","Model"];for(var r in e){var i=e[r],o=e[r].scene;if(i.type){if(n.includes(i.type)){var a=rv(o);!1===t?(o.position.setY(o.userData.oldPositionY),o.scale.setY(o.userData.oldScaleY),delete o.userData.oldPositionY,delete o.userData.oldScaleY):(o.userData.oldPositionY=o.position.y,o.userData.oldScaleY=o.scale.y,o.position.setY(a.min.y),o.scale.setY(.01))}else t?i.hideAll():i.showAll();sv.sceneChanged.dispatch()}}}},{key:"addSelectedObjectForEdge",value:function(e,t){var n=[];"array"===Km(e)?n=e:"object"===Km(e)&&n.push(e),this.selectedObjects.edge=[].concat(ov(this.selectedObjects.edge),ov(n)),sv.outlineChange.dispatch({objects:this.selectedObjects.edge,option:t})}},{key:"unSelectedObjectForEdge",value:function(){var e=this;return new Promise((function(t){e.selectedObjects.edge=[],sv.outlineChange.dispatch(),t()}))}},{key:"addSelectedObjectForOpacity",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=function(e){if(-1===t.selectedObjects.opacity.findIndex((function(t){return t.uuid===e.uuid}))){var r=n.color,i=void 0===r?16711680:r,o=n.opacity,a=void 0===o?.8:o;e.traverse((function(e){e.isMesh&&e.material&&(e.userData.material=e.material.clone(),e.material=new Ym.MeshBasicMaterial({transparent:!0,opacity:a,color:i}))})),sv.materialChanged.dispatch(),t.selectedObjects.opacity.push(e)}};"array"===Km(e)?e.map((function(e){return r(e)})):"object"===Km(e)&&r(e)}},{key:"unSelectedObjectForOpacity",value:function(e){var t=Km(e),n=this.selectedObjects.opacity;return"object"===t?n=[e]:"array"===t&&(n=e),this._unSelecte(n)}},{key:"addSelectedObjectForEmissive",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=function(e){if(-1===t.selectedObjects.emissive.findIndex((function(t){return t.uuid===e.uuid}))){var r=n.isAnimation,i=void 0===r||r,o=n.color,a=void 0===o?"red":o,s=n.repeat,u=void 0===s||s,c=n.duration,l=void 0===c?1e3:c,h=n.maxOpacity,p=void 0===h?1:h,f=n.minOpacity,d=void 0===f?0:f;e.traverse((function(e){e.isMesh&&e.material&&(e.userData.isEmissive=!0,e.material.emissive.set(a),i&&ev({emissiveIntensity:p},{emissiveIntensity:d},{repeat:u,duration:l},(function(t){return e.material.emissiveIntensity=t.emissiveIntensity}),(function(t){return e.userData.emissiveAnimation=t})))})),t.selectedObjects.emissive.push(e)}};"array"===Km(e)?e.map((function(e){return r(e)})):"object"===Km(e)&&r(e)}},{key:"unSelectedObjectForEmissive",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectedObjects.emissive,n=function(t){return new Promise((function(n){t.traverse((function(e){e.isMesh&&e.material&&e.userData.isEmissive&&(e.userData.isEmissive=!1,e.userData.emissiveAnimation.stop(),e.userData.emissiveAnimation=null,e.material.emissive.set(0),e.material.emissiveIntensity=1)})),sv.materialChanged.dispatch();var r=e.selectedObjects.emissive.findIndex((function(e){return e.uuid===t.uuid}));r>-1&&e.selectedObjects.emissive.splice(r,1),n()}))};if("array"===Km(t)){var r=[];return t.map((function(e){return r.push(n(e))})),Promise.all(r)}if("object"===Km(t))return n(t)}},{key:"_triggerObjectAdded",value:function(e){var t=this;switch(e.stype){case"Sbm":case"Model":sv.modelAdded.dispatch(e);break;case"Poi":sv.poiAdded.dispatch(e);break;case"Group":e.children.length>0&&e.children.map((function(e){return t._triggerObjectAdded(e)}));break;case"SceneManager":break;default:sv.otherAdded.dispatch(e)}}},{key:"_unSelecte",value:function(e){var t=this,n=ov(e);return new Promise((function(r){n.length>0?n.map((function(n,i){n.traverse((function(t){t.isMesh&&t.userData.material&&(t.material=t.userData.material,delete t.userData.material),i===e.length-1&&(sv.materialChanged.dispatch(),r())}));var o=t.selectedObjects.opacity.findIndex((function(e){return e.uuid===n.uuid}));o>-1&&t.selectedObjects.opacity.splice(o,1)})):r()}))}}])&&av(t.prototype,n),r&&av(t,r),e}();function lv(e,t){var n=document.createElement("div");function r(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=document.createElement("span");return t&&(n.style.marginLeft="6px"),n.innerHTML=e,n}function i(){return document.createElement("br")}n.style.position="absolute",n.style.left="12px",n.style.bottom="12px",n.style.fontSize="12px",n.style.color="#fff";var o=r("0"),a=r("0"),s=r("0"),u=r("0"),c=r("0");function l(){for(var t=0,n=0,r=0,i=0,u=e.children.length;i<u;i++){e.children[i].traverseVisible((function(e){if("SceneManager"!==e.stype&&t++,e.isMesh){var i=e.geometry;i.isGeometry?(n+=i.vertices.length,r+=i.faces.length):i.isBufferGeometry&&(n+=i.attributes.position.count,null!==i.index?r+=i.index.count/3:r+=i.attributes.position.count/3)}}))}o.innerHTML=t,s.innerHTML=n,a.innerHTML=r}return n.appendChild(r("objects",!1)),n.appendChild(o),n.appendChild(i()),n.appendChild(r("triangles",!1)),n.appendChild(a),n.appendChild(i()),n.appendChild(r("vertices",!1)),n.appendChild(s),n.appendChild(i()),n.appendChild(r("frametime",!1)),n.appendChild(u),n.appendChild(i()),n.appendChild(r("lodFrametime",!1)),n.appendChild(c),t.objectAdded.add(l),t.objectRemoved.add(l),t.geometryChanged.add(l),t.sceneRendered.add((function(e){u.innerHTML=Number(e).toFixed(2)+" ms"})),t.lodRendered.add((function(e){c.innerHTML=Number(e).toFixed(2)+" ms"})),n}new Rn(1,2,1,.3),["varying vec3 vWorldPos;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","vWorldPos = (modelMatrix * vec4(position, 1.0)).xyz;","}"].join("\n"),["uniform vec3 color;","uniform float time;","uniform float seed;","uniform mat4 invModelMatrix;","uniform vec3 scale;","uniform vec4 noiseScale;","uniform float magnitude;","uniform float lacunarity;","uniform float gain;","uniform sampler2D fireTex;","varying vec3 vWorldPos;","vec3 mod289(vec3 x) {","return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec4 mod289(vec4 x) {","return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec4 permute(vec4 x) {","return mod289(((x * 34.0) + 1.0) * x);","}","vec4 taylorInvSqrt(vec4 r) {","return 1.79284291400159 - 0.85373472095314 * r;","}","float snoise(vec3 v) {","const vec2 C = vec2(1.0 / 6.0, 1.0 / 3.0);","const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);","vec3 i  = floor(v + dot(v, C.yyy));","vec3 x0 = v - i + dot(i, C.xxx);","vec3 g = step(x0.yzx, x0.xyz);","vec3 l = 1.0 - g;","vec3 i1 = min(g.xyz, l.zxy);","vec3 i2 = max(g.xyz, l.zxy);","vec3 x1 = x0 - i1 + C.xxx;","vec3 x2 = x0 - i2 + C.yyy;","vec3 x3 = x0 - D.yyy;","i = mod289(i); ","vec4 p = permute(permute(permute( ","i.z + vec4(0.0, i1.z, i2.z, 1.0))","+ i.y + vec4(0.0, i1.y, i2.y, 1.0)) ","+ i.x + vec4(0.0, i1.x, i2.x, 1.0));","float n_ = 0.142857142857;","vec3  ns = n_ * D.wyz - D.xzx;","vec4 j = p - 49.0 * floor(p * ns.z * ns.z);","vec4 x_ = floor(j * ns.z);","vec4 y_ = floor(j - 7.0 * x_);","vec4 x = x_ * ns.x + ns.yyyy;","vec4 y = y_ * ns.x + ns.yyyy;","vec4 h = 1.0 - abs(x) - abs(y);","vec4 b0 = vec4(x.xy, y.xy);","vec4 b1 = vec4(x.zw, y.zw);","vec4 s0 = floor(b0) * 2.0 + 1.0;","vec4 s1 = floor(b1) * 2.0 + 1.0;","vec4 sh = -step(h, vec4(0.0));","vec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy;","vec4 a1 = b1.xzyw + s1.xzyw * sh.zzww;","vec3 p0 = vec3(a0.xy, h.x);","vec3 p1 = vec3(a0.zw, h.y);","vec3 p2 = vec3(a1.xy, h.z);","vec3 p3 = vec3(a1.zw, h.w);","vec4 norm = taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));","p0 *= norm.x;","p1 *= norm.y;","p2 *= norm.z;","p3 *= norm.w;","vec4 m = max(0.6 - vec4(dot(x0, x0), dot(x1, x1), dot(x2, x2), dot(x3, x3)), 0.0);","m = m * m;","return 42.0 * dot(m * m, vec4(dot(p0, x0), dot(p1, x1), dot(p2, x2), dot(p3, x3)));","}","float turbulence(vec3 p) {","float sum = 0.0;","float freq = 1.0;","float amp = 1.0;","for(int i = 0; i < OCTIVES; i++) {","sum += abs(snoise(p * freq)) * amp;","freq *= lacunarity;","amp *= gain;","}","return sum;","}","vec4 samplerFire (vec3 p, vec4 scale) {","vec2 st = vec2(sqrt(dot(p.xz, p.xz)), p.y);","if(st.x <= 0.0 || st.x >= 1.0 || st.y <= 0.0 || st.y >= 1.0) return vec4(0.0);","p.y -= (seed + time) * scale.w;","p *= scale.xyz;","st.y += sqrt(st.y) * magnitude * turbulence(p);","if(st.y <= 0.0 || st.y >= 1.0) return vec4(0.0);","return texture2D(fireTex, st);","}","vec3 localize(vec3 p) {","return (invModelMatrix * vec4(p, 1.0)).xyz;","}","void main() {","vec3 rayPos = vWorldPos;","vec3 rayDir = normalize(rayPos - cameraPosition);","float rayLen = 0.0288 * length(scale.xyz);","vec4 col = vec4(0.0);","for(int i = 0; i < ITERATIONS; i++) {","rayPos += rayDir * rayLen;","vec3 lp = localize(rayPos);","lp.y += 0.5;","lp.xz *= 2.0;","col += samplerFire(lp, noiseScale);","}","col.a = col.r;","gl_FragColor = col;","}"].join("\n");var hv={uniforms:{tDiffuse:{type:"t",value:null},time:{type:"f",value:-1}},vertexShader:"\n  varying vec2 vUv;\n  varying vec3 iPosition;\n  void main(){\n  vUv = uv;\n  iPosition = position;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"\n      uniform float time;\n      uniform sampler2D tDiffuse;\n      varying vec2 vUv;\n      varying vec3 iPosition;\n      void main(){\n      vec4 texel = texture2D(tDiffuse, vUv);\n      float x = iPosition.x;\n      float lighty = -x*2.0 + time;\n      float alpha = abs(iPosition.y - lighty);\n      if(alpha < 0.1){\n          float a = 1.0 -  alpha / 0.1;\n          float enda = smoothstep(0.0,1.0,a) + 0.3;\n          gl_FragColor = texel * enda+vec4(1.0,0,0,0);\n      }else{\n          gl_FragColor = texel * 0.3;\n      }\n      }       \n      "},pv={vertexShader:'\n\n    // GLSL textureless classic 3D noise "cnoise",\n    // with an RSL-style periodic variant "pnoise".\n    // Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n    // Version: 2011-10-11\n    //\n    // Many thanks to Ian McEwan of Ashima Arts for the\n    // ideas for permutation and gradient selection.\n    //\n    // Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n    // Distributed under the MIT license. See LICENSE file.\n    // https://github.com/ashima/webgl-noise\n    //\n    \n    vec3 mod289(vec3 x)\n    {\n      return x - floor(x * (1.0 / 289.0)) * 289.0;\n    }\n    \n    vec4 mod289(vec4 x)\n    {\n      return x - floor(x * (1.0 / 289.0)) * 289.0;\n    }\n    \n    vec4 permute(vec4 x)\n    {\n      return mod289(((x*34.0)+1.0)*x);\n    }\n    \n    vec4 taylorInvSqrt(vec4 r)\n    {\n      return 1.79284291400159 - 0.85373472095314 * r;\n    }\n    \n    vec3 fade(vec3 t) {\n      return t*t*t*(t*(t*6.0-15.0)+10.0);\n    }\n    \n    // Classic Perlin noise\n    float cnoise(vec3 P)\n    {\n      vec3 Pi0 = floor(P); // Integer part for indexing\n      vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n      Pi0 = mod289(Pi0);\n      Pi1 = mod289(Pi1);\n      vec3 Pf0 = fract(P); // Fractional part for interpolation\n      vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n      vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n      vec4 iy = vec4(Pi0.yy, Pi1.yy);\n      vec4 iz0 = Pi0.zzzz;\n      vec4 iz1 = Pi1.zzzz;\n    \n      vec4 ixy = permute(permute(ix) + iy);\n      vec4 ixy0 = permute(ixy + iz0);\n      vec4 ixy1 = permute(ixy + iz1);\n    \n      vec4 gx0 = ixy0 * (1.0 / 7.0);\n      vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n      gx0 = fract(gx0);\n      vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n      vec4 sz0 = step(gz0, vec4(0.0));\n      gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n      gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n    \n      vec4 gx1 = ixy1 * (1.0 / 7.0);\n      vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n      gx1 = fract(gx1);\n      vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n      vec4 sz1 = step(gz1, vec4(0.0));\n      gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n      gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n    \n      vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n      vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n      vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n      vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n      vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n      vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n      vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n      vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n    \n      vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n      g000 *= norm0.x;\n      g010 *= norm0.y;\n      g100 *= norm0.z;\n      g110 *= norm0.w;\n      vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n      g001 *= norm1.x;\n      g011 *= norm1.y;\n      g101 *= norm1.z;\n      g111 *= norm1.w;\n    \n      float n000 = dot(g000, Pf0);\n      float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n      float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n      float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n      float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n      float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n      float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n      float n111 = dot(g111, Pf1);\n    \n      vec3 fade_xyz = fade(Pf0);\n      vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n      vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n      float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n      return 2.2 * n_xyz;\n    }\n    \n    // Classic Perlin noise, periodic variant\n    float pnoise(vec3 P, vec3 rep)\n    {\n      vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period\n      vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period\n      Pi0 = mod289(Pi0);\n      Pi1 = mod289(Pi1);\n      vec3 Pf0 = fract(P); // Fractional part for interpolation\n      vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n      vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n      vec4 iy = vec4(Pi0.yy, Pi1.yy);\n      vec4 iz0 = Pi0.zzzz;\n      vec4 iz1 = Pi1.zzzz;\n    \n      vec4 ixy = permute(permute(ix) + iy);\n      vec4 ixy0 = permute(ixy + iz0);\n      vec4 ixy1 = permute(ixy + iz1);\n    \n      vec4 gx0 = ixy0 * (1.0 / 7.0);\n      vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n      gx0 = fract(gx0);\n      vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n      vec4 sz0 = step(gz0, vec4(0.0));\n      gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n      gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n    \n      vec4 gx1 = ixy1 * (1.0 / 7.0);\n      vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n      gx1 = fract(gx1);\n      vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n      vec4 sz1 = step(gz1, vec4(0.0));\n      gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n      gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n    \n      vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n      vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n      vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n      vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n      vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n      vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n      vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n      vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n    \n      vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n      g000 *= norm0.x;\n      g010 *= norm0.y;\n      g100 *= norm0.z;\n      g110 *= norm0.w;\n      vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n      g001 *= norm1.x;\n      g011 *= norm1.y;\n      g101 *= norm1.z;\n      g111 *= norm1.w;\n    \n      float n000 = dot(g000, Pf0);\n      float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n      float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n      float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n      float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n      float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n      float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n      float n111 = dot(g111, Pf1);\n    \n      vec3 fade_xyz = fade(Pf0);\n      vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n      vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n      float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n      return 2.2 * n_xyz;\n    }\n    \n    // Include the Ashima code here!\n    \n    varying vec2 vUv;\n    varying float noise;\n    uniform float time;\n    \n    float turbulence( vec3 p ) {\n      // float w = 100.0;\n      float t = -.5;\n      for (float f = 1.0 ; f <= 10.0 ; f++ ){  // 凸起的数量\n        float power = pow( 2.0, f );\n        t += abs( pnoise( vec3( power * p ), vec3( 10.0, 10.0, 10.0 ) ) / power );\n      }\n      return t;\n    }\n    \n    void main() {\n    \n      vUv = uv;\n    \n      noise = 10.0 *  -.10 * turbulence( .5 * normal + time );\n      float b = 5.0 * pnoise( 0.05 * position + vec3( 2.0 * time ), vec3( 100.0 ) );\n      float displacement = - 10. * noise + b;\n    \n      // float displacement = - 10. * noise + time; // 波浪起伏度\n    \n      vec3 newPosition = position + normal * displacement;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );\n    \n    }\n    \n    \n        ',fragmentShader:"\n    varying vec2 vUv;\n    varying float noise;\n    uniform sampler2D tExplosion;\n    // uniform float time;\n    \n    float random( vec3 scale, float seed ){\n      return fract( sin( dot( gl_FragCoord.xyz + seed, scale ) ) * 43758.5453 + seed ) ;\n    }\n    \n    void main() {\n    \n      float r = .01 * random( vec3( 12.9898, 78.233, 151.7182 ), 0.0 );\n      vec2 tPos = vec2( 0, 1.3 * noise + r );\n      vec4 color = texture2D( tExplosion, tPos );\n      gl_FragColor = vec4( color.rgb, 1.0 );\n    \n    }\n    \n    \n        "};function fv(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var dv=n(382),mv=null,vv=null,gv=null,yv=null,bv=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),mv=t,vv=n,gv=r,this._internalOption={enableEffectComposer:!1,enableRenderCss2D:!1,enableRenderCss3D:!1},this.container=this._initContainer(),this.renderer=this._initRenderer()}var t,n,r;return t=e,(n=[{key:"initRenderCSS2D",value:function(){var e=new Ym.CSS2DRenderer;e.domElement.id="soonspacejs_view_2DPoi",e.domElement.style.position="absolute",e.domElement.style.top=0,e.domElement.style.width="100%",e.domElement.style.height="100%",e.domElement.style.zIndex=-1,this.container.appendChild(e.domElement);var t=setInterval((function(){var n=document.getElementById("soonspacejs_view_3DPoi");n&&(clearInterval(t),n.appendChild(e.domElement))}),500);return e.setSize(this.container.innerWidth,this.container.innerHeight),e}},{key:"initRenderCSS3D",value:function(e){var t=new Ym.CSS3DRenderer(this.container,e);return t.domElement.id="soonspacejs_view_3DPoi",t.domElement.style.position="absolute",t.domElement.style.top=0,t.domElement.style.width="100%",t.domElement.style.height="100%",this.container.appendChild(t.domElement),t.setSize(this.container.offsetWidth,this.container.offsetHeight),t}},{key:"initEffectComposer",value:function(e){return(yv=new Ym.EffectComposer(this.renderer)).addPass(new Ym.RenderPass(mv,e)),yv}},{key:"initAllPass",value:function(e){var t={ssaaPass:this._initSsaaPass(e),outlinePass:this._initOutlinePass(e)};for(var n in t)this.addPass(t[n]);return t}},{key:"xAxisClipping",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.renderer.clippingPlanes.push(new Ym.Plane(new Ym.Vector3(-1,0,0),e)),vv.sceneChanged.dispatch()}},{key:"changexAxisClipping",value:function(e){if(!e)return console.error("changexAxisClipping method missing param 'position'");this.renderer.clippingPlanes.find((function(e){return-1===e.normal.x})).constant=e,vv.sceneChanged.dispatch()}},{key:"yAxisClipping",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.renderer.clippingPlanes.push(new Ym.Plane(new Ym.Vector3(0,-1,0),e)),vv.sceneChanged.dispatch()}},{key:"changeyAxisClipping",value:function(e){if(!e)return console.error("changeyAxisClipping method missing param 'position'");this.renderer.clippingPlanes.find((function(e){return-1===e.normal.y})).constant=e,vv.sceneChanged.dispatch()}},{key:"zAxisClipping",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.renderer.clippingPlanes.push(new Ym.Plane(new Ym.Vector3(0,0,-1),e)),vv.sceneChanged.dispatch()}},{key:"changezAxisClipping",value:function(e){if(!e)return console.error("changezAxisClipping method missing param 'position'");this.renderer.clippingPlanes.find((function(e){return-1===e.normal.z})).constant=e,vv.sceneChanged.dispatch()}},{key:"removeClipping",value:function(e){if(["x","y","z"].includes(e)){var t=this.renderer.clippingPlanes.findIndex((function(t){return-1===t.normal[e]}));this.renderer.clippingPlanes.splice(t,1)}}},{key:"addPass",value:function(e){yv.addPass(e)}},{key:"setEffectComposerEnable",value:function(e){this._internalOption.enableEffectComposer=e}},{key:"setRenderCss2DEnable",value:function(e){this._internalOption.enableRenderCss2D=e}},{key:"setRenderCss3DEnable",value:function(e){this._internalOption.enableRenderCss3D=e}},{key:"getWidth",value:function(){return this.renderer.domElement.width}},{key:"getHeight",value:function(){return this.renderer.domElement.height}},{key:"getMouseRelativeConRatio",value:function(e){var t=this.container.getBoundingClientRect();return[(e.clientX-t.left)/t.width,(e.clientY-t.top)/t.height]}},{key:"getMousePoint",value:function(e){var t=new Ym.Vector2(0,0);return t.fromArray(this.getMouseRelativeConRatio(e)),t}},{key:"_initContainer",value:function(){var e=document.createElement("div");if(e.style.position="relative",e.style.width="100%",e.style.height="100%",gv.showInfo){var t=new lv(mv,vv);t.style.zIndex=1,e.appendChild(t)}return e}},{key:"_initRenderer",value:function(){var e=!1===dv.support.webgl?"CanvasRenderer":"WebGLRenderer",t=new Ym[e]({antialias:!0,alpha:gv.backgroundAlpha,logarithmicDepthBuffer:!0,preserveDrawingBuffer:!0}),n=gv.backgroundColor||11184810,r=gv.backgroundAlpha?0:1;t.setClearColor(n,r),t.setPixelRatio(window.devicePixelRatio),t.autoClear=!1,t.autoUpdateScene=!1,t.outputEncoding=Ym.GammaEncoding,t.shadowMap.type=Ym.PCFSoftShadowMap,t.shadowMap.enabled=!0;var i=this.container,o=i.offsetWidth,a=i.offsetHeight;return t.domElement.style.width=o,t.domElement.style.height=a,this.container.appendChild(t.domElement),t}},{key:"_initFxaaPass",value:function(){var e=new Ym.ShaderPass(Ym.FXAAShader),t=this.renderer.getPixelRatio();return e.material.uniforms.resolution.value.x=1/(this.container.offsetWidth*t),e.material.uniforms.resolution.value.y=1/(this.container.offsetHeight*t),e}},{key:"_initSsaaPass",value:function(e){var t=new Ym.SSAARenderPass(mv,e);return t.unbiased=!0,t.sampleLevel=1,t}},{key:"_initOutlinePass",value:function(e){return new Ym.OutlinePass(new Ym.Vector2(window.innerWidth,window.innerHeight),mv,e)}},{key:"_initSweepingLightShaderPass",value:function(){return new Ym.ShaderPass(hv)}},{key:"_initUnrealBloomPass",value:function(){return new Ym.UnrealBloomPass(new Ym.Vector2(this.getWidth(),this.getHeight()),0,.4,.85)}},{key:"_initSAOPass",value:function(e){var t=new Ym.SAOPass(mv,e,!1,!0);return t.params.saoScale=368900,t}}])&&fv(t.prototype,n),r&&fv(t,r),e}(),xv=xv||{};xv.KeyboardState=function(){this.keyCodes={},this.modifiers={};var e=this;this._onKeyDown=function(t){e._onKeyChange(t,!0)},this._onKeyUp=function(t){e._onKeyChange(t,!1)},document.addEventListener("keydown",this._onKeyDown,!1),document.addEventListener("keyup",this._onKeyUp,!1)},xv.KeyboardState.prototype.destroy=function(){document.removeEventListener("keydown",this._onKeyDown,!1),document.removeEventListener("keyup",this._onKeyUp,!1)},xv.KeyboardState.MODIFIERS=["shift","ctrl","alt","meta"],xv.KeyboardState.ALIAS={left:37,up:38,right:39,down:40,space:32,pageup:33,pagedown:34,enter:13,escape:27,lbracket:219,rbracket:221,tab:9},xv.KeyboardState.prototype._onKeyChange=function(e,t){var n=e.keyCode;this.keyCodes[n]=t,this.modifiers.shift=e.shiftKey,this.modifiers.ctrl=e.ctrlKey,this.modifiers.alt=e.altKey,this.modifiers.meta=e.metaKey},xv.KeyboardState.prototype.pressed=function(e){for(var t=e.split("+"),n=0;n<t.length;n++){var r=t[n];if(!(-1!==xv.KeyboardState.MODIFIERS.indexOf(r)?this.modifiers[r]:-1!=Object.keys(xv.KeyboardState.ALIAS).indexOf(r)?this.keyCodes[xv.KeyboardState.ALIAS[r]]:this.keyCodes[r.toUpperCase().charCodeAt(0)]))return!1}return!0};var wv=xv;function _v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Tv=new Ym.Clock,Sv=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewport=t,this.camera=n,this.keyboard=new wv.KeyboardState,this.enable=!1,this.enableClash=!0,this.enableGravity=!0,this.startPosition=null,this.person=null,this.eyeHeight=160,this.kneeheight=50,this._nextState={enableGravity:!0,cameraPositionY:null,jumpState:null,squatState:!1,bendState:null},this._defaults=Object.freeze({moveSpace:300,rotationSpace:Math.PI/2,jumpHeight:50}),this.activeParame={moveSpace:300,rotationSpace:Math.PI/2,jumpHeight:50},this.moveSpeed=1,this.rotationSpeed=1,this.jumpSpeed=1,this._event={onClashUpdate:null},this._oldCameraData=null,this._oldCameraNear=n.near}var t,n,r;return t=e,(n=[{key:"update",value:function(){if(this.enable){var e=Tv.getDelta(),t={yAngle:0,zDist:0};(this.keyboard.pressed("W")||this.keyboard.pressed("w")||this.keyboard.pressed("up"))&&(this.enableClash&&this.checkClash()||(t.zDist+=this.activeParame.moveSpace*e)),(this.keyboard.pressed("S")||this.keyboard.pressed("s")||this.keyboard.pressed("down"))&&(t.zDist-=this.activeParame.moveSpace*e),(this.keyboard.pressed("A")||this.keyboard.pressed("a")||this.keyboard.pressed("left"))&&(t.yAngle+=this.activeParame.rotationSpace*e),(this.keyboard.pressed("D")||this.keyboard.pressed("d")||this.keyboard.pressed("right"))&&(t.yAngle-=this.activeParame.rotationSpace*e),null===this._nextState.jumpState&&this.keyboard.pressed(" ")&&(this._nextState.jumpState="prev"),this.enableGravity&&this._nextState.enableGravity&&this.checkGravity();var n=this.camera.getWorldDirection(new Ym.Vector3).normalize().multiplyScalar(t.zDist),r=this.camera.position.clone().add(n);if(this._nextState.cameraPositionY){var i=this._nextState.cameraPositionY+this.eyeHeight,o=i+this.activeParame.jumpHeights;"prev"===this._nextState.jumpState?(r.y+=this.activeParame.jumpHeight*e*3,r.y>=o&&(r.y=o,this._nextState.jumpState="next")):"next"===this._nextState.jumpState?(r.y-=this.activeParame.jumpHeight*e*3,r.y<=i&&(r.y=i,this._nextState.jumpState=null)):null===this._nextState.jumpState&&(this._nextState.squatState?r.y=this._nextState.cameraPositionY+.55*this.eyeHeight:r.y=this._nextState.cameraPositionY+this.eyeHeight)}else r.y-=this.activeParame.jumpHeight;0!==r.distanceTo(this.camera.position)&&ev(this.camera.position,{x:r.x,y:r.y,z:r.z},{duration:e}),0!==t.yAngle&&ev(this.camera.rotation,{x:0,y:this.camera.rotation.y+t.yAngle,z:0},{duration:e})}}},{key:"checkGravity",value:function(){var e=this.viewport.rayClash(this.camera.position);e.length>0?e[0].distance>=this.eyeHeight-this.kneeheight?this._nextState.cameraPositionY=e[0].point.y:this._nextState.cameraPositionY=this.camera.position.y:this._nextState.cameraPositionY=null}},{key:"checkClash",value:function(){var e=null;(e=this.camera.getWorldDirection(new Ym.Vector3)).normalize();var t=this.camera.position.clone();t.y-=this.eyeHeight-this.kneeheight;var n=this.viewport.rayClash(t,e),r=this._event.onClashUpdate;return r&&r(n),n.length>0&&n[0].distance<=10}},{key:"open",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.startPosition,r=t.enableClash,i=void 0===r||r,o=t.enableGravity,a=void 0===o||o,s=t.moveSpeed,u=void 0===s?1:s,c=t.rotationSpeed,l=void 0===c?1:c,h=t.jumpSpeed,p=void 0===h?1:h,f=t.onClashUpdate,d=void 0===f?null:f;this.enableClash=i,this.enableGravity=a,this.moveSpeed=u,this.rotationSpeed=l,this.jumpSpeed=p,this.activeParame={moveSpace:this._defaults.moveSpace*u,rotationSpace:this._defaults.rotationSpace*l,jumpHeight:this._defaults.jumpHeight*p},this._event.onClashUpdate=d,this._oldCameraData=this.viewport.cameraControlerManager.getCameraViewpoint(),this.enable=!0,this.viewport.cameraControlerManager.setEnableControls(!1),n&&this.viewport.nextRender((function(){e.camera.position.set(n.x,n.y+e.eyeHeight,n.z)})),this.camera.updateProjectionMatrix(),this.startPosition=this.camera.position.clone()}},{key:"close",value:function(){this.camera.near=this._oldCameraNear,this.camera.updateProjectionMatrix(),this.enable=!1,this.viewport.cameraControlerManager.setCameraViewpoint(this._oldCameraData),this.viewport.cameraControlerManager.setEnableControls(!0)}},{key:"setEnable",value:function(e){e?this.open():this.close()}},{key:"setEnableClash",value:function(e){this.enableClash=e}},{key:"setEnableGravity",value:function(e){this.enableGravity=e}}])&&_v(t.prototype,n),r&&_v(t,r),e}();function Mv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ev(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Av(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Pv=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewport=t,this.manager=null,this.camera=n,this.cameraProp={position:null,rotation:null},this.navigatedPosition=[],this.navigatedPath=null,this.thirdPersonLastCamera=null,this.option={mode:"firstPerson",path:null,naviSpeed:1,changeDist:100,refresh:!0},this._animationId=null,this._currentLength=0,this._eyeHeight=190,this._startPosition=null}var t,n,r;return t=e,(n=[{key:"followPointPath",value:function(e,t){return this.manager=t,Object.assign(this.option,e),this.option.path?(this._startPosition=this.option.path.geometry.parameters.path.points[0],this.option.refresh?this.navigatedPosition=[this.option.path.geometry.parameters.path.points[0]]:this.navigatedPosition.push(this.option.path.geometry.parameters.path.points[0]),this._currentLength=0,this.cameraProp.position=this.viewport.camera.position.clone(),this.cameraProp.rotation=this.viewport.camera.rotation.clone(),this.following(),this):console.error('In autoPatrol: missing param "option.path"')}},{key:"getEyeState",value:function(e,t){var n=this.option,r=n.path,i=n.naviSpeed,o=r.geometry;i||(i=1);var a=9e6/i,s=e||this._currentLength,u=s%a/a,c=(s+8e3)%a/a,l=new this.viewport.THREE.Vector3,h=new this.viewport.THREE.Vector3,p=new this.viewport.THREE.Object3D,f=o.parameters.path.getPointAt(u),d=o.parameters.path.getTangentAt(u),m=o.tangents.length,v=u*m,g=Math.floor(v),y=(g+2)%m;l.subVectors(o.binormals[y],o.binormals[g]),l.multiplyScalar(v-g).add(o.binormals[g]),h.copy(l).cross(d);var b=f.clone().add(h.clone().multiplyScalar(.01));t||(b.y+=this._eyeHeight),p.position.copy(b);var x=o.parameters.path.getPointAt((u+1/o.parameters.path.getLength())%1);return x.copy(b).add(d),{position:b,lookAt:x,gvr:Math.abs(u-c)}}},{key:"following",value:function(){var e=this,t=this.camera.position.y-this._startPosition.y,n=this.option,r=n.changeDist,i=n.person;t<=r&&(this.option.mode="firstPerson",this.option.onModeChange&&this.option.onModeChange("firstPerson"),this.thirdPersonLastCamera=this.viewport.cameraControlerManager.getCameraViewpoint(),this.thirdPersonLastCamera.position.y=this._startPosition.y+r+1);var o=this.option,a=o.mode,s=o.lookAtY,u=o.onEnd,c=o.onUpdate,l=o.navigatedOption;this._currentLength+=8e3;var h=this.getEyeState(this._currentLength).position,p=h.clone().setY(h.y-this._eyeHeight);i&&i.position.copy(p),l&&(this.navigatedPosition.push(p.clone()),this.navigatedPosition.length>=2&&(this.navigatedPath&&this.manager.topologyManager.removeById("navigatedPath"),this.navigatedPath=this.manager.topologyManager.load(this.navigatedPosition,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mv(Object(n),!0).forEach((function(t){Ev(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mv(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({radius:15},l)),this.navigatedPath.sid="navigatedPath")),"firstPerson"===a&&(this.camera.position.copy(h),this.viewport.controls.enabled=!1);var f=this.getEyeState(this._currentLength+226e3,!0);if(f.gvr>.9)return cancelAnimationFrame(this._animationId),u&&u(),void this.viewport.signals.cameraChange.dispatch();f.position.y+=s,"firstPerson"===a&&(this.camera.matrix.lookAt(h,f.position,new this.viewport.THREE.Vector3(0,1,0)),this.camera.quaternion.setFromRotationMatrix(this.camera.matrix)),this._animationId=requestAnimationFrame((function(){e.viewport.signals.cameraChange.dispatch(),c&&c(p),e.following()}))}},{key:"modeChange",value:function(e){this.option.mode=e;var t=this.option.onModeChange;"firstPerson"===e?(this.option.mode="firstPerson",t&&t("firstPerson"),this.thirdPersonLastCamera=this.viewport.cameraControlerManager.getCameraViewpoint(),this.viewport.controls.enabled=!1):(this.option.mode="thirdPerson",t&&t("thirdPerson"),this.viewport.cameraControlerManager.setCameraViewpoint(this.thirdPersonLastCamera),this.viewport.controls.enabled=!0)}},{key:"pause",value:function(){cancelAnimationFrame(this._animationId)}},{key:"stop",value:function(){cancelAnimationFrame(this._animationId),this.option={path:null,naviSpeed:1},this._animationId=null,this._currentLength=0,this._eyeHeight=190,this.viewport.camera.position.copy(this.cameraProp.position),this.viewport.camera.rotation.copy(this.cameraProp.rotation),this.viewport.signals.cameraChange.dispatch(),this.cameraProp={position:null,rotation:null},this.navigatedPosition=[],this.navigatedPath=null,this.thirdPersonLastCamera=null,this.viewport.controls.enabled=!0}}])&&Av(t.prototype,n),r&&Av(t,r),e}(),Ov=new Ym.Matrix4,Lv=function(e,t){var n=Ov.clone(),r=Ov.clone(),i=Ov.clone();n.makeRotationY(e),r.makeRotationX(t);var o=new Ym.Euler;return i.multiplyMatrices(n,r),o.setFromRotationMatrix(i),o},Iv=Lv(-Math.PI/2,-Math.PI/4),Cv=Lv(Math.PI/2,-Math.PI/4),Rv=Lv(-Math.PI/4,-Math.PI/4),Dv=Lv(Math.PI/4,-Math.PI/4),Nv=Lv(1.25*Math.PI,-Math.PI/4),Fv=Lv(.75*Math.PI,-Math.PI/4),jv={LEFT:{x:0,y:-Math.PI/2,z:0},RIGHT:{x:0,y:Math.PI/2,z:0},FRONT:{x:0,y:0,z:0},BACK:{x:0,y:Math.PI,z:0},TOP:{x:-Math.PI/2,y:0,z:0},BOTTOM:{x:Math.PI/2,y:0,z:0},FRONTTOP:{x:-Math.PI/4,y:0,z:0},BACKTOP:{x:Math.PI/4,y:Math.PI,z:0},LEFTTOP:{x:Iv.x,y:Iv.y,z:Iv.z},RIGHTTOP:{x:Cv.x,y:Cv.y,z:Cv.z},LEFTFRONTTOP:{x:Rv.x,y:Rv.y,z:Rv.z},RIGHTFRONTTOP:{x:Dv.x,y:Dv.y,z:Dv.z},LEFTBACKTOP:{x:Nv.x,y:Nv.y,z:Nv.z},RIGHTBACKTOP:{x:Fv.x,y:Fv.y,z:Fv.z}};function Uv(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Bv=!1,kv=new Ym.Vector3,zv=new Ym.Vector3,Gv=new Ym.Vector3(0,1,0),Vv=new Ym.Matrix3,Hv=new Ym.Vector2,Wv=new Ym.Vector2,Xv=[new Ym.Vector3,new Ym.Vector3,new Ym.Vector3],Yv=[new Ym.Vector3,new Ym.Vector3,new Ym.Vector3],qv=null,Qv=!0,Zv=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewport=t,this.camera=n,this.domElement=t.container,this.rotateTiltRange={max:Math.PI,min:.1},this.enabled=!0,this.enableRotate=!0,this.enablePanX=!0,this.enablePanY=!0,this.enableZoom=!0,this.center=new Ym.Vector3,this.centerzoom=!0,this.wheelscale=.3,this.mindistance=6,this.maxdistance=1/0,this.enableDamping=!1,this.dampingFactor=.7,this.onProgress=void 0,this.STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},this.state=this.STATE.NONE,this.init()}var t,n,r;return t=e,(n=[{key:"init",value:function(){function e(e){if(e.preventDefault(),!1!==this.enabled){Hv.set(e.clientX,e.clientY);var t=Hv.x-Wv.x,n=Hv.y-Wv.y;if(this.state===this.STATE.ROTATE){if(!this.enableRotate)return;this.rotate(new Ym.Vector3(.005*-t,.005*-n,0),!1)}else if(this.state===this.STATE.ZOOM){if(!this.enableZoom)return;this.zoom(new Ym.Vector3(0,0,n))}else this.state===this.STATE.PAN&&(this.enablePanX||(t=0),this.enablePanY||(n=0),this.onProgress&&this.onProgress(t,n),this.pan(new Ym.Vector3(-t,n,0)));Wv.set(e.clientX,e.clientY)}}function t(){event.preventDefault(),this.domElement.removeEventListener("mousemove",e.bind(this),!1),this.domElement.removeEventListener("mouseup",t.bind(this),!1),this.state=this.STATE.NONE}function n(e){if(e.preventDefault(),!1!==this.enabled){var t=0;e.wheelDelta?t=-e.wheelDelta*this.wheelscale:e.detail&&(t=10*e.detail*this.wheelscale),this.enableZoom&&(this.centerzoom?this.zoom_on_point(new Ym.Vector3(0,0,t)):this.zoom(new Ym.Vector3(0,0,t)))}}function r(e){if(e.preventDefault(),e.stopPropagation(),!1!==this.enabled){switch(e.touches.length){case 1:Xv[0].set(e.touches[0].pageX,e.touches[0].pageY,0),Xv[1].set(e.touches[0].pageX,e.touches[0].pageY,0);var t=Xv[0].clone().sub(function(e,t){var n=t[0];for(var r in t)n.distanceTo(e)>t[r].distanceTo(e)&&(n=t[r]);return n}(Xv[0],Yv));t.x=-t.x;var n=t.multiplyScalar(.9);this.enablePanX||(n.x=0),this.enablePanY||(n.y=0),this.pan(n);break;case 2:Xv[0].set(e.touches[0].pageX,e.touches[0].pageY,0),Xv[1].set(e.touches[1].pageX,e.touches[1].pageY,0);var r=Xv[0].distanceTo(Xv[1]);r>100&&this.enableZoom&&this.zoom(new Ym.Vector3(0,0,1.2*(qv-r))),qv=r,this.enableRotate&&this.rotate(function(e,t){var n=new Ym.Vector2(e[1].x-e[0].x,e[1].y-e[0].y),r=new Ym.Vector2(t[1].x-t[0].x,t[1].y-t[0].y),i=n.angle(),o=r.angle();n.normalize(),r.normalize();var a=t[0].y-e[0].y;return(t[0].y-e[0].y)*(t[1].y-e[1].y)>0?new Ym.Vector2(0,.005*a,0):new Ym.Vector2(i-o,0,0)}(Xv,Yv).multiplyScalar(.9),!1)}Yv[0].copy(Xv[0]),Yv[1].copy(Xv[1])}}function i(e){e.preventDefault(),this.domElement.removeEventListener("touchmove",r.bind(this),!1),this.domElement.removeEventListener("touchend",i.bind(this),!1),this.state=this.STATE.NONE}this.domElement.addEventListener("contextmenu",(function(e){return e.preventDefault()}),!1),"ontouchstart"in window?this.domElement.addEventListener("touchstart",function(e){if(e.preventDefault(),!1!==this.enabled){switch(e.touches.length){case 1:Xv[0].set(e.touches[0].pageX,e.touches[0].pageY,0),Xv[1].set(e.touches[0].pageX,e.touches[0].pageY,0);break;case 2:Xv[0].set(e.touches[0].pageX,e.touches[0].pageY,0),Xv[1].set(e.touches[1].pageX,e.touches[1].pageY,0),qv=Xv[0].distanceTo(Xv[1]);break;case 3:Xv[0].set(e.touches[0].pageX,e.touches[0].pageY,0),Xv[1].set(e.touches[1].pageX,e.touches[1].pageY,0)}if(Yv[0].copy(Xv[0]),Yv[1].copy(Xv[1]),1===e.touches.length||2===e.touches.length||3===e.touches.length){var t=this.getIntersectPoint(e.changedTouches[0]);Bv=!0,kv.copy(t)}this.domElement.addEventListener("touchmove",r.bind(this),!1),this.domElement.addEventListener("touchend",i.bind(this),!1)}}.bind(this),!1):(this.domElement.addEventListener("mousedown",function(n){if(n.preventDefault(),!1!==this.enabled){if(0===n.button?this.state=this.STATE.ROTATE:1===n.button?this.state=this.STATE.ZOOM:2===n.button&&(this.state=this.STATE.PAN),Wv.set(n.clientX,n.clientFY),this.state===this.STATE.ROTATE||this.state===this.STATE.PAN){var r=this.getIntersectPoint(n);Bv=!0,kv.copy(r)}this.domElement.addEventListener("mousemove",e.bind(this),!1),this.domElement.addEventListener("mouseup",t.bind(this),!1)}}.bind(this),!1),this.domElement.addEventListener("wheel",n.bind(this),!1),this.domElement.addEventListener("DOMMouseScroll",n.bind(this),!1))}},{key:"getIntersectPoint",value:function(e){var t=new Ym.Vector3,n=this.viewport.getIntersects(e,this.viewport.scener.intersectsList.getAll());return n.length>0?t.copy(n[0].point):t}},{key:"panLeft",value:function(e){var t=new Ym.Vector3,n=this.camera.matrix.elements;t.set(n[0],n[1],n[2]),t.multiplyScalar(e),this.camera.position.add(t),this.viewport.signals.cameraChange.dispatch()}},{key:"panUp",value:function(e){var t=new Ym.Vector3,n=this.camera.matrix.elements;t.set(n[4],n[5],n[6]),t.multiplyScalar(e),this.camera.position.add(t),this.viewport.signals.cameraChange.dispatch()}},{key:"pan",value:function(e){if(void 0!==this.camera.fov){var t=this.camera.position.clone().sub(kv).length();t*=Math.tan(this.camera.fov/2*Math.PI/180),this.panLeft(2*e.x*t/this.domElement.offsetHeight),this.panUp(2*e.y*t/this.domElement.offsetHeight)}else void 0!==this.camera.top&&(this.panLeft(e.x*(this.camera.right-this.camera.left)/this.domElement.offsetWidth),this.panUp(e.y*(this.camera.top-this.camera.bottom)/this.domElement.offsetHeight))}},{key:"zoom_on_point",value:function(e){var t,n=e.z,r=this.domElement.getBoundingClientRect(),i=new Ym.Vector3((event.clientX-r.left)/r.width*2-1,-(event.clientY-r.top)/r.height*2+1,.1);i.clone().distanceTo(Gv)<=.05&&!Qv?t=kv.clone():(kv=this.getIntersectPoint(event),Bv=!0,Qv=!1,t=kv.clone()),Gv=i.clone(),i.unproject(this.camera),i.sub(this.camera.position);var o=this.center.distanceTo(this.camera.position);t&&(o=t.distanceTo(this.camera.position)),o>this.maxdistance&&n>0?(o=this.maxdistance,n=0):o<this.mindistance&&(o=20);var a=.3*o*(0===n?0:n<0?1:-1)*this.wheelscale,s=this.camera.position.clone();this.camera.position.addVectors(this.camera.position,i.setLength(a)),kv.clone().sub(s).angleTo(kv.clone().sub(this.camera.position))>.05&&(Qv=!0),this.viewport.signals.cameraChange.dispatch()}},{key:"zoom",value:function(e){var t=this.camera.position.distanceTo(this.center);if(t<5e3&&(t=5e3),e.multiplyScalar(.001*t),!(e.length()>t)){if(e.applyMatrix3(Vv.getNormalMatrix(this.camera.matrix)),this.rotateTiltRange.min>=Math.PI/2){var n=this.bbox.getCenter(new Ym.Vector3),r=[];(new Ym.Vector3).copy(n).x=this.bbox.min.x,(new Ym.Vector3).copy(n).x=this.bbox.max.x,(new Ym.Vector3).copy(n).z=this.bbox.max.z,(new Ym.Vector3).copy(n).z=this.bbox.min.z,(new Ym.Vector3).copy(n).y=this.bbox.min.y,r.push(new Ym.Plane(new Ym.Vector3(-1,0,0),-Math.abs(this.bbox.min.x))),r.push(new Ym.Plane(new Ym.Vector3(1,0,0),-Math.abs(this.bbox.max.x))),r.push(new Ym.Plane(new Ym.Vector3(0,0,1),-Math.abs(this.bbox.max.z))),r.push(new Ym.Plane(new Ym.Vector3(0,0,-1),-Math.abs(this.bbox.min.z))),r.push(new Ym.Plane(new Ym.Vector3(0,-1,0),-Math.abs(this.bbox.min.y)));var i=new Ym.Vector3(0,0,-1);i.applyMatrix3(Vv.getNormalMatrix(this.camera.matrix)),i.normalize();var o=(new Ym.Vector3).copy(e);o.normalize();for(var a=o.dot(i),s=new Ym.Ray(this.camera.position,o),u=0;u<r.length;++u){var c=s.distanceToPlane(r[u]);if(c&&c-100-this.camera.near<e.length()&&Math.abs(a-1)<.001&&o.dot(r[u].normal)>0)return}}this.camera.position.add(e),this.viewport.signals.cameraChange.dispatch()}}},{key:"rotate",value:function(e,t){if(t&&(Bv=!0,kv.copy(this.center)),Bv){var n=new Ym.Vector3(0,0,-1);n.applyQuaternion(this.camera.quaternion);var r=n.angleTo(new Ym.Vector3(0,1,0));this.rotateTiltRange.max<r-e.y?e.y=0:r-e.y<this.rotateTiltRange.min&&(e.y=0),zv.copy(this.camera.position).sub(kv);var i=new Ym.Matrix4;i.makeRotationAxis(new Ym.Vector3(0,1,0),e.x);var o=new Ym.Vector3(1,0,0).applyEuler(this.camera.rotation),a=new Ym.Matrix4;a.makeRotationAxis(o,e.y),i.multiply(a),zv.applyMatrix4(i),this.camera.position.copy(kv).add(zv),n.applyMatrix4(i),this.camera.lookAt(n.add(this.camera.position))}this.viewport.trigerRender()}},{key:"rotateTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return Promise.reject('In rotateTo: first two parameter "rotation" are required, Please check! ');var n=t.useAnimation,r=void 0===n||n;return r?ev(this.camera.rotation,e,t):(Object.assign(this.camera.rotation,e),Promise.resolve())}},{key:"moveTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return Promise.reject('In moveTo: first two parameter "position" are required, Please check! ');var n=t.useAnimation,r=void 0===n||n;return r?ev(this.camera.position,e,t):(Object.assign(this.camera.position,e),Promise.resolve())}},{key:"flyTo",value:function(e,t,n){if(!e||!t)return Promise.reject("In flyTo: first two parameters (postion、rotation) are required, Please check! ");var r=[];return r.push(this.moveTo(e,n)),r.push(this.rotateTo(t,n)),Promise.all(r)}},{key:"flyToBoundingBox",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FRONTTOP",n=arguments.length>2?arguments[2]:void 0;if(!e)return Promise.reject('In flyToBoundingBox: first two parameter "bbox" is required, Please check! ');if(!e.isBox3)return Promise.reject('In flyToBoundingBox: first two parameter "bbox" type error, it is not "box3", Please check! ');var r=this._getBboxLabelPos(e,{viewpoint:t}),i=jv[t.toLocaleUpperCase()];return this.flyTo(r,i,n)}},{key:"flyToObj",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FRONTTOP",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=null;return r=e.isPoi?e.getBoundingBox(n.padding||100):rv(e),this.flyToBoundingBox(r,t,n)}},{key:"surroundOnTarget",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,z:0},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(r){var i=e.viewport.signals,o=n.speed,a=void 0===o?1:o,s=n.angle,u=void 0===s?360:s;if(!t.isVector3){var c=t,l=c.x,h=c.y,p=c.z;t=new Ym.Vector3(l,h,p)}var f=Math.PI/180*u,d=new Ym.Vector3(t.x,e.camera.position.y,t.z).distanceTo(e.camera.position),m=0,v=setInterval((function(){m+=.02*a;var n=Math.sin(m)*d+t.x,o=Math.cos(m)*d+t.z;e.camera.position.x=n,e.camera.position.z=o,e.camera.lookAt(t),i.cameraChange.dispatch(),m>=f&&(clearInterval(v),r())}),20)}))}},{key:"surroundOnObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=rv(e).getCenter(new Ym.Vector3);return this.surroundOnTarget(n,t)}},{key:"_getObjectLabelPos",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return Promise.reject('In getObjectLabelPos: first two parameter "object" are required, Please check! ');var n=null;if(e.isObject3D)n=rv(e);else{if(!e.isBox3)return Promise.reject('In getObjectLabelPos: first two parameter "object" type error, Please check! ');n=e}return this._getBboxLabelPos(n,t)}},{key:"_getBboxLabelPos",value:function(e,t){var n=this,r=t.viewpoint,i=void 0===r?"FRONTTOP":r,o=t.extendScale,a=void 0===o?1.6:o,s=e.getCenter(),u=e.max.clone().sub(e.min),c=Math.max(u.x,u.y,u.z),l=s.clone(),h=function(e){var t=(a-.5)*Math.abs(c),r=Math.max(t,n.viewport.camera.near);l.add(e.multiplyScalar(r))};switch(i.toLocaleUpperCase()){case"FRONT":h(new Ym.Vector3(0,0,1),u.z);break;case"BACK":h(new Ym.Vector3(0,0,-1),u.z);break;case"RIGHT":h(new Ym.Vector3(1,0,0),u.x);break;case"LEFT":h(new Ym.Vector3(-1,0,0),u.x);break;case"TOP":h(new Ym.Vector3(0,1,0),u.y);break;case"BOTTOM":h(new Ym.Vector3(0,-1,0),u.y);break;case"FRONTTOP":h(new Ym.Vector3(0,1,0),u.y),h(new Ym.Vector3(0,0,1),u.z);break;case"BACKTOP":h(new Ym.Vector3(0,1,0),u.y),h(new Ym.Vector3(0,0,-1),u.z);break;case"LEFTTOP":h(new Ym.Vector3(-1,0,0),u.x),h(new Ym.Vector3(0,1,0),u.y);break;case"RIGHTTOP":h(new Ym.Vector3(1,0,0),u.x),h(new Ym.Vector3(0,1,0),u.y);break;case"LEFTFRONTTOP":h(new Ym.Vector3(-1,0,0),u.x),h(new Ym.Vector3(0,1,0),u.y),h(new Ym.Vector3(0,0,1),u.z);break;case"RIGHTFRONTTOP":h(new Ym.Vector3(1,0,0),u.x),h(new Ym.Vector3(0,1,0),u.y),h(new Ym.Vector3(0,0,1),u.z);break;case"LEFTBACKTOP":h(new Ym.Vector3(-1,0,0),u.x),h(new Ym.Vector3(0,1,0),u.y),h(new Ym.Vector3(0,0,-1),u.z);break;case"RIGHTBACKTOP":h(new Ym.Vector3(1,0,0),u.x),h(new Ym.Vector3(0,1,0),u.y),h(new Ym.Vector3(0,0,-1),u.z)}return l}}])&&Uv(t.prototype,n),r&&Uv(t,r),e}();function Kv(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Jv=new Ym.PerspectiveCamera(50,1,.1,3e6);Jv.name="Camera",Jv.position.set(500,250,500),Jv.lookAt(new Ym.Vector3);var $v=null,eg=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),$v=t,this.controlsManager=null,this._camera=Jv.clone(),this._controls=null,this._init()}var t,n,r;return t=e,(n=[{key:"setEnableControls",value:function(e){this._controls.enabled=e}},{key:"getCameraViewpoint",value:function(){return{position:this._camera.position.clone(),rotation:{x:this._camera.rotation.x,y:this._camera.rotation.y,z:this._camera.rotation.z}}}},{key:"setCameraViewpoint",value:function(e){var t=e.position,n=e.rotation;this._camera.position.set(t.x,t.y,t.z),this._camera.rotation.set(n.x,n.y,n.z),$v.signals.cameraChange.dispatch()}},{key:"update",value:function(){this.controlsManager.firstPersonControl.update()}},{key:"_init",value:function(){this._initControlsManager()}},{key:"_initControlsManager",value:function(){return this.controlsManager={fullFreeControler:new Zv($v,this._camera),firstPersonControl:new Sv($v,this._camera),pointLineFollower:new Pv($v,this._camera)},$v.controls=this._controls=this.controlsManager.fullFreeControler,this.controlsManager}}])&&Kv(t.prototype,n),r&&Kv(t,r),e}(),tg=["Sbm","Model"];function ng(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var rg=0,ig=0,og=new Ym.Clock,ag=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.option=t,this.THREE=Ym,this.state={useFreq:1,clickEnabled:!1,dblClickEnabled:!1,rightClickEnabled:!1,mouseDownEnabled:!1,mouseMoveEnabled:!1,mouseUpEnabled:!1,mouseWheelEnabled:!1,animationTotal:0},this.signals=Zm,this.scener=new cv(Zm,t),this.scene=this.scener.mainScene,this.rendererManager=new bv(this.scene,Zm,t),this.container=this.rendererManager.container,this.renderer=this.rendererManager.renderer,this.cameraControlerManager=new eg(this),this.controlsManager=this.cameraControlerManager.controlsManager,this.camera=this.cameraControlerManager._camera,this.controls=this.cameraControlerManager._controls,this.rendererCSS3D=this.rendererManager.initRenderCSS3D(this.camera),this.rendererCSS2D=this.rendererManager.initRenderCSS2D(),this.effectComposer=this.rendererManager.initEffectComposer(this.camera),this.pass=this.rendererManager.initAllPass(this.camera),this.mixer=new Ym.AnimationMixer(this.scene),this._signalsEventListen(),this._containerAddEventListener(this.container),this.animate()}var t,n,r;return t=e,(n=[{key:"setSkyBackground",value:function(e,t){var n=this;(new Ym.CubeTextureLoader).setPath(e).load(t,(function(e){e.format=Ym.RGBFormat,n.scene.background=e,n.signals.backgroundChanged.dispatch()}))}},{key:"setBackgroundColor",value:function(e){this.renderer.setClearColor(e),this.scene.background=new Ym.Color(e),this.signals.backgroundChanged.dispatch()}},{key:"setBackgroundImage",value:function(e){var t=this;(new Ym.TextureLoader).load(e,(function(e){e.wrapS=Ym.MirroredRepeatWrapping,e.wrapT=Ym.MirroredRepeatWrapping,e.encoding=Ym.GammaEncoding,t.scene.background=e,t.signals.backgroundChanged.dispatch()}))}},{key:"trigerRender",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.state.useFreq+=e}},{key:"render",value:function(){this.state.useFreq<=0||(this.state.useFreq-=1,rg=performance.now(),this.renderer.clear(),this.signals.beforeRender.dispatch(),this.renderer.render(this.scene,this.camera),this.signals.afterRender.dispatch(),this.rendererManager._internalOption.enableEffectComposer&&(this.effectComposer.render(),0===this.pass.outlinePass.selectedObjects.length&&this.rendererManager.setEffectComposerEnable(!1)),this.rendererCSS2D&&this.rendererManager._internalOption.enableRenderCss2D&&(this.rendererManager._internalOption.enableRenderCss3D||-1!=this.rendererCSS2D.domElement.style.zIndex?this.rendererManager._internalOption.enableRenderCss3D&&0==this.rendererCSS2D.domElement.style.zIndex&&(this.rendererCSS2D.domElement.style.zIndex=-1):this.rendererCSS2D.domElement.style.zIndex=0,this.rendererCSS2D.render(this.scene,this.camera)),this.rendererCSS3D&&this.rendererManager._internalOption.enableRenderCss3D&&this.rendererCSS3D.render(this.scene,this.camera),ig=performance.now(),this.signals.sceneRendered.dispatch(ig-rg))}},{key:"nextRender",value:function(e){var t=this;return new Promise((function(n){if(e){var r=e();if(r&&r.constructor&&"Promise"===r.constructor.name)return t.trigerRender(),r;t.trigerRender(),n()}else n()}))}},{key:"animate",value:function(){var e=this;requestAnimationFrame((function(){e.animate()}));var t=og.getDelta();this.cameraControlerManager.update(),this.state.animationTotal>0&&(this.mixer.update(t),this.signals.cameraChange.dispatch()),qm.a.update()&&this.signals.tweenUpdate.dispatch(),this.render()}},{key:"getIntersects",value:function(e,t){var n=new Ym.Vector2;n.set(e.clientX/this.container.offsetWidth*2-1,-e.clientY/this.container.offsetHeight*2+1);var r=new Ym.Raycaster;return r.setFromCamera(n,this.camera),Array.isArray(t)?r.intersectObjects(t,!0):r.intersectObject(t,!0)}},{key:"rayClash",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.camera.position,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ym.Vector3(0,-1,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.scener.intersectsList.getAll(),r=new Ym.Raycaster;return r.set(e,t),n instanceof Array?r.intersectObjects(n,!0):r.intersectObject(n,!0)}},{key:"setHoverEnabled",value:function(e){this.option.hoverEnabled=e}},{key:"_addAnimation",value:function(){this.state.animationTotal++}},{key:"_removeAnimation",value:function(){this.state.animationTotal--}},{key:"_setStateProp",value:function(e,t){this.state[e]=t}},{key:"_setMouseDownEnabled",value:function(e){this.state.mouseDownEnabled=e}},{key:"_setMouseMoveEnabled",value:function(e){this.state.mouseMoveEnabled=e}},{key:"_setMouseUpEnabled",value:function(e){this.state.mouseUpEnabled=e}},{key:"_signalsEventListen",value:function(){var e=this;this.signals.windowResize.add((function(){e.camera.aspect=e.container.offsetWidth/e.container.offsetHeight,e.camera.updateProjectionMatrix(),e.renderer.setSize(e.container.offsetWidth,e.container.offsetHeight),e.rendererCSS3D&&e.rendererCSS3D.setSize(e.container.offsetWidth,e.container.offsetHeight),e.rendererCSS2D&&e.rendererCSS2D.setSize(e.container.offsetWidth,e.container.offsetHeight),e.effectComposer.setSize(e.container.offsetWidth,e.container.offsetHeight),e.trigerRender()})),this.signals.sceneChanged.add((function(){e.trigerRender()})),this.signals.backgroundChanged.add((function(){e.trigerRender()})),this.signals.modelAdded.add((function(t){t.traverse((function(t){t.isMesh&&-1===e.scener.intersectsList.meshOfModelList.findIndex((function(e){return e.id===t.id}))&&e.scener.intersectsList.meshOfModelList.push(t)}))})),this.signals.poiAdded.add((function(t){-1===e.scener.intersectsList.poiIconList.findIndex((function(e){return e.uuid===t.icon.uuid}))&&e.scener.intersectsList.poiIconList.push(t.icon)})),this.signals.otherAdded.add((function(t){-1===e.scener.intersectsList.otherObjList.findIndex((function(e){return e.uuid===t.uuid}))&&e.scener.intersectsList.otherObjList.push(t)})),this.signals.objectAdded.add((function(){e.trigerRender()})),this.signals.objectRemoved.add((function(){e.trigerRender()})),this.signals.objectChanged.add((function(){e.trigerRender()})),this.signals.materialAdded.add((function(){e.trigerRender()})),this.signals.materialChanged.add((function(){e.trigerRender()})),this.signals.materialRemoved.add((function(){e.trigerRender()})),this.signals.geometryChanged.add((function(){e.trigerRender()})),this.signals.cameraChange.add((function(){e.trigerRender()})),this.signals.tweenUpdate.add((function(){e.trigerRender()})),this.signals.outlineChange.add((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.objects,r=void 0===n?[]:n,i=t.option,o=void 0===i?{}:i,a=o.edgeThickness,s=void 0===a?3:a,u=o.edgeStrength,c=void 0===u?10:u,l=o.color,h=void 0===l?"#fff":l;e.pass.outlinePass.selectedObjects=r,e.pass.outlinePass.visibleEdgeColor.set(h),e.pass.outlinePass.edgeThickness=s,e.pass.outlinePass.edgeStrength=c,e.pass.outlinePass.pulsePeriod=0,e.rendererManager.setEffectComposerEnable(!0),e.trigerRender()}))}},{key:"_containerAddEventListener",value:function(e){var t=this,n=0,r=null,i=null,o=function(e,o){if(e>300)return i=null,void(r=null);n++,setTimeout((function(){1===n?o.button?0===o.button?t._findIntersectInAllObject("click",o):2===o.button&&t._findIntersectInAllObject("rightClick",o):t._findIntersectInAllObject("click",o):2===n&&t._findIntersectInAllObject("dblClick",o),n=0}),300)},a=function n(a){a.preventDefault(),i=(new Date).getTime(),t.state.mouseUpEnabled&&t.signals.mouseUp.dispatch(t.getIntersects(a,t.scener.intersectsList.getAll())),o(i-r,a),e.removeEventListener("mouseup",n,!1)},s=function n(a){a.preventDefault(),t.state.mouseUpEnabled&&t.signals.mouseUp.dispatch(t.getIntersects(a,t.scener.intersectsList.getAll()));var s=(i=(new Date).getTime())-r,u=a.changedTouches[0],c=u.clientX,l=u.clientY;o(s,{clientX:c,clientY:l}),e.removeEventListener("touchend",n,!1)};"ontouchstart"in window?e.addEventListener("touchstart",(function(n){n.preventDefault(),r=(new Date).getTime(),t.state.mouseDownEnabled&&t.signals.mouseDown.dispatch(t.getIntersects(n,t.scener.intersectsList.getAll())),e.addEventListener("touchend",s,!1)}),!1):(e.addEventListener("mousedown",(function(n){n.preventDefault(),r=(new Date).getTime(),t.state.mouseDownEnabled&&t.signals.mouseDown.dispatch(t.getIntersects(n,t.scener.intersectsList.getAll())),e.addEventListener("mouseup",a,!1)}),!1),e.addEventListener("mousemove",(function(e){e.preventDefault(),t.state.mouseMoveEnabled&&t.signals.mouseMove.dispatch(t.getIntersects(e,t.scener.intersectsList.getAll())),t.option.hoverEnabled&&t._findIntersectInAllObject("hover",e)}),!1)),e.addEventListener("wheel",(function(e){e.preventDefault(),t.state.mouseWheelEnabled&&t.signals.mouseWheel.dispatch({event:e,intersects:t.getIntersects(e,t.scener.intersectsList.getAll())})}),!1)}},{key:"_findIntersectInAllObject",value:function(e,t){var n=this,r=this.getIntersects(t,this.scener.intersectsList.getAll());this.state["".concat(e,"Enabled")]&&this.signals[e].dispatch({event:t,intersects:r});var i=function(e){for(var t=["TransformControlsPlane"],n=0;n<e.length;n++)if(!t.includes(e[n].object.type))return e[n]}(r);if(i){var o=i.object,a=i.point;e=e.slice(0,1).toUpperCase()+e.slice(1),o.isIcon?function(e,t){var r=e.parent;if(r){var i=r["on".concat(t)];i?(i(r),r.isEventPropagation&&(n.signals["poi".concat(t)].dispatch(r),r.isEventPropagation=!1)):n.signals["poi".concat(t)].dispatch(r)}}(o,e):function(e,t){var r=function e(t){return t.parent?tg.includes(t.parent.stype)?t.parent:e(t.parent):void 0}(e);if(r){var i=r["on".concat(t)];i?(i(r),r.isEventPropagation&&(n.signals["model".concat(t)].dispatch({target:r,currentTarget:e}),r.isEventPropagation=!1)):n.signals["model".concat(t)].dispatch({target:r,currentTarget:e})}}(o,e),"Click"===e&&this.signals.selectPosition.dispatch(a)}}}])&&ng(t.prototype,n),r&&ng(t,r),e}();function sg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Object",r=t.id,i=void 0===r?null:r,o=t.name,a=void 0===o?null:o,s=t.level,u=void 0===s?null:s,c=t.userData,l=void 0===c?{}:c;e.sid=i,e.name=a,e.level=u,e.userData=l,e.stype=n,e["is".concat(n)]=!0,e.handleHide=!1}function ug(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0};e.position.set(t.x,t.y,t.z)}function cg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:1,y:1,z:1},n=e.stype;"Poi"===n||"PoiNode"===n?e.scale.set(t.width||1,t.height||1,1):e.scale.set(t.x,t.y,t.z)}function lg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0};e.rotation.set(t.x,t.y,t.z)}function hg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ug(e,t.position),cg(e,t.scale),lg(e,t.rotation)}function pg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.onClick,r=t.onDblClick,i=t.onRightClick,o=t.onLoad;n&&(e.onClick=n.bind(e)),r&&(e.onDblClick=r.bind(e)),i&&(e.onRightClick=i.bind(e)),o&&(e.onLoad=o.bind(e)),Object.defineProperties(e,{_isEventPropagation:{value:!1,writable:!0},isEventPropagation:{get:function(){return this._isEventPropagation},set:function(e){this._isEventPropagation=e}}}),fg(e)}function fg(e){e.eventPropagation=function(){e.isEventPropagation=!0}}function dg(e){e.show=function(){e.visible=!0,e.handleHide=!1,e.isPoiNode&&e.children.length>0&&e.children.map((function(e){e.visible=!0,e.element.style.display="block"})),Bx.signals.objectChanged.dispatch()},e.hide=function(){e.visible=!1,e.handleHide=!0,e.isPoiNode&&e.children.length>0&&e.children.map((function(e){e.visible=!1,e.element.style.display="none"})),Bx.signals.objectChanged.dispatch()},e.setMove=function(){return ev.apply(void 0,[e.position].concat(Array.prototype.slice.call(arguments)))},e.setRotate=function(){return ev.apply(void 0,[e.rotation].concat(Array.prototype.slice.call(arguments)))},e.setScale=function(){return ev.apply(void 0,[e.scale].concat(Array.prototype.slice.call(arguments)))},e.dispose=function(){Bx.scener.removeObject(e)}}function mg(e){return(mg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vg(e){return(vg=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function gg(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yg(e,t){return(yg=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var bg=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=function(e,t){return!t||"object"!==mg(t)&&"function"!=typeof t?gg(e):t}(this,vg(t).call(this)),sg(gg(e),n,"SceneManager"),hg(gg(e),n),dg(gg(e)),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&yg(e,t)}(t,e),t}(Ym.Scene);function xg(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var wg=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.type=n}var t,n,r;return t=e,(n=[{key:"update",value:function(){if(0!==this.scene.children.length){var e=function(e){var t=e.level,n=e.handleHide,r=e.children;t&&!n&&(Bx.camera.position.distanceTo(e.position)>e.level?(e.isPoiNode?r.length>0&&r.map((function(e){e.visible=!1,e.element.style.display="none"})):e.visible=!1,e.matrixAutoUpdate=!1):(e.isPoiNode?r.length>0&&r.map((function(e){e.visible=!0,e.element.style.display="block"})):e.visible=!0,e.matrixAutoUpdate=!0))};this.scene.children.map((function(t){e(t),"Group"===t.stype&&t.children.map((function(t){return e(t)}))}))}}},{key:"getById",value:function(e){return this._getChildByTypeAndProp(this.type,"sid",e)}},{key:"getByName",value:function(e){return this._getChildByTypeAndProp(this.type,"name",e)}},{key:"removeById",value:function(e){var t=!1,n=this.getById(e);return n&&(Bx.scener.removeObject(n),n.parent.remove(n),Bx.signals.objectRemoved.dispatch(),t=!0),t}},{key:"getGroupById",value:function(e){return this._getChildByTypeAndProp("Group","sid",e)}},{key:"getGroupByName",value:function(e){return this._getChildByTypeAndProp("Group","name",e)}},{key:"removeGroupById",value:function(e){var t=!1,n=this.getGroupById(e);return n&&(Bx.scener.removeObject(n),n.parent.remove(n),Bx.signals.objectRemoved.dispatch(),t=!0),t}},{key:"getByUserDataProperty",value:function(e,t){var n=[];return"function"===Km(t)?this.scene.traverse((function(r){r.userData[e]&&t(r.userData[e])&&n.push(r)})):this.scene.traverse((function(r){r.userData[e]===t&&n.push(r)})),n}},{key:"clear",value:function(){if(0!==this.scene.children.length){for(var e=0;e<this.scene.children.length;e++)Bx.scener.removeObject(this.scene.children[e]);this.scene.children=[],Bx.signals.objectRemoved.dispatch()}}},{key:"hideAll",value:function(){var e=this;this.scene.traverse((function(t){t.stype===e.type&&t.hide()}))}},{key:"showAll",value:function(){var e=this;this.scene.traverse((function(t){t.stype===e.type&&t.show()}))}},{key:"_getChildByTypeAndProp",value:function(e,t,n){var r=null;return"sid"!==t&&(r=[]),this.scene.traverse((function(i){if(i.stype===e&&i[t]===n){if("sid"===t)return r=i;r.push(i)}})),r}}])&&xg(t.prototype,n),r&&xg(t,r),e}();function _g(e){return(_g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Tg(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Sg(e,t){return!t||"object"!==_g(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Mg(e){return(Mg=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Eg(e,t){return(Eg=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ag=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Sg(this,(e=Mg(t)).call.apply(e,[this].concat(Array.prototype.slice.call(arguments),["Light"])))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Eg(e,t)}(t,e),n=t,(r=[{key:"createAmbientLight",value:function(e){if(!Option)return console.error("createAmbientLight missing param option");if(!e.color)return console.error("createAmbientLight missing param option.color");var t=new Ym.AmbientLight(e.color);return t.name=null==e.name?"ambientLight":e.name,Bx.scener.importObject(t,this.scene),t}},{key:"createDirectionalLight",value:function(e){if(null!=e){var t=new Ym.DirectionalLight(e.color,e.intensity);t.name=null==e.name?"directionalLight":e.name,t.position.set(e.direction.x,e.direction.y,e.direction.z),t.castShadow=!1;var n=e.depth;return t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024,t.shadow.camera.near=e.near,t.shadow.camera.far=e.far,t.shadow.camera.right=-n,t.shadow.camera.left=n,t.shadow.camera.top=-n,t.shadow.camera.bottom=n,t.shadow.bias=e.shadowBias,Bx.scener.importObject(t,this.scene),t}}},{key:"createHemisphereLight",value:function(e){if(null!=e){var t=new Ym.HemisphereLight(e.skyColor,e.groundColor,e.intensity);return t.name=null==e.name?"HemisphereLight":e.name,t.position.set(e.position.x,e.position.y,e.position.z),Bx.scener.importObject(t,this.scene),t}}},{key:"createSpotLight",value:function(e){if(null!=e){var t=new Ym.SpotLight(e.color);return t.position.set(e.position.x,e.position.y,e.position.z),t.castShadow=!0,t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024,t.shadow.camera.near=500,t.shadow.camera.far=4e3,t.shadow.camera.fov=30,t.target.position.set(e.target.x,e.target.y,e.target.z),t.target.updateMatrixWorld(),t.angle=e.angle,t.distnace=e.distance,Bx.scener.importObject(t,this.scene),t}}},{key:"createRectLight",value:function(e){if(null!=e){var t=new Ym.RectAreaLight(e.color,e.intensity,e.width,e.height);t.position.set(e.position.x,e.position.y,e.position.z);var n=new Ym.PlaneBufferGeometry(t.width,t.height,2,2),r=new Ym.MeshBasicMaterial({color:16777215,side:Ym.FrontSide}),i=new Ym.Mesh(n,r);t.add(i);var o=new Ym.PlaneBufferGeometry(t.width,t.height,2,2),a=new Ym.MeshBasicMaterial({color:526344,side:Ym.BackSide}),s=new Ym.Mesh(o,a);return t.add(s),Bx.scener.importObject(t,this.scene),t}}},{key:"createLEDLight",value:function(e){if(null!=e){if(e.shapetype){switch(e.shapetype){case"square":var t;(t=e.enablelight?new Ym.PointLight(e.color,e.intensity,e.distance,e.decay):new Ym.Object3D).castShadow=!0,t.position.set(e.position.x,e.position.y,e.position.z);var n=new Ym.PlaneBufferGeometry(e.width,e.height,2,2),r=new Ym.MeshBasicMaterial({color:16777215,side:Ym.DoubleSide}),i=new Ym.Mesh(n,r);t.add(i);break;case"circle":(t=e.enablelight?this.createSpotLight(e):new Ym.Object3D).position.set(e.position.x,e.position.y,e.position.z);break;default:(t=e.enablelight?new Ym.PointLight(e.color,e.intensity,e.distance,e.decay):new Ym.Object3D).position.set(e.position.x,e.position.y,e.position.z)}Bx.scener.importObject(t,this.scene)}return t}}}])&&Tg(n.prototype,r),i&&Tg(n,i),t}(wg);function Pg(e,t){return new Promise((function(n,r){var i=new XMLHttpRequest;i.open("GET",e,!0),t&&t.isArraybuffer&&(i.responseType="arraybuffer"),i.onreadystatechange=function(){4===this.readyState&&(200===this.status||304===this.status?n(this):r(this.error))},i.send(null)}))}var Og=n(193);function Lg(e){return new Promise((function(t,n){Object(Og.parseString)(e,(function(e,r){if(e)return n(e);t(r)}))}))}var Ig={xmlToObj:Lg};function Cg(e){return(Cg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Rg(e){return(Rg=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Dg(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ng(e,t){return(Ng=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Fg=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=function(e,t){return!t||"object"!==Cg(t)&&"function"!=typeof t?Dg(e):t}(this,Rg(t).call(this)),sg(Dg(e),n,"Group"),hg(Dg(e),n),dg(Dg(e)),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ng(e,t)}(t,e),t}(Ym.Group);function jg(e){return(jg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ug(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Bg(e){return(Bg=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function kg(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zg(e,t){return(zg=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Gg=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=function(e,t){return!t||"object"!==jg(t)&&"function"!=typeof t?kg(e):t}(this,Bg(t).call(this)),sg(kg(e),n,"Sbm"),hg(kg(e),n),pg(kg(e),n),dg(kg(e)),e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zg(e,t)}(t,e),n=t,(r=[{key:"getBoundingBox",value:function(){return nv(this)}}])&&Ug(n.prototype,r),i&&Ug(n,i),t}(Ym.Object3D);function Vg(e){return(Vg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Hg(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Wg(e){return(Wg=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Xg(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yg(e,t){return(Yg=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var qg=function(e){function t(e,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){return!t||"object"!==Vg(t)&&"function"!=typeof t?Xg(e):t}(this,Wg(t).call(this,e,n)),sg(Xg(r),i,"SbmChild"),hg(Xg(r),i),dg(Xg(r)),r.castShadow=!1,r.receiveShadow=!1,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Yg(e,t)}(t,e),n=t,(r=[{key:"changeMaterial",value:function(){this.changeMaterialMap.apply(this,arguments)}},{key:"changeMaterialMap",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new Promise((function(o){var a=Object.assign(t.material.clone(),r),s=Object.assign(t.geometry.clone(),i);t.material=a,t.geometry=s,(new Ym.TextureLoader).load(e,(function(e){e.encoding=Ym.GammaEncoding,t.material.map=Object.assign(e,n),Bx.signals.materialChanged.dispatch(),setTimeout((function(){o()}),100)}))}))}},{key:"changewall",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.direction,r=void 0===n?"front":n,i=t.axis,o=void 0===i?"x":i,a=[],s=this.geometry.attributes.position.array,u=0;u<s.length;u+=3)a.push(new Ym.Vector3(s[u],s[u+1],s[u+2]));var c=null;a.map((function(e){"x"===o?(!c||e.y<c)&&(c=e.y):"y"===o&&(!c||e.x<c)&&(c=e.x)}));var l=[];a.map((function(e){"x"===o?e.y===c&&-1===l.findIndex((function(t){return 0===t.distanceTo(e)}))&&l.push(e):"y"===o&&e.x===c&&-1===l.findIndex((function(t){return 0===t.distanceTo(e)||t.y===e.y}))&&l.push(e)}));var h=0;"x"===o?("front"===r&&(h=1),"back"===r&&(h=0)):"y"===o&&(l[0].y>l[1].y?("front"===r&&(h=0),"back"===r&&(h=1)):l[0].y<=l[1].y&&("front"===r&&(h=1),"back"===r&&(h=0)));var p=l[h],f=null;0===h?(f=l[0].clone().sub(l[1])).normalize():1===h&&(f=l[1].clone().sub(l[0])).normalize();for(var d=0;d<this.parent.children.length;d++){for(var m=this.parent.children[d],v=m.geometry.attributes.position.array,g=0;g<v.length;g+=3){var y=null;"x"===o?y=new Ym.Vector3(v[g+0],p.y,v[g+2]):"y"===o&&(y=new Ym.Vector3(p.x,v[g+1],p.z)),y.distanceTo(p)<50&&("x"===o?(v[g+0]+=f.x*e,v[g+2]+=f.z*e):"y"===o&&(v[g+1]+=f.y*e),m.geometry.attributes.position.needsUpdate=!0)}m.geometry.computeBoundingSphere(),m.geometry.computeBoundingBox()}Bx.signals.geometryChanged.dispatch()}}])&&Hg(n.prototype,r),i&&Hg(n,i),t}(Ym.Mesh);function Qg(e){return(Qg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zg(e){return(Zg=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Kg(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Jg(e,t){return(Jg=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var $g=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t){return!t||"object"!==Qg(t)&&"function"!=typeof t?Kg(e):t}(this,Zg(t).call(this,e)),sg(Kg(n),r,"Icon");var i=r.scale,o=void 0===i?{width:1,height:1}:i;return n.scale.set(Jm*o.width,Jm*o.height,1),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Jg(e,t)}(t,e),t}(Ym.Sprite);function ey(e){return(ey="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ty(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ny(e){return(ny=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ry(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function iy(e,t){return(iy=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var oy=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t){return!t||"object"!==ey(t)&&"function"!=typeof t?ry(e):t}(this,ny(t).call(this,e)),sg(ry(n),r,"Text2D");var i=r.position,o=void 0===i?{x:0,y:0,z:0}:i,a=r.scale,s=void 0===a?{width:1,height:1}:a,u=s.width,c=s.height,l=o.x,h=o.y,p=o.z;return n.scale.set(6*Jm*u,6*Jm*c,1),n.position.set(l,h,p),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&iy(e,t)}(t,e),n=t,(r=[{key:"dispose",value:function(){this.texture.dispose(),this.material.dispose()}}])&&ty(n.prototype,r),i&&ty(n,i),t}(Ym.Sprite);function ay(e){return(ay="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sy(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function uy(e){return(uy=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function cy(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ly(e,t){return(ly=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var hy=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=function(e,t){return!t||"object"!==ay(t)&&"function"!=typeof t?cy(e):t}(this,uy(t).call(this)),sg(cy(e),n,"Painter"),dg(cy(e)),e.drawType=null,e.points=n.points||[],e._initParam=Object.assign({color:"red",opacity:1,size:20,offsetY:1},n),e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ly(e,t)}(t,e),n=t,(r=[{key:"updatePoints",value:function(e){this.clear(),this.points=e,this.draw(),Bx.signals.objectChanged.dispatch()}},{key:"draw",value:function(e){switch(this.drawType=e||this.drawType,this.drawType){case"Line":case"line":for(var t=new Ym.BufferGeometry,n=[],r=new Ym.LineBasicMaterial({vertexColors:Ym.VertexColors,linewidth:5}),i=new Ym.Color(this._initParam.color),o=[],a=this.points.length,s=0;s<a;++s){var u=this.points[s];n.push(u.x,u.y+this._initParam.offsetY,u.z),o.push(i.r),o.push(i.g),o.push(i.b)}t.setAttribute("position",new Ym.Float32BufferAttribute(n,3)),t.setAttribute("color",new Ym.Float32BufferAttribute(o,3)),t.computeBoundingSphere();var c=new Ym.Line(t,r);Bx.scener.importObject(c,this);break;case"Face":case"face":for(var l=new Ym.MeshStandardMaterial({transparent:!0,opacity:this._initParam.opacity,color:this._initParam.color||"red",side:Ym.DoubleSide}),h=this.points,p=0;p<h.length-2;++p){for(var f=new Ym.Geometry,d=0;d<3;++d){var m=0;0!==d&&(m=p+d);var v=h[m],g=v.x,y=v.y,b=v.z,x=new Ym.Vector3(g,y+this._initParam.offsetY,b).clone();f.vertices.push(x)}var w=new Ym.Vector3(0,1,0),_=new Ym.Color(this._initParam.color),T=new Ym.Face3(0,1,2,w,_,0);f.faces.push(T),f.computeFaceNormals(),f.computeVertexNormals();var S=new Ym.Mesh(f,l);Bx.scener.importObject(S,this),f.dispose()}break;case"Point":case"point":for(var M=(new Ym.TextureLoader).load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wgaExY5fZXYlgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAASFUlEQVR42u1bS48bR5KOR2ZV8dHsh97WeD2Y82IxEI996YMAw/9jftb8j8ECPVgBgz74QP+AgS0YMNAtW61+kyxWZkbsIbPIYrHYLcmaxQK7BFJksyiy4osvIiPjAfD/j//bD/ySX/aXv/wFW9+LD6zmQxvP9y3461//qv+rAGgJXi96YDVBaAoo96z6OnwpMPALCl4Lxem1Sa9N6zWn1WZBLWQAAN94br6ur0sTtN8DAn4hjVNDMNtYWWvZw/HYQrHDvZ5h8IBgADx4BQ/inPNlWfrJZOIAwAFA1XiuXzdBCb8XCPwdwjfpbJLAeVoFABRjgN7O0VGR93qFZVswY27IZMhoAMEg4NIEFDSogBcJVQihEucWpXPl5eW8nExO5gBQprVIqwYptEzkk8wCP0N4bFDdNDTdS2tweHg4GI6GwyIrBsbagWHuE1GPiQogyhAxIwRGQEp3KqoaVNWpqhORUkTKEPxcJEzdwk1nZTm9PD6eTgCmADADgHkComowogbio0HAzxCeGlSvBe8DwPDo8Gg03B+OcpuPTGZGhs0OMw+JaYCEPSIuECAnjAyAyAAEAFHQAAJeQSsRXajKXCTMQpBp8OHOeXfjnLspp+XNf16e38JkcgsrMGog1sziY0DAzxDeJMHzJPjOeHw4evFitJ/n/b3M2n02Zt8Ys8tEO0g8JMI+EfUQMUdECwAGERkBUREAVFUVBEB9YkGlqqWqzIPoVEK4CyFce++vnXNXVbW4nE5nV8fHx1cAcAsAd4kRVcMsPgoE/AThuSF8DwAGALD7+vXr/cFg56Ao8kfWmsfGmANm3mPmXSIaEtEAEQsiyhHRYtQ8AwAhIAFG+WsPr6BeRb2qViJSqupcRO5CCLchhOsQwqV37sPCVR8W5eLD2dnlxWRycg0ANw021M7yQRDwE4XPk/A7Y4C9p99992gw6D/JsvyJtfaJYfOIDR8w8S4S7TBTn4gKQMgIySKiAQBGREKA5AMVQUE17fGquuYPVHQhKvMQwp2I3obgr0IIH7xz55Vz78v5/P31zc35mzdvLgDgOplF+bEg4EfSvrb3PgCMxoeHBy/29x/3er1neZ4/s9Y+ZeYnxpgDIt5jpiFRFB4RLSFZQGBCJEAkROyMBGsmJBBEVbyIOlWpRHQuItPEhMsEwm8L535dlOWvt7e3vx0fH38AgKtkEmXDL2x1jOYTbD4KPz48ePno0dNer/c8y7IX1trnxpinzHxgmPeIeUhEfUTMicgSESMiQ9I6IiIg1tI3I0GI8kcg4oOESIOIOEIpAlKPkHoUTaqIPoUyQjRARK9fv8bj4+PO8LkRQa49+IF9vmnzo/F4fPDi5bNn/V7/RZ7nL7M8e2mNfWGMeWqtfcTMu8w8ZOYeM+dEZJnIIDEzERERxn8RiRDT30jxD4zvE+HqQYjIiMhIZBAxLiIb/QmadA0JAMgY/cPLl+Ht27fS2BGWUeOrV6/ghx9+uB+AV69e1dqv9/geAAwBYH88/vPTQX/4VZ5lL22WvTTWvjDWPEmOb5eZ+8xcMHPGRIZqsVfCR6kiBIgtSZeyE0L9SYisIYhvcVq1L0nPQIQICCiGSJ49f+5//vln3xUktUEwD+z1S+1/9+13B0Vv8DTLsufGZi+MNc+N4SfMZp+Jdpi5IKKMiAwhEq6EjSJESQBT8IeIbQ8Q1RStAFUVVBUQEVQVURAFdYkXABAgkAGDAKCgIKoQVNWPRrtuPB67yWTSBYJuZUDSftvud4+Ojh7t7u0+L4reyyzLXlobac+GDzgGOz0iyonIEBEnzSMz1xQHIoKoWQJEjH8nQBARID0T4dr7tcSw2jZWrABIThUoBVUKAAGRQp7n7p///Gc7XN4wBfOA9vswhtFoNDrIsuxJZuxTY8wTZn7EzHtMPGSiHhFlzGSImFYU7xByyYLuDSg5Qai131yogAKa3OjSiRbxP7AwQ9o6oVKVMoRi/vr16/nx8XHZCpCkyQLu0D43orzdb//j28eDweB5ludfWWu/MsY8N8Y8MswjMqbPRDkxGSamhlMDYoZa80sGNEDZDs72BUtjAlSorQobJ1NV1Xh0VoAKARbD4XBxdnbm2hFizQJzT5zfG48Ph0XR38sy+8gwPzKGD5YRHlOPo80zEy9dd1PYpqDwgA9oaj/Z/cYCABARRCRlBlrtnlqoamA2uyK6EOFZZsytz7Lbx48f36XgaN7FAm5pnxqOb/fPf/73R4NB8SzLiq+Wds+8b4zZYeaCiQ0l1a/ZehK8DUQ3C6Ly7mcDtEHDVjC3llhRjYcqUChFZT4cDsuzs7NFOzB69erV2i6wHvKOx/0sy0bGZHuN2H6HiPqEmCGSQcJa+C0CIiBSS5Dk8Bo/W8vV1v7qQUCkICJASFFNAKgKgKhERKyqVlULIhow00gC77E1e5m1u/v7jy+TUmcJBKpBMB2ZHQsAxdHOft/abIeZR8Q0IsKdFN7mSGRTTIMNT32vjW9oOKp0zQRq4WttqyqoyDKEi2GBAMpyx0AAAlUlJDIoYik65QExjTjQyNpsVBT5MDnMrJGyQwBQ6mCABYB8OLR9a3jIzDuMNCTiKDwuw1taBTG0XWAiwC6/0Pr8NtOJn0vX1r537TXGwJJMikV6kQm8w8zDPLeDw8PDXgLANJOyppXUZACwYxgXbLM+MQ+IeBifqUDEDAlNI2Jd3kxkdn1TDWE3tB8p394K2wxoPogARNZ9AylFv4+KhASKWkeKFhFzXDFhQMYMhr1hFwDQCcDOUZFbMj0m7hNBDxGLOplB7RgWCRAQENZt/YHtbGMX2BAe148vbeeoqC3Q184OlgmLQBiZQNSzhS0eYsDSCeb5MGND6cRFBRHlAGAofjnhalNeJrUeEroLBIDoDBXWBUdFEJUGQWp2bP0NREStASAkI0CW4r0XTNRj5rwFAAFAoDVXmwAgshmhyZAwxzqTQ2Tqszw24o9t2l2uewIcomg+a/4BI7UR2maDnVtm4zexETYbJLSImCVzyIkoPzw8tO26RNcuYKwlg4QZImaYChuUMjm12poCNm15g+ZbGYCAHekY1foHNn1D/L+aPrNpHomKlO7TAIBFxIwIM2a21lrTLsp0AUDLc/dqUTOhsSlgGxDotPVuM4COEiG2hIfNLbL7jFH7V0IAQopHZ4QohzGGG/TfOA6vQKAlEOu1vPVIrFuClsBdr9ffw/YJdSMWQIQ1++/aKTa+GDEmXQEYARmAGHizLkkdOUKkmI5YfrCp2I8rNmCHoCt81vxABxu2s+P+3C52X0BI4QQDtz+CbQBgvFneBv3kipvec6V1CAJ9WKMPyp8OUvfjpiGEzRij/aEJgIKIKKgoaDuLop8kvq5Tepn56TjldZnAx77fcXdr5XZVFQFRAN6Qx7S+RgFAgkJQhQCylliUeAOrxNWmOldprFq72HBoS3pra+9vJUGa39UWfO11t/QxoQyxvgAAAWpZ/ELa2WLTFh4AAogGUPUaS1UhrQRC4x6hpc2Gs9g43KStTes9TB/IBHVca4MVQVptn3UyHQAk5gjVq6gTEKcqzrtlEbUTgGVzggvOiUiVanRVA4jlb9xH35Xnbnhz0JVJJGao6hoW25IgbYDuMQ1NDBAAiHVG0EpFq6BS3cKtb+cH2yYQAXCu0hAWolKq6iIB4VU1RKWrqip23XQtWLysAF3b1mqrXzOELgC2AbK+msUUFVX1oupAdSGipaiWwYVqcjJxjU6TrQxw8/l84Xd3SwkyT7X6BZA6VQ21Y0w/CqqrFHY0g6jplZ0IaNPXag3KWshwb0I00Xs7KCpNBEKkviwkVZglhLlzruwqoVPLBwQAcCcnJwvn3SxImInKTEXnEpngRCRIrNt9lMZUFFQlJjZElk5ENf2dlqounzfXA7+1qqcFEVlWlkVkJiIzH/ysAcDDDACA0lVuLiFMNeidsEw1FicrIvIqYhRRN7S/RlNZ7rIiKQBqOchtSdEmE7aDsgRHRURFREQlqKoT1VJEZyoy9SHcBR+ml5eX8w4ANnyAJAAW8/l82u8Pbq31Nyx8GyRMSWmuqoWIWiLlmKHFNTMQESCiKDTpZqBxT+ID4GG6twBJm0GqJktsr1GRmUi48yI3IYRb59x0Mpl0AQDUtQsAQPnmzZuZc9Vt8P4mhHAjIrciMpMQSlVxIhJUVURENWpgReUl/ddp3qR6UxCR+r1ujUstuOja/0+rfvi0c6VeArkOwV97567v7spmB0noMoEmCD59cDabzW6zLL8yNlyGEPaIaESEPRTJsU6OQKzZUeNmSQQk5fe6tF+f99ssuN8RRv8hDe3X1FdVLyKViMyDyF0QuQ4hXHnnr6qqunnz5rjdL7BsmqBW40ATgPnx8eWtc9W18/4yhHApQa5CSEyIP+iT9YnULAhhQ9Mbjk42r20sbX9HZEpilUa5VUQkiIgTkbmI3IlPbTTeXzjnLmazWbNrpBkIQRcDtOEI5wCTu+l0/8pau2OId4hpgAF7iJTXeYKUHDDL4yURisg9pS5IMQLcG+93275AtLil4wsi4kIIZeoeuQ4SLoL3586587KqLo+Pj28a9QD/UG2wfZSkt2/f8jd/+hNbYywjWYhpJlPX5ht5g41cyLaTizbjBNi2dW46vqTzWngfQqh7Cu9S28x77927qnKnZVW++3B1/f6Xn3++TJ1kdfOUNHuGlgD88MMP8OrVq66yEz178oSyImMiNtzo1IDY6kbrIGjz+NxVAq737Xv29VYMIJqOdBJ3PZUQQqhiM2W4CyFchRDOvfe/OudOF4vF2d3t3a//9fe/f2h0jzXtf1ke7+oP2Ego/PLLL/D1H75Gaw2vta0kwXE9y1KHyG0gNw45m5pv2X0Uetk1ldxNSP6nDCFMQwhX3vtz7/2v3rvTxcKdzmazd3/729/OU8PUNGnft7W/AUCDBRun7bdv3+Ifv/63uuxdt33QlhmAhsC6pPna+9qgfyNCTHRPB1pRXWpeQtrqFrXD8yFchiR81Hx1Wpbzs9OL0/dnv5zV1C+bpfF2p9hGj9AWEAAA9MeffoJvvvlGOXV7NAweoTPDq0s5oXmA2MqA5fYGDUdXb3MuCT8TkdsQ/GWT9tVicTqfz9+dn5+///7k+4sk/Hwb9bcC0DKF9hSH/Pjjj5pAECRaDTEoaqzXLlMZUh/a66AN1k9tqwsrhq+IvtJ4ley97hi99iFc+ODfe+/fOefOqqo6nc9nZ+fXH347+cdJl93LtmbJTgDuMYUahPD1118HIoonK8SAAEEV/CoLo6KgITnvsGp+jMK2/pZ0kAki6lOkWYnIIm1xdyGEW+9Tl6j3773z76qqOquq8nQ+L88+fPjw/uQfJxct4f026t8LQAcI7ZGW8NNPP4WXL196IvCq6ADUQUxAxCXqFMCpqgMAL7LMMHmNmg0i6uISJyIuneIWjZPcNIRwE728XIQQzr1zv4bgzypXnS0W5dl8Xr47PT09//777y86+oVlG/U/p1m6ORhRpGbpncPDw939/f2DoigOsix7ZIzZZ+Z9Zt5l4h2i1CofS1Sx0oRoGp1dAOt9wjGTszzP60yC3AXxNyHItfPuwrtwUVbzD9Pb6UXqGL/u6Bj/qNmBz2mX58Z0SN01Pnr97etRvxjs5Vm2Z43dY2t2mXnERENC7CNRj5ByJMgA0CAgA9aHsUZzU90uL1pKnBm4C0HuvA/Xwftr593VbDG7ujn77epkMrlJgk9bwxMfPTjxOQMT7db5BhDjnW+/fbxT5MWOzezIGDNk5iETD4gpltkJcwSyiMtOjWU6btkhrroIIQ5MSJBp8O6u8v7WufLm8u7m9uTNST0jMGuM0bTniOCLDUzcMy/UHJIq0uoDQP/o9dFgWAz7bO3AMPUMmx4SFYSUEYFFRKOAGCvfdYs8+NQZvvAhlEFkHhZutnCL2fn53XQyOZk1xmXK1mzAZ80N/Z6hKdwCRNYcnIIxFEc7R3me57m1NqfU6EwUu8viEVQEBEQk+BDABecqF9zicj5fTE5OmsNSZWuCbKMh+lMnxz57brBlEtiouzeHqWpAmqN0BgDMeDymoiioLMtYkZqAAEzqhIy7Z7X7fz9rWuxfMTiJHazgjoFJbk2PbhZmNld7aHKtxPU/Pjj5kUBsG6HFlvDQAYJC98jsF58h/lcNT0PH4ei+wek2CLBl6uOLD0//NxKXqwa3BaHgAAAAAElFTkSuQmCC"),E=new Ym.BufferGeometry,A=[],P=new Ym.PointsMaterial({size:this._initParam.size,color:this._initParam.color,sizeAttenuation:!1,map:M,alphaTest:.5,transparent:!0}),O=this.points,L=O.length,I=0;I<L;++I){var C=O[I];A.push(C.x,C.y+this._initParam.offsetY,C.z)}E.setAttribute("position",new Ym.Float32BufferAttribute(A,3)),E.computeBoundingSphere();var R=new Ym.Points(E,P);Bx.scener.importObject(R,this)}}},{key:"clear",value:function(){this.children=[],this.points=[]}}])&&sy(n.prototype,r),i&&sy(n,i),t}(Ym.Object3D),py=function(e){var t=16*Jm,n=document.createElement("canvas");n.width=t,n.height=t;var r=n.getContext("2d"),i=e.text,o=void 0===i?" ":i,a=e.fontFamily,s=void 0===a?"Microsoft YaHei":a,u=e.fontSize,c=void 0===u?12:u,l=e.color,h=void 0===l?"#fff":l,p=e.textAlign,f=void 0===p?"center":p,d=e.textBaseline,m=void 0===d?"bottom":d,v=.5*t,g=.5*t;return r.save(),r.font=c+"px "+s,r.textAlign=f,r.textBaseline=m,r.shadowColor="black",r.strokeStyle="black",r.lineWidth=3,r.fillStyle=h,r.strokeText(o,v,g),r.fillText(o,v,g),r.restore(),n};function fy(e){return(fy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function dy(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function my(e){return(my=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function vy(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function gy(e,t){return(gy=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var yy=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=function(e,t){return!t||"object"!==fy(t)&&"function"!=typeof t?vy(e):t}(this,my(t).call(this)),sg(vy(e),n,"Poi"),hg(vy(e),n),pg(vy(e),n),dg(vy(e)),e.icon=null,e.text=null,e.create(n),e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gy(e,t)}(t,e),n=t,(r=[{key:"create",value:function(e){var t=e.material,n=e.name,r=void 0===n?null:n,i=e.scale,o=e.line,a=e.point,s=e.text,u=void 0===s?{scale:{width:1,height:1}}:s,c=new Ym.Vector3(0,0,0);if(t&&(t.map.flipY=!0),a){var l=a.color,h=void 0===l?"red":l,p=a.size,f={color:h,size:void 0===p?15:p,points:[new Ym.Vector3(0,0,0)]};this._createPoint(f)}if(o){var d=o.color,m=void 0===d?"blue":d,v=o.height,g=void 0===v?100:v,y={color:m,points:[new Ym.Vector3(0,0,0),new Ym.Vector3(0,g,0)]};this._createLine(y),c.setY(g)}var b={material:t,position:c,scale:i};this._createIcon(b);var x={text:r,position:c,scale:u.scale};this._createText(x)}},{key:"getBoundingBox",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;e=e<=0?50:e;var t=new Ym.Vector3,n=new Ym.Vector3,r=new Ym.Vector3(e,e,e);return t.copy(this.position),n.copy(this.position),t.sub(r),n.add(r),new Ym.Box3(t,n)}},{key:"_createPoint",value:function(e){this.point=new hy(e),this.point.draw("Point"),this.add(this.point)}},{key:"_createLine",value:function(e){this.line=new hy(e),this.line.draw("Line"),this.add(this.line)}},{key:"_createIcon",value:function(e){var t=e.material,n=e.position,r=void 0===n?new Ym.Vector3(0,0,0):n,i=r.x,o=r.y,a=r.z;this.icon=new $g(t,{}),this.icon.position.set(i,o,a),this.add(this.icon)}},{key:"_createText",value:function(e){var t=e.position;e.position=t.add(new Ym.Vector3(0,10,0)).clone();var n=py(e),r=new Ym.Texture(n);r.generateMipMaps=!1,r.needsUpdate=!0;var i=new Ym.SpriteMaterial({map:r,depthTest:0});i.map.flipY=!0,this.text=new oy(i,e),this.add(this.text)}}])&&dy(n.prototype,r),i&&dy(n,i),t}(Ym.Object3D);function by(e){return(by="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xy(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function wy(e){return(wy=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ty(e,t){return(Ty=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Sy=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=function(e,t){return!t||"object"!==by(t)&&"function"!=typeof t?_y(e):t}(this,wy(t).call(this)),sg(_y(e),n,"PoiNode"),hg(_y(e),n),dg(_y(e)),e.create(n),e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ty(e,t)}(t,e),n=t,(r=[{key:"create",value:function(e){var t=e.type;"2D"===t||"2d"===t?this._create2D(e):"3D"!==t&&"3d"!==t||this._create3D(e)}},{key:"_create2D",value:function(e){var t=e.element;this.add(new Ym.CSS2DObject(t)),Bx.rendererManager.setRenderCss2DEnable(!0)}},{key:"_create3D",value:function(e){var t=e.element;this.add(new Ym.CSS3DObject(t)),Bx.rendererManager.setRenderCss3DEnable(!0)}}])&&xy(n.prototype,r),i&&xy(n,i),t}(Ym.Object3D);function My(e){return(My="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ey(e,t){return!t||"object"!==My(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ay(e){return(Ay=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Py(e,t){return(Py=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Oy=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Ey(this,Ay(t).call(this,e,n))).gmlid=null,r.isLink=!0,r.type="Link",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Py(e,t)}(t,e),t}(Ym.Mesh);function Ly(e){return(Ly="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Iy(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Cy(e,t){return!t||"object"!==Ly(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ry(e){return(Ry=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Dy(e,t){return(Dy=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ny=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Cy(this,Ry(t).call(this,e,n))).isNode=!0,r.type="Node",r.gmlid=null,r.floorId=null,r.links=new Map,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Dy(e,t)}(t,e),n=t,(r=[{key:"addLink",value:function(e){if(!this.links.get(e.gmlid)){var n=this.position.distanceTo(e.position),r=new t.Link(e.gmlid,n);return this.links.set(e.gmlid,r),r}}},{key:"updateLink",value:function(e){this.links.forEach((function(t){t.enable=(e&t.restrict)===t.restrict,(0===e&&1!==t.restrict||1!==e&&0===t.restrict)&&(t.enable=!0)}))}},{key:"makeGraph",value:function(){var e=[];e.push(this.gmlid);var t=[];return this.links.forEach((function(e){e.enable&&t.push(e.makeGraph())})),e.push(t),e}}])&&Iy(n.prototype,r),i&&Iy(n,i),t}(Ym.Mesh);function Fy(e){return(Fy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function jy(e){return(jy=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Uy(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function By(e,t){return(By=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Ny.Link=function(e,t){this.targetNodeId=e,this.weight=t,this.enable=!0,this.restrict=0},Ny.Link.prototype.makeGraph=function(){var e=[];return e.push(this.targetNodeId),e.push(this.weight),e};var ky=function(e){function t(e,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){return!t||"object"!==Fy(t)&&"function"!=typeof t?Uy(e):t}(this,jy(t).call(this,e,n)),sg(Uy(r),i,"Topology"),hg(Uy(r),i),dg(Uy(r)),r.restrict=i.restrict,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&By(e,t)}(t,e),t}(Ym.Mesh);function zy(e){return(zy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gy(e){return(Gy=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vy(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Hy(e,t){return(Hy=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Wy=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=function(e,t){return!t||"object"!==zy(t)&&"function"!=typeof t?Vy(e):t}(this,Gy(t).call(this)),sg(Vy(e),n,"Topology"),hg(Vy(e),n),dg(Vy(e)),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Hy(e,t)}(t,e),t}(Ym.Object3D);function Xy(e){return(Xy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yy(e){return(Yy=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qy(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qy(e,t){return(Qy=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Zy=function(e){function t(e,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=function(e,t){return!t||"object"!==Xy(t)&&"function"!=typeof t?qy(e):t}(this,Yy(t).call(this,e,n)),sg(qy(i),r,"Ground"),hg(qy(i),r),dg(qy(i)),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qy(e,t)}(t,e),t}(Ym.Mesh);function Ky(e){return(Ky="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Jy(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $y(e){return($y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function eb(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tb(e,t){return(tb=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var nb=function(e){function t(e,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){return!t||"object"!==Ky(t)&&"function"!=typeof t?eb(e):t}(this,$y(t).call(this,e,n)),sg(eb(r),i,"Transform"),dg(eb(r)),r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tb(e,t)}(t,e),n=t,(r=[{key:"close",value:function(){this.detach(),Bx.signals.objectRemoved.dispatch()}},{key:"changeMode",value:function(e){e&&(this.setMode(e),Bx.signals.objectChanged.dispatch())}}])&&Jy(n.prototype,r),i&&Jy(n,i),t}(Ym.TransformControls);function rb(e){return(rb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ib(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ob(e){return(ob=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ab(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function sb(e,t){return(sb=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ub=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=function(e,t){return!t||"object"!==rb(t)&&"function"!=typeof t?ab(e):t}(this,ob(t).call(this)),sg(ab(e),n,"Model"),hg(ab(e),n),pg(ab(e),n),dg(ab(e)),e.formatType=n.format,e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&sb(e,t)}(t,e),n=t,(r=[{key:"getBoundingBox",value:function(){return nv(this)}},{key:"playAnimation",value:function(e){var t=Km(e);"object"===t&&Bx.mixer.clipAction(e).play(),"number"===t&&Bx.mixer.clipAction(this.animations[e]).play(),"null"!==t&&"undefined"!==t||Bx.mixer.clipAction(this.animations[0]).play(),Bx.mixer.timeScale=1,Bx._addAnimation()}},{key:"stopAnimation",value:function(e){var t=Km(e);"object"===t&&Bx.mixer.uncacheClip(e),"number"===t&&Bx.mixer.uncacheClip(this.animations[e]),"null"!==t&&"undefined"!==t||Bx.mixer.uncacheClip(this.animations[0]),Bx.mixer.timeScale=0,Bx._removeAnimation()}}])&&ib(n.prototype,r),i&&ib(n,i),t}(Ym.Object3D);function cb(e){return(cb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lb(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function hb(e){return(hb=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pb(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fb(e,t){return(fb=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var db=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=function(e,t){return!t||"object"!==cb(t)&&"function"!=typeof t?pb(e):t}(this,hb(t).call(this)),sg(pb(e),n,"Fire"),hg(pb(e),n),dg(pb(e));var r=n.texturePath,i=n.position,o=n.scale,a=n.name;return(new Ym.TextureLoader).load(r,(function(t){e.initFire(t)})),e.position.set(i.x,i.y,i.z),e.scale.set(o.x,o.y,o.z),e.name=a,e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fb(e,t)}(t,e),n=t,(r=[{key:"initFire",value:function(e){return this.fireMaterial=new Ym.ShaderMaterial({uniforms:{tExplosion:{type:"t",value:e},time:{type:"f",value:0}},vertexShader:pv.vertexShader,fragmentShader:pv.fragmentShader,transparent:!1,depthWrite:!0,depthTest:!0}),this.add(new Ym.Mesh(new Ym.IcosahedronGeometry(20,4),this.fireMaterial)),this}},{key:"drawTorusPlane",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{center:{x:0,y:0,z:0},radius:800,planeSize:4e3,torusWidth:200,color:"red",opacity:1},t=e.center,n=e.radius,r=e.planeSize,i=e.color,o=e.opacity,a=e.torusWidth,s=new Ym.Color(i),u={u_color:{value:new Ym.Vector3(s.r,s.g,s.b)},u_r:{value:n/r},u_edge:{value:a/r},u_opcity:{value:o}},c=["varying vec2 vUv;","void main(){","vUv = uv;","\tgl_Position\t= projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),l=["varying vec2 vUv;","uniform vec3 u_color;","uniform float u_r;","uniform float u_edge;","uniform float u_opcity;","float plot(float d, float pct){","return  smoothstep( pct-u_edge, pct, d)- ","smoothstep( pct, pct+u_edge, d);","}","void main(){","float pct = distance(vUv,vec2(0.5));","float t = plot(pct,u_r)*u_opcity;","vec3 color = vec3(t*2.0);","gl_FragColor = vec4(u_color,t);","}"].join("\n"),h=new Ym.PlaneGeometry(n,n),p=new Ym.ShaderMaterial({vertexShader:c,fragmentShader:l,side:Ym.DoubleSide,uniforms:u,transparent:!0,depthWrite:!1}),f=new Ym.Mesh(h,p);return f.position.set(t.x,t.y,t.z),f.rotation.set(Math.PI/2,0,0),f}},{key:"update",value:function(){this.fireMaterial&&(this.fireMaterial.uniforms.time.value+=.0025)}}])&&lb(n.prototype,r),i&&lb(n,i),t}(Ym.Object3D);function mb(e,t,n){return String.fromCharCode.apply(null,new Uint8Array(e,t,n))}var vb={nextHighestPowerOfTwo_:function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1},ensurePowerOfTw:function(e){if(!Ym.Math.isPowerOfTwo(e.width)||!Ym.Math.isPowerOfTwo(e.height)){var t=document.createElement("canvas");return t.width=this.nextHighestPowerOfTwo_(e.width),t.height=this.nextHighestPowerOfTwo_(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),t}return e},load:function(e,t){var n,r=this,i=(new Ym.Loader).manager.getHandler(e);return null!==i?n=i.load(e,t):((n=new Ym.Texture).encoding=Ym.GammaEncoding,(i=new Ym.ImageLoader).crossOrigin="anonymous",i.load(e,(function(e){n.image=r.ensurePowerOfTw(e),n.needsUpdate=!0,t&&t(n)}))),n.sourceFile=e,n}};function gb(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function yb(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var bb={sbk:function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loadedModel=t,this.materials={},this.textures={}}var t,n,r;return t=e,(n=[{key:"load",value:function(e,t){var n=this;return Pg(e.url,{isArraybuffer:!0}).then((function(r){return n.parse(r.response,e,t)}))}},{key:"parse",value:function(e,t,n){var r=performance.now(),i=t.url,o=t.mapsUrl,a={total:0,loaded:0,timeStamp:0},s=new Gg(t),u=[],c=new DataView(e),l=!0,h=0,p=mb(e,h,8);if(h+=8,"SBK-----"!==p)return Promise.reject("This file is not supported by the SDK.");for(var f=[],d=0;d<32;d++){var m=c.getUint8(h,l);h+=1,f[d]=m}var v=c.getUint16(h);if(h+=2,3!==v&&4!==v&&2!==v&&1!==v)return Promise.reject("This is an unsupported version of SBK.");for(var g=[],y=0;y<32;y++){var b=c.getUint8(h,l);h+=1,g[y]=b}for(var x=[],w=0;w<64;w++){var _=c.getUint8(h,l);h+=1,x[w]=_}var T=[];T=(T=(T=T.concat(g)).concat(x)).concat(f);var S=0;for(d=0;d<128;d++)if(d<=7||d>23&&d<=31||d>39&&d<=55||d>63&&d<=87||d>95&&d<=103){if(S>=64)return Promise.reject("This is a wrong file.");u[S]=T[d],S++}e=new Uint8Array(function(e,t){for(var n=e.byteLength-t,r=[],i=0,o=0;o<n;o++){var a=e.getUint8(t,l);t+=1;var s=u[i++];i>=64&&(i=0);var c=a^s;r[o]=c}return r}(c,h)).buffer;var M=new DataView(e);if(h=0,v>2){for(var E=[],A=[],P=[],O=0;O<2;O++){var L=M.getUint8(h,l);h+=1,E[O]=L}for(var I=0;I<32;I++){var C=M.getUint8(h,l);h+=1,A[I]=C}for(var R=0;R<32;R++){var D=M.getUint8(h,l);h+=1,P[R]=D}}if(v>4)return Promise.reject("SBK version is wrong.");v>3&&(M.getUint8(h),h+=1,M.getUint16(h),h+=2,M.getUint16(h),h+=2,M.getUint16(h),h+=2,M.getUint16(h),h+=2);var N=M.getUint16(h,l);h+=2;var F=M.getUint16(h,l);h+=2,a.total=F,v>3&&(M.getUint8(h),h+=1,M.getUint8(h),h+=1);for(var j=0;j<N;++j){var U=v>3?M.getUint32(h,l):M.getUint16(h,l);h+=v>3?4:2,v>3&&(h+=1),M.getFloat32(h,l),h+=4,M.getFloat32(h,l),h+=4,M.getFloat32(h,l),h+=4,M.getFloat32(h,l),h+=4;var B=M.getFloat32(h,l);h+=4;var k=M.getFloat32(h,l);h+=4;var z=M.getFloat32(h,l);h+=4;var G=M.getFloat32(h,l);h+=4,M.getFloat32(h,l),h+=4,M.getFloat32(h,l),h+=4,M.getFloat32(h,l),h+=4,M.getFloat32(h,l),h+=4;var V=M.getUint8(h,l);h+=1;var H=0;0===V?H=Ym.FrontSide:1===V?H=Ym.BackSide:2===V&&(H=Ym.DoubleSide);var W=M.getUint16(h,l);h+=2;var X=null;if(W>0){for(var Y=e.slice(h,h+W),q="",Q="",Z=new Uint8Array(Y,0,W),K=0;K<W;++K)Z[K]>127?Q=Q+"%"+Z[K].toString(16).toUpperCase():(Q.length,q+=String.fromCharCode(Z[K]),Q="");h+=W,q=q.replace("\\","/");var J=null;if(o){if(o.toString().length){var $=q,ee=$.lastIndexOf("/");-1!==ee&&($=$.substr(ee+1,$.length-ee+1)),J=o+$}}else{var te=(J=i).lastIndexOf("/");J=-1!==te?J.substr(0,te+1)+q:q}this.textures[J]?X=this.textures[J]:((X=vb.load(J)).name=q,this.textures[J]=X),X.wrapS=Ym.RepeatWrapping,X.wrapT=Ym.RepeatWrapping,X.flipY=!1}var ne=this.materials[U.toString()];if(null==ne){var re=G<1;(ne=new Ym.MeshPhongMaterial({color:new Ym.Color(B,k,z),opacity:G,transparent:re,map:X,side:H,alphaTest:.5,shininess:50,specular:328965})).name=U.toString(),this.materials[U.toString()]=ne}}for(var ie=0;ie<F;++ie){var oe=String(v>3?M.getUint32(h,l):M.getUint16(h,l));h+=v>3?4:2,v>3&&(M.getUint16(h,l),h+=2,M.getUint16(h,l),h+=2);var ae=v>3?M.getUint32(h,l):M.getUint16(h,l);h+=v>3?4:2;var se=new Ym.Geometry,ue=v>3?M.getUint32(h,l):M.getUint16(h,l);if(h+=v>3?4:2,v>3&&(M.getUint8(h,l),h+=1),ue>0)for(var ce=0;ce<ue;++ce){var le=new Ym.Vector3;le.x=M.getFloat32(h,l),h+=4,le.y=M.getFloat32(h,l),h+=4,le.z=M.getFloat32(h,l),h+=4,se.vertices.push(le)}var he=v>3?M.getUint32(h,l):M.getUint16(h,l);if(h+=v>3?4:2,v>3&&(M.getUint8(h,l),h+=1),he>0)for(var pe=0;pe<he;++pe){var fe=new Ym.Vector3;fe.x=M.getFloat32(h,l),h+=4,fe.y=M.getFloat32(h,l),h+=4,fe.z=M.getFloat32(h,l),h+=4}var de=v>3?M.getUint32(h,l):M.getUint16(h,l);h+=v>3?4:2,v>3&&(M.getUint8(h,l),h+=1);var me=new Array(de);if(de>0)for(var ve=0;ve<de;++ve){var ge=new Ym.Vector2;ge.x=M.getFloat32(h,l),h+=4,ge.y=M.getFloat32(h,l),h+=4,me[ve]=ge}var ye=v>3?M.getUint32(h,l):M.getUint16(h,l);if(h+=v>3?4:2,v>3&&(M.getUint8(h,l),h+=1,M.getUint8(h,l),h+=1),ye>0)for(var be=0;be<ye;++be){var xe=new Ym.Face3;xe.a=v>3?M.getUint32(h,l):M.getUint16(h,l),h+=v>3?4:2,xe.b=v>3?M.getUint32(h,l):M.getUint16(h,l),h+=v>3?4:2,xe.c=v>3?M.getUint32(h,l):M.getUint16(h,l),h+=v>3?4:2,se.faces.push(xe),me.length>0&&se.faceVertexUvs[0].push([me[xe.a],me[xe.b],me[xe.c]])}se.computeBoundingSphere(),se.computeBoundingBox(),se.computeVertexNormals(!0),se.computeFaceNormals();var we=se;if((we=new Ym.BufferGeometry).fromGeometry(se),we.boundingBox=se.boundingBox.clone(),this.materials[ae.toString()]){var _e=new qg(we,this.materials[ae.toString()],{id:oe});s.add(_e)}a.loaded++,a.timeStamp=performance.now()-r,n&&n(a)}return Promise.resolve(s)}}])&&gb(t.prototype,n),r&&gb(t,r),e}(),sbm:function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loadedModel=t,this.materials={},this.textures={},this.worker}var t,n,r;return t=e,(n=[{key:"load",value:function(e,t){var n=this;return Pg(e.url,{isArraybuffer:!0}).then((function(r){return n.parse(r.response,e,t)}))}},{key:"parse",value:function(e,t,n){var r=performance.now(),i={total:0,loaded:0,timeStamp:0},o=new Gg(t);o.userData.textures=[],o.userData.materials=[],t.useBufferGeometry=!0;var a=new DataView(e),s=0,u=mb(e,s,8);if(s+=8,"SBM-----"!==u)return Promise.reject("it's not sbm file.");var c=a.getUint8(s);if(s+=1,c>4)return Promise.reject("sbm version is wrong.");c>3&&(a.getUint8(s),s+=1,a.getUint16(s),s+=2,a.getUint16(s),s+=2,a.getUint16(s),s+=2,a.getUint16(s),s+=2);var l=a.getUint16(s,!0);s+=2;var h=a.getUint16(s,!0);s+=2,i.total=h,c>3&&(a.getUint8(s),s+=1,a.getUint8(s),s+=1);for(var p=0;p<l;++p){var f=c>3?a.getUint32(s,!0):a.getUint16(s,!0);s+=c>3?4:2,c>3&&(a.getUint8(s),s+=1),a.getFloat32(s,!0),s+=4,a.getFloat32(s,!0),s+=4,a.getFloat32(s,!0),s+=4,a.getFloat32(s,!0),s+=4;var d=a.getFloat32(s,!0);s+=4;var m=a.getFloat32(s,!0);s+=4;var v=a.getFloat32(s,!0);s+=4;var g=a.getFloat32(s,!0);this.d3=g,s+=4,a.getFloat32(s,!0),s+=4,a.getFloat32(s,!0),s+=4,a.getFloat32(s,!0),s+=4,a.getFloat32(s,!0),s+=4;var y=a.getUint8(s,!0);s+=1;var b=0;0===y?b=Ym.FrontSide:1===y?b=Ym.BackSide:2===y&&(b=Ym.DoubleSide);var x=a.getUint16(s,!0);s+=2;var w=null;if(x>0){for(var _=e.slice(s,s+x),T="",S="",M=new Uint8Array(_,0,x),E=0;E<x;++E)M[E]>127?S=S+"%"+M[E].toString(16).toUpperCase():(T+=String.fromCharCode(M[E]),S="");s+=x,T=T.replace("\\","/");var A=null;if(t.mapsUrl){if(t.mapsUrl.toString().length){var P=T,O=P.lastIndexOf("/");-1!==O&&(P=P.substr(O+1,P.length-O+1)),A=t.mapsUrl+P}}else{var L=T.lastIndexOf("/");-1!==L&&(T="Maps/"+T.substr(L+1));var I=(A=t.url).lastIndexOf("/");A=-1!==I?A.substr(0,I+1)+T:T}this.textures[A]?w=this.textures[A]:((w=vb.load(A)).name=T,this.textures[A]=w,o.userData.textures.push(A)),w.wrapS=Ym.RepeatWrapping,w.wrapT=Ym.RepeatWrapping,w.flipY=!1,t.anisotropy&&(w.anisotropy=t.anisotropy)}var C=this.materials[f.toString()];if(null==C){var R=g<1;(C=new Ym.MeshPhongMaterial({color:new Ym.Color(d,m,v),opacity:g,transparent:R,map:w,side:b,alphaTest:R?.01:.5,shininess:50,specular:328965})).name=f.toString(),this.materials[f.toString()]=C,o.userData.materials.push(C.uuid)}}for(var D=0;D<h;++D){var N=String(c>3?a.getUint32(s,!0):a.getUint16(s,!0));if(s+=c>3?4:2,c>2){var F=a.getUint16(s,!0);if(s+=2,F>0){var j=e.slice(s,s+F);S="";for(var U=new Uint8Array(j,0,F),B=0;B<F;++B)U[B]>127?S=S+"%"+U[B].toString(16).toUpperCase():(S.length&&decodeURIComponent(S),String.fromCharCode(U[B]),S="");s+=F}}c>3&&(a.getUint16(s,!0),s+=2,a.getUint16(s,!0),s+=2);var k=c>3?a.getUint32(s,!0):a.getUint16(s,!0);s+=c>3?4:2;var z=new Ym.Geometry,G=c>2?a.getUint32(s,!0):a.getUint16(s,!0);if(s+=c>2?4:2,c>3&&(a.getUint8(s,!0),s+=1),G>0)for(var V=0;V<G;++V){var H=new Ym.Vector3;H.x=a.getFloat32(s,!0),s+=4,H.y=a.getFloat32(s,!0),s+=4,H.z=a.getFloat32(s,!0),s+=4,"number"==typeof t.scale&&H.multiplyScalar(t.scale),z.vertices.push(H)}var W=c>2?a.getUint32(s,!0):a.getUint16(s,!0);if(s+=c>2?4:2,c>3&&(a.getUint8(s,!0),s+=1),W>0)for(var X=0;X<W;++X){var Y=new Ym.Vector3;Y.x=a.getFloat32(s,!0),s+=4,Y.y=a.getFloat32(s,!0),s+=4,Y.z=a.getFloat32(s,!0),s+=4}var q=c>2?a.getUint32(s,!0):a.getUint16(s,!0);s+=c>2?4:2,c>3&&(a.getUint8(s,!0),s+=1);var Q=new Array(q);if(q>0)for(var Z=0;Z<q;++Z){var K=new Ym.Vector2;K.x=a.getFloat32(s,!0),s+=4,K.y=a.getFloat32(s,!0),s+=4,Q[Z]=K}var J=c>2?a.getUint32(s,!0):a.getUint16(s,!0);if(s+=c>2?4:2,c>3&&(a.getUint8(s,!0),s+=1,a.getUint8(s,!0),s+=1),J>0)for(var $=0;$<J;++$){var ee=new Ym.Face3;ee.a=c>2?a.getUint32(s,!0):a.getUint16(s,!0),s+=c>2?4:2,ee.b=c>2?a.getUint32(s,!0):a.getUint16(s,!0),s+=c>2?4:2,ee.c=c>2?a.getUint32(s,!0):a.getUint16(s,!0),s+=c>2?4:2,z.faces.push(ee),Q.length>0&&z.faceVertexUvs[0].push([Q[ee.a],Q[ee.b],Q[ee.c]])}z.computeBoundingSphere(),z.computeBoundingBox(),z.computeVertexNormals(!0),z.computeFaceNormals();var te=z;if(t.useBufferGeometry&&((te=new Ym.BufferGeometry).fromGeometry(z),te.boundingBox=z.boundingBox.clone()),this.materials[k.toString()]){var ne=new qg(te,this.materials[k.toString()],{id:N});o.add(ne)}i.loaded++,i.timeStamp=performance.now()-r,n&&n(i)}return Promise.resolve(o)}},{key:"parseWorker",value:function(e,t,n){var r=this,i=new Ym.Object3D;i.userData.filesource=t.url,i.userData.id=t.id,i.userData.materials=[],i.userData.textures=[],null!=t.baseFloor&&(i.userData.baseFloor=t.baseFloor),i.name=t.name;var o=new Worker(this.worker);o.onmessage=function(e){if("progress"===e.data.msg)n&&n(e.data.val);else{if("finish"===e.data.msg)return o.terminate(),Promise.resolve(i);if("debug"===e.data.msg);else if("material"===e.data.msg){var a=r.getTexture(e.data.texture.mapsUrl,e.data.texture.textureName,t.anisotropy,i),s=r.materials[e.data.material.id];null==s&&(s=r.createMaterial(e.data.material,a,i))}else if("mesh"===e.data.msg){for(var u=new Ym.Geometry,c=e.data.geom.vertices,l=0;l<c.length;++l){var h=new Ym.Vector3(c[l][0],c[l][1],c[l][2]);"number"==typeof t.scale&&h.multiplyScalar(t.scale),u.vertices.push(h)}for(var p=e.data.geom.texcoords,f=e.data.geom.indices,d=0;d<f.length;++d){var m=new Ym.Face3;m.a=f[d][0],m.b=f[d][1],m.c=f[d][2],u.faces.push(m),p.length>0&&u.faceVertexUvs[0].push([new Ym.Vector2(p[m.a][0],p[m.a][1]),new Ym.Vector2(p[m.b][0],p[m.b][1]),new Ym.Vector2(p[m.c][0],p[m.c][1])])}u.computeBoundingSphere(),u.computeBoundingBox(),u.computeVertexNormals(!0),u.computeFaceNormals(),u.mergeVertices();var v=u;t.useBufferGeometry&&((v=new Ym.BufferGeometry).fromGeometry(u),v.boundingBox=u.boundingBox.clone());var g=e.data.mat_id,y=e.data.id;if(r.materials[g.toString()]){var b=new qg(v,r.materials[g.toString()],{id:y});i.add(b)}}}};var a={progress:{total:0,loaded:0},sbmInfo:t,data:e};o.postMessage(a)}},{key:"getTexture",value:function(e,t,n,r){var i;return null!=e&&null==(i=this.textures[e])&&((i=vb.load(e)).name=t,this.textures[e]=i,r.userData.textures.push(e),i.wrapS=Ym.RepeatWrapping,i.wrapT=Ym.RepeatWrapping,i.flipY=!1,n&&(i.anisotropy=n)),i}},{key:"createMaterial",value:function(e,t,n){var r=Ym.FrontSide;if(1===e.side?r=Ym.BackSide:2===e.side&&(r=Ym.DoubleSide),t.sourceFile){var i=this.d3<1;new Ym.MeshPhongMaterial({color:new Ym.Color(e.d[0],e.d[1],e.d[2]),opacity:e.opacity,transparent:i,map:t,side:r,alphaTest:.5,shininess:50,specular:328965})}else{var o=this.d3<1;new Ym.MeshPhongMaterial({color:new Ym.Color(e.d[0],e.d[1],e.d[2]),opacity:e.opacity,transparent:o,side:r,alphaTest:.5,shininess:50,specular:328965})}var a={};return a.name=e.id.toString(),this.materials[a.name]=a,n.userData.materials.push(a.uuid),a}}])&&yb(t.prototype,n),r&&yb(t,r),e}()}.sbm;function xb(e,t,n){return(xb=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&wb(i,n.prototype),i}).apply(null,arguments)}function wb(e,t){return(wb=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _b(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Tb(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Sb(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Mb=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.textures=[],this.materials=[],this.geometries=[]}var t,n,r;return t=e,(n=[{key:"load",value:function(e,t){var n=this;return new Promise((function(r,i){Pg(t).then((function(e){return Lg(e.response)})).then((function(i){var o=n._parseSbmInfo(i,t),a=i.Project.ProjectInfo[0];e.userData=Object.assign({gkxmlVersion:a.$.gkxmlVersion},e.userData),e=Object.assign({name:a.Title[0]},e);var s=new Fg(e),u=new Ym.Box3(new Ym.Vector3(0,0,0),new Ym.Vector3(0,0,0));o.map(function(){var e,t=(e=regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(new bb).load(t.sbmInfo).then((function(e){var n=t.userData.boundingBox;e.userData.boundingBox=n,u.union(n),s.add(e),s.children.length===o.length&&(s.userData.boundingBox=u,r(s))}));case 1:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Tb(o,r,i,a,s,"next",e)}function s(e){Tb(o,r,i,a,s,"throw",e)}a(void 0)}))});return function(e){return t.apply(this,arguments)}}())})).catch((function(e){return i(e)}))}))}},{key:"_parseSbmInfo",value:function(e,t){var n=[],r=e.Project.Building[0].Floors[0].Floor.length;return e.Project.Building[0].Floors[0].Floor.map((function(i,o){var a=i.$,s=a.id,u=a.name,c=a.baseFloor,l=i.FileSource[0].$.name,h=l.lastIndexOf("\\");-1!==h&&(l=l.substr(h+1));var p="";-1!==(h=t.lastIndexOf("/"))&&(p=t.substr(0,h+1));var f={id:s,name:u,baseFloor:c,url:p+l,useBufferGeometry:!0,currentSBMs:o+1,totalSBMs:r},d=i.BoundingBox[0].$,m=d.minimum.split(", ").map((function(e){return Number(e)})),v=d.maximum.split(", ").map((function(e){return Number(e)})),g=e.Project.Building[0].ObjectHierarchy[0].Entity[o].$.longname,y={boundingBox:{min:xb(Ym.Vector3,_b(m)),max:xb(Ym.Vector3,_b(v))},id:s,name:u,longname:g};n.push({sbmInfo:f,userData:y})})),n}}])&&Sb(t.prototype,n),r&&Sb(t,r),e}(),Eb="sspindexeddb",Ab=1,Pb="sbmData";function Ob(e,t){return e.transaction(Pb,t).objectStore(Pb)}function Lb(e){return(Lb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ib(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Cb(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Ib(o,r,i,a,s,"next",e)}function s(e){Ib(o,r,i,a,s,"throw",e)}a(void 0)}))}}function Rb(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Db(e,t){return!t||"object"!==Lb(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Nb(e){return(Nb=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Fb(e,t){return(Fb=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var jb=function(e){function t(){var e,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Db(this,(e=Nb(t)).call.apply(e,[this].concat(Array.prototype.slice.call(arguments),["Sbm"])))).db=null,n.blobData=new Map,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fb(e,t)}(t,e),n=t,(r=[{key:"clone",value:function(e,t,n){var r=this;return new Promise((function(i,o){e.isSbm||o('model type not is "sbm"!');var a=t.id,s=t.name,u=t.level,c=t.position,l=t.rotation,h=t.scale,p=t.onClick,f=t.onDblClick,d=t.onRightClick,m=t.onLoad,v=t.userData,g=e.clone();a&&(g.sid=a),s&&(g.name=s),u&&(g.level=u),c&&g.position.set(c.x,c.y,c.z),l&&g.rotation.set(l.x,l.y,l.z),h&&g.scale.set(h.x,h.y,h.z),p&&(g.onClick=p.bind(g)),f&&(g.onDblClick=f.bind(g)),d&&(g.onRightClick=d.bind(g)),m&&(g.onLoad=m.bind(g),m()),v&&(g.userData=v),Bx.scener.importObject(g,n||e.parent||r.scene),i(g)}))}},{key:"load",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.scene;return new Promise((function(i,o){var a=0,s=0,u=Bx.option.useIndexedDB,c=Km(e);if("object"===c){a=1,s=1;var l=e.url;n.blobData.has(l)?n._parseItem(n.blobData.get(l),e,(function(e){return t&&t({modelTotal:a,loadingModelIndex:s,current:e})}),r).then((function(e){return i(e)})).catch((function(e){return o(e)})):u?n._getBlobData(l).then((function(i){return n.blobData.set(l,i),n._parseItem(i,e,(function(e){return t&&t({modelTotal:a,loadingModelIndex:s,current:e})}),r)})).then((function(e){return i(e)})).catch((function(e){return o(e)})):Pg(l,{isArraybuffer:!0}).then((function(i){return n.blobData.set(l,i.response),n._parseItem(i.response,e,(function(e){return t&&t({modelTotal:a,loadingModelIndex:s,current:e})}),r)})).then((function(e){return i(e)})).catch((function(e){return o(e)}))}else"array"===c&&function(){a=e.length;for(var c=[],l=function(l){var h=e[l].url;n.blobData.has(h)?n._parseItem(n.blobData.get(h),e[l],(function(e){return t&&t({modelTotal:a,loadingModelIndex:s,current:e})}),r).then((function(e){s=l+1,c.push(e),l+1===a&&i(c)})).catch((function(e){return o(e)})):u?n._getBlobData(h).then((function(i){return n.blobData.set(h,i),n._parseItem(i,e[l],(function(e){return t&&t({modelTotal:a,loadingModelIndex:s,current:e})}),r)})).then((function(e){s=l+1,c.push(e),l+1===a&&i(c)})).catch((function(e){return o(e)})):Pg(h,{isArraybuffer:!0}).then((function(i){return n._parseItem(i.response,e[l],(function(e){return t&&t({modelTotal:a,loadingModelIndex:s,current:e})}),r)})).then((function(e){s=l+1,c.push(e),l+1===a&&i(c)})).catch((function(e){return o(e)}))},h=0;h<e.length;h++)l(h)}()}))}},{key:"parse",value:function(e,t){return(new bb).parse(e.data,e,t).then(function(){var e=Cb(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Bx.scener.importObject(t);case 2:return e.next=4,Promise.resolve(t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"loadToGroup",value:function(e,t,n){var r=new Fg(e);return Bx.scener.importObject(r,this.scene),this.load(t,n,r).then((function(){return Promise.resolve(r)})).catch((function(e){return Promise.reject(e)}))}},{key:"addForGroup",value:function(e,t,n){var r=this.getGroupById(e);return r?this.load(t,n,r).then((function(){return Promise.resolve(r)})).catch((function(e){return Promise.reject(e)})):Promise.reject('In addSbmForGroup: not find group about id is "'.concat(e,'"'))}},{key:"loadXml",value:function(e,t){var n=this;return new Promise((function(r,i){(new Mb).load(e,t).then(function(){var e=Cb(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Bx.scener.importObject(t,n.scene);case 2:return e.next=4,r(t);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){return i(e)}))}))}},{key:"_parseItem",value:function(e,t,n,r){return(new bb).parse(e,t,n).then(function(){var e=Cb(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Bx.scener.importObject(t,r);case 2:return e.next=4,t.onLoad;case 4:if(e.t0=e.sent,!e.t0){e.next=7;break}t.onLoad(t);case 7:return e.next=9,Promise.resolve(t);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"_getBlobData",value:function(e){var t=this;return new Promise((function(n){var r=function(t){var r=Ob(t,"readonly");!function(e,t,n){t.get(e).onsuccess=function(e){var t=e.target.result;n(t)}}(e,r,(function(r){r&&r.data?n(r.data):Pg(e,{isArraybuffer:!0}).then((function(r){Ob(t,"readwrite").add({url:e,data:r.response}),n(r.response)}))}))};t.db?r(t.db):new Promise((function(e,t){var n=indexedDB.open(Eb,Ab);n.onsuccess=function(){this.result,e(this.result)},n.onerror=function(e){t(e.target.errorCode)},n.onupgradeneeded=function(e){e.currentTarget.result.createObjectStore(Pb,{keyPath:"url",autoIncrement:!0}).createIndex("url","url",{unique:!0})}})).then((function(e){t.db=e,r(e)}))}))}}])&&Rb(n.prototype,r),i&&Rb(n,i),t}(wg);function Ub(e){return(Ub="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bb(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function kb(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Bb(o,r,i,a,s,"next",e)}function s(e){Bb(o,r,i,a,s,"throw",e)}a(void 0)}))}}function zb(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gb(e,t){return!t||"object"!==Ub(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Vb(e){return(Vb=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Hb(e,t){return(Hb=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Wb=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Gb(this,(e=Vb(t)).call.apply(e,[this].concat(Array.prototype.slice.call(arguments),["Model"])))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Hb(e,t)}(t,e),n=t,(r=[{key:"load",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scene,r=Km(e);if("object"===r)return this._loadItem(e,n);if("array"===r){var i=[];return e.map((function(e){return i.push(t._loadItem(e,n))})),Promise.all(i)}}},{key:"loadToGroup",value:function(e,t){var n=new Fg(e);return Bx.scener.importObject(n,this.scene),this.load(t,n).then((function(){return Promise.resolve(n)})).catch((function(e){return Promise.reject(e)}))}},{key:"addForGroup",value:function(e,t){var n=this.getGroupById(e);return n?(Bx.scener.importObject(n,this.scene),this.load(t,n).then((function(){return Promise.resolve(n)})).catch((function(e){return Promise.reject(e)}))):Promise.reject('In addModelForGroup: not find group about id is "'.concat(e,'"'))}},{key:"parse",value:function(e){var t=null;if("object"===Km(e))switch(e.format.toLocaleUpperCase()){case"JSON":t=this._parseJSON(e)}return t}},{key:"_loadItem",value:function(e,t){return new Promise((function(n,r){var i=e.url;i||r('Missing necessary parameter "modelInfo.url" when loading model'),"string"!=typeof i&&r('Parameter "modelInfo.url" type error when loading model');var o=i.slice(i.lastIndexOf(".")+1);e.format=o;var a=new ub(e),s=null;switch(o.toLocaleUpperCase()){case"JSON":s=Ym.ObjectLoader;break;case"FBX":s=Ym.FBXLoader;break;case"GLTF":case"GLB":s=Ym.GLTFLoader}s?(new s).load(e.url,function(){var e=kb(regeneratorRuntime.mark((function e(r){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=r.animations)&&i.length>0&&(a.animations=i,delete r.animations),("GLTF"===o.toLocaleUpperCase()||"GLB"===o.toLocaleUpperCase()&&!r.isScene)&&(r=r.scene),e.next=5,r.traverse;case 5:if(e.t0=e.sent,!e.t0){e.next=8;break}r.traverse((function(e){"AmbientLight"!==e.type&&"DirectionalLight"!==e.type||(e.visible=!1)}));case 8:return e.next=10,a.add(r);case 10:return e.next=12,Bx.scener.importObject(a,t);case 12:return e.next=14,n(a);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()):r("Model file type error while loading model")}))}},{key:"_parseJSON",value:function(e){var t=this;return new Promise(function(){var n=kb(regeneratorRuntime.mark((function n(r){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:(new Ym.ObjectLoader).parse(e.json,function(){var n=kb(regeneratorRuntime.mark((function n(i){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=new ub(e),i.traverse((function(e){"AmbientLight"!==e.type&&"DirectionalLight"!==e.type||(e.visible=!1)})),n.next=4,o.add(i);case 4:return n.next=6,Bx.scener.importObject(o,t.scene);case 6:return n.next=8,r(o);case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}());case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}}])&&zb(n.prototype,r),i&&zb(n,i),t}(wg);function Xb(e){return(Xb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yb(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qb(e,t){return!t||"object"!==Xb(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Qb(e){return(Qb=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Zb(e,t){return(Zb=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Kb=function(e){function t(){var e,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=qb(this,(e=Qb(t)).call.apply(e,[this].concat(Array.prototype.slice.call(arguments),["Poi"])))).materials=new Map,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zb(e,t)}(t,e),n=t,(r=[{key:"create",value:function(e){var t=this._createItem(e);return Bx.scener.importObject(t,this.scene),t}},{key:"createToGroup",value:function(e,t){var n=this,r=new Fg(e);switch(Km(t)){case"object":this._addChildForGroup(r,t);break;case"array":t.map((function(e){n._addChildForGroup(r,e)}))}return Bx.scener.importObject(r,this.scene),r}},{key:"addForGroup",value:function(e,t){var n=this,r=this._getChildByTypeAndProp("Group","sid",e);if(r)switch(Km(t)){case"object":this._addChildForGroup(r,t);break;case"array":t.map((function(e){n._addChildForGroup(r,e)}))}return r}},{key:"_addMaterial",value:function(e){if(!e)return console.error("addMaterial method missing param: option");if(!e.textureUrl)return console.error("addMaterial method missing param: option.textureUrl");var t=e.textureUrl,n=e.color,r=void 0===n?16777215:n,i=e.fog,o=void 0===i||i;if(this.materials.has(t))return this.materials.get(t);var a=(new Ym.TextureLoader).load(t),s=new Ym.SpriteMaterial({map:a,color:r,fog:o});return this.materials.set(t,s),s}},{key:"_createItem",value:function(e){if(!e)return console.error("_createItem method missing param");if(!e.iconUrl)return console.error("_createItem method missing param.iconUrl");var t={textureUrl:e.iconUrl,color:e.color,fog:e.fog},n=this._addMaterial(t);return new yy(Object.assign(e,{material:n}))}},{key:"_addChildForGroup",value:function(e,t){var n=this._createItem(t);Bx.scener.importObject(n,e)}}])&&Yb(n.prototype,r),i&&Yb(n,i),t}(wg);function Jb(e){return(Jb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ex(e,t){return!t||"object"!==Jb(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function tx(e){return(tx=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function nx(e,t){return(nx=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var rx=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ex(this,(e=tx(t)).call.apply(e,[this].concat(Array.prototype.slice.call(arguments),["PoiNode"])))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nx(e,t)}(t,e),n=t,(r=[{key:"create",value:function(e){var t=new Sy(e);return Bx.scener.importObject(t,this.scene),t}},{key:"createToGroup",value:function(e,t){var n=this,r=new Fg(e);switch(Km(t)){case"object":this._addChildForGroup(r,t);break;case"array":t.map((function(e){n._addChildForGroup(r,e)}))}return Bx.scener.importObject(r,this.scene),r}},{key:"addForGroup",value:function(e,t){var n=this,r=this.getGroupById(e);if(r)switch(Km(t)){case"object":this._addChildForGroup(r,t);break;case"array":t.map((function(e){n._addChildForGroup(r,e)}))}return r}},{key:"_addChildForGroup",value:function(e,t){var n=new Sy(t);return Bx.scener.importObject(n,e),e}},{key:"_removeAllChildOfGroup",value:function(e){e.children.length>0&&e.children.map((function(t){e.remove(t)}))}}])&&$b(n.prototype,r),i&&$b(n,i),t}(wg);function ix(e){return(ix="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ox(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ax(e,t){return!t||"object"!==ix(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function sx(e){return(sx=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ux(e,t){return(ux=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var cx=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ax(this,(e=sx(t)).call.apply(e,[this].concat(Array.prototype.slice.call(arguments),["Painter"])))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ux(e,t)}(t,e),n=t,(r=[{key:"drawPoints",value:function(e){var t=this;return new Promise((function(n){Bx._setMouseUpEnabled(!0),Bx.signals.mouseUp.addOnce((function(r){if(r.length>0){var i={points:null,painter:null};i.points=e.points=[r[0].point],i.painter=t.renderPoints(e),Bx._setMouseUpEnabled(!1),n(i)}}))}))}},{key:"drawLine",value:function(e){return this._draw("line",e)}},{key:"drawFace",value:function(e){return this._draw("face",e)}},{key:"drawFence",value:function(e){var t=this;return new Promise((function(n){var r=e.id,i=null,o=[];e.points=o,e.offsetY=0,Bx._setStateProp("clickEnabled",!0),Bx._setStateProp("dblClickEnabled",!0),Bx._setStateProp("rightClickEnabled",!0);var a=function(n){var a=n.intersects;a.length>0&&(o.push(a[0].point),t.removeGroupById(r),i=t.renderFence(e)),o.length>0&&!Bx.state.mouseMoveEnabled&&Bx._setStateProp("mouseMoveEnabled",!0)},s=function(n){n.length>0&&(t.removeGroupById(r),i=t.renderFence(Object.assign(e,{points:[].concat(o,[n[0].point])})))},u=function(){o.pop(),t.removeGroupById(r),i=t.renderFence(e)};Bx.signals.click.add(a),Bx.signals.mouseMove.add(s),Bx.signals.rightClick.add(u),Bx.signals.dblClick.add((function c(l){var h=l.intersects;h.length>0&&(o.push(h[0].point),t.removeGroupById(r),i=t.renderFence(e),Bx._setStateProp("clickEnabled",!1),Bx._setStateProp("dblClickEnabled",!1),Bx._setStateProp("rightClickEnabled",!1),Bx._setStateProp("mouseMoveEnabled",!1),Bx.signals.click.remove(a),Bx.signals.mouseMove.remove(s),Bx.signals.rightClick.remove(u),Bx.signals.dblClick.remove(c),n({points:o,fence:i}))}))}))}},{key:"renderPoints",value:function(e){var t=new hy(e);return t.draw("Point"),Bx.scener.importObject(t,this.scene),t}},{key:"renderLine",value:function(e){var t=new hy(e);return t.draw("Line"),Bx.scener.importObject(t,this.scene),t}},{key:"renderFace",value:function(e){var t=new hy(e);return t.draw("Face"),Bx.scener.importObject(t,this.scene),t}},{key:"renderFence",value:function(e){for(var t=e.height,n=void 0===t?200:t,r=new Fg({id:e.id}),i=0;i<e.points.length;i++){var o=i+1;i===e.points.length-1&&(o=0);var a=[{x:e.points[i].x,y:e.points[i].y,z:e.points[i].z},{x:e.points[o].x,y:e.points[o].y,z:e.points[o].z},{x:e.points[o].x,y:e.points[o].y+n,z:e.points[o].z},{x:e.points[i].x,y:e.points[i].y+n,z:e.points[i].z}],s=new hy({points:a,id:i,color:e.color});s.draw("Face"),r.add(s)}return Bx.scener.importObject(r,this.scene),r}},{key:"_draw",value:function(e,t){var n=this;return new Promise((function(r){var i=e.slice(0,1).toUpperCase()+e.slice(1),o=[];t.points=o;var a=n["render".concat(i)](t);Bx._setStateProp("clickEnabled",!0),Bx._setStateProp("dblClickEnabled",!0),Bx._setStateProp("rightClickEnabled",!0);var s=function(n){var r=n.intersects;if(r.length>0&&(o.push(r[0].point),a.updatePoints(o),t.onSelectPoint)){var i={points:o};"line"===e?i.line=a:"face"===e&&(i.face=a),t.onSelectPoint(i)}o.length>0&&!Bx.state.mouseMoveEnabled&&Bx._setStateProp("mouseMoveEnabled",!0)},u=function(n){if(n.length>0){var r=[].concat(o,[n[0].point]);if(a.updatePoints(r),t.onMoving){var i={points:r};"line"===e?i.line=a:"face"===e&&(i.face=a),t.onMoving(i)}}},c=function(){if(o.pop(),a.updatePoints(o),t.onSelectPoint){var n={points:o};"line"===e?n.line=a:"face"===e&&(n.face=a),t.onSelectPoint(n)}};Bx.signals.click.add(s),Bx.signals.mouseMove.add(u),Bx.signals.rightClick.add(c),Bx.signals.dblClick.add((function n(i){var l=i.intersects;if(l.length>0){o.push(l[0].point),a.updatePoints(o),Bx._setStateProp("clickEnabled",!1),Bx._setStateProp("dblClickEnabled",!1),Bx._setStateProp("rightClickEnabled",!1),Bx._setStateProp("mouseMoveEnabled",!1),Bx.signals.click.remove(s),Bx.signals.mouseMove.remove(u),Bx.signals.rightClick.remove(c),Bx.signals.dblClick.remove(n);var h={points:o};"line"===e?h.line=a:"face"===e&&(h.face=a),t.onSelectPoint&&t.onSelectPoint(h),r(h)}}))}))}}])&&ox(n.prototype,r),i&&ox(n,i),t}(wg);function lx(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var hx=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.manager=t}var t,n,r;return t=e,(n=[{key:"load",value:function(e,t,n){var r=this;return Pg(t).then((function(e){var n=e.responseXML,r=e.responseText;if(n)return Promise.resolve(n);if(r){var i=(new DOMParser).parseFromString(r,"application/xml");return Promise.resolve(i)}return Promise.reject('ColladaLoader : Empty or non-existing file: "'.concat(t,'" '))})).then((function(t){return r.parse(e,t,n)})).catch((function(e){return Promise.reject(e)}))}},{key:"parse",value:function(e,t){var n=this,r=!1,i=new Fg(e),o=function(e){if(e.children)for(var t=e.children,i=0;i<t.length;++i){var o=t[i];"zcoord"===o.tagName?"true"===o.getElementsByTagName("apply_floorheight")[0].firstChild.nodeValue&&(r=!0):o.tagName}else for(var a=e.firstElementChild;a;){if("zcoord"===a.tagName)"true"===a.getElementsByTagName("apply_floorheight")[0].firstChild.nodeValue&&(r=!0);else if("restrict"===a.tagName){var s=a.getElementsByTagName("restrict_bit");n.manager.restrict_bit=parseInt(s[0].firstChild.nodeValue)}a=a.nextElementSibling}},a=function(e){for(var t=function e(t,n,r){if(0===t.children.length)return n;for(var i=t.children,o=0,a=i.length;o<a;o++)i[o].tagName===r?n.push(i[o]):e(i[o],n,r)},o=e.getElementsByTagName("X_floor"),a=0;a<o.length;++a){var s=o[a],u=s.getAttribute("id"),c=parseInt(s.getAttribute("number")),l=parseInt(s.getAttribute("level")),h=new Wy({id:u,userData:{baseFloor:c,level:l,id:u}}),p="gml:Node",f=s.getElementsByTagName(p);0===f.length&&t(s,f=[],"gml:Node");var d=new Ym.SphereGeometry(10,32,32);d.computeBoundingBox();var m=new Ym.BufferGeometry;m.fromGeometry(d),m.boundingBox=d.boundingBox.clone();for(var v=new Ym.MeshBasicMaterial({color:255,wireframe:!1}),g=0;g<f.length;++g){var y=new Ny(m,v),b=f[g];y.gmlid=b.getAttribute("gml:id"),y.userData.id=b.getAttribute("gml:id");var x=b.getElementsByTagName("type");y.userData.type=parseInt(x[0].firstChild.nodeValue),/Trident/i.test(navigator.userAgent)?(y.position.x=parseInt(b.getElementsByTagName("xcoord")[0].firstChild.wholeText),y.position.z=-1*parseInt(b.getElementsByTagName("ycoord")[0].firstChild.wholeText),y.position.y=parseInt(b.getElementsByTagName("zcoord")[0].firstChild.wholeText)+5):(y.position.x=parseInt(b.getElementsByTagName("xcoord")[0].firstChild.nodeValue),y.position.z=-1*parseInt(b.getElementsByTagName("ycoord")[0].firstChild.nodeValue),y.position.y=parseInt(b.getElementsByTagName("zcoord")[0].firstChild.nodeValue)+5),!1===r&&(y.position.z+=l),h.add(y)}i.add(h)}for(var w=0;w<o.length;++w)for(var _=i.children[w],T=o[w].getElementsByTagName("Transition"),S=0;S<T.length;++S){var M=T[S],E=M.getAttribute("gml:id");p="gml:directedNode";var A,P,O=M.getElementsByTagName(p);if(0===O.length&&t(M,O=[],"gml:directedNode"),2===O.length){A=O[0].getAttribute("xlink:href"),P=O[1].getAttribute("xlink:href");var L,I=M.getElementsByTagName("restrict"),C=parseInt(I[0].firstChild.nodeValue),R=M.getElementsByTagName("link_name");R[0].firstChild&&(L=R[0].firstChild.nodeValue);var D=M.getElementsByTagName("Width"),N=0;D.length>0&&D[0].firstChild&&(N=parseInt(D[0].firstChild.nodeValue)),n.manager.setLink(i,A,P,C);var F={available:new Ym.MeshBasicMaterial({color:65280,wireframe:!1}),impossibility:new Ym.MeshBasicMaterial({color:16711680,wireframe:!1})},j={gmlid:E,source:A,target:P,radius:5,thickness:N,material:1===C?F.impossibility:F.available,name:L,restrict:C},U=n.manager.makeLink(i,j);_.add(U)}}},s=t.firstChild;if("MultiLayeredGraph"===s.tagName)if(s.children)for(var u=s.children,c=0;c<u.length;++c){var l=u[c];"X_definition"===l.tagName?o(l):"SpaceLayerMember"===l.tagName&&a(l)}else for(var h=s.firstElementChild;h;)"X_definition"===h.tagName?o(h):"SpaceLayerMember"===h.tagName&&a(h),h=h.nextElementSibling;return this.manager.updateLink(i),Promise.resolve(i)}}])&&lx(t.prototype,n),r&&lx(t,r),e}();function px(e){return(px="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var fx=function(){var e=function(){this.graph=[],this.queue,this.distance=[],this.previous=[]};e.prototype.setGraph=function(e){if("object"!==px(e))throw"graph isn't an object ("+px(e)+")";if(e.length<1)throw"graph is empty";for(var t in e){var n=e[t];if("object"!==px(n)||2!==n.length)throw"node must be an array and contain 2 values (name, vertices). Failed at index: "+t;var r=n[0],i=n[1];for(var o in this.graph[r]=[],i){var a=i[o];if("object"!==px(a)||2!==a.length)throw"vertex must be an array and contain 2 values (name, vertices). Failed at index: "+t+"["+o+"]";var s=a[0],u=a[1];this.graph[r][s]=u}}},e.prototype.getPath=function(e,n){if(void 0===this.graph[e])throw"source "+e+" doesn't exist";if(void 0===this.graph[n])throw"target "+n+" doesn't exist";if(e===n)return[];this.queue=new t,this.queue.add(e,0),this.previous[e]=null;for(var r=null;r=this.queue.shift();){if(r===n){for(var i=[];null!=this.previous[r];)i.unshift(r),r=this.previous[r];return i}if(this.queue.getDistance(r)==1/0)return[];var o=this.queue.getDistance(r);for(var a in this.graph[r]){var s=this.queue.getDistance(a),u=o+this.graph[r][a];u<s&&(this.queue.update(a,u),this.previous[a]=r)}}return[]};var t=function(){var e=function(){this.min=null,this.roots=[],this.nodes=[]};return e.prototype.shift=function(){var e=this.min;if(null==e||this.roots.length<1)return this.min=null,e;this.remove(e),this.roots.length>50&&this.consolidate();for(var t=1/0,n=this.roots.length,r=0;r<n;r++){var i=this.roots[r],o=this.getDistance(i);o<t&&(t=o,this.min=i)}return e},e.prototype.consolidate=function(){for(var e=[[],[],[],[],[],[],[]],t=e.length-1,n=this.roots.length,r=0;r<n;r++){var i=this.roots[r];(o=this.nodes[i].depth)<t&&e[o].push(i)}for(var o=0;o<=t;o++)for(;e[o].length>1;){var a=e[o].shift(),s=e[o].shift(),u=o+1,c=-1;this.nodes[a].distance<this.nodes[s].distance?(this.nodes[a].depth=u,this.nodes[a].children.push(s),this.nodes[s].parent=a,u<=t&&e[u].push(a),c=this.roots.indexOf(s)):(this.nodes[s].depth=u,this.nodes[s].children.push(a),this.nodes[a].parent=s,u<=t&&e[u].push(s),c=this.roots.indexOf(a)),c>-1&&this.roots.splice(c,1)}},e.prototype.add=function(e,t){this.nodes[e]={node:e,distance:t,depth:0,parent:null,children:[]},(!this.min||t<this.nodes[this.min].distance)&&(this.min=e),this.roots.push(e)},e.prototype.update=function(e,t){this.remove(e),this.add(e,t)},e.prototype.remove=function(e){if(this.nodes[e]){var t=this.nodes[e].children.length;if(t>0)for(var n=0;n<t;n++){var r=this.nodes[e].children[n];this.nodes[r].parent=this.nodes[e].parent,null==this.nodes[r].parent&&this.roots.push(r)}var i=this.nodes[e].parent;if(null==i){var o=this.roots.indexOf(e);o>-1&&this.roots.splice(o,1)}else for(;i;)this.nodes[i].depth--,i=this.nodes[i].parent}},e.prototype.getDistance=function(e){return this.nodes[e]?this.nodes[e].distance:1/0},e}();return e}();function dx(e){return(dx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mx(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function vx(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function gx(e,t){return!t||"object"!==dx(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function yx(e){return(yx=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function bx(e,t){return(bx=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function xx(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var wx="transFormGroup",_x="groundGroup",Tx={model:"ModelTransForm"};function Sx(e){return(Sx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mx(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ex(e,t){return!t||"object"!==Sx(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ax(e){return(Ax=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Px(e,t){return(Px=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ox(e){return(Ox="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Lx(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ix(e,t){return!t||"object"!==Ox(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Cx(e){return(Cx=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Rx(e,t){return(Rx=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Dx(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Nx=0,Fx=0,jx=!1,Ux={light:{id:"LightSceneManager",classer:Ag},sbm:{id:"SbmSceneManager",classer:jb},model:{id:"ModelSceneManager",classer:Wb},poi:{id:"PoiSceneManager",classer:Kb},poiNode:{id:"PoiNodeSceneManager",classer:rx},topology:{id:"TopologySceneManager",classer:function(e){function t(){var e,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=gx(this,(e=yx(t)).call.apply(e,[this].concat(Array.prototype.slice.call(arguments),["Topology"])))).dijkstras=new fx,n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bx(e,t)}(t,e),n=t,(r=[{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.radius,r=void 0===n?10:n,i=t.radiusSegments,o=void 0===i?20:i,a=t.color,s=void 0===a?65280:a,u=t.extrusionSegments,c=void 0===u?100:u,l=t.restrict,h=void 0===l?0:l,p=new Ym.MeshBasicMaterial({color:s}),f=new Ym.CatmullRomCurve3(e);f.curveType="catmullrom",f.closed=!1;var d=new Ym.TubeBufferGeometry(f,c,r,o,closed),m=new ky(d,p,{restrict:h});return Bx.scener.importObject(m,this.scene),m}},{key:"loadGml",value:function(e,t){var n=this;return new Promise((function(r,i){new hx(n).load(e,t).then(function(){var e,t=(e=regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Bx.scener.importObject(t,n.scene);case 2:return e.next=4,r(t);case 4:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){mx(o,r,i,a,s,"next",e)}function s(e){mx(o,r,i,a,s,"throw",e)}a(void 0)}))});return function(e){return t.apply(this,arguments)}}()).catch((function(e){return i(e)}))}))}},{key:"setLink",value:function(e,t,n,r,i){var o=e.getObjectByProperty("gmlid",t),a=e.getObjectByProperty("gmlid",n);void 0!==o&&void 0!==a&&3!==i&&(void 0!==i&&0!==i&&1!==i||(o.addLink(a).restrict=r),void 0!==i&&0!==i&&2!==i||(a.addLink(o).restrict=r))}},{key:"makeLink",value:function(e,t){var n=e.getObjectByProperty("gmlid",t.source),r=e.getObjectByProperty("gmlid",t.target),i=n.position,o=r.position,a=i.distanceTo(o),s=new Ym.Vector3;s.subVectors(o,i),s.normalize();var u=new Ym.CylinderGeometry(1,1,1,8);u.applyMatrix4((new Ym.Matrix4).makeRotationZ(Math.PI/180*-90)),u.applyMatrix4((new Ym.Matrix4).makeTranslation(.5,0,0)),u.computeBoundingBox();var c=new Ym.BufferGeometry;c.fromGeometry(u),c.boundingBox=u.boundingBox.clone();var l=t.material,h=new Oy(c,l);h.gmlid=t.gmlid,h.userData.id=t.gmlid,h.name=t.name,h.userData.thickness=t.thickness,h.userData.restrict=t.restrict;var p=new Ym.Vector3(1,0,0),f=(new Ym.Quaternion).setFromUnitVectors(p,s),d=(new Ym.Matrix4).makeRotationFromQuaternion(f);return h.applyMatrix4(d),h.scale.x=a,h.scale.z=t.radius,h.scale.y=t.radius,h.position.copy(i),h}},{key:"updateLink",value:function(e,t){e.traverse((function(e){e.isNode&&e.updateLink(t)}))}},{key:"makeGraph",value:function(e){var t=[];e.traverse((function(e){if(e.isNode){var n=e.makeGraph();t.push(n)}})),this.dijkstras.setGraph(t)}},{key:"getPaths",value:function(e,t,n){if(!(t.length<2)){for(var r=new Ym.CurvePath,i=0;i<t.length-1;++i){var o=this.dijkstras.getPath(t[i],t[i+1]);if(o.length){var a=e.getObjectByProperty("gmlid",t[i]),s=e.getObjectByProperty("gmlid",o[0]);r.add(new Ym.LineCurve3(a.getWorldPosition(new Ym.Vector3),s.getWorldPosition(new Ym.Vector3)));for(var u=0;u<o.length-1;++u){var c=o[u],l=o[u+1],h=e.getObjectByProperty("gmlid",c),p=e.getObjectByProperty("gmlid",l);h&&p&&r.add(new Ym.LineCurve3(h.getWorldPosition(new Ym.Vector3),p.getWorldPosition(new Ym.Vector3)))}}}if(r.curves.length){var f=new Ym.TubeGeometry(r,8,10,16,!1);new Ym.SubdivisionModifier(.1).modify(f),new Ym.MeshBasicMaterial({color:65331,wireframe:!1,transparent:!1,opacity:1});var d=f.parameters.path.getPoints();return d.unshift(n.start),d.push(n.end),this.load(d)}}}},{key:"getNearNode",value:function(e,t){var n=Number.MAX_VALUE,r=null;return e&&e.traverse((function(e){if(e.isNode){var i=e.getWorldPosition(new Ym.Vector3).clone().distanceTo(t);n>i&&(n=i,r=e)}})),r}},{key:"getShortestPath",value:function(e){var t=e.topology.sid,n=this.getById(t);this.updateLink(n.parent,e.restrict),this.makeGraph(n.parent);var r=[];for(var i in e.positions){var o=e.positions[i],a=this.getNearNode(n,new Ym.Vector3(o.x,o.y,o.z));r.push(a.gmlid)}var s=this.getPaths(n.parent,r,e.positions);if(null!=s)return s.material.color.set(e.color),Bx.scener.importObject(s,this.scene),s}}])&&vx(n.prototype,r),i&&vx(n,i),t}(wg)},other:{id:"OtherSceneManager",classer:function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t}var t,n,r;return t=e,(n=[{key:"update",value:function(){}},{key:"createGround",value:function(e){if(!e)return console.error("createGround method missing 'option'");if(!e.imgUrl)return console.error("createGround method missing 'option.imgUrl'");var t=e.imgUrl,n=e.width,r=void 0===n?500:n,i=e.height,o=void 0===i?500:i,a=e.opacity,s=void 0===a?1:a,u=e.repeat,c=void 0===u?{width:10,height:10}:u,l=e.position,h=void 0===l?{x:0,y:0,z:0}:l,p=e.rotation,f=void 0===p?{x:0,y:0,z:0}:p,d=(new Ym.TextureLoader).load(t),m=new Ym.PlaneBufferGeometry(r,o);m.computeBoundingBox();var v=new Ym.MeshStandardMaterial({side:Ym.DoubleSide,map:d,transparent:!0,opacity:s,roughness:.8}),g=new Zy(m,v,{id:"MainGround"});g.material.map.repeat.set(c.width,c.height),g.material.map.wrapS=Ym.RepeatWrapping,g.material.map.wrapT=Ym.RepeatWrapping,g.position.set(h.x,h.y,h.z),g.rotation.set(f.x-Math.PI/2,f.y,f.z);var y=this.getChildByPorp("sid",_x);return y||(y=new Fg({id:_x}),Bx.scener.importObject(y,this.scene)),Bx.scener.importObject(g,y),g}},{key:"createTransform",value:function(e,t){if(!t)return console.error("createTransform method missing option");if(!t.object)return console.error("createTransform method missing option.object");var n=t.object,r=t.onUpdate,i=t.mode,o=void 0===i?"translate":i,a=new nb(Bx.camera,Bx.rendererCSS3D.domElement,{id:e});a.attach(n),a.setMode(o),this.scene.addEventListener("preUpdate",(function(){return a.update()})),a.addEventListener("dragging-changed",(function(e){return Bx.controls.enabled=!e.value})),a.addEventListener("objectChange",(function(){r&&r(n),Bx.signals.objectChanged.dispatch(n)}));var s=this.getChildByPorp("sid",wx);return s||(s=new Fg({id:wx}),Bx.scener.importObject(s,this.scene)),Bx.scener.importObject(a,s),a}},{key:"transformModel",value:function(){return this.createTransform.apply(this,[Tx.model].concat(Array.prototype.slice.call(arguments)))}},{key:"getChildByPorp",value:function(e,t){var n=null;return"sid"!==e&&(n=[]),this.scene.traverse((function(r){if(r[e]===t){if("sid"===e)return n=r;n.push(r)}})),n}}])&&xx(t.prototype,n),r&&xx(t,r),e}()},painter:{id:"PainterSceneManager",classer:cx},helper:{id:"HelperSceneManager",classer:function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ex(this,(e=Ax(t)).call.apply(e,[this].concat(Array.prototype.slice.call(arguments),["Helper"])))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Px(e,t)}(t,e),n=t,(r=[{key:"addGridHelper",value:function(e){var t={size:1e3,divisions:20,color:"#fff"};"object"===Km(e)&&Object.assign(t,e);var n=t.size,r=t.divisions,i=t.color,o=new Ym.GridHelper(n,r,i,i);o.userData.size=n,o.userData.divisions=r,o.userData.color=i,Bx.scener.importObject(o,this.scene)}},{key:"addAxishelper",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;Bx.scener.importObject(new Ym.AxesHelper(e),this.scene)}}])&&Mx(n.prototype,r),i&&Mx(n,i),t}(wg)},effect:{id:"EffectSceneManager",classer:function(e){function t(){var e,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Ix(this,(e=Cx(t)).call.apply(e,[this].concat(Array.prototype.slice.call(arguments),["effect"])))).animate(),n.effectObjects=[],n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rx(e,t)}(t,e),n=t,(r=[{key:"disposeFire",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"fire",t=this.getByName(e);return t}},{key:"createFire",value:function(e){var t=e.texturePath,n=e.position,r=void 0===n?new Ym.Vector3(0,0,0):n,i=e.scale,o=void 0===i?new Ym.Vector3(1,1,1):i,a=e.name,s=new db({texturePath:t,position:r,scale:o,name:void 0===a?"fire":a});return Bx.scener.importObject(s,this.scene),this.effectObjects.push(s),s}},{key:"stopAnimate",value:function(){cancelAnimationFrame(this.timeId)}},{key:"animate",value:function(){var e=this;this.timeId=requestAnimationFrame((function(){for(var t=!1,n=0;n<e.effectObjects.length;++n)e.effectObjects[n].update&&(t=!0,e.effectObjects[n].update());t&&Bx.signals.geometryChanged.dispatch(),e.animate()}))}}])&&Lx(n.prototype,r),i&&Lx(n,i),t}(wg)}},Bx=null,kx=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Bx=t,this._initAllManager(),this._addEventHandeler(),this.animate()}var t,n,r;return t=e,(n=[{key:"animate",value:function(){var e=this;requestAnimationFrame((function(){e.animate()})),this.render()}},{key:"render",value:function(){jx&&this._updateManager()}},{key:"_initAllManager",value:function(){for(var e in Ux){var t=Ux[e],n=t.id,r=t.classer,i=new bg({id:n,name:n});Bx.scener.importObject(i),this["".concat(e,"Manager")]=new r(i)}}},{key:"_addEventHandeler",value:function(){jx=!1,Bx.signals.cameraChange.add((function(){jx=!0})),Bx.signals.objectAdded.add((function(){jx=!0})),Bx.signals.objectRemoved.add((function(){jx=!0}))}},{key:"_updateManager",value:function(){for(var e in Nx=performance.now(),Ux)this["".concat(e,"Manager")].update();Fx=performance.now(),Bx.signals.lodRendered.dispatch(Fx-Nx),jx=!1}}])&&Dx(t.prototype,n),r&&Dx(t,r),e}(),zx=null,Gx=null;function Vx(e,t){if(!t)return console.error("In followMouse: missing param 'object'");zx=e.viewport,Gx=e.viewport.signals,this.init(t)}function Hx(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Vx.prototype=Object.create(Ym.EventDispatcher.prototype),Vx.prototype.constructor=Vx,Vx.prototype.init=function(e){zx.controls.enabled=!1,this.obj=e,this.obj.userData.oldposition=e.position.clone(),this.oldposition=this.obj.position.clone();var t=(new Ym.Box3).setFromObject(e);this.basePoint=new Ym.Vector3((t.min.x+t.max.x)/2,t.min.y,(t.min.z+t.max.z)/2),this.x=this.onMouseDown.bind(this),zx.container.addEventListener("mousedown",this.x),this.x_1=this.onMouseMove.bind(this),zx.container.addEventListener("mousemove",this.x_1)},Vx.prototype.attach=function(e){this.init(e)},Vx.prototype.detach=function(){zx.container.removeEventListener("mousedown",this.x,!1),zx.container.removeEventListener("mousemove",this.x_1,!1),zx.container.removeEventListener("keydown",this.x_2,!1),this.obj.position.copy(this.obj.userData.oldposition.clone()),Gx.objectChanged.dispatch()},Vx.prototype.GetParentTopIndoor=function(e,t){return e.parent&&e.parent.userData.type===t?e.parent:e.parent&&e.parent.userData.type!=t?this.GetParentTopIndoor(e.parent,t):void 0},Vx.prototype.MouseToWorld=function(e){for(var t=zx.getIntersects(e,zx.scener.intersectsList.getAll()),n=0;n<t.length;n++){if(this.GetParentTopIndoor(t[n].object,this.obj.userData.type)!=this.obj)return t[n].point}},Vx.prototype.onMouseDown=function(e){if(e.preventDefault(),3==e.which&&this.detach(),1==e.which){var t=this.MouseToWorld(e);null!=t&&this.obj.position.copy(t.clone().sub(this.basePoint.clone()).add(this.oldposition.clone())),this.x_up=this.onMouseUp.bind(this),zx.container.addEventListener("mouseup",this.x_up,!1),zx.container.removeEventListener("mousedown",this.x,!1),zx.container.removeEventListener("mousemove",this.x_1,!1),zx.container.removeEventListener("keydown",this.x_2,!1)}},Vx.prototype.onMouseUp=function(e){e.stopImmediatePropagation(),zx.controls.enabled=!0,this.dispatchEvent({type:"end",object:{model:this.obj,oldPos:this.obj.userData.oldposition,newPos:this.obj.position}}),zx.container.removeEventListener("mouseup",this.x_up,!1)},Vx.prototype.onMouseMove=function(e){e.preventDefault();var t=this.MouseToWorld(e);null!=t&&this.obj.position.copy(t.clone().sub(this.basePoint.clone()).add(this.oldposition.clone())),Gx.objectChanged.dispatch()};var Wx="copyModelHelperLine",Xx=null,Yx=null,qx=null,Qx=null,Zx=[];function Kx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Jx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kx(Object(n),!0).forEach((function(t){$x(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ew(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function tw(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function nw(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var rw=null,iw={Viewport:ag,Manager:kx,Command:{FollowMouse:Vx,CopyModel:function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Xx=t,Yx=t.viewport,Qx=n,this.option=Object.assign({mode:null,copyNumber:3,rowNumber:3,rowSpace:0,colNumber:3,colSpace:0,layerNumber:3,layerSpace:0},r),this.startPoint=null,this.endPoint=null,this.onProgress=i,this.onDone=o,this._start()}var t,n,r;return t=e,(n=[{key:"cancel",value:function(){Zx.length>0&&Zx.map((function(e){e.parent&&e.parent.remove(e)})),Qx=null,Zx=[]}},{key:"_start",value:function(){var e=this;Yx._setMouseDownEnabled(!0),Yx.signals.mouseDown.addOnce((function(t){if(Xx.viewport.controls.enabled=!1,t.length>0){var n=t[0].point;n.y+=2,e.startPoint=n,Yx._setMouseMoveEnabled(!0),Yx._setMouseUpEnabled(!0)}})),Yx.signals.mouseMove.add(this.mouseMove.bind(this)),Yx.signals.mouseUp.addOnce((function(){Xx.viewport.controls.enabled=!0,Xx.removePainterById(Wx),e._cloneNewObject()}))}},{key:"mouseMove",value:function(e){if(this.startPoint&&e.length>0){var t=e[0].point;switch(t.y+=2,this.option.mode){case"row":t.x=this.startPoint.x,t.y=this.startPoint.y;break;case"col":t.y=this.startPoint.y,t.z=this.startPoint.z;break;default:t.y=this.startPoint.y}this.endPoint=t,qx&&Xx.removePainterById(Wx),qx=Xx.renderLine({points:[this.startPoint,this.endPoint],id:Wx,color:"red"})}}},{key:"_clearData",value:function(){Yx.signals.mouseMove.remove(this.mouseMove),Yx._setMouseDownEnabled(!1),Yx._setMouseMoveEnabled(!1),Yx._setMouseUpEnabled(!1),Xx=null,Yx=null,qx=null,this.startPoint=null,this.endPoint=null,this.onProgress=null,this.onDone=null}},{key:"_cloneNewObject",value:function(){var e=nv(Qx),t=e.max.x-e.min.x,n=e.max.z-e.min.z,r=this.option,i=r.mode,o=r.copyNumber,a=r.rowNumber,s=r.rowSpace,u=r.colNumber,c=r.colSpace,l=r.layerNumber,h=r.layerSpace,p=Qx.position.y,f=this.startPoint,d=f.x,m=f.z;switch(i){case"row":for(var v=0;v<o;v++){var g=Qx.clone();m-this.endPoint.z>=0?g.position.set(d,p,m-(c+n)*v):g.position.set(d,p,m+(c+n)*v),Zx.push(g),Yx.scener.importObject(g,Qx.parent);var y=v/(o-1);this.onProgress&&this.onProgress(y),1===y&&(this.onDone&&this.onDone({object:Qx,newObjects:Zx}),this._clearData())}break;case"col":for(var b=0;b<o;b++){var x=Qx.clone();d-this.endPoint.x>=0?x.position.set(d-(s+t)*b,p,m):x.position.set(d+(s+t)*b,p,m),Zx.push(x),Yx.scener.importObject(x,Qx.parent);var w=b/(o-1);this.onProgress&&this.onProgress(w),1===w&&(this.onDone&&this.onDone({object:Qx,newObjects:Zx}),this._clearData())}break;case"matrix":this.option.copyNumber=a*u;for(var _=0;_<a;_++)for(var T=0;T<u;T++){var S=Qx.clone(),M=null,E=null;M=d-this.endPoint.x>=0?d-(s+t)*_:d+(s+t)*_,E=m-this.endPoint.z>=0?m-(c+n)*T:m+(c+n)*T,S.position.set(M,p,E),Zx.push(S),Yx.scener.importObject(S,Qx.parent);var A=(_*u+T+1)/this.option.copyNumber;this.onProgress&&this.onProgress(A),1===A&&(this.onDone&&this.onDone({object:Qx,newObjects:Zx}),this._clearData())}break;case"matrix3D":var P=e.max.y-e.min.y;this.option.copyNumber=a*u*l;for(var O=0;O<l;O++)for(var L=0;L<a;L++)for(var I=0;I<u;I++){var C,R=Qx.clone(),D=null,N=null;D=d-this.endPoint.x>=0?d-(s+t)*L:d+(s+t)*L,N=m-this.endPoint.z>=0?m-(c+n)*I:m+(c+n)*I,C=p+(h+P)*O,R.position.set(D,C,N),Zx.push(R),Yx.scener.importObject(R,Qx.parent);var F=(O*a*u+L*u+I+1)/this.option.copyNumber;this.onProgress&&this.onProgress(F),1===F&&(this.onDone&&this.onDone({object:Qx,newObjects:Zx}),this._clearData())}break;default:for(var j=0;j<o;j++){var U=Qx.clone(),B=null,k=null;B=d-this.endPoint.x>=0?d-(s+t)*j:d+(s+t)*j,k=m-this.endPoint.z>=0?m-(c+n)*j:m+(c+n)*j,U.position.set(B,p,k),Zx.push(U),Yx.scener.importObject(U,Qx.parent);var z=j/(o-1);this.onProgress&&this.onProgress(z),1===z&&(this.onDone&&this.onDone({object:Qx,newObjects:Zx}),this._clearData())}}}}])&&Hx(t.prototype,n),r&&Hx(t,r),e}(),Measure:function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ssp=t,this.mode=null}var t,n,r;return t=e,(n=[{key:"measureLine",value:function(e){var t=this;this.mode="measureLine";var n=e.onSelectPoint;delete e.onSelectPoint;var r=function(n){for(var r=n.points,i=n.line,o=[],a=0;a<r.length-1;a++){var s=r[a].clone(),u=r[a+1].clone(),c=s.clone().add(u).multiplyScalar(.5);c.y+=e.offsetY||1;var l=Math.abs(s.distanceTo(u)).toFixed(2);o.push(Number(l));var h=t._createText({position:c,text:l});t.ssp.viewport.scener.importObject(h,i)}return o},i=null,o=Object.assign(e,{onSelectPoint:function(e){e.points.length>1&&(i=r(e),n&&n({distList:i,points:e.points}))},onMoving:r});return this.ssp.drawLine(o).then((function(e){return Promise.resolve(Jx({},e,{distList:i}))}))}},{key:"measureHeight",value:function(e){var t=this;return new Promise((function(n){var r=e.onSelectPoint;delete e.onSelectPoint,e.offsetY=1;var i=[],o=null;t.ssp.viewport._setStateProp("clickEnabled",!0);var a=function(n){t.ssp.viewport.controls.enabled=!1;var r=n.intersects;r.length>0&&0===i.length&&(i.push(r[0].point.clone()),i.push(r[0].point.clone()),o=t.ssp.renderLine(Object.assign(e,{points:i})),t.ssp.viewport._setStateProp("mouseWheelEnabled",!0),t.ssp.viewport._setStateProp("dblClickEnabled",!0))},s=null,u=function(n){var a=n.event;i[1].y+=a.deltaY/10,o.updatePoints(i);var u=i[0].clone().add(i[1]).multiplyScalar(.5);u.y+=e.offsetY,s=Number(Math.abs(i[0].distanceTo(i[1])).toFixed(2));var c=t._createText({position:u,text:s});t.ssp.viewport.scener.importObject(c,o),r({dist:s,line:o})};t.ssp.viewport.signals.click.add(a),t.ssp.viewport.signals.mouseWheel.add(u),t.ssp.viewport.signals.dblClick.add((function e(){t.ssp.viewport.controls.enabled=!0,t.ssp.viewport.signals.click.remove(a),t.ssp.viewport.signals.mouseWheel.remove(u),t.ssp.viewport.signals.dblClick.remove(e),n({dist:s,line:o})}))}))}},{key:"measureFace",value:function(e){var t=this;this.mode="measureFace";var n=e.onSelectPoint;delete e.onSelectPoint;var r=function(e){var n=e.face,r=null,i=0,o=[];return n.children.map((function(e){e.geometry.computeBoundingBox();var a=e.geometry,s=a.vertices,u=a.boundingBox,c=s[0].distanceTo(s[1]),l=s[1].distanceTo(s[2]),h=s[2].distanceTo(s[0]);i+=Number(t.ssp.utils.triangleArea(c,l,h).toFixed(2)),o.push(u.getCenter());var p=null;if(1===o.length&&(p=o[0]),2===o.length)p=o[0].add(o[1]).multiplyScalar(.5);else{var f=new Ym.Geometry;o.map((function(e){return f.vertices.push(e)})),f.computeVertexNormals(),f.computeBoundingBox(),p=f.boundingBox.getCenter()}r&&n.remove(r),r=t._createText({position:p,text:i}),t.ssp.viewport.scener.importObject(r,n)})),Number(i.toFixed(2))},i=null,o=Object.assign(e,{onSelectPoint:function(e){e.points.length>2&&(i=r(e),n&&n({area:i,points:e.points}))},onMoving:r});return this.ssp.drawFace(o).then((function(e){return Promise.resolve(Jx({},e,{area:i}))}))}},{key:"_createText",value:function(e){var t=this.ssp.utils.CanvasText(e),n=new Ym.Texture(t);n.generateMipMaps=!1,n.needsUpdate=!0;var r=new Ym.SpriteMaterial({map:n,depthTest:!0,alphaTest:.1});return r.map.flipY=!0,new this.ssp.library.Text2D(r,e)}}])&&ew(t.prototype,n),r&&ew(t,r),e}(),BlastModel:function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),rw=t,this.object=n,this.scalar=r,this.modelBox3=null,this.update(n,r)}var t,n,r,i,o;return t=e,(n=[{key:"update",value:function(e,t){var n=this;this.setObject(e),t&&(this.scalar=t),this.modelBox3||(this.modelBox3=(new Ym.Box3).expandByObject(e));var r=(new Ym.Vector3).addVectors(this.modelBox3.max,this.modelBox3.min).multiplyScalar(.5);e.traverse((function(e){if(e.isMesh){if(!e.userData.worldDir){var t=new Ym.Box3;t.setFromObject(e);var i=(new Ym.Vector3).addVectors(t.max,t.min).multiplyScalar(.5);e.userData.worldDir=(new Ym.Vector3).subVectors(i,r).normalize(),e.userData.oldPosition=e.position.clone()}e.position.copy((new Ym.Vector3).copy(e.userData.oldPosition).add((new Ym.Vector3).copy(e.userData.worldDir).multiplyScalar(n.scalar)))}})),rw.viewport.signals.objectChanged.dispatch()}},{key:"setObject",value:(i=regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.object){e.next=7;break}if(this.object.uuid!==t.uuid){e.next=3;break}return e.abrupt("return");case 3:this.close(),this.object=t,e.next=8;break;case 7:this.object=t;case 8:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(n,r){var o=i.apply(e,t);function a(e){tw(o,n,r,a,s,"next",e)}function s(e){tw(o,n,r,a,s,"throw",e)}a(void 0)}))},function(e){return o.apply(this,arguments)})},{key:"close",value:function(){this.object.traverse((function(e){e.isMesh&&e.userData.oldPosition&&(e.position.copy(e.userData.oldPosition),delete e.userData.worldDir,delete e.userData.oldPosition)})),this.object=null,this.scalar=null,this.modelBox3=null,rw.viewport.signals.objectChanged.dispatch()}}])&&nw(t.prototype,n),r&&nw(t,r),e}()},Library:i,Animation:ev};var ow={imgTag2Base64:function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0,e.width,e.height);var n=e.getAttribute("src"),r=n.slice(n.lastIndexOf(".")+1),i=t.toDataURL("image/"+r);return t=null,i},imgUrl2Base64:function(e){return new Promise((function(t){var n=document.createElement("canvas"),r=n.getContext("2d"),i=new Image;i.crossOrigin="Anonymous",i.src=e,i.onload=function(){n.width=i.width,n.height=i.height,r.drawImage(i,0,0,i.width,i.height);var o=e.slice(e.lastIndexOf(".")+1),a=n.toDataURL("image/"+o);n=null,t(a)}}))}};var aw={strideOverCompute:function(e,t){for(var n=e.x,r=e.z,i=0,o=0,a=t.length,s=a-1;o<a;s=o,o++){var u=t[o].x,c=t[o].z,l=t[s].x,h=t[s].z;if((u-n)*(n-l)>=0&&(c-r)*(r-h)>=0&&(n-u)*(h-c)==(r-c)*(l-u))return"on";var p=Math.atan2(c-r,u-n)-Math.atan2(h-r,l-n);p>=Math.PI?p-=2*Math.PI:p<=-Math.PI&&(p+=2*Math.PI),i+=p}return 0===Math.round(i/Math.PI)?"out":"in"},triangleArea:function(e,t,n){var r=(e+t+n)/2;return Math.sqrt(r*(r-e)*(r-t)*(r-n))}};var sw=Object.assign($m,iv,ow,aw,Ig,{soonXhr:Pg,CanvasText:py,debounce:function(e,t){var n;return function(){var r=arguments,i=this;n&&clearTimeout(n),n=setTimeout((function(){e.apply(i,r)}),t)}},log:function(e,t){var n="";for(var r in t)n+="".concat(r,": ").concat(t[r],";");console.log("%c".concat(e),n)}});function uw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function cw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?uw(Object(n),!0).forEach((function(t){lw(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uw(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function lw(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var hw={_init:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=document.querySelector(e);if(!i)throw new Error('No element found by "'.concat(e,'" in SoopSpace constructor ! '));if(sw.log("SoonSpace.js",{color:"#3eaf7c","font-size":"24px"}),sw.log("当前版本: ".concat(this.version),{color:"#3eaf7c","font-size":"12px"}),sw.log("文档: http://www.xwbuilders.com:9018/soonspacejs/Docs/",{color:"#3eaf7c","font-size":"12px"}),(n=cw({showInfo:!1,showGrid:!1,backgroundAlpha:!1,backgroundColor:3355392,hoverEnabled:!1,closeWarnLog:!0,fog:null,useIndexedDB:!0},n)).useIndexedDB&&!window.indexedDB&&(n.useIndexedDB=!1,window.console.warn("Your browser doesn't support a stable version of IndexedDB. Such and such feature will not be available.")),n.closeWarnLog&&(window.console.warn=function(){}),this.viewport=new iw.Viewport(n),this.manager=new iw.Manager(this.viewport),this.command=iw.Command,this.library=iw.Library,this.utils=sw,n.showGrid&&this.addGridHelper(n.showGrid),n.fog&&this.openSceneFog(n.fog),n.backgroundColor&&this.setBackgroundColor(n.backgroundColor),i.appendChild(this.viewport.container),r){var o=r.modelHover,a=r.modelClick,s=r.modelRightClick,u=r.modelDblClick,c=r.poiHover,l=r.poiClick,h=r.poiRightClick,p=r.poiDblClick,f=r.selectPosition;o&&this.viewport.signals.modelHover.add(o),a&&this.viewport.signals.modelClick.add(a),s&&this.viewport.signals.modelRightClick.add(s),u&&this.viewport.signals.modelDblClick.add(u),c&&this.viewport.signals.poiHover.add(c),l&&this.viewport.signals.poiClick.add(l),h&&this.viewport.signals.poiRightClick.add(h),p&&this.viewport.signals.poiDblClick.add(p),f&&this.viewport.signals.selectPosition.add(f)}var d=function(e){r&&r.resize&&r.resize(e),t.viewport.signals.windowResize.dispatch()};window.addEventListener("resize",d,!1),d(),this.setDefaultLight()}},pw={loadGml:function(){var e;return(e=this.manager.topologyManager).loadGml.apply(e,arguments)},loadTopology:function(){var e;return(e=this.manager.topologyManager).load.apply(e,arguments)},getTopologyById:function(e){return this.manager.topologyManager.getById(e)},getShortestPath:function(e){return this.manager.topologyManager.getShortestPath(e)},clearTopology:function(){return this.manager.topologyManager.clear()},findShortestPathByPosition:function(e){if(null!=e&&null!=e.topologyID&&null!=e.positions&&!(e.positions.length<2)){var t=this.viewport.getChildByUserData(this.viewport.scene,"id",e.topologyID,!0);this.viewport.topologyManager.updateLink(t,e.restrict),this.viewport.topologyManager.makeGraph(t);for(var n=[],r=0;r<e.positions.length;++r){var i=e.positions[r].position,o=s(t,new Ym.Vector3(i.x,i.y,i.z),e.positions[r].floorId,e.positions[r].longname);n.push(o.gmlid)}var a=this.viewport.topologyManager.getPaths(t,n);return null!=a?(this.viewport.importObject(a,t.parent),a):void 0}function s(e,t,n,r){var i,o=Number.MAX_VALUE,a=function(e,t,n){for(var r=0;r<e.children.length;++r){var i=e.children[r];if(n&&i.userData.id===n)return i;if(i.userData.id===t)return i}}(e,n,r);if(a)for(var s=0;s<a.children.length;++s){var u=a.children[s];if(u.isNode){var c=u.getWorldPosition().clone().distanceTo(t);o>c&&(o=c,i=u)}}return i}},showTopologyByType:function(e){if(null!=e.topologyID&&null!=e.type&&null!=e.visible){var t=this.viewport,n=t.getChildByUserData(t.scene,"id",e.topologyID,!0);n&&n.traverse((function(t){var n=-1;n=t.isNode?1:t.isLink?2:-1,(e.type===n||0===e.type&&n>0)&&(t.visible=e.visible)}))}},removeTopology:function(e){var t=this.viewport,n=t.getChildByUserData(t.scene,"id",e,!0);n&&t.removeObject(n)},findShortestPathById:function(e){if(null!=e&&null!=e.topologyID){var t=this.viewport,n=t.scene.getObjectById(e.toplogyID);t.topologyManager.makeGraph(n);var r=t.topologyManager.getPaths(n,e.startGMLID,e.endGMLID);return t.importObject(n.parent,r),r}},removePathByUUID:function(e){if(null!=e){var t=this.viewport.getChildByProperty(this.viewport.scene,"uuid",e,!0);t&&(this.viewport.removeGeometry(t.geometry),t.material.map&&this.viewport.removeTexture(t.material.map.sourceFile),this.viewport.removeMaterial(t.material.uuid),this.viewport.removeObject(t))}},setPathColor:function(e,t){if(null!=e){var n=this.viewport.getChildByProperty(this.viewport.scene,"uuid",e,!0);n&&n.material.map&&n.material.map.color.set(t.color)}},showPath:function(e,t){if(null!=e){var n=this.viewport.getChildByProperty(this.viewport.scene,"uuid",e,!0);n&&(n.visible=t)}},checkHandicappedPath:function(){var e=this.viewport.topologyManager.restrict_bit;return!e||4&e},getDistanceOfPath:function(e){if(null!=e){var t=this.viewport.getChildByProperty(this.viewport.scene,"uuid",e,!0);return t?t.geometry.parameters.path.getLength():0}},followPath:function(e){switch(e.cmd){case 1:if(e.pathUUID){var t=this.viewport.getChildByProperty(this.viewport.scene,"uuid",e.pathUUID,!0);t&&(this.viewport.topologyManager.stop(),this.viewport.enable=!1,this.viewport.stopAnimate(),this.viewport.topologyManager.path=t.geometry,this.viewport.topologyManager.speed=e.speed,this.viewport.topologyManager.DriveMode=e.mode,this.viewport.topologyManager.DrivePoi=e.poi,this.viewport.topologyManager.enableAutoLookAt=e.lookat,this.viewport.topologyManager.start())}break;case 2:this.viewport.topologyManager.pause();break;case 3:this.viewport.topologyManager.stop(),-1==this.viewport.renderRequestId&&(this.viewport.enable=!0,this.viewport.animate())}}},fw=Object.assign({setDefaultLight:function(){this.createAmbientLight({color:10132122,name:"MainAmbientLight"}),this.createDirectionalLight({color:16777215,intensity:1,name:"MainDirectionalLight",direction:{x:1,y:.5,z:.8}})},createAmbientLight:function(e){return this.manager.lightManager.createAmbientLight(e)},createDirectionalLight:function(e){return this.manager.lightManager.createDirectionalLight(e)},createHemisphereLight:function(e){return this.manager.lightManager.createHemisphereLight(e)},createSpotLight:function(e){return this.manager.lightManager.createSpotLight(e)},createRectLight:function(e){return this.manager.lightManager.createRectLight(e)},createLEDLight:function(e){return this.manager.lightManager.createLEDLight(e)}},{loadSbm:function(){var e;return(e=this.manager.sbmManager).load.apply(e,arguments)},cloneSbm:function(){var e;return(e=this.manager.sbmManager).clone.apply(e,arguments)},parseSbm:function(){var e;return(e=this.manager.sbmManager).parse.apply(e,arguments)},getSbmById:function(){var e;return(e=this.manager.sbmManager).getById.apply(e,arguments)},getSbmByName:function(){var e;return(e=this.manager.sbmManager).getByName.apply(e,arguments)},getSbmByUserDataProperty:function(){var e;return(e=this.manager.sbmManager).getByUserDataProperty.apply(e,arguments)},removeSbmById:function(){var e;return(e=this.manager.sbmManager).removeById.apply(e,arguments)},loadSbmToGroup:function(){var e;return(e=this.manager.sbmManager).loadToGroup.apply(e,arguments)},addSbmForGroup:function(){var e;return(e=this.manager.sbmManager).addForGroup.apply(e,arguments)},getSbmGroupById:function(){var e;return(e=this.manager.sbmManager).getGroupById.apply(e,arguments)},getSbmGroupByName:function(){var e;return(e=this.manager.sbmManager).getGroupByName.apply(e,arguments)},removeSbmGroupById:function(){var e;return(e=this.manager.sbmManager).removeGroupById.apply(e,arguments)},loadXml:function(){var e;return(e=this.manager.sbmManager).loadXml.apply(e,arguments)},clearSbm:function(){var e;return(e=this.manager.sbmManager).clear.apply(e,arguments)},showAllSbm:function(){return this.manager.sbmManager.showAll()},hideAllSbm:function(){return this.manager.sbmManager.hideAll()}},{loadModel:function(){var e;return(e=this.manager.modelManager).load.apply(e,arguments)},parseModel:function(){var e;return(e=this.manager.modelManager).parse.apply(e,arguments)},getModelById:function(){var e;return(e=this.manager.modelManager).getById.apply(e,arguments)},getModelByName:function(){var e;return(e=this.manager.modelManager).getByName.apply(e,arguments)},getModelByUserDataProperty:function(){var e;return(e=this.manager.modelManager).getByUserDataProperty.apply(e,arguments)},removeModelById:function(){var e;return(e=this.manager.modelManager).removeById.apply(e,arguments)},loadModelToGroup:function(){var e;return(e=this.manager.modelManager).loadToGroup.apply(e,arguments)},addModelForGroup:function(){var e;return(e=this.manager.modelManager).addForGroup.apply(e,arguments)},getModelGroupById:function(){var e;return(e=this.manager.modelManager).getGroupById.apply(e,arguments)},getModelGroupByName:function(){var e;return(e=this.manager.modelManager).getGroupByName.apply(e,arguments)},removeModelGroupById:function(){var e;return(e=this.manager.modelManager).removeGroupById.apply(e,arguments)},clearModel:function(){return this.manager.modelManager.clear()},showAllModel:function(){return this.manager.modelManager.showAll()},hideAllModel:function(){return this.manager.modelManager.hideAll()}},{createPoi:function(e){return this.manager.poiManager.create(e)},getPoiById:function(e){return this.manager.poiManager.getById(e)},getPoiByName:function(e){return this.manager.poiManager.getByName(e)},getPoiByUserDataProperty:function(){var e;return(e=this.manager.poiManager).getByUserDataProperty.apply(e,arguments)},removePoiById:function(e){return this.manager.poiManager.removeById(e)},createPoiToGroup:function(){var e;return(e=this.manager.poiManager).createToGroup.apply(e,arguments)},addPoiForGroup:function(){var e;return(e=this.manager.poiManager).addForGroup.apply(e,arguments)},getPoiGroupById:function(e){return this.manager.poiManager.getGroupById(e)},getPoiGroupByName:function(e){return this.manager.poiManager.getGroupByName(e)},removePoiGroupById:function(e){return this.manager.poiManager.removeGroupById(e)},clearPoi:function(){return this.manager.poiManager.clear()},showAllPoi:function(){return this.manager.poiManager.showAll()},hideAllPoi:function(){return this.manager.poiManager.hideAll()}},{createPoiNode:function(){var e;return(e=this.manager.poiNodeManager).create.apply(e,arguments)},getPoiNodeById:function(e){return this.manager.poiNodeManager.getById(e)},getPoiNodeByName:function(e){return this.manager.poiNodeManager.getByName(e)},getPoiNodeByUserDataProperty:function(){var e;return(e=this.manager.poiNodeManager).getByUserDataProperty.apply(e,arguments)},removePoiNodeById:function(e){return this.manager.poiNodeManager.removeById(e)},createPoiNodeToGroup:function(){var e;return(e=this.manager.poiNodeManager).createToGroup.apply(e,arguments)},addPoiNodeForGroup:function(){var e;return(e=this.manager.poiNodeManager).addForGroup.apply(e,arguments)},getPoiNodeGroupById:function(e){return this.manager.poiNodeManager.getGroupById(e)},getPoiNodeGroupByName:function(e){return this.manager.poiNodeManager.getGroupByName(e)},removePoiNodeGroupById:function(e){return this.manager.poiNodeManager.removeGroupById(e)},clearPoiNode:function(){return this.manager.poiNodeManager.clear()},showAllPoiNode:function(){return this.manager.poiNodeManager.showAll()},hideAllPoiNode:function(){return this.manager.poiNodeManager.hideAll()}},pw,{addGridHelper:function(){var e;(e=this.manager.helperManager).addGridHelper.apply(e,arguments)},addAxishelper:function(){var e;(e=this.manager.helperManager).addAxishelper.apply(e,arguments)}},{drawPoints:function(){var e;return(e=this.manager.painterManager).drawPoints.apply(e,arguments)},drawLine:function(){var e;return(e=this.manager.painterManager).drawLine.apply(e,arguments)},drawFace:function(){var e;return(e=this.manager.painterManager).drawFace.apply(e,arguments)},drawFence:function(){var e;return(e=this.manager.painterManager).drawFence.apply(e,arguments)},renderPoints:function(){var e;return(e=this.manager.painterManager).renderPoints.apply(e,arguments)},renderLine:function(){var e;return(e=this.manager.painterManager).renderLine.apply(e,arguments)},renderFace:function(){var e;return(e=this.manager.painterManager).renderFace.apply(e,arguments)},renderFence:function(){var e;return(e=this.manager.painterManager).renderFence.apply(e,arguments)},getPainterById:function(e){return this.manager.painterManager.getById(e)},getPainterByName:function(e){return this.manager.painterManager.getByName(e)},getPainterByUserDataProperty:function(){var e;return(e=this.manager.painterManager).getByUserDataProperty.apply(e,arguments)},removePainterById:function(e){return this.manager.painterManager.removeById(e)},clearPainter:function(){return this.manager.painterManager.clear()},showAllPainter:function(){return this.manager.painterManager.showAll()},hideAllPainter:function(){return this.manager.painterManager.hideAll()}},{createFire:function(){var e;return(e=this.manager.effectManager).createFire.apply(e,arguments)},clearEffect:function(){return this.manager.effectManager.clear()}},{transformModel:function(){var e;return(e=this.manager.otherManager).transformModel.apply(e,arguments)},createTransform:function(){var e;return(e=this.manager.otherManager).createTransform.apply(e,arguments)},createGround:function(){var e;return(e=this.manager.otherManager).createGround.apply(e,arguments)}});function dw(e,t,n){return(dw=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&mw(i,n.prototype),i}).apply(null,arguments)}function mw(e,t){return(mw=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var vw=null,gw=null,yw=null,bw={followMouse:function(e){return new this.command.FollowMouse(this,e)},copyModel:function(e,t,n){var r=this;return new Promise((function(i){vw=new r.command.CopyModel(r,e,t,n,(function(e){return i(e)}))}))},cancelCopyModel:function(){vw&&(vw.cancel(),vw=null)},measureLine:function(){var e;return gw||(gw=new this.command.Measure(this)),(e=gw).measureLine.apply(e,arguments)},measureHeight:function(){var e;return gw||(gw=new this.command.Measure(this)),(e=gw).measureHeight.apply(e,arguments)},measureFace:function(){var e;return gw||(gw=new this.command.Measure(this)),(e=gw).measureFace.apply(e,arguments)},blastModel:function(){var e;yw?(e=yw).update.apply(e,arguments):yw=dw(this.command.BlastModel,[this].concat(Array.prototype.slice.call(arguments)))},closeBlastModel:function(){yw&&(yw.close(),yw=null)}},xw={edgeShow:function(){var e;return(e=this.viewport.scener).addSelectedObjectForEdge.apply(e,arguments)},unEdgeShow:function(){var e;return(e=this.viewport.scener).unSelectedObjectForEdge.apply(e,arguments)},opacityShow:function(){var e;return(e=this.viewport.scener).addSelectedObjectForOpacity.apply(e,arguments)},unOpacityShow:function(){var e;return(e=this.viewport.scener).unSelectedObjectForOpacity.apply(e,arguments)},emissiveShow:function(){var e;return(e=this.viewport.scener).addSelectedObjectForEmissive.apply(e,arguments)},unEmissiveShow:function(){var e;return(e=this.viewport.scener).unSelectedObjectForEmissive.apply(e,arguments)},closeSceneFog:function(){return this.viewport.scener.closeFog()},openSceneFog:function(){var e;return(e=this.viewport.scener).openFog.apply(e,arguments)},enable2DMode:function(){var e;return(e=this.viewport.scener).enable2DMode.apply(e,[this.manager].concat(Array.prototype.slice.call(arguments)))}},ww={getCameraViewpoint:function(){var e;return(e=this.viewport.cameraControlerManager).getCameraViewpoint.apply(e,arguments)},setCameraViewpoint:function(){var e;return(e=this.viewport.cameraControlerManager).setCameraViewpoint.apply(e,arguments)},autoPatrol:function(){var e;return(e=this.viewport.cameraControlerManager.controlsManager.pointLineFollower).followPointPath.apply(e,Array.prototype.slice.call(arguments).concat([this.manager]))},pauseAutoPatrol:function(){return this.viewport.cameraControlerManager.controlsManager.pointLineFollower.pause()},stopAutoPatrol:function(){return this.viewport.cameraControlerManager.controlsManager.pointLineFollower.stop()},startFirstPerson:function(){var e;return(e=this.viewport.cameraControlerManager.controlsManager.firstPersonControl).open.apply(e,arguments)},stopFirstPerson:function(){return this.viewport.cameraControlerManager.controlsManager.firstPersonControl.close()},flyMainViewpoint:function(){return this.flyToObj.apply(this,[this.viewport.scene].concat(Array.prototype.slice.call(arguments)))},flyTo:function(){var e;return(e=this.viewport.controls).flyTo.apply(e,arguments)},flyToObj:function(){var e;return(e=this.viewport.controls).flyToObj.apply(e,arguments)},flyToBoundingBox:function(){var e;return(e=this.viewport.controls).flyToBoundingBox.apply(e,arguments)},surroundOnTarget:function(){var e;return(e=this.viewport.controls).surroundOnTarget.apply(e,arguments)},surroundOnObject:function(){var e;return(e=this.viewport.controls).surroundOnObject.apply(e,arguments)},getObjectLabelPos:function(){var e;return(e=this.viewport.controls)._getObjectLabelPos.apply(e,arguments)}},_w=Object.assign(xw,ww,{xAxisClipping:function(e){return this.viewport.rendererManager.xAxisClipping(e)},changexAxisClipping:function(e){return this.viewport.rendererManager.changexAxisClipping(e)},yAxisClipping:function(e){return this.viewport.rendererManager.yAxisClipping(e)},changeyAxisClipping:function(e){return this.viewport.rendererManager.changeyAxisClipping(e)},zAxisClipping:function(e){return this.viewport.rendererManager.zAxisClipping(e)},changezAxisClipping:function(e){return this.viewport.rendererManager.changezAxisClipping(e)},removeClipping:function(e){return this.viewport.rendererManager.removeClipping(e)}},{nextRender:function(e){return this.viewport.nextRender(e)},clear:function(){for(var e in this.manager)"Light"!==this.manager[e].type&&this.manager[e].clear&&this.manager[e].clear()},setHoverEnabled:function(e){return this.viewport.setHoverEnabled(e)},setSkyBackground:function(){var e;return(e=this.viewport).setSkyBackground.apply(e,arguments)},setBackgroundColor:function(e){return this.viewport.setBackgroundColor(e)},setBackgroundImage:function(e){return this.viewport.setBackgroundImage(e)}}),Tw={animation:function(){return iw.Animation.apply(iw,arguments)}},Sw=Object.assign(hw,fw,bw,{strideOverCompute:function(){var e;return(e=this.utils).strideOverCompute.apply(e,arguments)}},_w,Tw),Mw=n(439);function Ew(e){this.version=Mw.version;var t=e.el,n=e.option,r=e.events;this._init(t,n,r)}!function(e){for(var t in e)Ew[t]&&console.warn("In SoonSpace: ".concat(t," method rename, Please check!")),Ew.prototype[t]=e[t]}(Sw),window.SoonSpace=Ew;t.default=Ew}])}));